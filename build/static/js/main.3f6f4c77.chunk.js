(this["webpackJsonpAgora-Edu-Web"]=this["webpackJsonpAgora-Edu-Web"]||[]).push([[0],{229:function(e,t,r){},271:function(e,t,r){e.exports=function(){return new Worker(r.p+"1336a3d3db7ce3347ba1.worker.js")}},304:function(e,t,r){e.exports=r(618)},311:function(e,t,r){},315:function(e,t,r){},358:function(e,t){},360:function(e,t){},384:function(e,t){},406:function(e,t,r){},407:function(e,t,r){},408:function(e,t,r){},430:function(e,t,r){},431:function(e,t,r){},432:function(e,t,r){},433:function(e,t,r){},434:function(e,t,r){},435:function(e,t,r){},600:function(e,t,r){},601:function(e,t,r){},602:function(e,t,r){},603:function(e,t,r){},604:function(e,t,r){},605:function(e,t,r){},606:function(e,t,r){},607:function(e,t,r){},608:function(e,t,r){},609:function(e,t,r){},610:function(e,t,r){},611:function(e,t,r){},613:function(e,t,r){},618:function(e,t,r){"use strict";r.r(t);r(305);var a=r(0),n=r.n(a),o=r(27),i=r.n(o),s=(r(311),r(43)),c=r(39),u=r(650),l=r(288),p=Object(l.a)({typography:{fontFamily:'-apple-system, BlinkMacSystemFont, \\"Segoe UI\\", \\"Roboto\\", \\"Oxygen\\", \\"Ubuntu\\", \\"Cantarell\\", \\"Fira Sans\\", \\"Droid Sans\\", \\"Helvetica Neue\\", sans-serif',fontSize:14,fontWeightLight:300,fontWeightRegular:400,fontWeightMedium:500},overrides:{MuiRadio:{root:{padding:"4px"}},MuiSvgIcon:{root:{width:"1rem",height:"1rem"}},MuiFormControl:{root:{margin:"0.3rem 0"}},MuiInput:{underline:{"&:before":{borderBottom:"1px solid #EAEAEA"},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:"2px solid #EAEAEA"},"&$focused":{"&:after":{borderBottom:"2px solid #44a2fc"}}}}}}),d=function(e){var t=e.children;return n.a.createElement(u.a,{theme:p},t)},h=r(21),m=r(1),f=r.n(m),v=r(3),b=r(30),g=r(681),y=r(660),k=r(653),S=r(651),_=function(e){return n.a.createElement(S.a,{variant:"contained",className:e.className?e.className:"custom-button",color:"primary",onClick:e.onClick},e.name)},O=r(678),w=r(654),j=r(674),x=r(289),T=(r(315),r(17)),C=r(18),E=r(8),U=new(function(){function e(){Object(T.a)(this,e),this.storage=void 0,this.languageKey="demo_language",this.storage=window.sessionStorage}return Object(C.a)(e,[{key:"read",value:function(e){try{return JSON.parse(this.storage.getItem(e))}catch(t){return this.storage.getItem(e)}}},{key:"save",value:function(e,t){this.storage.setItem(e,JSON.stringify(t))}},{key:"clear",value:function(e){this.storage.removeItem(e)}},{key:"setLanguage",value:function(e){this.save(this.languageKey,e)}},{key:"getLanguage",value:function(){return this.read(this.languageKey)?this.read(this.languageKey):navigator.language}},{key:"getRtmMessage",value:function(){var e=U.read("channelMessages");if(Object(E.isEmpty)(e))return{count:0,messages:[]};var t=e.filter((function(e){return"group_message"===e.message_type})).reduce((function(e,t){var r=t.payload,a=JSON.parse(r);return a.content?e.concat({account:a.account,content:a.content,ms:t.ms,src:t.src}):e}),[]);return{messages:t,count:t.length}}}]),e}());window.GlobalStorage=U;var R={unknown:"[\u672a\u77e5]: ",from_room:"[\u6559\u5ba4]: ",student_role:"[\u5b66\u751f]: ",teacher_role:"[\u8001\u5e08]: ",assistant_role:"[\u52a9\u6559]: ",upload_log_failed:"\u4e0a\u4f20\u65e5\u5fd7\u5931\u8d25",create_screen_share_failed:"\u521b\u5efa\u5c4f\u5e55\u5171\u4eab\u5931\u8d25",screen_share_permission:"\u7f3a\u5c11\u5c4f\u5e55\u5171\u4eab\u6743\u9650",electron:{start_screen_share_failed:"native screen sharing failed"},icon:{setting:"\u8bbe\u7f6e","upload-log":"\u4e0a\u4f20\u65e5\u5fd7","exit-room":"\u9000\u51fa\u6559\u5ba4","lang-select":"\u8bed\u8a00\u5207\u6362",requests_to_connect_the_microphone:"\u7533\u8bf7\u8fde\u63a5\u9ea6\u514b\u98ce"},doc_center:"\u6587\u6863\u4e2d\u5fc3",upload_picture:"\u4e0a\u4f20\u56fe\u7247",convert_webpage:"\u8f6c\u6362\u52a8\u6001PPT",convert_to_picture:"PPT\u8f6c\u56fe\u7247",upload_audio_video:"\u4e0a\u4f20\u97f3\u89c6\u9891",return:{home:"\u8fd4\u56de\u4e3b\u9875"},control_items:{first_page:"\u7b2c\u4e00\u9875",prev_page:"\u4e0a\u4e00\u9875",next_page:"\u4e0b\u4e00\u9875",last_page:"\u6700\u540e\u4e00\u9875",stop_recording:"\u505c\u6b62\u4e91\u7aef\u5f55\u5236",recording:"\u5f00\u59cb\u4e91\u7aef\u5f55\u5236",quit_screen_sharing:"\u505c\u6b62\u5c4f\u5e55\u5206\u4eab",screen_sharing:"\u5f00\u59cb\u5c4f\u5e55\u5206\u4eab",delete_current:"\u5220\u9664\u5f53\u524d",delete_all:"\u5220\u9664\u5168\u90e8"},zoom_control:{folder:"\u6587\u6863\u4e2d\u5fc3",lock_board:"\u8bbe\u7f6e\u767d\u677f\u8ddf\u968f",unlock_board:"\u53d6\u6d88\u767d\u677f\u8ddf\u968f"},tool:{selector:"\u9f20\u6807\u9009\u62e9\u5668",pencil:"\u753b\u7b14",rectangle:"\u77e9\u5f62",ellipse:"\u692d\u5706",eraser:"\u6a61\u76ae\u64e6",text:"\u6587\u5b57",color_picker:"\u8c03\u8272\u677f",add:"\u65b0\u589e\u4e00\u9875",upload:"\u4e0a\u4f20",hand_tool:"\u624b\u6293\u5de5\u5177"},error:{not_found:"\u9875\u9762\u627e\u4e0d\u5230",components:{paramsEmpty:"\u53c2\u6570\uff1a{reason}\u4e0d\u80fd\u4e3a\u7a7a"}},whiteboard:{loading:"\u52a0\u8f7d\u4e2d...",converting:"\u8f6c\u6362\u4e2d...",global_state_limit:"\u8bf7\u4e0d\u8981\u7ed9\u767d\u677f\u8bbe\u7f6e\u8fc7\u5927\u7684globalState size",locked_board:"\u8001\u5e08\u6b63\u5728\u63a7\u5236\u767d\u677f\uff0c\u8bf7\u52ff\u4e66\u5199",unlocked_board:"\u767d\u677f\u5df2\u89e3\u9664\u9501\u5b9a\u3002"},toast:{upload_log_failure:"\u4e0a\u4f20\u65e5\u5fd7\u5931\u8d25\uff0c\u9519\u8bef\u7c7b\u578b\uff1a{reason}, \u8be6\u60c5\u53c2\u8003\u5f00\u53d1\u8005\u5de5\u5177",show_log_id:"\u8bf7\u63d0\u4f9b\u4f60\u7684\u65e5\u5fd7ID: {no}",api_login_failured:"\u623f\u95f4\u52a0\u5165\u5931\u8d25, \u539f\u56e0: {reason}",confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",quit_room:"\u786e\u5b9a\u9000\u51fa\u8bfe\u7a0b\u5417\uff1f",kick:"\u5176\u4ed6\u7aef\u767b\u5f55\uff0c\u88ab\u8e22\u51fa\u623f\u95f4",login_failure:"\u767b\u5f55\u623f\u95f4\u5931\u8d25",whiteboard_lock:"\u8bbe\u7f6e\u767d\u677f\u8ddf\u968f",whiteboard_unlock:"\u53d6\u6d88\u767d\u677f\u8ddf\u968f",canceled_screen_share:"\u5df2\u53d6\u6d88\u5c4f\u5e55\u5171\u4eab",screen_sharing_failed:"\u5c4f\u5e55\u5206\u4eab\u5931\u8d25, \u539f\u56e0\uff1a{reason}",recording_failed:"\u5f00\u542f\u4e91\u5f55\u5236\u5931\u8d25, \u539f\u56e0\uff1a{reason}",start_recording:"\u5f00\u59cb\u4e91\u5f55\u5236",stop_recording:"\u7ed3\u675f\u4e91\u5f55\u5236",recording_too_short:"\u5f55\u5236\u592a\u77ed\uff0c\u81f3\u5c1115\u79d2",rtm_login_failed:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e",rtm_login_failed_reason:"\u623f\u95f4\u767b\u5f55\u5931\u8d25, \u539f\u56e0\uff1a {reason}",replay_failed:"\u56de\u653e\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5",teacher_exists:"\u8be5\u623f\u95f4\u8001\u5e08\u5df2\u5b58\u5728\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",student_over_limit:"\u8d85\u51fa\u5b66\u751f\u6700\u5927\u4eba\u6570\uff0c\u8bf7\u7b49\u5f8530\u79d2\u6216\u91cd\u65b0\u521b\u5efa\u6559\u5ba4",teacher_and_student_over_limit:"\u8d85\u51fa\u5b66\u751f\u548c\u8001\u5e08\u7684\u6700\u5927\u4eba\u6570",teacher_accept_whiteboard:"\u8001\u5e08\u5df2\u6388\u6743\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_cancel_whiteboard:"\u8001\u5e08\u5df2\u6536\u56de\u4e86\u4f60\u767d\u677f\u7684\u6743\u9650",teacher_accept_co_video:"\u8001\u5e08\u5df2\u5141\u8bb8\u8fde\u9ea6",teacher_reject_co_video:"\u8001\u5e08\u5df2\u62d2\u7edd\u8fde\u9ea6",teacher_cancel_co_video:"\u8001\u5e08\u5df2\u53d6\u6d88\u8fde\u9ea6",student_cancel_co_video:"\u5b66\u751f\u5df2\u53d6\u6d88\u8fde\u9ea6",student_send_co_video_apply:'"{reason}" \u5b66\u751f\u53d1\u8d77\u4e86\u8fde\u9ea6\u7533\u8bf7',student_peer_leave:'"{reason}" \u79bb\u5f00\u4e86',stop_co_video:'\u6559\u5e08\u505c\u6b62\u4e86"{reason}"\u7684\u8fde\u9ea6',reject_co_video:"\u60a8\u53d6\u6d88\u4e86\u5b66\u751f\u7684\u8fde\u9ea6\u7533\u8bf7",close_co_video:"\u60a8\u5173\u95ed\u4e86\u5b66\u751f\u7684\u8fde\u9ea6",close_youself_co_video:"\u4f60\u5173\u95ed\u4e86\u81ea\u5df1\u7684\u8fde\u9ea6",accept_co_video:"\u60a8\u540c\u610f\u4e86\u8fde\u9ea6",successfully_joined_the_room:"\u52a0\u5165\u623f\u95f4\u6210\u529f",failed_to_join_the_room:"\u52a0\u5165\u623f\u95f4\u5931\u8d25",failed_to_authorize_whiteboard:"\u6388\u6743\u767d\u677f\u5931\u8d25",failed_to_deauthorize_whiteboard:"\u53d6\u6d88\u6388\u6743\u767d\u677f\u5931\u8d25",failed_to_query_playback_list:"\u67e5\u8be2\u56de\u653e\u5217\u8868\u5931\u8d25",audio_equipment_has_changed:"\u97f3\u9891\u8bbe\u5907\u53d1\u751f\u4e86\u53d8\u5316",video_equipment_has_changed:"\u89c6\u9891\u8bbe\u5907\u53d1\u751f\u4e86\u53d8\u5316",failed_to_initiate_screen_sharing:"\u53d1\u8d77\u5c4f\u5e55\u5171\u4eab\u5931\u8d25",failed_to_end_screen_sharing:"\u7ed3\u675f\u5c4f\u5e55\u5171\u4eab\u5931\u8d25",failed_to_initiate_screen_sharing_to_remote:"\u5411\u8fdc\u7aef\u53d1\u8d77\u5c4f\u5e55\u5171\u4eab\u5931\u8d25",failed_to_enable_screen_sharing:"\u5f00\u542f\u5c4f\u5e55\u5171\u4eab\u5931\u8d25",failed_to_enable_screen_sharing_permission_denied:"\u5f00\u542f\u5c4f\u5e55\u5171\u4eab\u5931\u8d25\uff01\u8bf7\u5148\u6388\u6743\u5c4f\u5e55\u5171\u4eab\u6743\u9650\uff01",failed_to_send_chat:"\u53d1\u9001\u804a\u5929\u5931\u8d25",failed_to_join_rtc_please_refresh_and_try_again:"\u52a0\u5165rtc\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",leave_rtc_channel:"\u79bb\u5f00rtc\u9891\u9053",failed_to_leave_rtc:"\u79bb\u5f00rtc\u5931\u8d25",co_video_close_success:"\u4e0b\u9ea6\u6210\u529f",co_video_close_failed:"\u4e0b\u9ea6\u5931\u8d25",publish_rtc_success:"\u53d1\u5e03RTC\u6210\u529f",open_whiteboard_follow:"\u6253\u5f00\u767d\u677f\u8ddf\u968f",close_whiteboard_follow:"\u5173\u95ed\u767d\u677f\u8ddf\u968f",i:"\u6211",teacher:"\u8001\u5e08",the_teacher_authorized_your_whiteboard:"\u8001\u5e08\u6388\u6743\u4e86\u4f60\u7684\u767d\u677f",the_teacher_cancelled_your_whiteboard_permission:"\u8001\u5e08\u53d6\u6d88\u4e86\u4f60\u7684\u767d\u677f\u6743\u9650",publish_business_flow_successfully:"\u53d1\u5e03\u4e1a\u52a1\u6d41\u6210\u529f",media_method_call_failed:"\u5a92\u4f53\u65b9\u6cd5\u8c03\u7528\u5931\u8d25",successfully_left_the_business_channel:"\u79bb\u5f00\u4e1a\u52a1\u9891\u9053\u6210\u529f",course_started_successfully:"\u8bfe\u7a0b\u5f00\u59cb\u6210\u529f",setting_start_failed:"\u8bbe\u7f6e\u5f00\u59cb\u5931\u8d25",the_course_ends_successfully:"\u8bfe\u7a0b\u7ed3\u675f\u6210\u529f",setting_ended_failed:"\u8bbe\u7f6e\u7ed3\u675f\u5931\u8d25",start_recording_successfully:"\u5f00\u59cb\u5f55\u5236\u6210\u529f",start_recording_failed:"\u5f00\u59cb\u5f55\u5236\u5931\u8d25",successfully_ended_recording:"\u7ed3\u675f\u5f55\u5236\u6210\u529f",failed_to_end_recording:"\u7ed3\u675f\u5f55\u5236\u5931\u8d25",you_have_a_default_message:"\u4f60\u6709\u4e00\u6761\u9ed8\u8ba4\u6d88\u606f",the_teacher_agreed:"\u8001\u5e08\u540c\u610f\u4e86",student_applied:"\u5b66\u751f\u7533\u8bf7\u4e86",you_were_dismissed_by_the_teacher:"\u4f60\u88ab\u8001\u5e08\u4e0b\u9ea6\u4e86",student_canceled:"\u5b66\u751f\u53d6\u6d88\u4e86",the_teacher_refused:"\u8001\u5e08\u62d2\u7edd\u4e86",failed_to_initiate_a_raise_of_hand_application:"\u53d1\u8d77\u4e3e\u624b\u7533\u8bf7\u5931\u8d25",failed_to_end_the_call:"\u7ed3\u675f\u901a\u8bdd\u5931\u8d25"},notice:{student_interactive_apply:'"{reason}"\u60f3\u548c\u4f60\u8fde\u9ea6'},chat:{placeholder:"\u8bf4\u70b9\u4ec0\u4e48",banned:"\u7981\u8a00\u4e2d",send:"\u53d1\u9001"},device:{camera:"\u6444\u50cf\u5934",microphone:"\u9ea6\u514b\u98ce",speaker:"\u626c\u58f0\u5668",finish:"\u5b8c\u6210",detect:"\u68c0\u6d4b",test_again:"\u518d\u6d4b\u4e00\u6b21",close:"\u5173\u95ed",test_report:"\u68c0\u6d4b\u62a5\u544a",is_look:"\u662f\u5426\u53ef\u4ee5\u770b\u5230\u753b\u9762\uff1f",no:"\u5426",yes:"\u662f",is_hear:"\u97f3\u4e50\u64ad\u653e\u4e2d\uff0c\u60a8\u662f\u5426\u53ef\u4ee5\u542c\u5230\u97f3\u4e50\uff1f",click_play:"\u70b9\u51fb\u64ad\u653e\u540e\u5f00\u59cb\u68c0\u6d4b\u626c\u58f0\u5668",test_microphone:"\u5bf9\u9ea6\u514b\u98ce\u8bf4\u4e9b\u4ec0\u4e48\uff0c\u68c0\u6d4b\u9ea6\u514b\u98ce\u662f\u5426\u6b63\u5e38"},nav:{delay:"\u5ef6\u8fdf: ",network:"\u7f51\u7edc: ",cpu:"CPU: ",class_end:"\u8bfe\u7a0b\u7ed3\u675f",class_start:"\u8bfe\u7a0b\u5f00\u59cb",back:"\u8fd4\u56de"},home:{"entry-home":"\u8fdb\u5165\u6559\u5ba4",teacher:"\u8001\u5e08",student:"\u5b66\u751f",assistant:"\u52a9\u6559",cover_class:"cover-cn",room_name:"\u623f\u95f4\u540d",nickname:"\u6635\u79f0",room_type:"\u623f\u95f4\u7c7b\u578b",room_join:"\u52a0\u5165\u623f\u95f4",short_title:{title:"\u58f0\u7f51\u4e91\u8bfe\u5802",subtitle:"\u7531\u58f0\u7f51\u63d0\u4f9b"},name_too_long:"\u540d\u5b57\u8fc7\u957f\uff0c\u4e0d\u5f97\u8d85\u8fc720\u4e2a\u5b57\u7b26","1v1":"\u4e00\u5bf9\u4e00",mini_class:"\u5c0f\u73ed\u8bfe",large_class:"\u5927\u73ed\u8bfe",missing_room_name:"\u7f3a\u5c11\u623f\u95f4\u540d",missing_your_name:"\u7f3a\u5c11\u6635\u79f0",missing_password:"\u7f3a\u5c11\u623f\u95f4\u5bc6\u7801",missing_role:"\b\u7f3a\u5c11\u89d2\u8272",account:"\u59d3\u540d",password:"\u5bc6\u7801"},room:{show:"\u663e\u793a",course_list:"\u6559\u5ba4\u5217\u8868",chat_room:"\u6d88\u606f\u5217\u8868",student_list:"\u5b66\u751f\u5217\u8868",uploading:"\u4e0a\u4f20\u4e2d...",converting:"\u8f6c\u6362\u4e2d...",upload_success:"\u4e0a\u4f20\u6210\u529f",upload_failure:"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc",convert_success:"\u8f6c\u6362\u6210\u529f",convert_failure:"\u8f6c\u6362\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc"},replay:{loading:"\u52a0\u8f7d\u4e2d...",recording:"\u5728\u5f55\u5236\u4e2d",finished:"\u5f55\u5236\u5b8c\u6210",finished_recording_to_be_download:"\u670d\u52a1\u7aef\u51c6\u5907\u4e0b\u8f7d\u4e2d",finished_download_to_be_convert:"\u670d\u52a1\u7aef\u51c6\u5907\u8f6c\u6362\u4e2d",finished_convert_to_be_upload:"\u670d\u52a1\u7aef\u51c6\u5907\u4fdd\u5b58\u4e2d"},assistant:{className:"\u73ed\u7ea7\u540d",creatTime:"\u521b\u5efa\u65f6\u95f4",operation:"\u64cd\u4f5c",classList:"\u73ed\u7ea7\u5217\u8868",enterClassRoom:"\u8fdb\u5165\u73ed\u7ea7",data_null_text:"\u5f53\u524d\u6ca1\u6709\u6b63\u5728\u4e0a\u8bfe\u7684\u73ed\u7ea7\uff0c\u60a8\u53ef\u4ee5\u5237\u65b0\u6216\u8005\u9000\u51fa\u754c\u9762",refresh:"\u5237\u65b0",exit:"\u9000\u51fa"},course_recording:"\u5f55\u5236\u56de\u653e",build_version:"\u6784\u5efa\u7248\u672c: ".concat("0.0.1")},P={unknown:"[unknown]: ",from_room:"[Room]: ",student_role:"[Student]: ",teacher_role:"[Teacher]: ",assistant_role:"[Tas]: ",upload_log_failed:"Upload Log failed",create_screen_share_failed:"Create Screen Share failed",screen_share_permission:"Need Electron Screen Capture Permission",electron:{start_screen_share_failed:"native screen sharing failed"},icon:{setting:"Setting","upload-log":"Upload Log","exit-room":"Exit Room","lang-select":"Switch Language",requests_to_connect_the_microphone:"Requests To Connect The Microphone"},doc_center:"Course Document Center",upload_picture:"Upload Picture",convert_webpage:"Dynamic PPT",convert_to_picture:"Static PPT",upload_audio_video:"Upload Audio/Video",return:{home:"Back To Home"},control_items:{first_page:"First Page",prev_page:"Prev Page",next_page:"Next Page",last_page:"Last Page",stop_recording:"Stop Cloud Recording",recording:"Start Cloud Recording",quit_screen_sharing:"Stop Screen Sharing",screen_sharing:"Start Screen Sharing",delete_current:"Remove Current",delete_all:"Remove All"},zoom_control:{folder:"Document Center",lock_board:"Set Whiteboard Follow",unlock_board:"Reset Whiteboard Follow"},tool:{selector:"mouse selector",pencil:"penceil",rectangle:"rectangle",ellipse:"ellipse",eraser:"eraser",text:"text",color_picker:"color picker",add:"add new page",upload:"upload ",hand_tool:"hand selector"},error:{not_found:"Page Not Found",components:{paramsEmpty:"params\uff1a{reason} can`t be empty"}},whiteboard:{loading:"Loading...",converting:"Converting...",global_state_limit:"globalState size limit size probably overflow",locked_board:"The teacher is moving the whiteboard. Please do not draw on it.",unlocked_board:"The whiteboard already unlocked"},toast:{upload_log_failure:"Upload Log Failure\uff0cErrorName: {reason}\uff0csee more details in devtool",show_log_id:"Report your log ID: {reason}",api_login_failured:"Join Failured, Reason: {reason}",confirm:"Confirm",cancel:"Cancel",quit_room:"Are you sure to exit the classroom?",kick:"kicked",login_failure:"login failure",whiteboard_lock:"Whiteboard follow",whiteboard_unlock:"Whiteboard nofollow",canceled_screen_share:"Canceled screen sharing",screen_sharing_failed:"Screen sharing failed, reason: {reason}",recording_failed:"Start cloud recording failed, reason: {reason}",start_recording:"Start cloud recording success",stop_recording:"Stop cloud recording success",recording_too_short:"Recording too short, at least 15 seconds",rtm_login_failed:"login failure, please check your network",rtm_login_failed_reason:"login failure, reason: {reason}",replay_failed:"Replay Failed please refresh browser",teacher_exists:"Teacher already exists, Please waiting for 30s or reopen new class",student_over_limit:"Student have reached upper limit, , Please waiting for 30s or rejoin new class",teacher_and_student_over_limit:"The number of students and teacher have reached upper limit",teacher_accept_whiteboard:"Teacher already grant your whiteboard",teacher_cancel_whiteboard:"Teacher already cancel your whiteboard",teacher_accept_co_video:"Teacher already accept co-video",teacher_reject_co_video:"Teacher already rejected co-video",teacher_cancel_co_video:"Teacher already canceled co-video",student_cancel_co_video:"Student canceled co-video",student_peer_leave:'"{reason}" Left',student_send_co_video_apply:'"{reason}" send the co-video request',stop_co_video:'Stop "{reason}" co-video',reject_co_video:"Reject co-video",close_co_video:"Close co-video",close_youself_co_video:"Stop co-video",accept_co_video:"Accept co-video",successfully_joined_the_room:"Successfully joined the room",failed_to_join_the_room:"Failed to join the room",failed_to_authorize_whiteboard:"Failed to authorize whiteboard",failed_to_deauthorize_whiteboard:"Failed to deauthorize whiteboard",failed_to_query_playback_list:"Failed to query playback list",audio_equipment_has_changed:"Audio equipment has changed",video_equipment_has_changed:"Video equipment has changed",failed_to_initiate_screen_sharing:"Failed to initiate screen sharing",failed_to_end_screen_sharing:"Failed to end screen sharing",failed_to_initiate_screen_sharing_to_remote:"Failed to initiate screen sharing to remote",failed_to_enable_screen_sharing:"Failed to enable screen sharing",failed_to_enable_screen_sharing_permission_denied:"Open screen capture failed\uff01Please grant permission for screen capture!",failed_to_send_chat:"Failed to send chat",failed_to_join_rtc_please_refresh_and_try_again:"Failed to join rtc, please refresh and try again",leave_rtc_channel:"Leave rtc channel",failed_to_leave_rtc:"Failed to leave rtc",co_video_close_success:"CoVideo dismissed success",co_video_close_failed:"CoVideo dismissed failure",publish_rtc_success:"Publish RTC Success",open_whiteboard_follow:"open whiteboard follow",close_whiteboard_follow:"close whiteboard follow",i:"I",teacher:"Teacher",the_teacher_authorized_your_whiteboard:"The teacher authorized your whiteboard",the_teacher_cancelled_your_whiteboard_permission:"The teacher cancelled your whiteboard permission",publish_business_flow_successfully:"Publish business flow successfully",media_method_call_failed:"Media method call failed",successfully_left_the_business_channel:"Successfully left the business channel",course_started_successfully:"Course start successfully",setting_start_failed:"Setting start failed",the_course_ends_successfully:"Course end successfully",setting_ended_failed:"Setting ended failed",start_recording_successfully:"Start recording successfully",start_recording_failed:"Start recording failed",successfully_ended_recording:"Successfully_ended_recording",failed_to_end_recording:"Failed to end recording",you_have_a_default_message:"You have a default message",the_teacher_agreed:"Teacher Agreed",student_applied:"Student applied",you_were_dismissed_by_the_teacher:"You were dismissed by the teacher",student_canceled:"Student canceled",the_teacher_refused:"Teacher refused",failed_to_initiate_a_raise_of_hand_application:"Failed to initiate a raise of hand application",failed_to_end_the_call:"Failed to end the call"},notice:{student_interactive_apply:'"{reason}" wants to interact with you'},chat:{placeholder:"Input Message",banned:"Banned",send:"send"},device:{camera:"Camera",microphone:"Microphone",speaker:"Speaker",finish:"Finish",detect:"Detect",test_again:"Test again",close:"Close",test_report:"Test report",is_look:"Can you see the screen?",no:"No",yes:"Yes",is_hear:"Can you hear the music while the music is playing?",click_play:"Start to detect speakers after clicking play",test_microphone:"What to say to the microphone, check if the microphone is normal"},nav:{delay:"Delay: ",network:"Network: ",cpu:"CPU: ",class_end:"Class end",class_start:"Class start",back:"Back"},home:{"entry-home":"Join Classroom",teacher:"teacher",student:"student",assistant:"tas",cover_class:"cover-en",room_name:"Room Name",nickname:"Your Name",room_type:"Room Type",room_join:"Join",short_title:{title:"Virtual Education Solution",subtitle:""},name_too_long:"name too long, should <= 20 characters","1v1":"One to One Classroom",mini_class:"Small Classroom",large_class:"Lecture Hall",missing_room_name:"missing room name",missing_your_name:"missing your name",missing_password:"missing password",missing_role:"missing role",account:"Name",password:"Password"},room:{show:"Show",course_list:"Room List",chat_room:"Chat Room",student_list:"Student List",uploading:"Uploading...",converting:"Converting...",upload_success:"upload success",upload_failure:"upload failure, check the network",convert_success:"convert success",convert_failure:"convert failure, check the network"},replay:{loading:"loading...",recording:"In Recording",finished:"Finished",finished_recording_to_be_download:"Server prepare downloading",finished_download_to_be_convert:"Server prepare converting",finished_convert_to_be_upload:"Server prepare saving"},assistant:{className:"className",creatTime:"creatTime",operation:"operation",classList:"classList",enterClassRoom:"enterClassRoom",data_null_text:"There is no class currently in session, you can refresh or exit the interface",refresh:"refresh",exit:"exit"},course_recording:"course recording",build_version:"Version 1.0"},A=function(e,t){var r=U.getLanguage().match(/zh/)?R:P,a=Object(E.get)(r,e,null);return a?(Object(E.isEmpty)(t)||t.reason&&a.match(/\{.+\}/)&&(a=a.replace(/\{.+\}/,t.reason)),a):(console.error("".concat(r,": ").concat(e," has no match")),"".concat(r,".").concat(e))},I=Object(k.a)((function(e){return{radioGroup:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"23px"}}})),L=function(e){var t=I();return n.a.createElement(O.a,{className:t.radioGroup,row:!0,value:e.role,onChange:e.onChange},n.a.createElement(w.a,{className:"custom-radio align-left",value:"teacher",control:n.a.createElement(j.a,{className:"custom-radio",color:"primary"}),label:A("home.teacher"),labelPlacement:"end"}),3===e.type?n.a.createElement(w.a,{className:"custom-radio align-middle",value:"assistant",control:n.a.createElement(j.a,{className:"custom-radio",color:"primary"}),label:A("home.assistant"),labelPlacement:"end"}):null,n.a.createElement(w.a,{className:"custom-radio align-right",value:"student",control:n.a.createElement(j.a,{className:"custom-radio",color:"primary"}),label:A("home.student"),labelPlacement:"end"}),e.requiredText?n.a.createElement(x.a,{className:t.required},e.requiredText):null)},N=function(e){var t=e.data,r=e.icon,a=e.disable,o=e.className,i=e.onClick,s=a?"":r?"icon-btn":"icon";s=e.active?s+" active":s;var c=t||"";return n.a.createElement("div",{className:"".concat(s," ").concat(o),onClick:i,"data-name":c})},M=r(679),D=r(656),V=r(150),W=r.n(V),F=((new V.UAParser).getResult(),Object(k.a)((function(e){return{formInput:{"ime-mode":"disabled","&:after":{borderBottom:"1px solid #44a2fc"}},required:{fontSize:"12px",color:"#ff0000",lineHeight:"17px",position:"absolute",top:"48px"}}}))),B=function(e){var t=F(),r=Object(a.useRef)(!1),o=function(t){e.onChange(t)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(M.a,null,e.Label),n.a.createElement(D.a,{className:t.formInput,value:e.value,onCompositionStart:function(e){r.current=!0},onCompositionEnd:function(t){r.current=!1,o(e.value.replace(/[^0-9a-zA-Z$]/g,"").slice(0,20))},inputProps:{maxLength:20},onChange:function(e){var t=e.target.value.replace(/[^0-9a-zA-Z$]/g,"").slice(0,20);r.current||(e.target.value=t,o(e.target.value)),r.current=!1}}),e.requiredText?n.a.createElement(x.a,{className:t.required},e.requiredText):null)},z=r(673),q=r(680),G=function(e){var t=e.Label,r=e.value,a=e.onChange,o=e.items;return n.a.createElement(n.a.Fragment,null,n.a.createElement(M.a,null,t),n.a.createElement(z.a,{value:r,onChange:a},o.map((function(e,t){return n.a.createElement(q.a,{key:t,value:t},e.text)}))))},K=function(e){var t=e.value,r=e.onChange,a=e.items;return n.a.createElement(z.a,{value:t,onChange:r},a.map((function(e,t){return n.a.createElement(q.a,{key:t,value:t},e.text)})))},J=r(13),Y=function(){return Object(a.useContext)(J.a).store},H=function(){return Object(a.useContext)(J.a).store.uiStore},Q=function(){return Object(a.useContext)(J.a).store.roomStore},X=function(){return Object(a.useContext)(J.a).store.breakoutRoomStore},Z=function(){return Object(a.useContext)(J.a).store.boardStore},$=function(){return Object(a.useContext)(J.a).store.deviceStore},ee=function(){return Object(a.useContext)(J.a).store.replayStore},te=r(7),re=r(4),ae=(r(72),r(83)),ne=r(34),oe=r(33),ie=r(40);function se(e){var t=function(e){try{var t=U.getLanguage().match(/^zh/)?"zh-cn":"en-us";return(U.read("demo-i18n-error")||{})[t][e]}catch(r){return console.warn(r),null}}(e);return t||e}function ce(e,t){return ue.apply(this,arguments)}function ue(){return(ue=Object(v.a)(f.a.mark((function e(t,r){var a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.length>2&&void 0!==a[2]?a[2]:0,e.abrupt("return",new Promise((function(e,a){var n=function(t){return Te.info("OnResponse success"),t.ok||(Te.info("status",t.status," ok ",t.ok),a(new Error(t.statusText))),t.json().then(e).catch(a)},o=function(e){a(e)},i=function(e){throw Te.warn(e),e};fetch(t,r).then(n).catch(o).catch(i);var s=new Error("request timeout");setTimeout(a,1e4,s)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,t){return pe.apply(this,arguments)}function pe(){return(pe=Object(v.a)(f.a.mark((function e(t,r){var a,n=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.length>2&&void 0!==n[2]?n[2]:0,e.prev=1,e.next=4,ce(t,r,a);case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0||"request timeout"!==e.t0.message){e.next=11;break}return e.abrupt("return",{code:e.t0.code,msg:null,response:null});case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}var de=r(154),he=r.n(de),me=r(126),fe=r.n(me),ve=(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_APP_TOKEN,"c5fe1ae528154b5fa97f26c6c82b6575"),be=window.btoa("".concat("8c9ba8213b0541c49bd9651bc71b6fc0",":").concat("7bc716b34ecf49a5b4f2f0d05e80a00b")),ge=function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,a=t.method,n=t.data,o=t.token,i=t.outHeaders,s={method:a,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(be.replace(/basic\s+|basic/i,""))}},o&&(s.headers.token=o),i&&Object.keys(i).forEach((function(e){s.headers[e]=i[e]})),n&&(s.body=JSON.stringify(n)),e.next=7,le("".concat(r),s);case 7:if(c=e.sent,u=c.code,c.msg,l=c.data,0===u||408===u){e.next=15;break}if(p=se("".concat(u)),d="".concat(p)==="".concat(u),401!==u&&1101012!==u){e.next=14;break}return e.abrupt("return");case 14:throw{api_error:p,isErrorCode:d};case 15:return e.abrupt("return",l);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=new(function(){function e(){Object(T.a)(this,e),this.appID=ve,this.roomId="",this._userToken=""}return Object(C.a)(e,[{key:"fetchStsToken",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t||0,n=(new Date).getTime(),o={appId:this.appID,appVersion:A("build_version"),deviceName:"mac",deviceVersion:"2.0",fileExt:r,platform:"web",tag:{roomId:a}},i=JSON.stringify(o),"https://api.agora.io",s="https://api.agora.io"+i+n,c=fe()(s),e.next=9,ge({url:"".concat("https://api.agora.io","/monitor/v1/log/oss/policy"),data:o,method:"POST",outHeaders:{sign:c,timestamp:n}});case 9:return u=e.sent,e.abrupt("return",{bucketName:u.bucketName,callbackBody:u.callbackBody,callbackContentType:u.callbackContentType,accessKeyId:u.accessKeyId,accessKeySecret:u.accessKeySecret,securityToken:u.securityToken,ossKey:u.ossKey});case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uploadZipLogFile",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uploadToOss(t,r,"zip");case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uploadLogFile",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uploadToOss(t,r,"log");case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uploadToOss",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o,i,s,c,u,l,p,d,h,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchStsToken(t,a);case 2:return n=e.sent,o=n.bucketName,i=n.callbackBody,s=n.callbackContentType,c=n.accessKeyId,u=n.accessKeySecret,l=n.securityToken,p=n.ossKey,d={bucketName:o,callbackBody:i,callbackContentType:s,accessKeyId:c,accessKeySecret:u,securityToken:l},h=new he.a({accessKeyId:d.accessKeyId,accessKeySecret:d.accessKeySecret,stsToken:d.securityToken,bucket:d.bucketName,secure:!0,endpoint:"oss-accelerate.aliyuncs.com"}),e.prev=12,e.next=15,h.put(p,r,{callback:{url:"".concat("https://api.agora.io","/monitor/v1/log/oss/callback"),body:i,contentType:s}});case 15:return m=e.sent,e.abrupt("return",Object(E.get)(m,"data.data",-1));case 19:throw e.prev=19,e.t0=e.catch(12),e.t0;case 22:case"end":return e.stop()}}),e,this,[[12,19]])})));return function(t,r,a){return e.apply(this,arguments)}}()}]),e}());console.log("CURRENT RUNTIME: ".concat("web"));var ke=r(155),Se=new ke.a("webdemo_agora_edu");Se.version(1).stores({logs:"content"});var _e,Oe=Se,we=r(271),je=r.n(we);!function(e){e.Debug="Debug",e.None="None"}(_e||(_e={}));var xe=function(e){return e.reduce((function(e,t){return e.concat(t)}),[])},Te=function(){function e(){Object(T.a)(this,e)}return Object(C.a)(e,null,[{key:"currentTime",get:function(){var e=new Date;return"".concat(e.toTimeString().split(" ")[0]+":"+e.getMilliseconds())}},{key:"setLogLevel",value:function(e){this.logLevel=e}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["WARN"].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["DEBUG"].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,["INFO"].concat(t))}},{key:"log",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];if(this.logLevel!==_e.None){var n="".concat(this.currentTime," %cAgoraEdu-SDK [").concat(e,"]: "),o=[],i={WARN:{call:function(){o=[n,"color: #9C640C;"].concat(r),console.log.apply(console,o)}},DEBUG:{call:function(){o=[n,"color: #99CC66;"].concat(r),console.log.apply(console,o)}},INFO:{call:function(){o=[n,"color: #99CC99; font-weight: bold;"].concat(r),console.log.apply(console,o)}}};i.hasOwnProperty(e)?i[e].call():(o=[n,"color: #64B5F6;"].concat(r),console.log.apply(console,o))}}},{key:"init",value:function(){this.thread||(this.thread=new je.a,this.debugLog())}},{key:"debugLog",value:function(){var e=this.thread;Object.keys(console).filter((function(e){return["info","error","warn","log","debug"].indexOf(e)>=0})).forEach((function(t,r){console[t]=function(t,r){return function(){var a=Array.prototype.slice.call(arguments);xe(a).join(""),e.postMessage({type:"log",data:JSON.stringify([xe(a).join("")])}),r.apply(t,a)}}(console,console[t])})),window.console=console}},{key:"uploadElectronLog",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.doGzip();case 2:return r=e.sent,e.next=5,ye.uploadZipLogFile(t,r);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableUpload",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],e.next=7;break;case 5:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 7:return e.t2=r,e.next=10,this.uploadLog(t);case 10:return e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.abrupt("return",r.join("#"));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadLog",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[upload] roomId: ",t),e.next=3,Oe.logs.toArray();case 3:return r=e.sent,a=r.reverse().map((function(e){return JSON.parse(e.content)})).map((function(e){return Array.isArray(e)?e[0]:e})).join("\n"),window.logsStr=a,e.next=8,new File([a],"".concat(+Date.now()));case 8:return n=e.sent,window.file=n,e.next=12,ye.uploadLogFile(t,n);case 12:return o=e.sent,e.next=15,Oe.delete();case 15:return e.next=17,ke.a.exists(Oe.name);case 17:if(e.sent){e.next=19;break}Oe.version(1).stores({logs:"content"});case 19:return e.next=21,Oe.open();case 21:return console.log(">>>>> res",o),e.abrupt("return",o);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Te.logLevel=_e.Debug,Te.originConsole=window.console,Te.thread=null,window.EduLogger=Te;var Ce=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this))._client=void 0,a._subClient=void 0,a._screenClient=void 0,a.agoraWebSdk=void 0,a.deviceList=[],a.localUid=void 0,a.clientConfig=void 0,a.joined=void 0,a.cameraTrack=void 0,a.microphoneTrack=void 0,a.cameraTestTrack=void 0,a.microphoneTestTrack=void 0,a.localScreenUid=void 0,a.screenVideoTrack=void 0,a.screenAudioTrack=void 0,a.publishedTrackIds=[],a.appId=void 0,a.intervalMap={},a.subscribeAudioList=[],a.subscribeVideoList=[],a.unsubscribeAudioList=[],a.unsubscribeVideoList=[],a.videoMuted=!1,a.audioMuted=!1,a.publishedAudio=!1,a.publishedVideo=!1,a.channelName="",a.agoraWebSdk=e.agoraWebSdk,a.clientConfig=e.webConfig,a.appId=e.appId,a.joined=!1,a.publishedAudio=!1,a.publishedVideo=!1,a._subClient={},a}return Object(C.a)(r,[{key:"clearAllInterval",value:function(){for(var e=0,t=Object.keys(this.intervalMap);e<t.length;e++){var r=t[e];this.closeInterval(r)}}},{key:"releaseAllClient",value:function(){if(this.client&&(this.client.removeAllListeners(),this._client=void 0),this.screenClient&&(this.screenClient.removeAllListeners(),this._screenClient=void 0),this._subClient){for(var e=0,t=Object.keys(this._subClient);e<t.length;e++){var r=t[e];this._subClient[r]&&(this._subClient[r].removeAllListeners(),delete this._subClient[r])}this._subClient={}}}},{key:"reset",value:function(){this.publishedVideo=!1,this.publishedAudio=!1,this.localUid=void 0,this.releaseAllClient(),this.clearAllInterval(),this.cameraTrack&&this.closeMediaTrack(this.cameraTrack),this.microphoneTrack&&this.closeMediaTrack(this.microphoneTrack),this.cameraTestTrack&&this.closeTestTrack(this.cameraTestTrack),this.microphoneTestTrack&&this.closeTestTrack(this.microphoneTestTrack),this.screenVideoTrack&&this.closeScreenTrack(this.screenVideoTrack),this.screenAudioTrack&&this.closeScreenTrack(this.screenAudioTrack),this.joined=!1,this.publishedTrackIds=[],this.deviceList=[],this.subscribeVideoList=[],this.subscribeAudioList=[],this.unsubscribeAudioList=[],this.unsubscribeVideoList=[],this.videoMuted=!1,this.audioMuted=!1,this.channelName=""}},{key:"client",get:function(){return this._client}},{key:"screenClient",get:function(){return this._screenClient}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],n=t.slice(1);this.emit.apply(this,[a].concat(Object(ae.a)(n)))}},{key:"init",value:function(){var e=this;this._client=this.agoraWebSdk.createClient(this.clientConfig),this.client.on("user-joined",(function(e){})),this.client.on("user-left",(function(e){})),this.client.on("user-published",function(){var t=Object(v.a)(f.a.mark((function t(r,a){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("user-published ",r,a),r.uid===e.localScreenUid){t.next=14;break}if("audio"!==a){t.next=8;break}if(e.audioMuted){t.next=8;break}return console.log("subscribeAudio, user",r),t.next=7,e.client.subscribe(r,"audio");case 7:r.audioTrack&&!r.audioTrack.isPlaying&&r.audioTrack.play();case 8:if("video"!==a){t.next=14;break}if(e.videoMuted){t.next=14;break}return console.log("subscribeVideo, user",r),t.next=13,e.client.subscribe(r,"video");case 13:e.fire("user-published",{user:r,mediaType:a,channel:e.channelName});case 14:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),this.client.on("user-unpublished",(function(t,r){t.uid!==e.localScreenUid&&e.fire("user-unpublished",{user:t,mediaType:r,channel:e.channelName})})),this.client.on("token-privilege-did-expire",(function(){e.fire("token-privilege-did-expire")})),this.client.on("token-privilege-will-expire",(function(){e.fire("token-privilege-will-expire")})),this.client.on("connection-state-change",(function(t,r){e.fire("connection-state-change",{curState:t,revState:r})})),this.client.on("exception",(function(t){e.fire("exception",{err:t})})),this.client.on("stream-fallback",(function(t,r){e.fire("stream-fallback",{uid:t,isFallbackOrRecover:r})})),this.client.on("network-quality",(function(t){e.fire("network-quality",{downlinkNetworkQuality:t.downlinkNetworkQuality,uplinkNetworkQuality:t.uplinkNetworkQuality})}))}},{key:"release",value:function(){this.reset()}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.registerClientByChannelName(t.channel),Te.debug("web#join ".concat(JSON.stringify(t))),e.next=4,r.join(this.appId,t.channel,t.token,t.uid);case 4:return this.localUid=e.sent,this.joined=!0,this.channelName=t.channel,this._client=r,e.abrupt("return",this.localUid);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerClientByChannelName",value:function(e){var t=this,r=this.agoraWebSdk.createClient(this.clientConfig);return r.on("user-published",function(){var a=Object(v.a)(f.a.mark((function a(n,o){return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(console.log("user-published ",n,o),n.uid===t.localScreenUid){a.next=10;break}if("audio"!==o){a.next=6;break}return a.next=5,r.subscribe(n,"audio");case 5:n.audioTrack&&!n.audioTrack.isPlaying&&n.audioTrack.play();case 6:if("video"!==o){a.next=10;break}return a.next=9,r.subscribe(n,"video");case 9:t.fire("user-published",{user:n,mediaType:o,channel:e});case 10:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()),r.on("user-unpublished",(function(r,a){r.uid!==t.localScreenUid&&t.fire("user-unpublished",{user:r,mediaType:a,channel:e})})),r.on("token-privilege-did-expire",(function(){})),r.on("token-privilege-will-expire",(function(){})),r.on("connection-state-change",(function(r,a){t.fire("connection-state-change",{curState:r,revState:a,channel:e})})),r.on("exception",(function(r){t.fire("exception",{err:r,channel:e})})),r.on("stream-fallback",(function(r,a){t.fire("stream-fallback",{uid:r,isFallbackOrRecover:a,channel:e})})),r.on("network-quality",(function(r){t.fire("network-quality",{downlinkNetworkQuality:r.downlinkNetworkQuality,uplinkNetworkQuality:r.uplinkNetworkQuality,channel:e})})),this.addInterval((function(){var a=r.getRTCStats();t.fire("watch-rtt",{RTT:a.RTT,channel:e})}),"watch-rtt-".concat(e),null,300),r}},{key:"joinChannel",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._subClient[t.channel]){e.next=7;break}return r=this.registerClientByChannelName(t.channel),e.next=5,r.join(this.appId,t.channel,t.token,t.uid);case 5:return this._subClient[t.channel]=r,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"releaseChannel",value:function(e){this._subClient[e].removeAllListeners(),delete this._subClient[e]}},{key:"leaveChannel",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._subClient[t.channel])){e.next=5;break}return e.next=4,r.leave();case 4:this.releaseChannel(t.channel);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stopScreenShare();case 2:return e.next=4,this.client.leave();case 4:this.joined=!1;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"closeMediaTrack",value:function(e){e&&(e.stop(),e.close()),"video"===e.trackMediaType&&(this.cameraTrack=void 0),"audio"===e.trackMediaType&&(this.closeInterval("volume"),this.microphoneTrack=void 0)}},{key:"closeTestTrack",value:function(e){e&&(e.stop(),e.close()),"video"===e.trackMediaType&&(this.cameraTestTrack=void 0),"audio"===e.trackMediaType&&(this.closeInterval("test-volume"),this.microphoneTestTrack=void 0)}},{key:"muteAllVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.muteLocalVideo(t)].concat(this.subscribeVideoList.map((function(e){return a.muteRemoteVideo(e,t)}))),e.prev=1,e.next=4,Promise.all(r);case 4:this.videoMuted=t,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"muteAllAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[this.muteLocalAudio(t)].concat(this.subscribeAudioList.map((function(e){return a.muteRemoteAudio(e,t)}))),e.prev=1,e.next=4,Promise.all(r);case 4:this.audioMuted=t,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"muteLocalVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraTrack){e.next=3;break}return e.next=3,this.cameraTrack.setEnabled(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteLocalAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneTrack){e.next=3;break}return e.next=3,this.microphoneTrack.setEnabled(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateVideoList",value:function(e,t){if("subscribe"===t){-1===this.subscribeVideoList.findIndex((function(t){return t===e}))&&this.subscribeVideoList.push(e);var r=this.unsubscribeVideoList.findIndex((function(t){return t===e}));-1!==r&&this.unsubscribeVideoList.splice(r,1)}if("unsubscribe"===t){var a=this.subscribeVideoList.findIndex((function(t){return t===e}));-1!==a&&this.subscribeVideoList.splice(a,1),-1===this.unsubscribeVideoList.findIndex((function(t){return t===e}))&&this.unsubscribeVideoList.push(e)}}},{key:"updateAudioList",value:function(e,t){if("subscribe"===t){-1===this.subscribeAudioList.findIndex((function(t){return t===e}))&&this.subscribeAudioList.push(e);var r=this.unsubscribeAudioList.findIndex((function(t){return t===e}));-1!==r&&this.unsubscribeAudioList.splice(r,1)}if("unsubscribe"===t){var a=this.subscribeAudioList.findIndex((function(t){return t===e}));-1!==a&&this.subscribeAudioList.splice(a,1);var n=this.unsubscribeAudioList.findIndex((function(t){return t===e}));-1===n&&this.unsubscribeAudioList.push(n)}}},{key:"subscribeAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.subscribe(t,"audio");case 2:this.updateAudioList(t.uid,"subscribe");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribeAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.unsubscribe(t,"audio");case 2:this.updateAudioList(t.uid,"unsubscribe");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"subscribeVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("subscribe user",t),e.next=3,this.client.subscribe(t,"video");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribeVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.unsubscribe(t,"video");case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteRemoteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.client.remoteUsers.find((function(e){return e.uid===+t}))){e.next=3;break}return e.abrupt("return");case 3:if(!r){e.next=8;break}return e.next=6,this.unsubscribeVideo(a);case 6:e.next=9;break;case 8:console.log("call subscribeVideo");case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteRemoteVideoByClient",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.remoteUsers.find((function(e){return e.uid===+r}))){e.next=3;break}return e.abrupt("return");case 3:if(!a){e.next=8;break}return e.next=6,t.unsubscribe(n,"video");case 6:e.next=9;break;case 8:console.log("call subscribeVideo");case 9:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"muteRemoteAudioByClient",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.remoteUsers.find((function(e){return e.uid===+r}))){e.next=3;break}return e.abrupt("return");case 3:if(!a){e.next=9;break}return e.next=6,t.unsubscribe(n,"audio");case 6:this.fire("user-unpublished"),e.next=10;break;case 9:console.log("call subscribeVideo");case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"muteRemoteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.client.remoteUsers.find((function(e){return e.uid===+t}))){e.next=3;break}return e.abrupt("return");case 3:if(!r){e.next=8;break}return e.next=6,this.unsubscribeAudio(a);case 6:e.next=9;break;case 8:console.log("call subscribeAudio");case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te.info("[agora-web] invoke web#openCamera"),t){e.next=9;break}return e.next=4,this.agoraWebSdk.createCameraVideoTrack();case 4:this.cameraTrack=e.sent,this.cameraTrack.on("track-ended",(function(){n.cameraTrack&&n.closeMediaTrack(n.cameraTrack),n.fire("track-ended",{video:!0})})),Te.info("[agora-web] create default camera [".concat(this.cameraTrack.getTrackId(),"] video track success")),e.next=15;break;case 9:return e.next=11,this.agoraWebSdk.createCameraVideoTrack({cameraId:t.deviceId,encoderConfig:t.encoderConfig});case 11:this.cameraTrack=e.sent,r=this.cameraTrack.getTrackId(),this.cameraTrack.on("track-ended",(function(){n.cameraTrack&&n.closeMediaTrack(n.cameraTrack),n.fire("track-ended",{video:!0})})),Te.info("[agora-web] create camera [".concat(r,"], option: ").concat(JSON.stringify(t)," success"));case 15:if(!this.joined||!this.publishedVideo){e.next=20;break}return a=this.cameraTrack.getTrackId(),e.next=19,this.client.publish([this.cameraTrack]);case 19:Te.info("[agora-web] publish camera [".concat(a,"] success"));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te.info("[agora-web] invoke close#openCamera"),!this.cameraTrack){e.next=12;break}return e.prev=2,e.next=5,this.unpublishTrack(this.cameraTrack);case 5:this.cameraTrack&&(r=null===(t=this.cameraTestTrack)||void 0===t?void 0:t.getTrackId(),this.cameraTrack.isPlaying&&this.cameraTrack.stop(),this.cameraTrack.close(),Te.info("[agora-web] close camera [".concat(r,"] success")),this.cameraTrack=void 0),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),this.cameraTrack&&(n=null===(a=this.cameraTestTrack)||void 0===a?void 0:a.getTrackId(),this.cameraTrack.isPlaying&&this.cameraTrack.stop(),this.cameraTrack.close(),Te.info("[agora-web] close camera [".concat(n,"] success")),this.cameraTrack=void 0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te.info("[agora-web] invoke close#changeCamera"),!this.cameraTrack){e.next=9;break}return e.next=4,this.cameraTrack.setDevice(t);case 4:return e.next=6,this.agoraWebSdk.checkVideoTrackIsActive(this.cameraTrack);case 6:Te.info("[agora-web] changeCamera by deviceId: ".concat(t," success")),e.next=10;break;case 9:throw"no camera track found";case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te.info("[agora-web] invoke web#openMicrophone"),t){e.next=9;break}return e.next=4,this.agoraWebSdk.createMicrophoneAudioTrack();case 4:this.microphoneTrack=e.sent,this.microphoneTrack.on("track-ended",(function(){r.microphoneTrack&&r.closeMediaTrack(r.microphoneTrack),r.fire("track-ended",{audio:!0})})),Te.info("[agora-web] create audio track [".concat(this.microphoneTrack.getTrackId(),"] success")),e.next=14;break;case 9:return e.next=11,this.agoraWebSdk.createMicrophoneAudioTrack({microphoneId:t.deviceId});case 11:this.microphoneTrack=e.sent,this.microphoneTrack.on("track-ended",(function(){r.microphoneTrack&&r.closeMediaTrack(r.microphoneTrack),r.fire("track-ended",{audio:!0})})),Te.info("[agora-web] create audio track with  by deviceId: ".concat(t.deviceId," [").concat(this.microphoneTrack.getTrackId(),"] success"));case 14:if(this.microphoneTrack&&(this.microphoneTrack.stop(),Te.info("[agora-web] create audio track stop playback [".concat(this.microphoneTrack.getTrackId(),"] success"))),!this.joined||!this.publishedAudio){e.next=19;break}return e.next=18,this.client.publish([this.microphoneTrack]);case 18:Te.info("[agora-web] publish audio track [".concat(this.microphoneTrack.getTrackId(),"] success"));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this.cameraTrack)||void 0===r?void 0:r.setEncoderConfiguration(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeInterval",value:function(e){this.intervalMap[e]&&(clearInterval(this.intervalMap[e]),this.intervalMap[e]=void 0)}},{key:"addInterval",value:function(e,t,r,a){this.intervalMap[t]&&this.closeInterval(t),this.intervalMap[t]=setInterval(e,a,r)}},{key:"closeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Te.info("[agora-web] close microphone"),!this.microphoneTrack){e.next=12;break}return e.prev=2,e.next=5,this.unpublishTrack(this.microphoneTrack);case 5:this.microphoneTrack&&(this.microphoneTrack.stop(),this.microphoneTrack.close(),Te.info("[agora-web] close microphone success"),this.microphoneTrack=void 0),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),this.microphoneTrack&&(this.microphoneTrack.stop(),this.microphoneTrack.close(),Te.info("[agora-web] close microphone success"),this.microphoneTrack=void 0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneTrack){e.next=7;break}return e.next=3,this.microphoneTrack.setDevice(t);case 3:return e.next=5,this.agoraWebSdk.checkAudioTrackIsActive(this.microphoneTrack);case 5:e.next=8;break;case 7:throw"no microphone track found";case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeScreenTrack",value:function(e){if(e){e.stop(),e.close();var t=this.publishedTrackIds.indexOf(e.getTrackId);-1!==t&&this.publishedTrackIds.splice(t,1)}"video"===e.trackMediaType&&(this.screenVideoTrack=void 0),"audio"===e.trackMediaType&&(this.screenAudioTrack=void 0)}},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.agoraWebSdk.createClient(this.clientConfig),e.next=4,this.agoraWebSdk.createScreenVideoTrack({encoderConfig:t.encoderConfig},t.shareAudio);case 4:return a=e.sent,"enable"===t.shareAudio?(n=a,this.screenVideoTrack=n[0],this.screenAudioTrack=n[1]):this.screenVideoTrack=a,this.screenVideoTrack.on("track-ended",(function(){o.screenAudioTrack&&o.closeScreenTrack(o.screenAudioTrack),o.screenVideoTrack&&o.closeScreenTrack(o.screenVideoTrack),o.fire("track-ended",{screen:!0})})),this._screenClient=r,e.abrupt("return");case 11:throw e.prev=11,e.t0=e.catch(0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screenClient){e.next=2;break}return e.abrupt("return");case 2:return r=t.params,e.next=5,this.screenClient.join(this.appId,r.channel,r.token,r.uid);case 5:if(this.localScreenUid=e.sent,!this.screenAudioTrack){e.next=12;break}if(a=this.screenAudioTrack.getTrackId(),!(this.publishedTrackIds.indexOf(a)<0)){e.next=12;break}return e.next=11,this.screenClient.publish([this.screenAudioTrack]);case 11:this.publishedTrackIds.push(a);case 12:if(!this.screenVideoTrack){e.next=18;break}if(n=this.screenVideoTrack.getTrackId(),!(this.publishedTrackIds.indexOf(n)<0)){e.next=18;break}return e.next=17,this.screenClient.publish([this.screenVideoTrack]);case 17:this.publishedTrackIds.push(n);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screenClient){e.next=2;break}return e.abrupt("return");case 2:return this.screenAudioTrack&&this.closeScreenTrack(this.screenAudioTrack),this.screenVideoTrack&&this.closeScreenTrack(this.screenVideoTrack),e.next=6,this.screenClient.leave();case 6:this.screenClient.removeAllListeners(),this._screenClient=void 0,this.localScreenUid=void 0;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraTrack){e.next=7;break}if(t=this.cameraTrack.getTrackId(),!(this.publishedTrackIds.indexOf(t)<0)){e.next=7;break}return e.next=5,this.client.publish([this.cameraTrack]);case 5:this.publishedVideo=!0,this.publishedTrackIds.push(t);case 7:if(!this.microphoneTrack){e.next=14;break}if(r=this.microphoneTrack.getTrackId(),!(this.publishedTrackIds.indexOf(r)<0)){e.next=14;break}return e.next=12,this.client.publish([this.microphoneTrack]);case 12:this.publishedAudio=!0,this.publishedTrackIds.push(r);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unpublishTrack",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getTrackId(),a=this.publishedTrackIds.indexOf(r),!this.cameraTrack||this.cameraTrack.getTrackId()!==r){e.next=6;break}return e.next=5,this.client.unpublish([this.cameraTrack]);case 5:Te.info("[agora-web] unpublish camera track [".concat(r,"] success"));case 6:if(!this.microphoneTrack||this.microphoneTrack.getTrackId()!==r){e.next=10;break}return e.next=9,this.client.unpublish([this.microphoneTrack]);case 9:Te.info("[agora-web] unpublish microphone track [".concat(r,"] success"));case 10:this.publishedTrackIds.splice(a,1);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraTrack){e.next=8;break}if(t=this.cameraTrack.getTrackId(),-1===(r=this.publishedTrackIds.indexOf(t))){e.next=8;break}return e.next=6,this.client.unpublish([this.cameraTrack]);case 6:Te.info("[agora-web] unpublish camera track success"),this.publishedTrackIds.splice(r,1);case 8:if(!this.microphoneTrack){e.next=16;break}if(a=this.microphoneTrack.getTrackId(),-1===(n=this.publishedTrackIds.indexOf(a))){e.next=16;break}return e.next=14,this.client.unpublish([this.microphoneTrack]);case 14:Te.info("[agora-web] unpublish microphone track success"),this.publishedTrackIds.splice(n,1);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.agoraWebSdk.getDevices();case 2:return t=e.sent,this.deviceList=t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMicrophones",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.agoraWebSdk.getMicrophones();case 2:return t=e.sent,this.deviceList=t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCameras",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.agoraWebSdk.getCameras();case 2:return t=e.sent,this.deviceList=t,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changePlaybackVolume",value:function(e){this.client.localTracks.forEach((function(t){"audio"===t.trackMediaType&&t.setVolume(e)})),this.client.remoteUsers.forEach((function(t){var r;null===(r=t.audioTrack)||void 0===r||r.setVolume(e)}))}},{key:"openTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraTestTrack){e.next=2;break}throw"camera test track already exists";case 2:if(t){e.next=9;break}return e.next=5,this.agoraWebSdk.createCameraVideoTrack();case 5:this.cameraTestTrack=e.sent,this.cameraTestTrack.on("track-ended",(function(){console.log("track-ended"),r.cameraTestTrack&&r.closeMediaTrack(r.cameraTestTrack),r.fire("track-ended",{video:!0})})),e.next=13;break;case 9:return e.next=11,this.agoraWebSdk.createCameraVideoTrack({cameraId:t.deviceId,encoderConfig:t.encoderConfig});case 11:this.cameraTestTrack=e.sent,this.cameraTestTrack.on("track-ended",(function(){console.log("track-ended"),r.cameraTestTrack&&r.closeMediaTrack(r.cameraTestTrack),r.fire("track-ended",{video:!0})}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestCamera",value:function(){this.cameraTestTrack&&(this.cameraTestTrack.isPlaying&&this.cameraTestTrack.stop(),this.cameraTestTrack.close()),this.cameraTestTrack=void 0}},{key:"changeTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraTestTrack){e.next=7;break}return e.next=3,this.cameraTestTrack.setDevice(t);case 3:return e.next=5,this.agoraWebSdk.checkVideoTrackIsActive(this.cameraTestTrack);case 5:e.next=8;break;case 7:throw"no camera test track found";case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneTestTrack){e.next=2;break}throw"microphone test track already exists";case 2:if(t){e.next=9;break}return e.next=5,this.agoraWebSdk.createMicrophoneAudioTrack();case 5:this.microphoneTestTrack=e.sent,this.microphoneTestTrack.on("track-ended",(function(){r.microphoneTestTrack&&r.closeMediaTrack(r.microphoneTestTrack),r.fire("track-ended",{audio:!0})})),e.next=13;break;case 9:return e.next=11,this.agoraWebSdk.createMicrophoneAudioTrack({microphoneId:t.deviceId});case 11:this.microphoneTestTrack=e.sent,this.microphoneTestTrack.on("track-ended",(function(){r.microphoneTestTrack&&r.closeMediaTrack(r.microphoneTestTrack),r.fire("track-ended",{audio:!0})}));case 13:this.microphoneTestTrack&&this.addInterval((function(e){if(e){var t=e.getVolumeLevel();r.fire("volume-indication",{totalVolume:t})}}),"test-volume",this.microphoneTestTrack,300);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeTestResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this.cameraTestTrack)||void 0===r?void 0:r.setEncoderConfiguration(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestMicrophone",value:function(){this.microphoneTestTrack&&(this.closeInterval("test-volume"),this.microphoneTestTrack.isPlaying&&this.microphoneTestTrack.stop(),this.microphoneTestTrack.close()),this.microphoneTestTrack=void 0}},{key:"changeTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneTestTrack){e.next=7;break}return e.next=3,this.microphoneTestTrack.setDevice(t);case 3:return e.next=5,this.agoraWebSdk.checkAudioTrackIsActive(this.microphoneTestTrack);case 5:e.next=8;break;case 7:throw"no microphone test track found";case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter),Ee=r(2),Ue=function(e){return new Promise((function(t,r){return setTimeout(r,e,new Error("Timeout after ".concat(e," ms")))}))},Re=function(e){var t=encodeURI(e.name),r=t.substring(t.length,t.lastIndexOf("."));return{fileName:t,fileType:r}};function Pe(e){for(var t,r,a,n,o,i,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",l=0;l<e.length;)n=(t=e[l++])>>2,o=(3&t)<<4|(r=l<e.length?e[l++]:Number.NaN)>>4,i=(15&r)<<2|(a=l<e.length?e[l++]:Number.NaN)>>6,s=63&a,isNaN(r)?i=s=64:isNaN(a)&&(s=64),u+=c.charAt(n)+c.charAt(o)+c.charAt(i)+c.charAt(s);return u}var Ae,Ie,Le,Ne,Me,De,Ve,We,Fe,Be,ze,qe,Ge,Ke,Je,Ye,He,Qe,Xe,Ze,$e,et,tt,rt,at,nt,ot,it,st,ct,ut,lt,pt,dt,ht,mt,ft,vt,bt,gt,yt,kt,St,_t,Ot,wt,jt,xt,Tt,Ct,Et,Ut,Rt,Pt,At=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;Object(T.a)(this,r),(a=t.call(this)).client=void 0,a.logPath=void 0,a.videoSourceLogPath=void 0,a.role=void 0,a.joined=void 0,a.videoMuted=void 0,a.audioMuted=void 0,a.localUid=void 0,a.appId=void 0,a.subscribedList=[],a.cameraList=[],a.microphoneList=[],a.logPath=e.logPath,a.videoSourceLogPath=e.videoSourceLogPath,console.log("[electron-log], logPath: ".concat(a.logPath,", videoSourceLogPath: ").concat(a.videoSourceLogPath,", appId: ").concat(e.appId)),a.role=2,a.joined=!1,a.videoMuted=!1,a.audioMuted=!1,a.localUid=0,a.appId=e.appId,a.subscribedList=[],a.client=e.AgoraRtcEngine;var n=a.client.initialize(a.appId);if(n<0)throw{message:"AgoraRtcEngine initialize with APPID: ".concat(a.appId," failured"),code:n};return a.client.setChannelProfile(1),a.client.enableVideo(),a.client.enableAudio(),a.client.enableWebSdkInteroperability(!0),a.client.enableAudioVolumeIndication(1e3,3,!0),a.client.setVideoProfile(43,!1),a.client.setClientRole(2),a.logPath&&(console.log("[electron-log-path] set logPath: ".concat(a.logPath)),a.client.setLogFile(a.logPath)),a.init(),a}return Object(C.a)(r,[{key:"deviceList",get:function(){return this.cameraList.concat(this.microphoneList)}},{key:"setAddonLogPath",value:function(e){this.logPath=e.logPath,this.videoSourceLogPath=e.videoSourceLogPath}},{key:"enableLogPersist",value:function(){this.logPath&&(console.log("[electron-log-path] set logPath: ".concat(this.logPath)),this.client.setLogFile(this.logPath),window.setNodeAddonLogPath=this.logPath)}},{key:"changePlaybackVolume",value:function(e){var t=+(e/100*255).toFixed(0),r=this.client.setAudioPlaybackVolume(t);Te.info("setAudioPlaybackVolume ret",r)}},{key:"muteLocalVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.client.enableLocalVideo(!t);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteLocalAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.client.muteLocalAudioStream(t),this.client.enableLocalAudio(!t),Te.info("muteLocalAudio ret",r);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteRemoteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.client.muteRemoteVideoStream(t,r),Te.info("muteRemoteVideoStream ret",a);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteRemoteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.client.muteRemoteAudioStream(t,r),Te.info("muteRemoteAudioStream ret",a);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.role=2,this.joined=!1,this.videoMuted=!1,this.audioMuted=!1,this.localUid=void 0,this.subscribedList=[]}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],n=t.slice(1);this.emit.apply(this,[a].concat(Object(ae.a)(n)))}},{key:"init",value:function(){var e=this;this.client.on("error",(function(t){e.fire("exception",t)})),this.client.on("groupAudioVolumeIndication",(function(t,r,a){e.fire("volume-indication",{speakers:t,speakerNumber:r,totalVolume:a})})),this.client.on("userjoined",(function(t,r){Te.info("userjoined",t),e.fire("user-published",{user:{uid:t}})})),this.client.on("removestream",(function(t,r){Te.info("removestream",t),e.fire("user-unpublished",{user:{uid:t}})})),this.client.on("connectionStateChanged",(function(t,r){e.fire("connection-state-change",{curState:t,reason:r})})),this.client.on("networkquality",(function(){console.log("network-quality, uid: ",arguments.length<=0?void 0:arguments[0]," downlinkNetworkQuality: ",arguments.length<=1?void 0:arguments[1]," uplinkNetworkQuality ",arguments.length<=2?void 0:arguments[2]),e.fire("network-quality",{downlinkNetworkQuality:arguments.length<=1?void 0:arguments[1],uplinkNetworkQuality:arguments.length<=2?void 0:arguments[2]})})),this.client.on("remoteVideoStateChanged",(function(t,r,a){console.log("remoteVideoStateChanged ",a,t),5===a&&e.fire("user-unpublished",{user:{uid:t},mediaType:"video"}),6===a&&e.fire("user-published",{user:{uid:t},mediaType:"video"})})),this.client.on("remoteAudioStateChanged",(function(t,r,a){console.log("remoteAudioStateChanged ",a,t),5===a&&e.fire("user-unpublished",{user:{uid:t},mediaType:"audio"}),6===a&&Te.info("user-published audio",t)})),this.client.on("joinedchannel",(function(e,t){Te.info("joinedchannel",t)})),this.client.on("localVideoStateChanged",(function(t,r){e.fire("user-info-updated",{uid:e.localUid,state:t,type:"video",msg:r})})),this.client.on("localAudioStateChanged",(function(t,r){e.fire("user-info-updated",{uid:e.localUid,state:t,type:"audio",msg:r})})),this.client.on("tokenPrivilegeWillExpire",(function(){e.fire("token-privilege-will-expire")})),this.client.on("tokenPrivilegeDidExpire",(function(){e.fire("token-privilege-did-expire")})),this.client.on("localPublishFallbackToAudioOnly",(function(t){e.fire("stream-fallback",{uid:e.localUid,isFallbackOrRecover:t})})),this.client.on("remoteSubscribeFallbackToAudioOnly",(function(t,r){e.fire("stream-fallback",{uid:t,isFallbackOrRecover:r})})),this.client.on("rtcStats",(function(t){e.fire("rtcStats",t)}))}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.client.joinChannel(t.token,t.channel,t.info,t.uid),Te.info("electron joinChannel ",r),!(r<0)){e.next=5;break}throw{message:"joinChannel failure",code:r};case 5:return this.joined=!0,e.abrupt("return");case 9:throw e.prev=9,e.t0=e.catch(0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((t=this.client.setClientRole(2))<0)){e.next=4;break}throw{message:"setClientRole failure",code:t};case 4:if(!((t=this.client.leaveChannel())<0)){e.next=7;break}throw{message:"leaveChannel failure",code:t};case 7:return e.abrupt("return");case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this.client.release();if(e<0)throw{message:"release failure",code:e};this.reset()}},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((r=this.client.enableLocalVideo(!0))<0)){e.next=4;break}throw{message:"enableLocalVideo failure",code:r};case 4:t&&(t.deviceId&&this.client.setVideoDevice(t.deviceId),t.encoderConfig&&this.client.setVideoEncoderConfiguration(t.encoderConfig)),this.joined&&(r=this.client.muteLocalVideoStream(!1),Te.info("living muteLocalVideoStream, ret: ",r),this.videoMuted=!1),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"closeCamera",value:function(){try{var e=this.client.enableLocalVideo(!1);if(e<0)throw{message:"enableLocalVideo failure",code:e};if(Te.info("electron: closeCamera"),this.joined){if(e=this.client.muteLocalVideoStream(!0),this.videoMuted=!0,e<0)throw{message:"enableLocalVideo failure",code:e};Te.info("electron: muteCamera")}}catch(t){throw t}}},{key:"changeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((r=this.client.setVideoDevice(t))<0)){e.next=4;break}throw{message:"changeCamera failure",code:r};case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMicrophones",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.client.getAudioRecordingDevices(),r=t.map((function(e){return{deviceId:e.deviceid,label:e.devicename,kind:"audioinput"}})),this.microphoneList=r,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCameras",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.client.getVideoDevices(),r=t.map((function(e){return{deviceId:e.deviceid,label:e.devicename,kind:"videoinput"}})),this.cameraList=r,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Te.warn("changeResolution need implement",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"openMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((r=this.client.enableLocalAudio(!0))<0)){e.next=4;break}throw{message:"enableLocalAudio failure",code:r};case 4:t&&t.deviceId&&this.client.setAudioRecordingDevice(t.deviceId),this.joined&&(r=this.client.muteLocalAudioStream(!1),this.audioMuted=!1,Te.info("living muteLocalAudioStream, ret: ",r)),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"closeMicrophone",value:function(){try{var e=this.client.enableLocalAudio(!1);if(e<0)throw{message:"enableLocalAudio failure",code:e};this.client.stopAudioRecordingDeviceTest(),this.joined&&(e=this.client.muteLocalAudioStream(!0),this.audioMuted=!0)}catch(t){throw t}}},{key:"changeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((r=this.client.setAudioRecordingDevice(t))<0)){e.next=4;break}throw{message:"setAudioRecordingDevice failure",code:r};case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=this.client.getScreenWindowsInfo(),!t.filter((function(e){return!e.image})).length){e.next=5;break}throw{code:"ELECTRON_PERMISSION_DENIED"};case 5:return e.abrupt("return",t.map((function(e){return{ownerName:e.ownerName,name:e.name,windowId:e.windowId,image:Pe(e.image)}})));case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise((function(e,r){var n=t.config||{profile:50,rect:{x:0,y:0,width:0,height:0},param:{width:0,height:0,bitrate:500,frameRate:15}};Te.info("startScreenShare#options",t);try{var o=a.client.videoSourceInitialize(a.appId);o<0&&r({message:"videoSourceInitialize with APPID: ".concat(a.appId," failured"),code:o}),a.client.videoSourceSetChannelProfile(1),a.client.videoSourceEnableWebSdkInteroperability(!0),a.client.videoSourceSetVideoProfile(n&&n.profile?n.profile:50,!1),console.log("[electron-log-path] checkout videoSourceLogPath: ".concat(a.videoSourceLogPath)),a.videoSourceLogPath&&(a.client.videoSourceSetLogFile(a.videoSourceLogPath),window.setNodeAddonVideoSourceLogPath=a.videoSourceLogPath,console.log("[electron-log-path] set videoSourceLogPath: ".concat(a.videoSourceLogPath)));var i=function r(o){a.client.off("videoSourceJoinedSuccess",r),Te.info("startScreenShare#options uid, ",o,"  options",t),a.client.videoSourceStartScreenCaptureByWindow(t.windowId,n.rect,n.param),a.client.startScreenCapturePreview(),e(o)};a.client.on("videoSourceJoinedSuccess",i);var s=t.params;o=a.client.videoSourceJoin(s.token,s.channel,s.joinInfo?s.joinInfo:"",s.uid),Te.info("videoSourceJoin ret",o,s),o<0&&(a.client.off("videoSourceJoinedSuccess",i),r({message:"videoSourceJoin failure",code:o}))}catch(c){a.client.off("videoSourceJoinedSuccess",(function(){})),r(c)}})),e.next=3,Promise.race([r,Ue(8e3)]);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Promise((function(e,t){var a=function t(a){r.client.off("videoSourceLeaveChannel",t),setTimeout(e,1)};try{r.client.on("videoSourceLeaveChannel",a);var n=r.client.videoSourceLeave();Te.info("stopScreenShare leaveChannel",n),Ue(8e3).catch((function(e){r.client.off("videoSourceLeaveChannel",a),t(e)}))}catch(o){r.client.off("videoSourceLeaveChannel",a),t(o)}})),e.prev=1,e.next=4,t;case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Te.info("Raw Message: media-service#publish, prepare"),this.joined?(Te.info("Raw Message: media-service#publish, publish"),this.client.setClientRole(1)):Te.info("before invoke publish, please join channel first");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.joined?this.client.setClientRole(2):Te.info("before invoke unpublish, please join channel first");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.joined){e.next=2;break}throw"electron not support openTestCamera";case 2:return e.next=4,this.openCamera(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestCamera",value:function(){if(this.joined)throw"electron not support closeTestCamera";this.closeCamera()}},{key:"changeTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.joined){e.next=2;break}throw"electron not support changeTestCamera";case 2:return e.next=4,this.changeCamera(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.joined){e.next=2;break}throw"electron not support openTestMicrophone";case 2:return e.next=4,this.openMicrophone(t);case 4:this.client.startAudioRecordingDeviceTest(300);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeTestResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.joined){e.next=2;break}throw"electron not support changeTestResolution";case 2:return e.next=4,this.changeResolution(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestMicrophone",value:function(){if(this.joined)throw"electron not support closeTestMicrophone";this.closeMicrophone()}},{key:"changeTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.joined){e.next=2;break}throw"electron not support changeTestMicrophone";case 2:return e.next=4,this.changeMicrophone(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter),It=(et=$e=function(){function e(t){Object(T.a)(this,e),Object(te.a)(this,"settingVisible",Ie,this),Object(te.a)(this,"activeDeviceItem",Le,this),Object(te.a)(this,"cameraTestResult",Ne,this),Object(te.a)(this,"microphoneTestResult",Me,this),Object(te.a)(this,"speakerTestResult",De,this),Object(te.a)(this,"resolutionIdx",Ve,this),Object(te.a)(this,"deviceList",We,this),Object(te.a)(this,"cameraLabel",Fe,this),Object(te.a)(this,"microphoneLabel",Be,this),this._totalVolume=void 0,Object(te.a)(this,"_cameraId",ze,this),Object(te.a)(this,"_microphoneId",qe,this),Object(te.a)(this,"resolution",Ge,this),Object(te.a)(this,"_playbackVolume",Ke,this),Object(te.a)(this,"_cameraRenderer",Je,this),Object(te.a)(this,"_microphoneTrack",Ye,this),Object(te.a)(this,"_screenVideoRenderer",He,this),Object(te.a)(this,"totalVolume",Qe,this),this.appStore=void 0,Object(te.a)(this,"cameraList",Xe,this),Object(te.a)(this,"microphoneList",Ze,this),this.appStore=t}return Object(C.a)(e,[{key:"showSetting",value:function(){this.settingVisible=!0}},{key:"hideSetting",value:function(){this.settingVisible=!1}},{key:"setActiveItem",value:function(e){this.activeDeviceItem=e}},{key:"setCameraTestResult",value:function(e){this.cameraTestResult=e}},{key:"setMicrophoneTestResult",value:function(e){this.microphoneTestResult=e}},{key:"setSpeakerTestResult",value:function(e){this.speakerTestResult=e}},{key:"cameraId",get:function(){var e=this,t=this.cameraList.findIndex((function(t){return t.label===e.cameraLabel}));return this.cameraList[t]?this.cameraList[t].deviceId:""}},{key:"microphoneId",get:function(){var e=this,t=this.microphoneList.findIndex((function(t){return t.label===e.microphoneLabel}));return this.microphoneList[t]?this.microphoneList[t].deviceId:""}},{key:"playbackVolume",get:function(){return this._playbackVolume?this._playbackVolume:this.mediaService.getPlaybackVolume()}},{key:"changePlaybackVolume",value:function(e){this.mediaService.changePlaybackVolume(e),this._playbackVolume=e}},{key:"cameraRenderer",get:function(){return this._cameraRenderer}},{key:"resetCameraTrack",value:function(){this._cameraRenderer=void 0}},{key:"resetMicrophoneTrack",value:function(){this._microphoneTrack=void 0}},{key:"reset",value:function(){this.resolutionIdx=0,this.totalVolume=0,this.cameraLabel="",this.microphoneLabel="",this.web.reset(),this.resetCameraTrack(),this.resetMicrophoneTrack(),this.activeDeviceItem="video",this.cameraTestResult="default",this.microphoneTestResult="default",this.speakerTestResult="default"}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};t.video&&this.mediaService.getCameras().then((function(t){Object(Ee.p)((function(){e.cameraList=t}))})),t.audio&&this.mediaService.getMicrophones().then((function(t){Object(Ee.p)((function(){e.microphoneList=t}))}))}},{key:"mediaService",get:function(){return this.appStore.eduManager.mediaService}},{key:"web",get:function(){return this.mediaService.sdkWrapper}},{key:"isWeb",get:function(){return this.mediaService.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.mediaService.sdkWrapper instanceof At}},{key:"openTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._cameraId,e.next=3,this.mediaService.openTestCamera({deviceId:t});case 3:this._cameraRenderer=this.mediaService.cameraTestRenderer,this.cameraLabel=this.mediaService.getTestCameraLabel(),this._cameraId=this.cameraId;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"closeTestCamera",value:function(){this.mediaService.closeTestCamera(),this.resetCameraTrack()}},{key:"changeTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeTestCamera(t);case 2:this.cameraLabel=this.mediaService.getTestCameraLabel(),this._cameraId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._microphoneId,e.next=3,this.mediaService.openTestMicrophone({deviceId:t});case 3:this.isWeb&&(this._microphoneTrack=this.web.microphoneTrack),this.microphoneLabel=this.mediaService.getTestMicrophoneLabel(),this.mediaService.on("volume-indication",(function(e){e.speakers,e.speakerNumber;var t=e.totalVolume;Object(Ee.p)((function(){r.isElectron?r.totalVolume=Number((t/255).toFixed(3)):r.totalVolume=t}))})),this._microphoneId=this.microphoneId;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"closeTestMicrophone",value:function(){this.mediaService.closeTestMicrophone(),this.resetMicrophoneTrack(),this.mediaService.off("volume-indication",(function(e){e.speakers,e.speakerNumber,e.totalVolume}))}},{key:"changeTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeTestMicrophone(t);case 2:this.microphoneLabel=this.mediaService.getTestMicrophoneLabel(),this._microphoneId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeTestResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeTestResolution(t);case 2:Object(Ee.p)((function(){r.resolution=t}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"speakerLabel",get:function(){return this.appStore.uiStore.isElectron?this.appStore.eduManager.mediaService.getSpeakerLabel():"\u9ed8\u8ba4"}}]),e}(),$e.resolutions=[{name:"480p",value:"480p_1"},{name:"720p",value:"720p_1"},{name:"1080p",value:"1080p_1"}],Ae=et,Ie=Object(re.a)(Ae.prototype,"settingVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(Ae.prototype,"showSetting",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"showSetting"),Ae.prototype),Object(re.a)(Ae.prototype,"hideSetting",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"hideSetting"),Ae.prototype),Le=Object(re.a)(Ae.prototype,"activeDeviceItem",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"video"}}),Object(re.a)(Ae.prototype,"setActiveItem",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"setActiveItem"),Ae.prototype),Ne=Object(re.a)(Ae.prototype,"cameraTestResult",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),Me=Object(re.a)(Ae.prototype,"microphoneTestResult",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),De=Object(re.a)(Ae.prototype,"speakerTestResult",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),Object(re.a)(Ae.prototype,"setCameraTestResult",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"setCameraTestResult"),Ae.prototype),Object(re.a)(Ae.prototype,"setMicrophoneTestResult",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"setMicrophoneTestResult"),Ae.prototype),Object(re.a)(Ae.prototype,"setSpeakerTestResult",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"setSpeakerTestResult"),Ae.prototype),Ve=Object(re.a)(Ae.prototype,"resolutionIdx",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),We=Object(re.a)(Ae.prototype,"deviceList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fe=Object(re.a)(Ae.prototype,"cameraLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Be=Object(re.a)(Ae.prototype,"microphoneLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ze=Object(re.a)(Ae.prototype,"_cameraId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qe=Object(re.a)(Ae.prototype,"_microphoneId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(Ae.prototype,"cameraId",[Ee.h],Object.getOwnPropertyDescriptor(Ae.prototype,"cameraId"),Ae.prototype),Object(re.a)(Ae.prototype,"microphoneId",[Ee.h],Object.getOwnPropertyDescriptor(Ae.prototype,"microphoneId"),Ae.prototype),Ge=Object(re.a)(Ae.prototype,"resolution",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"480p_1"}}),Object(re.a)(Ae.prototype,"playbackVolume",[Ee.h],Object.getOwnPropertyDescriptor(Ae.prototype,"playbackVolume"),Ae.prototype),Ke=Object(re.a)(Ae.prototype,"_playbackVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(Ae.prototype,"changePlaybackVolume",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"changePlaybackVolume"),Ae.prototype),Je=Object(re.a)(Ae.prototype,"_cameraRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Ye=Object(re.a)(Ae.prototype,"_microphoneTrack",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),He=Object(re.a)(Ae.prototype,"_screenVideoRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(Ae.prototype,"cameraRenderer",[Ee.h],Object.getOwnPropertyDescriptor(Ae.prototype,"cameraRenderer"),Ae.prototype),Qe=Object(re.a)(Ae.prototype,"totalVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(Ae.prototype,"resetCameraTrack",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"resetCameraTrack"),Ae.prototype),Object(re.a)(Ae.prototype,"resetMicrophoneTrack",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"resetMicrophoneTrack"),Ae.prototype),Object(re.a)(Ae.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"reset"),Ae.prototype),Xe=Object(re.a)(Ae.prototype,"cameraList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ze=Object(re.a)(Ae.prototype,"microphoneList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(Ae.prototype,"openTestCamera",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"openTestCamera"),Ae.prototype),Object(re.a)(Ae.prototype,"closeTestCamera",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"closeTestCamera"),Ae.prototype),Object(re.a)(Ae.prototype,"changeTestCamera",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"changeTestCamera"),Ae.prototype),Object(re.a)(Ae.prototype,"openTestMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"openTestMicrophone"),Ae.prototype),Object(re.a)(Ae.prototype,"closeTestMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"closeTestMicrophone"),Ae.prototype),Object(re.a)(Ae.prototype,"changeTestMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"changeTestMicrophone"),Ae.prototype),Object(re.a)(Ae.prototype,"changeTestResolution",[Ee.f],Object.getOwnPropertyDescriptor(Ae.prototype,"changeTestResolution"),Ae.prototype),Object(re.a)(Ae.prototype,"speakerLabel",[Ee.h],Object.getOwnPropertyDescriptor(Ae.prototype,"speakerLabel"),Ae.prototype),Ae),Lt=(vt=ft=function(){function e(t){Object(T.a)(this,e),Object(te.a)(this,"loading",rt,this),Object(te.a)(this,"boardLoading",at,this),Object(te.a)(this,"uploading",nt,this),Object(te.a)(this,"converting",ot,this),Object(te.a)(this,"notice",it,this),Object(te.a)(this,"dialog",st,this),Object(te.a)(this,"settingDialog",ct,this),Object(te.a)(this,"toastQueue",ut,this),Object(te.a)(this,"autoplayToast",lt,this),this.appStore=void 0,Object(te.a)(this,"dialogs",pt,this),Object(te.a)(this,"_language",dt,this),Object(te.a)(this,"curSeqId",ht,this),Object(te.a)(this,"lastSeqId",mt,this),this.appStore=t}return Object(C.a)(e,[{key:"addToast",value:function(e){this.toastQueue.push(e)}},{key:"removeToast",value:function(e){var t=this.toastQueue.findIndex((function(t){return t===e}));-1!==t&&this.toastQueue.splice(t,1)}},{key:"showAutoplayNotification",value:function(){this.autoplayToast=!0}},{key:"removeAutoplayNotification",value:function(){this.autoplayToast=!1}},{key:"platform",get:function(){return"web"}},{key:"isElectron",get:function(){return"electron"===this.platform}},{key:"isWeb",get:function(){return"web"===this.platform}},{key:"reset",value:function(){this.settingDialog=!1,this.loading=!1,this.uploading=!1,this.boardLoading=!1,this.converting=!1,this.notice=void 0,this.dialog=void 0,this.toastQueue=[],this.autoplayToast=!1,this.dialogs=[]}},{key:"startLoading",value:function(){this.loading=!0}},{key:"stopLoading",value:function(){this.loading=!1}},{key:"startBoardLoading",value:function(){this.loading=!1}},{key:"stopBoardLoading",value:function(){this.loading=!0}},{key:"startConverting",value:function(){this.converting=!0}},{key:"stopConverting",value:function(){this.converting=!1}},{key:"startUploading",value:function(){this.uploading=!0}},{key:"stopUploading",value:function(){this.uploading=!1}},{key:"showNotice",value:function(e){this.notice=e}},{key:"removeNotice",value:function(){this.notice=void 0}},{key:"showDialog",value:function(e){this.addDialog(e)}},{key:"addDialog",value:function(e){this.dialogs.push({dialog:e,id:this.dialogs.length})}},{key:"removeDialog",value:function(e){var t=this.dialogs.findIndex((function(t){return t.id===e}));-1!==t&&this.dialogs.splice(t,1)}},{key:"ipc",get:function(){return window.ipc}},{key:"windowMinimum",value:function(){this.isElectron&&this.ipc&&this.ipc.send("minimum")}},{key:"windowMaximum",value:function(){this.isElectron&&this.ipc&&this.ipc.send("maximum")}},{key:"windowClose",value:function(){this.isElectron&&this.ipc&&this.ipc.send("close")}},{key:"language",get:function(){return this._language}},{key:"setLanguage",value:function(e){this._language=e,U.setLanguage(this._language)}},{key:"hasDialog",value:function(e){return this.dialogs.find((function(t){return t.dialog.type===e}))}},{key:"updateCurSeqId",value:function(e){this.curSeqId=e}},{key:"updateLastSeqId",value:function(e){this.lastSeqId=e}}]),e}(),ft.roomTypes=[{path:"one-to-one",text:"home.1v1",value:0},{path:"small-class",text:"home.mini_class",value:1},{path:"big-class",text:"home.large_class",value:2}],ft.languages=[{text:"\u4e2d\u6587",name:"zh-CN"},{text:"En",name:"en"}],tt=vt,rt=Object(re.a)(tt.prototype,"loading",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),at=Object(re.a)(tt.prototype,"boardLoading",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nt=Object(re.a)(tt.prototype,"uploading",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ot=Object(re.a)(tt.prototype,"converting",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),it=Object(re.a)(tt.prototype,"notice",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=Object(re.a)(tt.prototype,"dialog",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=Object(re.a)(tt.prototype,"settingDialog",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ut=Object(re.a)(tt.prototype,"toastQueue",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(tt.prototype,"addToast",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"addToast"),tt.prototype),Object(re.a)(tt.prototype,"removeToast",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"removeToast"),tt.prototype),lt=Object(re.a)(tt.prototype,"autoplayToast",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(tt.prototype,"showAutoplayNotification",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"showAutoplayNotification"),tt.prototype),Object(re.a)(tt.prototype,"removeAutoplayNotification",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"removeAutoplayNotification"),tt.prototype),Object(re.a)(tt.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"reset"),tt.prototype),Object(re.a)(tt.prototype,"startLoading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"startLoading"),tt.prototype),Object(re.a)(tt.prototype,"stopLoading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"stopLoading"),tt.prototype),Object(re.a)(tt.prototype,"startBoardLoading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"startBoardLoading"),tt.prototype),Object(re.a)(tt.prototype,"stopBoardLoading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"stopBoardLoading"),tt.prototype),Object(re.a)(tt.prototype,"startConverting",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"startConverting"),tt.prototype),Object(re.a)(tt.prototype,"stopConverting",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"stopConverting"),tt.prototype),Object(re.a)(tt.prototype,"startUploading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"startUploading"),tt.prototype),Object(re.a)(tt.prototype,"stopUploading",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"stopUploading"),tt.prototype),Object(re.a)(tt.prototype,"showNotice",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"showNotice"),tt.prototype),Object(re.a)(tt.prototype,"removeNotice",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"removeNotice"),tt.prototype),pt=Object(re.a)(tt.prototype,"dialogs",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(tt.prototype,"showDialog",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"showDialog"),tt.prototype),Object(re.a)(tt.prototype,"addDialog",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"addDialog"),tt.prototype),Object(re.a)(tt.prototype,"removeDialog",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"removeDialog"),tt.prototype),dt=Object(re.a)(tt.prototype,"_language",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return U.getLanguage()}}),Object(re.a)(tt.prototype,"language",[Ee.h],Object.getOwnPropertyDescriptor(tt.prototype,"language"),tt.prototype),Object(re.a)(tt.prototype,"setLanguage",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"setLanguage"),tt.prototype),ht=Object(re.a)(tt.prototype,"curSeqId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(tt.prototype,"updateCurSeqId",[Ee.f],Object.getOwnPropertyDescriptor(tt.prototype,"updateCurSeqId"),tt.prototype),mt=Object(re.a)(tt.prototype,"lastSeqId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tt),Nt=r(50);!function(e){e[e.EduClassroomStateTypeAllStudentsChat=0]="EduClassroomStateTypeAllStudentsChat",e[e.EduClassroomStateTypeCourseState=1]="EduClassroomStateTypeCourseState",e[e.EduClassroomStateTypeRoomAttrs=2]="EduClassroomStateTypeRoomAttrs"}(bt||(bt={})),function(e){e[e.add=1]="add",e[e.modify=2]="modify",e[e.remove=3]="remove"}(gt||(gt={})),function(e){e[e.courseState=1]="courseState",e[e.roomMediaState=2]="roomMediaState",e[e.roomChatState=3]="roomChatState",e[e.roomPropertiesStateChanged=4]="roomPropertiesStateChanged",e[e.userListChanged=20]="userListChanged",e[e.userStateUpdated=21]="userStateUpdated",e[e.streamListChanged=40]="streamListChanged",e[e.boardState=60]="boardState",e[e.boardUserState=61]="boardUserState",e[e.customMessage=99]="customMessage"}(yt||(yt={})),function(e){e[e.peer=1]="peer",e[e.roomInfo=2]="roomInfo",e[e.userStream=3]="userStream",e[e.customMessage=99]="customMessage"}(kt||(kt={})),function(e){e[e.teacher=1]="teacher",e[e.student=2]="student",e[e.assistant=3]="assistant"}(St||(St={})),function(e){e.teacher="host",e.audience="audience",e.student="broadcaster"}(_t||(_t={})),function(e){e[e.none=0]="none",e[e.mic=1]="mic"}(Ot||(Ot={})),function(e){e[e.none=0]="none",e[e.camera=1]="camera",e[e.screen=2]="screen"}(wt||(wt={})),jt||(jt={}),xt||(xt={}),Tt||(Tt={}),Ct||(Ct={}),function(e){e[e.Scene1v1=0]="Scene1v1",e[e.SceneSmall=1]="SceneSmall",e[e.SceneLarge=2]="SceneLarge"}(Et||(Et={})),function(e){e[e.EduClassroomType1V1=0]="EduClassroomType1V1",e[e.EduClassroomTypeSmall=1]="EduClassroomTypeSmall",e[e.EduClassroomTypeBig=2]="EduClassroomTypeBig"}(Ut||(Ut={})),Rt||(Rt={}),function(e){e[e.EduCourseStatePending=0]="EduCourseStatePending",e[e.EduCourseStateStart=1]="EduCourseStateStart",e[e.EduCourseStateStop=2]="EduCourseStateStop"}(Pt||(Pt={}));var Mt,Dt=function(){function e(t){Object(T.a)(this,e),this._user=void 0,this._ts=void 0,this._state=void 0,this._streamUuid=void 0,this._rtcToken=void 0,this._screenRtcToken=void 0,this._rtmToken=void 0,this._streamsMap={},this.updateUser(t),t.hasOwnProperty("rtcToken")&&(this._rtcToken=t.rtcToken),t.hasOwnProperty("screenRtcToken")&&(this._screenRtcToken=t.screenRtcToken),t.hasOwnProperty("rtmToken")&&(this._rtmToken=t.rtmToken)}return Object(C.a)(e,[{key:"rtmToken",get:function(){return this._rtmToken}},{key:"updateUser",value:function(e){var t=e.updateTime,r=e.state,a=e.streamUuid,n=e.rtcToken,o=e.screenRtcToken,i=Object(Nt.a)(e,["updateTime","state","streamUuid","rtcToken","screenRtcToken"]);this._user=i,e.hasOwnProperty("updateTime")&&(this._ts=t),e.hasOwnProperty("state")&&(this._state=r),e.hasOwnProperty("streamUuid")&&(this._streamUuid=a),n&&this.setRtcToken(n),o&&this.setScreenRtcToken(o)}},{key:"updateState",value:function(e){this._state=e}},{key:"setRtcToken",value:function(e){this._rtcToken=e}},{key:"setScreenRtcToken",value:function(e){this._screenRtcToken=e}},{key:"rtcToken",get:function(){return this._rtcToken}},{key:"screenRtcToken",get:function(){return this._screenRtcToken}},{key:"streamUuid",get:function(){return this._streamUuid}},{key:"user",get:function(){return this._user}},{key:"ts",get:function(){return this._ts}},{key:"state",get:function(){return this._state}},{key:"streams",get:function(){return this._streamsMap}},{key:"updateStreamsMap",value:function(e){this._streamsMap=e}}],[{key:"fromArray",value:function(t){return t.reduce((function(t,r){return t.push(new e({state:r.state,updateTime:r.updateTime,userUuid:r.userUuid,userName:r.userName,role:r.role,userProperties:r.userProperties,isChatAllowed:r.isChatAllowed,streamUuid:r.streamUuid})),t}),[])}},{key:"combineLatest",value:function(e){return this.fromArray(e).reduce((function(e,t){var r=e.findIndex((function(e){return e.user.userUuid===t.user.userUuid}));return-1!==r?e[r]=t:e.push(t),e}),[])}}]),e}(),Vt=function(){function e(t){Object(T.a)(this,e),this._stream=void 0,this._rtcToken=void 0,this._ts=void 0,this._state=void 0,this.updateStream(t)}return Object(C.a)(e,[{key:"updateStreamUuid",value:function(e){this._stream&&(this._stream.streamUuid=e)}},{key:"updateMediaState",value:function(e){this._stream&&(e.hasOwnProperty("hasAudio")&&(this._stream.hasAudio=e.hasAudio),e.hasOwnProperty("hasVideo")&&(this._stream.hasVideo=e.hasVideo))}},{key:"updateStream",value:function(e){var t=e.updateTime,r=e.state,a=e.token,n=Object(Nt.a)(e,["updateTime","state","token"]);this._stream?this._stream=Object(h.a)(Object(h.a)({},this._stream),n):this._stream=n,console.log("...stream",this._stream),e.hasOwnProperty("updateTime")&&(this._ts=t),e.hasOwnProperty("state")&&(this._state=r),e.hasOwnProperty("token")&&(this._rtcToken=a)}},{key:"updateTime",value:function(e){this._ts=e}},{key:"update",value:function(e){this.updateStream({updateTime:e.ts,token:e.token,state:e.state,streamUuid:e.stream.streamUuid,streamName:e.stream.streamName,videoSourceType:e.stream.videoSourceType,audioSourceType:e.stream.audioSourceType,hasVideo:e.stream.hasVideo,hasAudio:e.stream.hasAudio,userInfo:e.stream.userInfo})}},{key:"modifyStream",value:function(e){var t=e.updateTime,r=e.state,a=e.token,n=Object(Nt.a)(e,["updateTime","state","token"]);e.hasOwnProperty("updateTime")&&(this._ts=t),e.hasOwnProperty("state")&&(this._state=r),e.hasOwnProperty("token")&&(this._rtcToken=a),Object(E.isEmpty)(n)||(this._stream=Object(h.a)(Object(h.a)({},this._stream),n))}},{key:"setRtcToken",value:function(e){this._rtcToken=e}},{key:"token",get:function(){return this._rtcToken}},{key:"state",get:function(){return this._state}},{key:"stream",get:function(){return this._stream}},{key:"ts",get:function(){return this._ts}}],[{key:"fromArray",value:function(t){return t.reduce((function(t,r){return t.push(new e({streamUuid:r.streamUuid,streamName:r.streamName,videoSourceType:r.videoSourceType,audioSourceType:r.audioSourceType,hasVideo:r.videoState,hasAudio:r.audioState,userInfo:r.userInfo,state:r.state})),t}),[])}},{key:"combineLatest",value:function(e){return this.fromArray(e).reduce((function(e,t){var r=e.findIndex((function(e){return e.stream.streamUuid===t.stream.streamUuid}));return-1!==r?e[r]=t:e.push(t),e}),[])}}]),e}(),Wt=function(){function e(){Object(T.a)(this,e)}return Object(C.a)(e,null,[{key:"readMessage",value:function(e){try{return JSON.parse(e)}catch(t){return Te.warn(t),null}}},{key:"getStreamsFromUserList",value:function(e){console.log("getStreamsFromUserList#data",e);return[]}},{key:"getOperator",value:function(e){return{userUuid:Object(E.get)(e,"operator.userUuid"),userName:Object(E.get)(e,"operator.userName"),role:Object(E.get)(e,"operator.role")}}},{key:"getFromUser",value:function(e){return{userUuid:Object(E.get)(e,"fromUser.userUuid"),userName:Object(E.get)(e,"fromUser.userName"),role:Object(E.get)(e,"fromUser.role")}}},{key:"getEduCustomMessage",value:function(e){return{fromUser:this.getFromUser(e),message:Object(E.get)(e,"message"),timestamp:Object(E.get)(e,"ts")}}},{key:"getEduTextMessage",value:function(e){return{fromUser:this.getFromUser(e),type:Object(E.get)(e,"type"),message:Object(E.get)(e,"message"),timestamp:Object(E.get)(e,"ts")}}},{key:"getRoomInfo",value:function(e){return{roomInfo:Object(E.get)(e,"roomInfo"),roomState:Object(E.get)(e,"roomState")}}},{key:"getUserStream",value:function(e){return{step:Object(E.get)(e,"step"),count:Object(E.get)(e,"count"),total:Object(E.get)(e,"total"),nextId:Object(E.get)(e,"nextId"),nextTs:Object(E.get)(e,"nextTs"),isFinished:Object(E.get)(e,"isFinished"),list:Object(E.get)(e,"list")}}},{key:"roomStatus",value:function(e){return{courseState:e.state,startTime:e.startTime,isStudentChatAllowed:this.isStudentChatAllowed(e),onlineUsersCount:this.onlineUsersCount(e)}}},{key:"onlineUsersCount",value:function(e){return Object(E.get)(e.users,"length",0)}},{key:"isStudentChatAllowed",value:function(e){var t=Object(E.get)(e,"muteChat.audience"),r=Object(E.get)(e,"muteChat.broadcaster");return!t&&!r}},{key:"getUsersStreams",value:function(e){console.log("[serializer] getUserStreams: ",e);var t=[],r=Object(E.get)(e,"onlineUsers",[]).reduce((function(e,r){e.push({userUuid:r.userUuid,userName:r.userName,role:r.role,isChatAllowed:r.muteChat,userProperties:r.userProperties,streamUuid:r.streamUuid,updateTime:r.updateTime,state:r.state});var a=Object(E.get)(r,"streams",[]).map((function(e){return{streamUuid:e.streamUuid,streamName:e.streamName,videoSourceType:e.videoSourceType,audioSourceType:e.audioSourceType,videoState:e.videoState,audioState:e.audioState,userInfo:{userUuid:r.userUuid,userName:r.userName,role:r.role},state:e.state}}));return t=t.concat(Vt.fromArray(a)),e}),[]),a=Object(E.get)(e,"offlineUsers",[]).reduce((function(e,r){e.push({userUuid:r.userUuid,userName:r.userName,role:r.role,isChatAllowed:r.muteChat,userProperties:r.userProperties,streamUuid:r.streamUuid,updateTime:r.updateTime,state:r.state});var a=Object(E.get)(r,"streams",[]).map((function(e){return{streamUuid:e.streamUuid,streamName:e.streamName,videoSourceType:e.videoSourceType,audioSourceType:e.audioSourceType,videoState:e.videoState,audioState:e.audioState,userInfo:{userUuid:r.userUuid,userName:r.userName,role:r.role},state:e.state}}));return t=t.concat(Vt.fromArray(a)),e}),[]),n=Dt.fromArray(r),o=Dt.fromArray(a),i=t.filter((function(e){return 0!==e.state})),s=t.filter((function(e){return 0===e.state}));return console.log("[EduUsersStreams] onlineUsers: ",n),console.log("[EduUsersStreams] offlineUsers: ",o),console.log("[EduUsersStreams] onlineStreams: ",i),console.log("[EduUsersStreams] offlineStreams: ",s),{onlineUsers:n,onlineStreams:i,offlineUsers:o,offlineStreams:s}}},{key:"getUsers",value:function(e){return{onlineUsers:Dt.fromArray(Object(E.get)(e,"onlineUsers",[]).map((function(e){return{userUuid:e.userUuid,userName:e.userName,role:e.role,isChatAllowed:e.muteChat,userProperties:e.userProperties,streamUuid:e.streamUuid,updateTime:e.updateTime,state:e.state}}))),offlineUsers:Dt.fromArray(Object(E.get)(e,"offlineUsers",[]).map((function(e){return{userUuid:e.userUuid,userName:e.userName,state:e.state,role:e.role,isChatAllowed:e.muteChat,userProperties:e.userProperties,streamUuid:e.streamUuid,updateTime:e.updateTime}})))}}},{key:"getChangedUser",value:function(e){var t={userUuid:Object(E.get)(e,"userUuid"),userName:Object(E.get)(e,"userName"),role:Object(E.get)(e,"role"),updateTime:Object(E.get)(e,"updateTime"),state:Object(E.get)(e,"state",1),isChatAllowed:Object(E.get)(e,"muteChat"),userProperties:Object(E.get)(e,"userProperties"),streamUuid:Object(E.get)(e,"streamUuid")};return new Dt(t)}},{key:"getAction",value:function(e){return Object(E.get)(e,"action")}},{key:"getStreams",value:function(e){return[new Vt({streamUuid:Object(E.get)(e,"streamUuid"),streamName:Object(E.get)(e,"streamName"),videoSourceType:+Object(E.get)(e,"videoSourceType",0),audioSourceType:+Object(E.get)(e,"audioSourceType",0),hasVideo:!!Object(E.get)(e,"videoState",0),hasAudio:!!Object(E.get)(e,"audioState",0),updateTime:Object(E.get)(e,"updateTime"),state:Object(E.get)(e,"state"),userInfo:this.getFromUser(e)})]}},{key:"getFollowMode",value:function(e){return+Object(E.get)(e,"followMode")}},{key:"getBoardUsersState",value:function(e){return e.reduce((function(e,t){return t.userUuid&&e.push(t),e}),[])}}]),e}(),Ft=r(66),Bt=r.n(Ft),zt=(Bt.a.LOG_FILTER_OFF,Bt.a.LOG_FILTER_ERROR,Bt.a.LOG_FILTER_INFO,Bt.a.LOG_FILTER_WARNING,Bt.a.LOG_FILTER_DEBUG,Bt.a.LOG_FILTER_OFF);!function(e){e[e.isFinished=1]="isFinished"}(Mt||(Mt={}));var qt,Gt=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this)).agoraRtm=e,a.localUid=void 0,a.logged=void 0,a.connectionState="DISCONNECTED",a.prevConnectionState="",a.channels={},a._client=void 0,a._streamList=[],a._userList=[],a._channels={},a.localUid=void 0,a.logged=!1,a.connectionState="DISCONNECTED",a.prevConnectionState="",a.channels={},a._client=void 0,a._streamList=[],a._userList=[],a}return Object(C.a)(r,[{key:"client",get:function(){return this._client}},{key:"releaseChannels",value:function(){for(var e=0,t=Object.keys(this.channels);e<t.length;e++){var r=t[e];this.channels[r]&&this.release(this.channels[r]),this.channels[r]=void 0}}},{key:"releaseClient",value:function(){this._client&&this.release(this._client)}},{key:"reset",value:function(){this.localUid=void 0,this.logged=!1,this.connectionState="DISCONNECTED",this.prevConnectionState="",this.releaseClient(),this.releaseChannels(),this.channels={},this.client&&(this.client.removeAllListeners(),console.log("[rtmWrapper] removeAllListeners")),this._client=void 0,this.removeAllListeners(),console.log("[rtmWrapper] self removeAllListeners"),this._streamList=[],this._userList=[]}},{key:"addStream",value:function(e){this._streamList.push(e)}},{key:"updateStream",value:function(e){var t=this._streamList.findIndex((function(t){return t.streamUuid===e.streamUuid})),r=this._streamList[t];r&&r&&this._streamList[t]}},{key:"resetDataList",value:function(){this._streamList=[],this._userList=[]}},{key:"release",value:function(e){e.removeAllListeners(),console.log("[rtmWrapper]  eventClient removeAllListeners ")}},{key:"login",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.agoraRtm.createInstance(t.appId,{enableLogUpload:t.uploadLog,logFilter:zt})).on("ConnectionStateChanged",(function(e,t){a.prevConnectionState=a.connectionState,a.connectionState=e,a.emit("ConnectionStateChanged",{newState:e,reason:t})})),r.on("MessageFromPeer",(function(e,t,r){a.emit("MessageFromPeer",{message:e,peerId:t,props:r})})),e.next=5,r.login({uid:t.userUuid,token:t.rtmToken});case 5:this._client=r;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.agoraRtm.createInstance(t.appId,{enableLogUpload:t.uploadLog,logFilter:zt}),a=null,console.log("[rtm]  wrapper init"),e.prev=3,r.on("ConnectionStateChanged",(function(e,t){console.log("[rtm] [Wrapper] ConnectionStateChanged"),n.prevConnectionState=n.connectionState,n.connectionState=e,n.emit("ConnectionStateChanged",{newState:e,reason:t})})),r.on("MessageFromPeer",(function(e,t,r){console.log("[rtm] [Wrapper] MessageFromPeer"),n.emit("MessageFromPeer",{message:e,peerId:t,props:r})})),e.next=8,r.login({uid:t.uid,token:t.token});case 8:this._client=r,this.channels[t.channelName]=a,this.logged=!0,e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(3),!r){e.next=18;break}return e.next=18,r.logout();case 18:throw this.reset(),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createObserverChannel",value:function(e){return[this.client.createChannel(e.channelName),new ie.EventEmitter]}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.on("ChannelMessage",(function(e,t,n){console.log("[rtm] ChannelMessage",e),r.emit("ChannelMessage",{channelName:a.channelName,message:e,memberId:t,messagePros:n})})),t.on("MemberJoined",(function(e){r.emit("MemberJoined",{channelName:a.channelName,memberId:e})})),t.on("MemberLeft",(function(e){r.emit("MemberLeft",{channelName:a.channelName,memberId:e})})),t.on("MemberCountUpdated",(function(e){r.emit("MemberCountUpdated",{channelName:a.channelName,memberCount:e})})),e.next=7,t.join();case 7:this.channels[a.channelName]=t,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r=this.channels[t.channelName])){e.next=7;break}return e.next=5,r.leave();case 5:r.removeAllListeners(),delete this.channels[t.channelName];case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"destroyRtm",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client){e.next=3;break}return e.next=3,this.client.logout();case 3:for(t=0,r=Object.keys(this.channels);t<r.length;t++)a=r[t],this.channels[a]&&(this.channels[a].removeAllListeners(),console.log("[rtmWrapper]  removeAllListeners ",a),this.channels[a]=void 0);this.reset();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendChannelMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.channels[t],e.next=3,n.sendMessage(r,{enableHistoricalMessaging:a.enableHistoricalMessaging});case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"sendPeerMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.sendMessageToPeer(r,t,{enableHistoricalMessaging:a.enableHistoricalMessaging});case 2:return n=e.sent,e.abrupt("return",n.hasPeerReceived);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter),Kt=r(14),Jt=r(54),Yt=r.n(Jt),Ht=function(){function e(t){Object(T.a)(this,e),this.context=void 0,this._playing=!1,this.local=!1,this.sourceType="screen",this.uid=0,this.videoTrack=void 0,this.uuid=void 0,this.context=t.context,this.uid=t.uid,t.videoTrack&&(this.videoTrack=t.videoTrack),this.uuid=Yt()(),this.sourceType=t.sourceType}return Object(C.a)(e,[{key:"play",value:function(e,t){throw new Error("Method not implemented.")}},{key:"stop",value:function(){throw new Error("Method not implemented.")}},{key:"isWeb",get:function(){return this.context.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.context.sdkWrapper instanceof At}},{key:"web",get:function(){return this.context.sdkWrapper}},{key:"electron",get:function(){return this.context.sdkWrapper}}]),e}(),Qt=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this,e)).local=!0,a}return Object(C.a)(r,[{key:"play",value:function(e,t){this.isWeb&&this.videoTrack&&this.videoTrack.play(e),this.isElectron&&("default"===this.sourceType?(this.electron.client.setupLocalVideo(e),this.electron.client.setupViewContentMode(+this.uid,0)):(this.electron.client.setupLocalVideoSource(e),this.electron.client.setupViewContentMode("videosource",1)),this.electron.client.setClientRole(1),Te.info("Raw Message: setClientRole(1) in LocalUserRenderer"),this.electron.client.startPreview()),this._playing=!0}},{key:"stop",value:function(e){this.isWeb&&(this.videoTrack&&this.videoTrack.stop(),this.videoTrack),this.isElectron&&"default"===this.sourceType&&(this.electron.client.stopPreview(),e&&this.electron.client.setClientRole(2)),this._playing=!1}},{key:"getUuid",value:function(){return this.uuid}}]),r}(Ht),Xt=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this,e)).local=!1,a.uid=e.uid,a}return Object(C.a)(r,[{key:"play",value:function(e,t){this.isWeb&&this.videoTrack&&this.videoTrack.play(e),this.isElectron&&(this.electron.client.subscribe(+this.uid,e),t?this.electron.client.setupViewContentMode(+this.uid,1):this.electron.client.setupViewContentMode(+this.uid,0)),this._playing=!0}},{key:"stop",value:function(){this.isWeb&&this.videoTrack&&this.videoTrack.stop(),this.isElectron,this._playing=!1}},{key:"getUuid",value:function(){return this.uuid}}]),r}(Ht),Zt=r(112),$t=r.n(Zt);!function(e){e[e.fillContentMode=0]="fillContentMode",e[e.fitContentMode=1]="fitContentMode"}(qt||(qt={}));var er,tr=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;if(Object(T.a)(this,r),(a=t.call(this)).sdkWrapper=void 0,a.cameraTestRenderer=void 0,a.cameraRenderer=void 0,a.microphoneTrack=void 0,a.screenRenderer=void 0,a.remoteUsersRenderer=[],a.screenShareIds=[],Te.info("[rtcProvider] appId: ".concat(e.appId,", platform: ").concat(e.platform)),"electron"===e.platform){var n=e.electronLogPath;a.sdkWrapper=new At({logPath:n.logPath,videoSourceLogPath:n.videoSourceLogPath,AgoraRtcEngine:e.agoraSdk,appId:e.appId}),window.ipc&&window.ipc.once("initialize",(function(e,t){var r=t[0],n=t[2];window.videoSourceLogPath=n,window.logPath=r,console.log("[media-service] set logPath: ".concat(r,", ").concat(n)),a.electron.setAddonLogPath({logPath:r,videoSourceLogPath:n}),a.electron.enableLogPersist()}))}else a.sdkWrapper=new Ce({uploadLog:!0,agoraWebSdk:e.agoraSdk,webConfig:{mode:"live",codec:e.codec,role:"host"},appId:e.appId});return a.sdkWrapper.on("watch-rtt",(function(e){a.fire("watch-rtt",e)})),a.sdkWrapper.on("network-quality",(function(e){a.fire("network-quality",e)})),a.sdkWrapper.on("connection-state-change",(function(e){console.log("[media-service] connection-state-change >>>>>>>>>>>",e),a.fire("connection-state-change",{curState:e})})),a.sdkWrapper.on("volume-indication",(function(e){var t=e.totalVolume;a.fire("volume-indication",{totalVolume:t})})),a.sdkWrapper.on("exception",(function(e){a.fire("exception",e)})),a.sdkWrapper.on("user-unpublished",(function(e){var t=e.user;if("audio"!==e.mediaType){Te.debug("sdkwrapper user-unpublished",t);var r=a.remoteUsersRenderer.findIndex((function(e){return e.uid===t.uid}));if(-1!==r){var n=a.remoteUsersRenderer[r];a.remoteUsersRenderer.splice(r,1),a.fire("user-unpublished",{remoteUserRender:n})}}})),a.sdkWrapper.on("user-published",(function(e){var t=e.user;Te.debug("sdkwrapper user-published",t);var r=a.remoteUsersRenderer.findIndex((function(e){return e.uid===t.uid}));-1===r?a.remoteUsersRenderer.push(new Xt({context:Object(Kt.a)(a),uid:+t.uid,videoTrack:t.videoTrack,sourceType:"default"})):t.videoTrack&&(a.remoteUsersRenderer[r].videoTrack=t.videoTrack),a.fire("user-published",{remoteUserRender:a.remoteUsersRenderer[r]})})),a.sdkWrapper.on("rtcStats",(function(e){a.fire("rtcStats",e)})),a.cameraRenderer=void 0,a.screenRenderer=void 0,a.remoteUsersRenderer=[],$t.a.onCameraChanged=function(e){a.fire("video-device-changed",e)},$t.a.onMicrophoneChanged=function(e){a.fire("audio-device-changed",e)},$t.a.onAudioAutoplayFailed=function(){a.fire("audio-autoplay-failed")},a}return Object(C.a)(r,[{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=t[0],n=t.slice(1);["volume-indication","watch-rtt","network-quality"].includes(a)||Te.info(n[0],n),this.emit.apply(this,[a].concat(Object(ae.a)(n)))}},{key:"isWeb",get:function(){return this.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.sdkWrapper instanceof At}},{key:"getTestCameraLabel",value:function(){if(this.isWeb&&this.web.cameraTestTrack)return this.web.cameraTestTrack.getTrackLabel();if(this.isElectron){var e=this.electron.client.getCurrentVideoDevice(),t=this.electron.client.getVideoDevices().find((function(t){return t.deviceid===e}));if(t)return t.devicename}return""}},{key:"getTestMicrophoneLabel",value:function(){if(this.isWeb&&this.web.microphoneTestTrack)return this.web.microphoneTestTrack.getTrackLabel();if(this.isElectron){var e=this.electron.client.getCurrentAudioRecordingDevice(),t=this.electron.client.getAudioRecordingDevices().find((function(t){return t.deviceid===e}));if(t)return t.devicename}return""}},{key:"getCameraLabel",value:function(){if(this.isWeb&&this.web.cameraTrack)return this.web.cameraTrack.getTrackLabel();if(this.isElectron){var e=this.electron.client.getCurrentVideoDevice(),t=this.electron.client.getVideoDevices().find((function(t){return t.deviceid===e}));if(t)return t.devicename}return""}},{key:"getSpeakerLabel",value:function(){return this.isElectron?this.electron.client.getPlaybackDeviceInfo()[0].devicename:""}},{key:"getMicrophoneLabel",value:function(){if(this.isWeb&&this.web.microphoneTrack)return this.web.microphoneTrack.getTrackLabel();if(this.isElectron){var e=this.electron.client.getCurrentAudioRecordingDevice(),t=this.electron.client.getAudioRecordingDevices().find((function(t){return t.deviceid===e}));if(t)return t.devicename}return""}},{key:"changePlaybackVolume",value:function(e){this.isWeb&&this.sdkWrapper.changePlaybackVolume(e),this.isElectron&&this.sdkWrapper.changePlaybackVolume(e)}},{key:"muteLocalVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.muteLocalVideo(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.muteLocalVideo(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteLocalAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.muteLocalAudio(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.muteLocalAudio(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteRemoteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.muteRemoteVideo(t,r);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.muteRemoteVideo(t,r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteRemoteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.muteRemoteAudio(t,r);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.muteRemoteAudio(t,r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteRemoteVideoByClient",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=5;break}return e.next=3,this.sdkWrapper.muteRemoteVideoByClient(t,r,a);case 3:e.next=6;break;case 5:throw"electron not implemented";case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"muteRemoteAudioByClient",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=5;break}return e.next=3,this.sdkWrapper.muteRemoteAudioByClient(t,r,a);case 3:e.next=6;break;case 5:throw"electron not implemented";case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"web",get:function(){return this.sdkWrapper}},{key:"electron",get:function(){return this.sdkWrapper}},{key:"init",value:function(){this.isWeb&&this.sdkWrapper.init(),this.isElectron&&this.sdkWrapper.init()}},{key:"release",value:function(){this.isWeb&&this.sdkWrapper.release(),this.isElectron&&this.sdkWrapper.release()}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.join(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.join(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.leave();case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.leave();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"joinChannel",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=5;break}return e.next=3,this.sdkWrapper.joinChannel(t);case 3:e.next=6;break;case 5:throw"electron no implement";case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveChannel",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=5;break}return e.next=3,this.sdkWrapper.leaveChannel(t);case 3:e.next=6;break;case 5:throw"electron no implement";case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publish",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.publish();case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.publish();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unpublish",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.unpublish();case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.unpublish();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=6;break}return e.next=3,this.sdkWrapper.openCamera(t);case 3:if(this.web.cameraTrack){e.next=5;break}return e.abrupt("return");case 5:this.cameraRenderer?this.cameraRenderer.videoTrack=this.web.cameraTrack:this.cameraRenderer=new Qt({context:this,uid:0,sourceType:"default",videoTrack:this.web.cameraTrack});case 6:if(!this.isElectron){e.next=10;break}return e.next=9,this.sdkWrapper.openCamera();case 9:this.cameraRenderer||(this.cameraRenderer=new Qt({context:this,uid:0,sourceType:"default"}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.changeCamera(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.changeCamera(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.closeCamera();case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.closeCamera();case 6:this.cameraRenderer&&(this.cameraRenderer.stop(),this.cameraRenderer=void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=4;break}return e.next=3,this.sdkWrapper.openMicrophone(t);case 3:this.microphoneTrack=this.web.microphoneTrack;case 4:if(!this.isElectron){e.next=8;break}return e.next=7,this.sdkWrapper.openMicrophone(t);case 7:this.microphoneTrack={};case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.changeMicrophone(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.changeMicrophone(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdkWrapper.closeMicrophone();case 2:this.microphoneTrack=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=6;break}return e.next=3,this.sdkWrapper.openTestCamera(t);case 3:if(this.web.cameraTestTrack){e.next=5;break}return e.abrupt("return");case 5:this.cameraTestRenderer?this.cameraTestRenderer.videoTrack=this.web.cameraTestTrack:this.cameraTestRenderer=new Qt({context:this,uid:0,sourceType:"default",videoTrack:this.web.cameraTestTrack});case 6:if(!this.isElectron){e.next=10;break}return e.next=9,this.sdkWrapper.openTestCamera();case 9:this.cameraTestRenderer||(this.cameraTestRenderer=new Qt({context:this,uid:0,sourceType:"default"}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestCamera",value:function(){this.sdkWrapper.closeTestCamera(),this.cameraTestRenderer&&(this.cameraTestRenderer.stop(),this.cameraTestRenderer=void 0)}},{key:"changeTestCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.changeTestCamera(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.changeTestCamera(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeTestResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.web.changeTestResolution(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.electron.changeTestResolution(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdkWrapper.openTestMicrophone(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeTestMicrophone",value:function(){this.sdkWrapper.closeTestMicrophone()}},{key:"changeTestMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdkWrapper.changeTestMicrophone(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCameras",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=4;break}return e.next=3,this.web.getCameras();case 3:return e.abrupt("return",e.sent);case 4:if(!this.isElectron){e.next=8;break}return e.next=7,this.electron.getCameras();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMicrophones",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=4;break}return e.next=3,this.web.getMicrophones();case 3:return e.abrupt("return",e.sent);case 4:if(!this.isElectron){e.next=8;break}return e.next=7,this.electron.getMicrophones();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},!this.isWeb){e.next=5;break}return e.next=4,this.sdkWrapper.prepareScreenShare(t);case 4:this.screenRenderer=new Qt({context:this,uid:0,videoTrack:this.web.screenVideoTrack,sourceType:"screen"});case 5:if(!this.isElectron){e.next=10;break}return e.next=8,this.sdkWrapper.prepareScreenShare();case 8:return r=e.sent,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.startScreenShare(t);case 3:if(!this.isElectron){e.next=7;break}return e.next=6,this.sdkWrapper.startScreenShare(t);case 6:this.screenRenderer=new Qt({context:this,uid:0,videoTrack:void 0,sourceType:"screen"});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.sdkWrapper.stopScreenShare();case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.sdkWrapper.stopScreenShare();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=3;break}return e.next=3,this.web.changeResolution(t);case 3:if(!this.isElectron){e.next=6;break}return e.next=6,this.electron.changeResolution(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPlaybackVolume",value:function(){return this.isElectron?+(this.electron.client.getAudioPlaybackVolume()/255*100).toFixed(1):100}},{key:"reset",value:function(){this.isWeb&&this.web.reset(),this.isElectron&&this.electron.reset()}}]),r}(ie.EventEmitter);!function(e){e[e.studentApply=1]="studentApply",e[e.teacherReject=2]="teacherReject",e[e.studentCancel=3]="studentCancel",e[e.teacherAccept=4]="teacherAccept",e[e.teacherStop=5]="teacherStop",e[e.studentStop=6]="studentStop"}(er||(er={}));var rr,ar=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this)).roomManager=void 0,a.roomManager=e,a}return Object(C.a)(r,[{key:"roomUuid",get:function(){return this.roomManager.roomUuid}},{key:"apiService",get:function(){return this.roomManager.apiService}},{key:"localUser",get:function(){return this.roomManager.data.localUser?this.roomManager.data.localUser.user:{}}},{key:"localUserUuid",get:function(){return this.localUser.userUuid}},{key:"localStream",get:function(){return this.roomManager.data.localStreamData}},{key:"screenStream",get:function(){return this.roomManager.data.localScreenShareStream}},{key:"data",get:function(){return this.roomManager.data}},{key:"publishStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.upsertBizStream({roomUuid:this.roomUuid,userUuid:this.localUserUuid,streamUuid:t.streamUuid,streamName:t.streamName,audioState:+t.hasAudio,videoState:+t.hasVideo,videoSourceType:t.videoSourceType,audioSourceType:t.audioSourceType});case 2:return r=e.sent,a=new Vt({state:1,streamUuid:t.streamUuid,streamName:t.streamName,hasAudio:t.hasAudio,hasVideo:t.hasVideo,videoSourceType:t.videoSourceType,audioSourceType:t.audioSourceType,token:r.rtcToken,userInfo:{userUuid:this.data.localUser.user.userUuid,userName:this.data.localUser.user.userName,role:this.data.localUser.user.role},updateTime:r.ts}),this.data.upsertLocalStream("main",a),e.abrupt("return",{streamUuid:r.streamUuid,rtcToken:r.rtcToken});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unpublishStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.deleteBizStream({roomUuid:this.roomUuid,userUuid:this.localUserUuid,streamUuid:t.streamUuid});case 2:e.sent,Te.info("[EDU-STATE] unpublish stream remove local stream, streamUuid: ",t.streamUuid),this.data.removeLocalStream(t.streamUuid);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRoomMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sendChannelMessage({roomUuid:this.roomUuid,msg:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendUserMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sendPeerMessage({roomUuid:this.roomUuid,userId:r.userUuid,msg:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendRoomChatMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sendRoomChatMessage({message:t,roomUuid:this.roomUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendUserChatMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sendUserChatMessage({message:t,remoteUser:r,roomUuid:this.roomUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateRoomProperties",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.updateRoomProperties({roomUuid:this.roomUuid,key:t.key,value:t.value,cause:t.cause});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCourseState",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.updateCourseState({roomUuid:this.roomUuid,courseState:+t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"kickUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.kickUser({roomUuid:this.roomUuid,userUuid:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"allowStudentChatByRole",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.allowStudentChatByRole({roomUuid:this.roomUuid,enable:t,roles:r});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"allowRemoteStudentChat",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.allowRemoteStudentChat({roomUuid:this.roomUuid,userUuid:r.userUuid,muteChat:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"startShareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s,c,u,l,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.screenStream&&this.screenStream.stream&&this.screenStream.stream.streamUuid)){e.next=11;break}return e.next=3,this.apiService.upsertBizStream({roomUuid:this.roomUuid,userUuid:this.localUserUuid,streamName:this.screenStream.stream.streamName,streamUuid:this.screenStream.stream.streamUuid,videoSourceType:this.screenStream.stream.videoSourceType,audioSourceType:this.screenStream.stream.audioSourceType,videoState:this.screenStream.stream.hasVideo,audioState:this.screenStream.stream.hasAudio});case 3:t=e.sent,r=t.rtcToken,a=t.streamUuid,n=t.ts,o=new Vt({state:1,streamUuid:a,streamName:this.screenStream.stream.streamName,hasAudio:!0,hasVideo:!0,videoSourceType:wt.screen,audioSourceType:Ot.mic,token:r,userInfo:{userUuid:this.data.localUser.user.userUuid,userName:this.data.localUser.user.userName,role:this.data.localUser.user.role},updateTime:n}),this.data.upsertLocalStream("screen",o),e.next=23;break;case 11:return i=new Vt({state:1,streamUuid:"0",streamName:"".concat(this.localUser.userName,"\u7684\u5c4f\u5e55\u5171\u4eab"),hasAudio:!0,hasVideo:!0,videoSourceType:wt.screen,audioSourceType:Ot.mic,token:"",userInfo:{userUuid:this.data.localUser.user.userUuid,userName:this.data.localUser.user.userName,role:this.data.localUser.user.role}}),s={roomUuid:this.roomUuid,userUuid:this.localUserUuid,streamName:i.stream.streamName,streamUuid:i.stream.streamUuid,audioState:+i.stream.hasAudio,videoState:+i.stream.hasVideo,videoSourceType:wt.screen,audioSourceType:Ot.mic},e.next=15,this.apiService.upsertBizStream(s);case 15:c=e.sent,u=c.rtcToken,l=c.streamUuid,p=c.ts,i.setRtcToken(u),i.updateStreamUuid(l),i.updateTime(p),this.data.upsertLocalStream("screen",i);case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopShareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.screenStream){e.next=5;break}return e.next=3,this.apiService.stopShareScreen(this.roomUuid,this.screenStream.stream.streamUuid,this.data.localUser.user.userUuid);case 3:Te.info("[EDU-STATE] unpublish stream remove local screen stream, streamUuid: ",this.screenStream.stream.streamUuid),this.data.removeLocalStream(this.screenStream.stream.streamUuid);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"remoteStartStudentCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.remoteStartStudentCamera({roomUuid:this.roomUuid,userUuid:t.userInfo.userUuid,streamUuid:t.streamUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStopStudentCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.remoteStopStudentCamera({roomUuid:this.roomUuid,userUuid:t.userInfo.userUuid,streamUuid:t.streamUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStartStudentMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.remoteStartStudentMicrophone({roomUuid:this.roomUuid,userUuid:t.userInfo.userUuid,streamUuid:t.streamUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStopStudentMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.remoteStopStudentMicrophone({roomUuid:this.roomUuid,userUuid:t.userInfo.userUuid,streamUuid:t.streamUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteCloseStudentStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.remoteCloseStudentStream({roomUuid:this.roomUuid,userUuid:t.userInfo.userUuid,streamUuid:t.streamUuid});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateMainStreamState",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=+this.localStream.stream.hasAudio,a=+this.localStream.stream.hasVideo,n=t.hasOwnProperty("audioState")?+t.audioState:r,o=t.hasOwnProperty("videoState")?+t.videoState:a,console.log("args>>> ",t,this.localStream.stream,t),e.next=7,this.apiService.updateBizStream({roomUuid:this.roomUuid,userUuid:this.localUserUuid,streamUuid:this.data.streamMap.main.streamUuid,videoSourceType:this.localStream.stream.videoSourceType,audioSourceType:this.localStream.stream.audioSourceType,videoState:o,audioState:n,streamName:this.localStream.stream.streamName});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"muteStudentChatByRoles",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.allowStudentChatByRole({enable:!0,roomUuid:this.roomUuid,roles:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unmuteStudentChatByRoles",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.allowStudentChatByRole({enable:!1,roomUuid:this.roomUuid,roles:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendCoVideoApply",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.studentApply}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"acceptCoVideoApply",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.teacherAccept}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rejectCoVideoApply",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.teacherReject}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"inviteStreamBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.inviteUserPublishStream(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"studentCancelApply",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.studentCancel}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"studentCloseStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.studentCancel}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"teacherCloseStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.stringify({cmd:1,data:{userUuid:t.userUuid,userName:t.userName,type:er.teacherStop}}),e.next=3,this.apiService.sendUserChatMessage({message:r,remoteUser:t,roomUuid:this.roomUuid});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter),nr=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this))._roomUuid=void 0,a.rawRoomUuid="",a._roomName=void 0,a.eduManager=void 0,a._apiService=void 0,a._userService=void 0,a._rtmObserver=void 0,a.eduManager=e.eduManager,a.rawRoomUuid=e.roomUuid,a._roomUuid=e.roomUuid,a._roomName=e.roomName,a._apiService=e.apiService,a._userService=void 0,a._rtmObserver=void 0,a}return Object(C.a)(r,[{key:"syncingData",get:function(){return!["DISCONNECTED","RECONNECTING"].includes(this.eduManager.rtmConnectionState)&&(this.data,!0)}},{key:"roomName",get:function(){return this._roomName}},{key:"roomUuid",get:function(){return this._roomUuid}},{key:"apiService",get:function(){return this._apiService}},{key:"localUser",get:function(){return this.data.localUser}},{key:"userService",get:function(){return this._userService}},{key:"data",get:function(){return this.eduManager._dataBuffer[this.rawRoomUuid]}},{key:"prepareRoomJoin",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[breakout] params ",t.userRole),e.next=3,this.apiService.joinRoom({roomUuid:t.roomUuid,userRole:t.userRole,userName:t.userName,userUuid:t.userUuid,streamUuid:t.streamUuid?t.streamUuid:"0"});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rtmWrapper",get:function(){return this.eduManager._rtmWrapper}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Te.debug("join classroom ".concat(this.roomUuid)),r=Object(h.a)(Object(h.a)({},t),{},{roomUuid:this.roomUuid,roomName:this.roomName}),e.next=4,this.prepareRoomJoin(r);case 4:if(a=e.sent,Te.debug("join classroom [prepareRoomJoin] ".concat(this.roomUuid," success")),!this.rtmWrapper){e.next=18;break}return n=this.rtmWrapper.createObserverChannel({channelName:this.roomUuid}),o=Object(b.a)(n,2),i=o[0],(s=o[1]).on("ChannelMessage",(function(e){if(console.log("[rtm] ChannelMessage channelName",e.channelName),e.channelName===c.roomUuid)try{var t=Wt.readMessage(e.message.text);if(null===t)return console.warn("[room] ChannelMessage is invalid",t);var r=t.sequence,a=t.cmd,n=t.version,o=t.data;if(Te.info("[EDU-STATE] Raw ChannelMessage",JSON.stringify(t)),1!==n)return Te.warn("using old version");var i={seqId:r,cmd:a,data:o};console.log("appendBuffer in Raw Message ",i),c.data.appendBuffer({seqId:r,cmd:a,data:o}),c.data.asyncBatchUpdateData(500)}catch(s){console.error(s)}})),e.next=11,this.rtmWrapper.join(i,s,{channelName:this.roomUuid});case 11:return this._rtmObserver=s,this.data.setLocalData(a),e.next=15,this.data.syncFullSequence();case 15:this.data.BatchUpdateData(),this._userService=new ar(this),Te.debug("join classroom ".concat(this.roomUuid," success"));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._rtmObserver&&(this._rtmObserver.removeAllListeners(),this._rtmObserver=void 0),Te.debug("leave classroom ".concat(this.roomUuid)),!this.eduManager._rtmWrapper){e.next=8;break}return Te.debug("leave this.rtmWrapper ".concat(this.roomUuid)),e.next=6,this.eduManager._rtmWrapper.leave({channelName:this.roomUuid});case 6:delete this.eduManager._dataBuffer[this.rawRoomUuid],Te.debug("leave classroom ".concat(this.roomUuid," success"));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"userToken",get:function(){return this.data.userToken}},{key:"joinRTC",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveRTC",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocalStreamData",value:function(){return this.data.localStreamData}},{key:"getLocalScreenData",value:function(){return this.data.localScreenShareStream}},{key:"getLocalUser",value:function(){return this.data.localUser}},{key:"getFullUserList",value:function(){return this.data.userList.map((function(e){return e.user}))}},{key:"getFullStreamList",value:function(){return this.data.streamList.map((function(e){return e.stream}))}},{key:"classroom",get:function(){return{roomInfo:this.data.roomInfo,roomProperties:this.data.roomProperties,roomStatus:this.data.roomState}}},{key:"getClassroomInfo",value:function(){return this.classroom}},{key:"getStudentCount",value:function(){return this.data.userList.filter((function(e){return e.user.role===_t.student})).length}},{key:"getTeacherCount",value:function(){return this.data.userList.filter((function(e){return e.user.role===_t.teacher})).length}},{key:"studentList",get:function(){return this.data.userList.filter((function(e){return e.user.role===_t.student})).map((function(e){return e.user}))}},{key:"teacherList",get:function(){return this.data.userList.filter((function(e){return e.user.role===_t.teacher})).map((function(e){return e.user}))}},{key:"getTeacherList",value:function(){return this.teacherList}},{key:"getStudentList",value:function(){return this.studentList}}]),r}(ie.EventEmitter),or=r(67),ir=function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.prev=1,e.next=4,fetch(t,r);case 4:return a=e.sent,e.next=7,a.json();case 7:return n=e.sent,console.log("[http] ".concat(r.method,"#").concat(t," response params: "),JSON.stringify(r)," response: ",JSON.stringify(n)," status: ",a.status," statusText: ",a.statusText),e.abrupt("return",n);case 12:throw e.prev=12,e.t0=e.catch(1),console.log("[http] ".concat(r.method,"#").concat(t," request failed code: ").concat(e.t0.code,", msg: ").concat(e.t0.msg,", params: "),JSON.stringify(r)," status: ",a.status," statusText: ",a.statusText),e.t0;case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,r){return e.apply(this,arguments)}}(),sr=function(){function e(t,r){Object(T.a)(this,e),this.appID=t,this.AUTHORIZATION=r,this.roomUuid="",this._prefix="".concat("https://api.agora.io","/scene/apps/%app_id"),this._board_prefix="".concat("https://api.agora.io","/board/apps/%app_id"),this._record_prefix="".concat("https://api.agora.io","/recording/apps/%app_id"),this.appId=void 0,this.authorization=void 0,this._userToken="",this.nextId=void 0,this.localInfo=void 0,this.latestTime=0,this.lastUserListTime=0,this.lastStreamListTime=0,this.appId=t,this.authorization=r,this.setApiPrefix(this.appId),this.nextId=void 0,this.latestTime=0,this.lastUserListTime=0,this.lastStreamListTime=0}return Object(C.a)(e,[{key:"prefix",get:function(){return this._prefix}},{key:"board_prefix",get:function(){return this._board_prefix}},{key:"record_prefix",get:function(){return this._record_prefix}},{key:"setApiPrefix",value:function(e){this._prefix=this._prefix.replace("%app_id",e)}},{key:"userToken",get:function(){return this._userToken},set:function(e){window.sessionStorage.setItem("edu-userToken",e)}},{key:"updateLastTime",value:function(e){this.latestTime=e}},{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.method,n=t.token,o=t.data,i=t.full_url,s=t.url,t.type,c={method:a,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(this.AUTHORIZATION.replace(/basic\s+|basic/i,""))}},(null===(r=this.localInfo)||void 0===r?void 0:r.userToken)&&(c.headers.token=this.localInfo.userToken),t.hasOwnProperty("token")&&!n&&delete c.headers.token,o&&(c.body=JSON.stringify(o)),!i){e.next=11;break}return e.next=8,ir("".concat(i),c);case 8:u=e.sent,e.next=15;break;case 11:return l="".concat(this.prefix).concat(s),e.next=14,ir("".concat(l),c);case 14:u=e.sent;case 15:if(0===u.code){e.next=17;break}throw{msg:u.msg};case 17:return u.data&&u.data.ts&&this.updateLastTime(u.data.ts),e.abrupt("return",u);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRoomConfig",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/config"),method:"GET"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateClassroomState",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/state"),method:"PUT",data:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getUserList",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/v1/rooms/".concat(t,"/users?count=").concat(r.count),r.nextId&&(a="".concat(a,"&nextId=").concat(r.nextId)),r.hasOwnProperty("includeOffline")&&(a="".concat(a,"&includeOffline=").concat(r.includeOffline)),r.hasOwnProperty("updateTimeOffset")&&(a="".concat(a,"&updateTimeOffset=").concat(r.updateTimeOffset)),e.next=6,this.fetch({url:a,method:"GET",data:r});case 6:return n=e.sent,o=n.data,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getStreamList",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/v1/rooms/".concat(t,"/users/streams?count=").concat(r.count),r.nextId&&(a="".concat(a,"&nextId=").concat(r.nextId)),r.hasOwnProperty("includeOffline")&&(a="".concat(a,"&includeOffline=").concat(r.includeOffline)),r.hasOwnProperty("updateTimeOffset")&&(a="".concat(a,"&updateTimeOffset=").concat(r.updateTimeOffset)),e.next=6,this.fetch({url:a,method:"GET",data:r});case 6:return n=e.sent,o=n.data,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.streamUuid,n=Object(Nt.a)(r,["streamUuid"]),e.next=3,this.fetch({url:"/v1/rooms/".concat(t,"/streams/").concat(a),method:"POST",data:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updatePublishStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/streams/").concat(r),method:"PUT",data:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"removePublishStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/streams/").concat(r),method:"DELETE"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"sendChannelMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=Object(Nt.a)(t,["roomUuid"]),e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/message/broadcast"),method:"POST",data:a});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendPeerMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=Object(Nt.a)(t,["roomUuid"]),e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/message/peer"),method:"POST",data:a});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exitRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/exit"),method:"POST"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"entryRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={userName:t.userName,role:t.role,streamUuid:t.streamUuid},e.next=3,this.fetch({url:"/v1/rooms/".concat(t.roomUuid,"/users/").concat(t.userUuid,"/entry"),method:"POST",data:r,token:t.token});case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchUsersStreams",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i,s,c=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>2&&void 0!==c[2]?c[2]:0,n=c.length>3&&void 0!==c[3]?c[3]:0,o="/v1/rooms/".concat(this.roomUuid,"/users/userStreams?count=").concat(r),a&&(o="".concat(o,"&updateTimeOffset=").concat(a)),n&&(o="".concat(o,"&includeOffline=").concat(n)),t&&(o="".concat(o,"&nextId=").concat(t)),e.next=8,this.fetch({url:o,method:"GET"});case 8:return i=e.sent,s=i.data,e.abrupt("return",{count:s.count,total:s.total,nextId:s.nextId,list:s.list,ts:s.ts});case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchAllOfflineUsersStream",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",r=[],a=[],n=0;case 4:return e.next=6,this.fetchUsersStreams(t,1e3,this.latestTime,1);case 6:o=e.sent,t=o.nextId,n=o.ts,i=o.list.reduce((function(e,t){t.streams;var r=Object(Nt.a)(t,["streams"]),a=e.findIndex((function(e){return e.userUuid===r.userUuid}));return-1!==a?e[a]=r:e=e.concat([r]),e}),a),s=o.list.reduce((function(e,t){var r=t.streams,a=r.map((function(t,r){return{oldStreamIndex:e.findIndex((function(e){return e.streamUuid===t.streamUuid})),newStreamIndex:r}}));a.length||Te.warn("combineLatestStreamIndexList is empty",r,a);var n,o=Object(or.a)(a);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=i.oldStreamIndex,c=i.newStreamIndex;-1!==s?e[s]=r[c]:e=e.concat(t.streams)}}catch(u){o.e(u)}finally{o.f()}return e}),r),a=a.concat(i),r=r.concat(s);case 13:if(null!=t){e.next=4;break}case 14:return n&&(this.latestTime=n),e.abrupt("return",{users:a,streams:r});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAllOnlineUserStream",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="",r=[],a=[];case 3:return e.next=5,this.fetchUsersStreams(t,1e3);case 5:n=e.sent,console.log("fetchUsersStreams",n),t=n.nextId,o=n.list.reduce((function(e,t){t.streams;var r=Object(Nt.a)(t,["streams"]),a=e.findIndex((function(e){return e.userUuid===r.userUuid}));return-1!==a?e[a]=r:e=e.concat([r]),e}),a),i=n.list.reduce((function(e,t){var r=t.streams,a=r.map((function(t,r){return{oldStreamIndex:e.findIndex((function(e){return e.streamUuid===t.streamUuid})),newStreamIndex:r}}));a.length||Te.warn("combineLatestStreamIndexList is empty",r,a);var n,o=Object(or.a)(a);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=i.oldStreamIndex,c=i.newStreamIndex;-1!==s?e[s]=r[c]:e=e.concat(t.streams)}}catch(u){o.e(u)}finally{o.f()}return e}),r),a=a.concat(o),r=r.concat(i);case 12:if(null!=t){e.next=3;break}case 13:return e.abrupt("return",{users:Dt.fromArray(a),streams:Vt.fromArray(r)});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"syncUserList",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",a=[],n=this.lastUserListTime,o=0;case 4:return e.next=6,this.getUserList(t,{nextId:r||void 0,updateTimeOffset:n,includeOffline:1,count:1e3});case 6:i=e.sent,o=i.ts,r=i.nextId,a=a.concat(Dt.fromArray(i.list));case 10:if(null!==r){e.next=4;break}case 11:return o&&(this.lastUserListTime=o),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncStreamList",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="",a=[],n=this.lastStreamListTime,o=0;case 4:return e.next=6,this.getStreamList(t,{nextId:r||void 0,updateTimeOffset:n,includeOffline:1,count:1e3});case 6:i=e.sent,o=i.ts,r=i.nextId,a=a.concat(Vt.fromArray(i.list));case 10:if(null!==r){e.next=4;break}case 11:return o&&(this.lastStreamListTime=o),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"subRoomData",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.step,a=t.roomUuid,n=t.requestId,o=t.nextId,i=t.nextTs,e.prev=1,e.next=4,this.fetch({url:"/v1/rooms/".concat(a,"/sync"),method:"POST",data:{step:r,requestId:n,nextId:o,nextTs:i}});case 4:return s=e.sent,console.log("subRoomData",s),e.abrupt("return",s.msg);case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"joinRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entryRoom({userUuid:t.userUuid,roomUuid:t.roomUuid,userName:t.userName,role:t.userRole,streamUuid:t.streamUuid,token:""});case 2:return r=e.sent,this.roomUuid=t.roomUuid,this.localInfo={userToken:Object(E.get)(r,"user.userToken"),userUuid:Object(E.get)(r,"user.userUuid"),rtmToken:Object(E.get)(r,"user.rtmToken"),rtcToken:Object(E.get)(r,"user.rtcToken")},a=Object(E.get)(r,"user.streams",[]),e.abrupt("return",{room:{name:Object(E.get)(r,"room.roomInfo.roomName"),uuid:Object(E.get)(r,"room.roomInfo.roomUuid"),muteChat:{audience:Object(E.get)(r,"room.roomState.muteChat.audience"),broadcaster:Object(E.get)(r,"room.roomState.muteChat.broadcaster"),host:Object(E.get)(r,"room.roomState.muteChat.host")},muteVideo:{audience:Object(E.get)(r,"room.roomState.muteVideo.audience"),host:Object(E.get)(r,"room.roomState.muteVideo.host")},muteAudio:{audience:Object(E.get)(r,"room.roomState.muteAudio.audience"),host:Object(E.get)(r,"room.roomState.muteAudio.host")},startTime:Object(E.get)(r,"room.roomState.startTime"),state:Object(E.get)(r,"room.roomState.state"),properties:Object(E.get)(r,"room.roomProperties")},user:{uuid:Object(E.get)(r,"user.userUuid"),name:Object(E.get)(r,"user.userName"),role:Object(E.get)(r,"user.role"),streamUuid:Object(E.get)(r,"user.streamUuid"),userToken:Object(E.get)(r,"user.userToken"),rtmToken:Object(E.get)(r,"user.rtmToken"),rtcToken:Object(E.get)(r,"user.rtcToken"),muteChat:Object(E.get)(r,"user.muteChat"),streams:a,properties:Object(E.get)(r,"user.userProperties",{})}});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"upsertBizStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamName,o=t.streamUuid,i=t.videoSourceType,s=t.audioSourceType,c=t.videoState,u=t.audioState,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(o),method:"PUT",data:{streamName:n,userUuid:a,videoSourceType:i,audioSourceType:s,videoState:+c,audioState:+u}});case 3:return l=e.sent,p=l.data,e.abrupt("return",{streamUuid:p.streamUuid,rtcToken:p.rtcToken,ts:l.ts});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBizStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamName,o=t.streamUuid,i=t.videoSourceType,s=t.audioSourceType,c=t.videoState,u=t.audioState,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(o),method:"POST",data:{streamName:n,userUuid:a,videoSourceType:i,audioSourceType:s,videoState:c,audioState:u}});case 3:return l=e.sent,p=l.data,e.abrupt("return",{streamUuid:p.streamUuid,rtcToken:p.rtcToken,ts:l.ts});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateBizStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamName,o=t.streamUuid,i=t.videoSourceType,s=t.audioSourceType,c=t.videoState,u=t.audioState,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(o),method:"PUT",data:{streamName:n,videoSourceType:i,audioSourceType:s,videoState:c,audioState:u}});case 3:return l=e.sent,p=l.data,e.abrupt("return",{streamUuid:p.streamUuid,rtcToken:p.rtcToken,ts:l.ts});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteBizStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"DELETE"});case 3:return o=e.sent,e.abrupt("return",Object(h.a)(Object(h.a)({},o.data),{},{ts:o.ts}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRoomChatMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.message,a=t.roomUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(a,"/chat/channel"),method:"POST",data:{message:r,type:1}});case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendUserChatMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.message,a=t.remoteUser,n=t.roomUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(n,"/users/").concat(a.userUuid,"/messages/peer"),method:"POST",data:{message:r,type:1}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCourseState",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t.roomUuid,"/states/").concat(t.courseState),method:"PUT",data:{}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateRoomProperties",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.key,n=t.value,o=t.cause,i={value:n},o&&(i.cause=o),e.next=5,this.fetch({url:"/v1/rooms/".concat(r,"/properties/").concat(a),method:"PUT",data:i});case 5:return s=e.sent,e.abrupt("return",s.data);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"allowStudentChatByRole",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},t.roles.reduce((function(e,r){return e[r]=+t.enable,e}),r),e.next=4,this.fetch({url:"/v1/rooms/".concat(t.roomUuid,"/roles/mute"),method:"PUT",data:{muteChat:r}});case 4:return a=e.sent,e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopShareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deleteBizStream({roomUuid:t,streamUuid:r,userUuid:a});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"allowRemoteStudentChat",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.muteChat,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a),method:"PUT",data:{muteChat:n}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"kickUser",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/rooms/".concat(t.roomUuid,"/users/").concat(t.userUuid,"/exit"),method:"POST"});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"inviteUserPublishStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"PUT",data:{videoState:1,audioState:1}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStartStudentCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"PUT",data:{videoState:1}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteCloseStudentStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"DELETE",data:{}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStopStudentCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"PUT",data:{videoState:0}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStartStudentMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"PUT",data:{audioState:1}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remoteStopStudentMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=t.userUuid,n=t.streamUuid,e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/users/").concat(a,"/streams/").concat(n),method:"PUT",data:{audioState:0}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/users/".concat(t,"/login"),method:"POST",data:{}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncSnapShot",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[syncing] , userToken: ",null===(r=this.localInfo)||void 0===r?void 0:r.userToken),e.next=3,this.fetch({url:"/v1/rooms/".concat(t,"/snapshot"),method:"GET"});case 3:return a=e.sent,n=a.data,o=Object(E.get)(n,"snapshot.room.roomInfo",null),i=Object(E.get)(n,"snapshot.room.roomProperties",null),s=Object(E.get)(n,"snapshot.room.roomState",null),e.abrupt("return",{seq:Object(E.get)(n,"sequence",0),roomInfo:o,roomState:s,roomProperties:i,users:Object(E.get)(n,"snapshot.users",[])});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncSequence",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/sequences?nextId=").concat(r),method:"GET"});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()}]),e}(),cr=r(95);!function(e){e[e.users=1]="users",e[e.streams=2]="streams",e[e.classRoom=3]="classRoom",e[e.chat=4]="chat"}(rr||(rr={}));var ur,lr,pr,dr,hr,mr,fr=function(){function e(t){Object(T.a)(this,e),this._roomAttrs=void 0,this._localUser=void 0,this._streamList=[],this._userList=[],this._localUserUuid="",this._userToken=void 0,this.roomManager=void 0,this._id=void 0,this._curSeqId=void 0,this._bufferMap=void 0,this._latestSeqId=0,this.syncSequenceTimes=0,this.syncingData=!1,this.syncTimer=null,this._minSeqId=0,this.retryTimer=null,this._cachedLocalStreams={},this._roomInfo={},this._roomProperties={},this._users=[],this._streams=[],this._roomStatus={},this._localUserData=void 0,this._localStreams=[],this.roomManager=t,this._curSeqId=null,this._minSeqId=0,this._latestSeqId=0,this._bufferMap={},this.retryTimer=null,this._id="roomUuid:".concat(this.roomManager.roomUuid,"#ins:").concat(Yt()()),Te.info("EDU-STATE EduDataController: [".concat(this._id,"]"))}return Object(C.a)(e,[{key:"setLocalUserUuid",value:function(e){this._localUserUuid=e}},{key:"localUserUuid",get:function(){return this._localUserUuid}},{key:"userToken",get:function(){return this._userToken}},{key:"setUserToken",value:function(e){this._userToken=e}},{key:"roomAttrs",get:function(){return this._roomAttrs}},{key:"roomUuid",get:function(){var e;return null===(e=this._roomInfo)||void 0===e?void 0:e.roomUuid}},{key:"setCurrentSeqId",value:function(e){this._curSeqId=e,this._latestSeqId=Math.max(this._latestSeqId,this._curSeqId),Te.info("[seqId] setCurrentSeqId, curSeqId: ",this._curSeqId," latestSeqId: ",this._latestSeqId),this.roomManager.emit("seqIdChanged",{curSeqId:this._curSeqId,latestSeqId:this._latestSeqId})}},{key:"curSeqId",get:function(){return this._curSeqId}},{key:"missingSeqId",get:function(){return this._curSeqId!==this._latestSeqId&&0!==this._latestSeqId}},{key:"syncData",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.syncingData){e.next=3;break}return Te.warn("already syncing data"),e.abrupt("return");case 3:if(this.syncingData=!0,t){e.next=10;break}return e.next=7,this.syncFromCurrentSequenceId();case 7:this.syncingData=!1,e.next=13;break;case 10:return e.next=12,this.syncFullSequence();case 12:this.syncingData=!1;case 13:this.asyncBatchUpdateData(r);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"asyncBatchUpdateData",value:function(e){var t=this;null===this.syncTimer&&(this.syncTimer=setTimeout((function(){t.BatchUpdateData(),clearTimeout(t.syncTimer),t.syncTimer=null}),e))}},{key:"BatchUpdateData",value:function(){for(var e=this,t=this._bufferMap,r=[],a=0,n=Object.keys(t);a<n.length;a++){var o=n[a],i=t["".concat(o)];if(!i){Te.info("gap>>>>>> !!!");break}if(this._curSeqId){if(+o<=+this._curSeqId){delete this._bufferMap["".concat(o)];continue}if(+o!==this._curSeqId+1){if(+o===+this._curSeqId)break;Te.info("[seqId] greaterThanSeqId, is consequence"),Te.warn("is consequence",this._curSeqId);this.syncData(!1,300).then((function(){Te.warn("[seqId] syncData success",e._curSeqId,e._latestSeqId)})).catch((function(){Te.warn("[seqId] syncData missingSeqId failure",e._curSeqId,e._latestSeqId)}));break}r.push(Object(h.a)({seqId:+o},i)),this.setCurrentSeqId(+o),delete this._bufferMap["".concat(o)]}else r.push(Object(h.a)({seqId:+o},i)),this.setCurrentSeqId(+o),delete this._bufferMap["".concat(o)]}Te.info("[".concat(this._id,"] [seqId] fetch bufferMap "),t," taskBuffer ",r);for(var s=0,c=r;s<c.length;s++){var u=c[s],l=u,p=l.cmd,d=l.data,m=l.seqId;switch(Te.info("[seqId] data ",u),p){case 0:this.setRoomInfo(d.roomInfo),this.setRoomStatus(Wt.roomStatus(d.roomState)),this.setRoomProperties(d.roomProperties),this.setRawUsers(d.users),Te.info("[".concat(this._id,"] [").concat(m,"] set latest currentId, seqId: "));break;case yt.courseState:this.setRoomStatus({courseState:d.state,startTime:d.startTime}),Te.info("[".concat(this._id,"] [").concat(m,"]#setRoomStatus: "),d);break;case yt.roomMediaState:Te.info("[".concat(this._id,"] before [").concat(m,"]#setRoomStatus: "),d),this.setRoomStatus({isStudentChatAllowed:Wt.isStudentChatAllowed(d)}),Te.info("[".concat(this._id,"] after [").concat(m,"]#setRoomStatus: "),d);break;case yt.userListChanged:var f=Wt.getUsersStreams(d),v=f.onlineUsers,b=f.offlineUsers,g=f.onlineStreams,y=f.offlineStreams;Te.info("[".concat(this._id,"] before [").concat(m,"]#updateUsersStreams: "),d),Te.info("[".concat(this._id,"] before [").concat(m,"]#updateUsersStreams: "),v,b,g,y),this.updateUserList(v,b,m),this.updateStreamList(g,y,null,m),Te.info("[".concat(this._id,"] after [").concat(m,"]#updateUsersStreams: "),d),Te.info("[".concat(this._id,"] after [").concat(m,"]#updateUsersStreams: userList, streamList,"),this._userList,this._streamList);break;case yt.userStateUpdated:Te.info("[".concat(this._id,"] before [").concat(m,"]#updateUserState: "),d),Te.info("[".concat(this._id,"] before [").concat(m,"]#updateUserState: "));var k=Wt.getChangedUser(d);this.updateUserState(k),Te.info("[".concat(this._id,"] after [").concat(m,"]#updateUserState: "),d),Te.info("[".concat(this._id,"] after [").concat(m,"]#updateUserState: "),k);break;case yt.streamListChanged:Wt.getAction(d);var S=Wt.getStreams(d),_=Wt.getOperator(d),O=S.filter((function(e){return 0!==e.state})),w=S.filter((function(e){return 0===e.state}));Te.info("[".concat(this._id,"] before [").concat(m,"]#updateStreamList: data"),d),Te.info("[".concat(this._id,"] before [").concat(m,"]#updateStreamList: onlineStreams"),O," offlineStreams",O," operatorUser",_),this.updateStreamList(O,w,_,m),Te.info("[".concat(this._id,"] after [").concat(m,"]#updateUsersStreams: userList, streamList,"),this._userList,this._streamList);break;case yt.roomPropertiesStateChanged:this.setRoomProperties(d.changeProperties);break;case yt.roomChatState:var j=Wt.getEduTextMessage(d);this.userIds.includes(j.fromUser.userUuid)&&(this.isLocalUser(j.fromUser.userUuid)||(Te.info("EDU-STATE [".concat(this._id,"], ").concat(JSON.stringify(j))),this.fire("room-chat-message",{textMessage:j})));break;case yt.customMessage:var x=Wt.getEduTextMessage(d);this.userIds.includes(x.fromUser.userUuid)&&this.fire("room-message",{textMessage:x})}}}},{key:"dispatchBatchMessage",value:function(e){for(var t=0,r=Object.keys(e);t<r.length;t++){var a=r[t];e[a];switch(+a){case yt.courseState:case yt.roomMediaState:case yt.userListChanged:case yt.userStateUpdated:case yt.streamListChanged:case yt.roomPropertiesStateChanged:case yt.roomChatState:case yt.customMessage:}}}},{key:"syncFullSequence",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s,c,u=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=3;case 1:return e.prev=1,r=this.roomManager.roomUuid,e.next=5,this.roomManager.apiService.syncSnapShot(r);case 5:return a=e.sent,n=a.seq,o=a.roomInfo,i=a.roomState,s=a.roomProperties,c=a.users,this.appendBuffer({cmd:0,seqId:n,data:{roomInfo:o,roomState:i,roomProperties:s,users:c}}),Te.info("[".concat(this._id,"] [seqId] : ").concat(n," syncFullSequences data succeed")),e.abrupt("return");case 12:e.prev=12,e.t0=e.catch(1),Te.warn("syncFullSequences ",e.t0.msg,e.t0),--t;case 16:if(t>0){e.next=1;break}case 17:if(!this.retryTimer){e.next=21;break}return e.abrupt("return");case 21:this.retryTimer=setTimeout((function(){u.syncFullSequence().then((function(){Te.info("[".concat(u._id,"] [seqId] retryTimer success")),u.retryTimer&&(clearTimeout(u.retryTimer),u.retryTimer=null)})).catch((function(){Te.info("[".concat(u._id,"] [seqId] retryTimer failure")),u.retryTimer&&(clearTimeout(u.retryTimer),u.retryTimer=null)}))}),2e3);case 22:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"syncSequence",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],Te.info("[EDU-STATE] [syncSequence] [".concat(this._id,"], start: [").concat(r,"] acquire, roomUuid: ").concat(t,", nextId: ").concat(r,", count: ").concat(a," ")),0;case 3:return e.next=5,this.roomManager.apiService.syncSequence(t,r,a);case 5:o=e.sent,i=o.nextId,s=o.list,Te.info("[EDU-STATE] [syncSequence] [".concat(this._id,"], cur_nextId: [").concat(r,"], nex_nextId: [").concat(i,"]  acquire, roomUuid: ").concat(t,", nextId: ").concat(r,", count: ").concat(a," "),JSON.stringify(n)),n=n.concat(s),s.slice(-1),r=i;case 12:if(r){e.next=3;break}case 13:return e.abrupt("return",{list:n});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"syncFromCurrentSequenceId",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=3;case 1:if(e.prev=1,r=this.roomManager.roomUuid,a=this.curSeqId,!(Math.abs(this.curSeqId-this._latestSeqId)>1e3)){e.next=7;break}throw"";case 7:return e.next=9,this.syncSequence(r,a);case 9:n=e.sent,o=n.list,i=Object(or.a)(o);try{for(i.s();!(s=i.n()).done;)c=s.value,this.appendBuffer(Object(h.a)({seqId:c.sequence},c))}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",Te.warn("[EDU-STATE] [".concat(this._id,"] [seqId] res syncSequence done")));case 16:e.prev=16,e.t0=e.catch(1),--t;case 19:if(t>0){e.next=1;break}case 20:return e.next=22,this.syncFullSequence();case 22:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"setLatestSeqId",value:function(e){this._latestSeqId=e,Te.info("[seqId] setLatestSeqId ",this._latestSeqId)}},{key:"appendBuffer",value:function(e){if(this._bufferMap[e.seqId]={cmd:e.cmd,data:e.data},Te.info("Raw ChannelMessage, buffer >>> ",JSON.stringify(this._bufferMap[e.seqId])),!e.hasOwnProperty("seqId"))throw console.error("buffer",e),"seqId not exists";this._minSeqId=Math.min(e.seqId,this._minSeqId),this.setLatestSeqId(Math.max(e.seqId,this._latestSeqId)),this.roomManager.emit("seqIdChanged",{curSeqId:this._curSeqId,latestSeqId:this._latestSeqId})}},{key:"upsertLocalUser",value:function(e,t){this.localUser?(this.localUser.updateUser(e),this.fire("local-user-updated",{user:this._localUser}),Te.info("EDU-STATE EduDataController: [".concat(this._id,"] upsert local user ").concat(e.userUuid),this.localUser,"id: ".concat(this._id))):(this.localUser=new Dt(e),this.localUser.state&&(this.fire("local-user-added",{user:this._localUser}),Te.info("EDU-STATE EduDataController: [".concat(this._id,"] added local user ").concat(e.userUuid),this.localUser))),t&&(this.localUser.updateStreamsMap(t),Te.info("EDU-STATE EduDataController: [".concat(this._id,"] update streams local user ").concat(e.userUuid),this.localUser)),Te.info("invoke upsertLocalUser ",e,t,this)}},{key:"streamMap",get:function(){return Object(E.get)(this.localUser,"streams",{})}},{key:"streamIds",get:function(){var e=this;return Object.keys(this._cachedLocalStreams).reduce((function(t,r){var a=e._cachedLocalStreams[r].stream.streamUuid;return t.push(a),t}),[])}},{key:"streamList",get:function(){return this._streamList}},{key:"userList",get:function(){return this._userList}},{key:"userIds",get:function(){return this._userList.map((function(e){return e.user.userUuid}))}},{key:"localUser",get:function(){return this._localUser},set:function(e){this._localUser=e,Te.info("EDU-STATE EduDataController: [".concat(this._id,"]  access localUser: "),e," _localUser: ",JSON.stringify(this._localUser))}},{key:"localStreamData",get:function(){return this._cachedLocalStreams.main}},{key:"localScreenShareStream",get:function(){return this._cachedLocalStreams.screen}},{key:"isLocalStreams",value:function(e){return this.localUserUuid===e.userInfo.userUuid}},{key:"isLocalUser",value:function(e){return this.localUserUuid===e}},{key:"addStreams",value:function(e,t){var r=this,a=this._userList.map((function(e){return e.user.userUuid})).concat([this.localUserUuid]),n=e.filter((function(e){return a.includes(e.stream.userInfo.userUuid)}));Te.info("[".concat(this._id,"] before [").concat(t,"]#addStreams: ")," user List ",this._userList," stream List ",this._streamList," streams ",n);var o,i=Object(or.a)(n);try{var s=function(){var e=o.value,a=e.stream,n=r._streamList.findIndex((function(e){return e.stream.streamUuid===a.streamUuid})),i=r._streamList[n];i&&(Te.info("EDU-STATE addStreams: [".concat(r._id,"] before [").concat(t,"]#addStreams: "),r._userList,r._streamList," targetStream ",i," newItem ",e),r.streamIsOffline(e)?(Te.info("EDU-STATE addStreams: [".concat(r._id,"] streamIsOffline: "),e,i),r._streamList.splice(n,1),r.isLocalStreams(i.stream)?(Te.info("EDU-STATE addStreams: [".concat(r._id,"] before [").concat(t,"]#addStreams: "),r._userList,r._streamList," targetStream ",i," newItem ",e),r.removeLocalStream(i.stream.streamUuid,"addStreams[".concat(t,"]"))):r.fire("remote-stream-removed",{stream:e.stream})):(Te.info("EDU-STATE EduDataController: [".concat(r._id,"] update stream addStreams"),e),r._streamList[n]=e,r.isLocalStreams(i.stream)?(r.isScreenShare(i.stream.streamUuid)&&r.upsertLocalStream("screen",e,t),r.isMainStream(i.stream.streamUuid)&&r.upsertLocalStream("main",e,t)):r.fire("remote-stream-updated",{stream:e.stream}))),i||(Te.info("EDU-STATE EduDataController: [".concat(r._id,"] add stream addStreams"),e),r._streamList.push(e),r.isLocalStreams(e.stream)?(r.isScreenShare(e.stream.streamUuid)&&r.upsertLocalStream("screen",e,t),r.isMainStream(e.stream.streamUuid)&&r.upsertLocalStream("main",e,t)):r.fire("remote-stream-added",{stream:e.stream}))};for(i.s();!(o=i.n()).done;)s()}catch(c){i.e(c)}finally{i.f()}}},{key:"isMainStream",value:function(e){var t=this._cachedLocalStreams.main;return!(!t||t.stream.streamUuid!==e)}},{key:"isScreenShare",value:function(e){var t=this._cachedLocalStreams.screen;return!(!t||t.stream.streamUuid!==e)}},{key:"removeTargetStream",value:function(e){var t=this._streamList.findIndex((function(t){return t.stream.streamUuid===e.stream.streamUuid}));-1!==t&&this._streamList.splice(t,1)}},{key:"removeLocalStream",value:function(e,t){Te.info("[EDU-STATE] [".concat(this._id,"] seqId: [").concat(t,"] removeLocalStream remove after, streamUuid "),e);var r="main";switch(this.isMainStream(e)&&(r="main"),this.isScreenShare(e)&&(r="screen"),r){case"main":var a=this._cachedLocalStreams.main;a&&(Te.info("[EDU-STATE] [".concat(this._id,"] seqId: [").concat(t,"] removeLocalStream, streamList: "),JSON.stringify(this._streamList),"userList: ",JSON.stringify(this._userList)," cachedLocalStreams ",JSON.stringify(this._cachedLocalStreams)),a.modifyStream({streamUuid:e,hasAudio:!1,hasVideo:!1,videoSourceType:wt.camera,audioSourceType:Ot.mic,state:0,token:"",userInfo:{userUuid:this.localUser.user.userUuid,userName:this.localUser.user.userName,role:this.localUser.user.role}}),this.removeTargetStream(a),Te.info("".concat(Date.now()," local-stream-removed local-stream"),a,this._userList),this.fire("local-stream-removed",{stream:a.stream,type:"main",seqId:t}));break;case"screen":var n=this._cachedLocalStreams.screen;n&&(n.modifyStream({streamUuid:e,hasAudio:!1,hasVideo:!1,videoSourceType:wt.screen,audioSourceType:Ot.mic,state:0,token:"",userInfo:{userUuid:this.localUser.user.userUuid,userName:this.localUser.user.userName,role:this.localUser.user.role}}),this.removeTargetStream(n),Te.info("".concat(Date.now()," local-stream-removed screen"),n,this._userList),this.fire("local-stream-removed",{stream:n.stream,type:"screen"}))}}},{key:"removeStreams",value:function(e,t){var r=this;Te.info("[EDU-STATE] [".concat(this._id,"] seqId: [").concat(t,"] before removeStreams in target: ")," streams ",e," _userList ",this._userList," _streamList ",this._streamList);var a,n=Object(or.a)(e);try{var o=function(){var n=a.value,o=n.stream,i=r._streamList.findIndex((function(e){return e.stream.streamUuid===o.streamUuid})),s=r._streamList[i];Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] before removeStreams in target: ")," streams ",e," _userList ",r._userList," _streamList ",r._streamList),s&&(Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] removeStreams in condition, streamUuid"),s.stream.streamUuid," newItem",JSON.stringify(n)," streams",JSON.stringify(e)),Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] removeStreams"),n),r._streamList.splice(i,1),Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] removeStreams remove after, streamUuid"),s," newItem",JSON.stringify(n)," streams",JSON.stringify(e),r.isLocalStreams(s.stream)),r.isLocalStreams(s.stream)?(Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] before removeLocalStream, streamUuid"),s," newItem",JSON.stringify(n)," streams",JSON.stringify(e),r.isLocalStreams(s.stream)),r.removeLocalStream(s.stream.streamUuid,"removeStreams[".concat(t,"]"))):r.fire("remote-stream-removed",{stream:n.stream}))};for(n.s();!(a=n.n()).done;)o()}catch(i){n.e(i)}finally{n.f()}}},{key:"userIsOffline",value:function(e){return 0===e.state}},{key:"streamIsOffline",value:function(e){return 0===e.state}},{key:"addUserList",value:function(e,t){var r,a=this,n=Object(or.a)(e);try{var o=function(){var n=r.value,o=a._userList.findIndex((function(e){return e.user.userUuid===n.user.userUuid})),i=a._userList[o];i&&(a.userIsOffline(n)?(Te.info("[EDU-STATE] remove user in addUserList before",JSON.stringify(e)),a._userList.splice(o,1),a.removeStreams(a._streamList.filter((function(e){return e.stream.userInfo.userUuid===n.user.userUuid})),t),Te.info("[EDU-STATE] remove user in addUserList after ",JSON.stringify(n)),a.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:a._userList})}),a.isLocalUser(i.user.userUuid)?(a.localUser.updateState(0),a.fire("local-user-removed",{user:n.user})):a.fire("remote-user-removed",{user:n.user})):(a._userList[o]=n,Te.info("[EDU-STATE] update user in addUserList before",JSON.stringify(n)),a.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:a._userList})}),a.isLocalUser(i.user.userUuid)?(a.localUser.updateUser(Object(h.a)(Object(h.a)(Object(h.a)({},a.localUser.user),n.user),{},{updateTime:n.ts,rtmToken:n.hasOwnProperty("rtmToken")?n.rtmToken:a.localUser.rtmToken})),a.fire("local-user-updated",{user:n.user})):a.fire("remote-user-updated",{user:n.user}))),i||(Te.info("[EDU-STATE] add user in addUserList before",JSON.stringify(n)),a._userList.push(n),a.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:a._userList})}),a.isLocalUser(n.user.userUuid)?(a.localUser.updateUser(Object(h.a)(Object(h.a)(Object(h.a)({},a.localUser.user),n.user),{},{updateTime:n.ts,rtmToken:n.hasOwnProperty("rtmToken")?n.rtmToken:a.localUser.rtmToken})),a.fire("local-user-updated",{user:n.user})):a.fire("remote-user-added",{user:n.user}))};for(n.s();!(r=n.n()).done;)o()}catch(i){n.e(i)}finally{n.f()}}},{key:"removeUserList",value:function(e,t){var r=this;Te.info("[EDU-STATE] [".concat(this._id,"] seqId: [").concat(t,"] removeUserList: "),JSON.stringify(e),"userList: ",this._userList,", streamList: ",this._streamList);var a,n=Object(or.a)(e);try{var o=function(){var n=a.value,o=r._userList.findIndex((function(e){return e.user.userUuid===n.user.userUuid})),i=r._userList[o];i&&(Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] "),i),r._userList.splice(o,1),r.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:r._userList})}),Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] before removeUserList in target: ")," isLocalUser",r.isLocalUser(n.user.userUuid)," list: ",JSON.stringify(e)),r.removeStreams(r._streamList.filter((function(e){return e.stream.userInfo.userUuid===n.user.userUuid})),t),Te.info("[EDU-STATE] [".concat(r._id,"] seqId: [").concat(t,"] after removeUserList in target: "),"  targetItem ",n," userList ",r._userList),r.isLocalUser(n.user.userUuid)?(r.localUser.updateState(0),r.fire("local-user-removed",{user:n.user})):r.fire("remote-user-removed",{user:n.user}))};for(n.s();!(a=n.n()).done;)o()}catch(i){n.e(i)}finally{n.f()}}},{key:"updateUserState",value:function(e){if(this.isLocalUser(e.user.userUuid))this.localUser.updateUser(e);else{var t=this._userList.find((function(t){return t.user.userUuid===e.user.userUuid}));t&&t.updateUser(e)}}},{key:"updateUserProperties",value:function(e){if(this.isLocalUser(e.user.userUuid))this.localUser.updateUser(e);else{var t=this._userList.find((function(t){return t.user.userUuid===e.user.userUuid}));t&&t.updateUser(e)}}},{key:"updateUserList",value:function(e,t,r){Te.info("[".concat(this._id,"] before [").concat(r,"]#updateUserList: "),this._userList,this._streamList),this.addUserList(e,r),this.removeUserList(t,r),Te.info("[".concat(this._id,"] after [").concat(r,"]#updateUserList: "),this._userList,this._streamList)}},{key:"updateStreamList",value:function(e,t,r,a){Te.info("[".concat(this._id,"] before [").concat(a,"]#updateStreamList: "),this._userList,this._streamList),this.addStreams(e,a),this.removeStreams(t,a),Te.info("[".concat(this._id,"] after [").concat(a,"]#updateStreamList: "),this._userList,this._streamList)}},{key:"updateUser",value:function(e,t){Te.info("EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t]),this._userList),Te.info("EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t]),e);var r=this._userList.findIndex((function(t){return t.user.userUuid===e.user.userUuid})),a=this._userList[r];a?0===a.state?(this._userList.splice(r,1),Te.info("removeStreams, EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t]),this._userList),Te.info("removeStreams, EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t]),e),Te.info("removeStreams, EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t]),a),this.removeStreams(this._streamList.filter((function(e){return e.stream.userInfo.userUuid===a.user.userUuid})),t),this.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:this._userList})}),this.isLocalUser(a.user.userUuid)?(Te.info("isLocalUser, EDU-STATE: [".concat(this._id,"] updateUser, ").concat([t],", local-user-remove"),a),this.localUser.updateState(0),this.fire("local-user-removed",{user:a.user})):this.fire("remote-user-removed",{user:a.user})):(this._userList[r]=e,this.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:this._userList})}),this.isLocalUser(e.user.userUuid)?(this.localUser.updateUser(Object(h.a)(Object(h.a)(Object(h.a)({},this.localUser.user),e.user),{},{updateTime:e.ts,rtmToken:e.hasOwnProperty("rtmToken")?e.rtmToken:this.localUser.rtmToken})),this.fire("local-user-updated",{user:e.user})):this.fire("remote-user-updated",{user:e.user})):(this._userList.push(e),this.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:this._userList})}),this.isLocalUser(e.user.userUuid)?this.fire("local-user-updated",{user:e.user}):this.fire("remote-user-added",{user:e.user}))}},{key:"upsertTargetStream",value:function(e){var t=this._streamList.findIndex((function(t){return t.stream.streamUuid===e.stream.streamUuid}));-1!==t?this._streamList[t]=e:(this._streamList.push(e),this.setRoomStatus({onlineUsersCount:Wt.onlineUsersCount({users:this._userList})}))}},{key:"upsertLocalStream",value:function(e,t,r){if(Te.info("[EDU-STATE] upsertLocalStream: [".concat(r,"] type: ").concat(e,", data: ").concat(JSON.stringify(t))),"main"===e){var a=this._cachedLocalStreams.main;if(Te.info("mainStream  ",a),a)a.update(t),this.upsertTargetStream(a),this.fire("local-stream-updated",{data:this._cachedLocalStreams.main,type:"main",seqId:r});else{var n=new Vt({state:t.state,streamUuid:t.stream.streamUuid,streamName:t.stream.streamName,videoSourceType:t.stream.videoSourceType,audioSourceType:t.stream.audioSourceType,hasVideo:t.stream.hasVideo,hasAudio:t.stream.hasAudio,userInfo:{userUuid:this.localUser.user.userUuid,userName:this.localUser.user.userName,role:this.localUser.user.role},updateTime:t.ts,token:t.token});this._cachedLocalStreams.main=n,this.upsertTargetStream(this._cachedLocalStreams.main),this.fire("local-stream-updated",{data:this._cachedLocalStreams.main,type:"main"})}}if("screen"===e){var o=this._cachedLocalStreams.screen;if(o)o.update(t),this.upsertTargetStream(o),this.fire("local-stream-updated",{data:this._cachedLocalStreams[e],type:"screen"});else{var i=new Vt({state:t.state,streamUuid:t.stream.streamUuid,streamName:t.stream.streamName,videoSourceType:wt.screen,audioSourceType:Ot.mic,hasVideo:t.stream.hasVideo,hasAudio:t.stream.hasAudio,userInfo:{userUuid:this.localUser.user.userUuid,userName:this.localUser.user.userName,role:this.localUser.user.role},token:t.token});this._cachedLocalStreams.screen=i;var s=this._cachedLocalStreams.screen;this.upsertTargetStream(s),this.fire("local-stream-updated",{data:this._cachedLocalStreams[e],type:"screen"})}}}},{key:"updateClassroomAttrs",value:function(e){this._roomAttrs=Object(h.a)(Object(h.a)({},this._roomAttrs),e)}},{key:"updateClassroom",value:function(e){}},{key:"classroom",get:function(){return{roomInfo:this._roomInfo,roomStatus:this._roomStatus,roomProperties:this._roomProperties}}},{key:"getClassroom",value:function(){return this.classroom}},{key:"reset",value:function(){this._localUserUuid="",this.localUser=void 0,this._streamList=[],this._userList=[],this._cachedLocalStreams={},this._roomAttrs={},Te.info("reset data controller ".concat(this._id)),this._roomInfo={},this._roomStatus={},this._roomProperties={},this._roomStatus={},this._localUserData=void 0,this._localStreams=[],this._minSeqId=0,this._latestSeqId=0,null!==this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"roomProperties",get:function(){return this._roomProperties}},{key:"users",get:function(){return this._users}},{key:"streams",get:function(){return this._streams}},{key:"roomState",get:function(){return this._roomStatus}},{key:"fire",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];(t=this.roomManager).emit.apply(t,[e].concat(a))}},{key:"setRoomInfo",value:function(e){var t=this._roomInfo,r=Object(h.a)(Object(h.a)({},t),e);Te.info("roomInfo ",r),this._roomInfo=r,Object(cr.diff)(t,r)&&this.fire("classroom-property-updated",this.classroom)}},{key:"setRoomStatus",value:function(e){var t=this._roomStatus,r=Object(h.a)(Object(h.a)({},t),e);this._roomStatus=r,Te.info(">>> setRoomStatus ",e),Object(cr.diff)(t,r)&&this.fire("classroom-property-updated",this.classroom)}},{key:"setRoomProperties",value:function(e){var t=this._roomProperties,r=Object(h.a)(Object(h.a)({},t),e);this._roomProperties=r,Te.info(">>> setRoomProperties ",r),Object(cr.diff)(t,r)&&this.fire("classroom-property-updated",this.classroom)}},{key:"localUserData",get:function(){return this._localUserData}},{key:"setLocalData",value:function(e){var t=this;this.setLocalUserUuid(e.user.uuid),this.setUserToken(e.user.userToken);var r=Object(E.get)(e,"user.streamUuid"),a=Object(E.get)(e,"user.rtcToken"),n=Object(E.get)(e,"user.streams",[]),o={main:{streamUuid:r,rtcToken:a}};e&&n.reduce((function(e,t){return o.main.streamUuid===t.streamUuid||t.videoSourceType===wt.screen&&(e.screen={streamUuid:t.streamUuid,rtcToken:t.rtcToken}),e}),o),this.upsertLocalUser({userUuid:e.user.uuid,userName:e.user.name,role:e.user.role,isChatAllowed:!!e.user.muteChat,userProperties:e.user.properties,rtmToken:e.user.rtmToken},o);for(var i=0,s=Object.keys(o);i<s.length;i++){var c=s[i];o[c]&&function(){var e=o[c],r=e.streamUuid,a=(e.rtcToken,n.find((function(e){return e.streamUuid===r}))),i=!a||a.videoState,s=!a||a.audioState,u=a?a.state:0,l=new Vt({streamUuid:r,streamName:"",videoSourceType:0,audioSourceType:0,hasVideo:i,hasAudio:s,userInfo:{userUuid:t.localUser.user.userUuid,userName:t.localUser.user.userName,role:t.localUser.user.role},state:u});t.upsertLocalStream(c,l)}()}}},{key:"setLocalUser",value:function(e){var t=this.localUserData;Object(cr.diff)(t,e)&&(t?t.updateUser(e):this._localUserData=e,this.fire("local-user-updated",{user:this.localUserData}))}},{key:"setRawUsers",value:function(e){var t=this.localUserUuid,r=Dt.fromArray(e.map((function(e){return e}))),a=Vt.fromArray(e.filter((function(e){return e.streams})).reduce((function(e,t){var r=t.streams.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{userInfo:{userUuid:t.userUuid,userName:t.userName,role:t.role}})}));return e.concat(r)}),[]));if(Te.info("users: ",JSON.stringify(r)," streams: ",JSON.stringify(a),JSON.stringify(e)),t){var n=r.find((function(e){return e.user.userUuid===t}));n&&this.upsertLocalUser({userUuid:n.user.userUuid,userName:n.user.userName,role:n.user.role,isChatAllowed:!!n.user.isChatAllowed,userProperties:n.user.userProperties});var o=r.filter((function(e){return 0!==e.state})),i=r.filter((function(e){return 0===e.state}));this.updateUserList(o,i);var s=a.filter((function(e){return 0!==e.state})),c=a.filter((function(e){return 0===e.state}));this.updateStreamList(s,c,null)}}},{key:"setRemoteOnlineUsers",value:function(e){var t=this._users;if(!t.length)return this._users=t.concat(e),void(this._users.length&&this.fire("remote-user-added",{users:this._users}));if(Object(cr.diff)(t,e)){var r=t.reduce((function(t,r){var a=e.find((function(e){return e.user.userUuid===r.user.userUuid}));if(a){var n=Object(h.a)(Object(h.a)({},r),a);t.push(n)}else t.push(r);return t}),[]);this._users=r,this._users.length&&this.fire("remote-user-updated",{users:r})}}},{key:"setRemoteOfflineUsers",value:function(e){if(e.length){var t=this._users.filter((function(t){return e.includes(t.user.userUuid)}));this._users=this._users.filter((function(t){return!e.includes(t.userUuid)}));var r=this._streams.filter((function(t){return e.includes(t.stream.userInfo.userUuid)}));this._streams=this._streams.filter((function(t){return!e.includes(t.stream.userInfo.userUuid)})),r&&this.fire("remote-stream-removed",{streams:r}),this.fire("remote-user-removed",{users:t})}}},{key:"setRemoteUsers",value:function(e){var t=e.filter((function(e){return 0!==e.state})),r=e.filter((function(e){return 0===e.state})).map((function(e){return e.user.userUuid}));this.setRemoteOnlineUsers(t),this.setRemoteOfflineUsers(r)}},{key:"setRemoteOnlineStreams",value:function(e){if(e.length){var t=this._streams;if(!t.length)return this._streams=t.concat(e),void(this._streams.length&&this.fire("remote-stream-added",{streams:this._streams}));if(Object(cr.diff)(t,e)){var r=[],a=t.reduce((function(t,a){var n=e.find((function(e){return e.stream.streamUuid===a.stream.streamUuid}));return n?(a.update(n),r.push(a),t.push(a)):t.push(a),t}),[]);this._streams=a,Te.info("setRemoteStreams 1301 ",this._streams,e),this._streams.length&&this.fire("remote-stream-updated",{streams:r})}}}},{key:"setRemoteOfflineStreams",value:function(e){if(e.length){var t=this._streams.filter((function(t){return e.includes(t.stream.streamUuid)}));t.length&&(this._streams=this._streams.filter((function(t){return!e.includes(t.stream.streamUuid)})),this.fire("remote-stream-removed",{streams:t}))}}},{key:"setRemoteStreams",value:function(e){var t=e.filter((function(e){return 0!==e.state})),r=e.filter((function(e){return 0===e.state})).map((function(e){return e.stream.streamUuid}));this.setRemoteOnlineStreams(t),this.setRemoteOfflineStreams(r)}}]),e}(),vr=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;Object(T.a)(this,r),(a=t.call(this)).apiService=void 0,a._rtmWrapper=void 0,a.config=void 0,a._classroomMap={},a._ended=!1,a._dataBuffer={},a._mediaService=void 0,a._rtmConnectionState="DISCONNECTED",a.config=e;var n={platform:a.config.platform,agoraSdk:a.config.agoraRtc,codec:a.config.codec?a.config.codec:"vp8",appId:a.config.appId};return"electron"===n.platform&&(n.electronLogPath={logPath:window.logPath,videoSourceLogPath:window.videoSourceLogPath}),a._mediaService=new tr(n),a.apiService=new sr(a.config.appId,a.authorization),a}return Object(C.a)(r,[{key:"rtmWrapper",get:function(){return this._rtmWrapper}},{key:"mediaService",get:function(){return this._mediaService}},{key:"authorization",get:function(){return window.btoa("".concat(this.config.customerId,":").concat(this.config.customerCertificate))}},{key:"prepareLogin",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.login(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fire",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];this.emit.apply(this,[e].concat(r))}},{key:"rtmConnectionState",get:function(){return this._rtmConnectionState}},{key:"login",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Te.debug("login userUuid: ".concat(t)),e.prev=1,e.next=4,this.prepareLogin(t);case 4:return r=e.sent,r.userUuid,a=r.rtmToken,Te.debug("prepareLogin login userUuid: ".concat(t," success")),(n=new Gt(this.config.agoraRtm)).on("ConnectionStateChanged",function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[rtm] ConnectionStateChanged",t),"RECONNECTING"!==n.prevConnectionState||"CONNECTED"!==n.connectionState){e.next=13;break}r=0,a=Object.keys(o._dataBuffer);case 3:if(!(r<a.length)){e.next=13;break}if(i=a[r],!(s=o._dataBuffer[i])){e.next=10;break}return console.log("[syncing] classroom",i),e.next=10,s.syncData(!0,300);case 10:r++,e.next=3;break;case 13:o.fire("ConnectionStateChanged",t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.on("MessageFromPeer",(function(e){console.log("[rtm] MessageFromPeer",e);var t=Wt.readMessage(e.message.text);if(null===t)return console.warn("[room] edu-manager is invalid",t);var r=t.cmd,a=t.version,n=t.requestId,i=t.data;if(Te.info("Raw MessageFromPeer peer cmd",r),1!==a)return Te.warn("received old version",n,i,r);switch(r){case kt.peer:Te.info("\u81ea\u5b9a\u4e49\u804a\u5929\u6d88\u606f, PeerMessage.".concat(kt.peer,": "),i,n);var s=Wt.getEduTextMessage(i);o.emit("user-chat-message",{message:s});break;case kt.customMessage:Te.info("\u8ba2\u9605\u81ea\u5b9a\u4e49\u70b9\u5bf9\u70b9\u6d88\u606f\uff0cPeerMessage.".concat(kt.customMessage,": "),i);var c=Wt.getEduCustomMessage(i);Te.info("\u81ea\u5b9a\u4e49\u70b9\u5bf9\u70b9\u6d88\u606f, user-message",c),o.emit("user-message",{message:c})}})),Te.debug("rtm login userUuid: ".concat(t,", rtmToken: ").concat(a," success")),e.next=14,n.login({userUuid:t,rtmToken:a,appId:this.config.appId,uploadLog:!0});case 14:Te.debug("login userUuid: ".concat(t," success")),this._rtmWrapper=n,e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(1),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rtmWrapper){e.next=6;break}return this._ended=!0,e.next=4,this.rtmWrapper.destroyRtm();case 4:this.removeAllListeners(),this._rtmWrapper=void 0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createClassroom",value:function(e){var t=e.roomUuid,r=new nr({roomUuid:t,roomName:e.roomName,eduManager:this,apiService:new sr(this.config.appId,this.authorization)});return this._classroomMap[e.roomUuid]=r,this._dataBuffer[e.roomUuid]=new fr(this._classroomMap[e.roomUuid]),this._classroomMap[e.roomUuid]}}],[{key:"init",value:function(e){return new r(e)}},{key:"enableDebugLog",value:function(e){this.enable=e,this.enable&&Te.init()}},{key:"uploadLog",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te.enableUpload(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter);vr.enable=!0,function(e){e[e.SceneType1v1=0]="SceneType1v1",e[e.SceneTypeSmallClass=1]="SceneTypeSmallClass",e[e.SceneTypeBigClass=2]="SceneTypeBigClass",e[e.SceneTypeBreakoutClass=3]="SceneTypeBreakoutClass"}(ur||(ur={})),function(e){e[e.follow=1]="follow",e[e.unfollow=0]="unfollow",e[e.grantPermission=1]="grantPermission",e[e.revokePermission=0]="revokePermission"}(lr||(lr={})),function(e){e[e.unmute=0]="unmute",e[e.mute=1]="mute"}(pr||(pr={})),function(e){e[e.unmute=0]="unmute",e[e.mute=1]="mute",e[e.disable=2]="disable"}(dr||(dr={})),function(e){e[e.unmute=0]="unmute",e[e.mute=1]="mute",e[e.disable=2]="disable"}(hr||(hr={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(mr||(mr={}));var br,gr,yr=r(28);!function(e){e.dynamic="dynamic",e.static="static",e.init="init"}(br||(br={})),function(e){e[e.Uploading=0]="Uploading",e[e.Converting=1]="Converting"}(gr||(gr={}));var kr,Sr,_r,Or,wr,jr,xr,Tr,Cr,Er,Ur,Rr,Pr,Ar,Ir,Lr,Nr,Mr,Dr,Vr,Wr,Fr,Br,zr,qr,Gr,Kr,Jr,Yr,Hr,Qr,Xr,Zr,$r,ea,ta=function(){function e(t,r,a){var n=this;Object(T.a)(this,e),this.ossClient=void 0,this.room=void 0,this.ossUploadCallback=void 0,this.getFile=function(e){return n.ossClient.generateObjectUrl(e)},this.addFile=function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ossClient.multipartUpload(t,r,{progress:function(e){a&&a(gr.Uploading,e)}});case 2:if(o=e.sent,n.ossUploadCallback&&n.ossUploadCallback(o),200!==o.res.status){e.next=8;break}return e.abrupt("return",n.getFile(t));case 8:throw new Error("upload to ali oss error, status is ".concat(o.res.status));case 9:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),this.ossClient=t,this.room=r,this.ossUploadCallback=a}return Object(C.a)(e,[{key:"convertFile",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a,n,o,i){var s,c,u,l,p,d,h,m,v;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Re(t),c=s.fileType,u="/".concat(n,"/").concat(o).concat(c),e.next=4,this.addFile(u,t,i);case 4:if(l=e.sent,a!==yr.PPTKind.Static){e.next=15;break}return e.next=8,r.convert({url:l,kind:a,onProgressUpdated:function(e){i&&i(gr.Converting,e)}});case 8:p=e.sent,d={active:!0,id:"".concat(Yt()()),pptType:br.static,data:p.scenes},h=fe()("/".concat(o,"/").concat(d.id)),this.room.putScenes("/".concat(h),p.scenes),this.room.setScenePath("/".concat(h,"/").concat(p.scenes[0].name)),e.next=22;break;case 15:return e.next=17,r.convert({url:l,kind:a,onProgressUpdated:function(e){i&&i(gr.Converting,e)}});case 17:p=e.sent,m={active:!0,id:"".concat(Yt()()),pptType:br.dynamic,data:p.scenes},v=fe()("/".concat(o,"/").concat(m.id)),this.room.putScenes("/".concat(v),p.scenes),this.room.setScenePath("/".concat(v,"/").concat(p.scenes[0].name));case 22:i&&i(gr.Converting,1);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,o,i){return e.apply(this,arguments)}}()},{key:"getImageSize",value:function(e){var t={width:window.innerWidth,height:window.innerHeight},r=e.width/e.height;return e.width>960&&t.width>960||e.height>960&&t.height>960?r>1?{width:960,height:960/r}:{width:960*r,height:960}:e.width>t.width||e.height>t.height?r>1?{width:t.width,height:t.width/r}:{width:t.height*r,height:t.height}:{width:e.width,height:e.height}}},{key:"uploadImageFiles",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a,n,o){var i,s,c=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.map((function(e){return c.fetchWhiteImageFileWith(e,a,n)})),e.next=3,Promise.all(i);case 3:return s=e.sent,e.next=6,this.uploadImageFilesArray(t,s,o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,o){return e.apply(this,arguments)}}()},{key:"fetchWhiteImageFileWith",value:function(e,t,r){var a=this;return new Promise((function(n){var o=new Image,i=new FileReader;i.readAsDataURL(e),i.onload=function(){o.src=i.result,o.onload=Object(v.a)(f.a.mark((function i(){var s,c;return f.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:s=a.getImageSize(o),c={width:s.width,height:s.height,file:e,coordinateX:t,coordinateY:r},n(c);case 3:case"end":return i.stop()}}),i)})))}}))}},{key:"uploadImageFilesArray",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o,i,s,c,u,l,p,d,h=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0)){e.next=7;break}n=r.map((function(e){return{uuid:Yt()(),imageFile:e}})),o=Object(or.a)(n);try{for(o.s();!(i=o.n()).done;)s=i.value,c=s.uuid,u=s.imageFile,l=this.room.convertToPointInWorld({x:u.coordinateX,y:u.coordinateY}),p=l.x,d=l.y,this.room.insertImage({uuid:c,centerX:p,centerY:d,width:u.width,height:u.height,locked:!1})}catch(m){o.e(m)}finally{o.f()}return e.next=6,Promise.all(n.map((function(e){return h.handleUploadTask(t,e,a)})));case 6:this.room.isWritable&&this.room.setMemberState({currentApplianceName:yr.ApplianceNames.selector});case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"handleUploadTask",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addFile("/".concat(t,"/").concat(r.uuid).concat(r.imageFile.file.name),r.imageFile.file,a);case 2:n=e.sent,this.room.isWritable&&this.room.completeImageUpload(r.uuid,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()}]),e}(),ra=r(281),aa=r(282),na=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{identity:"guest"};return Object(T.a)(this,r),(e=t.call(this)).client=void 0,e.plugins=void 0,e.room=void 0,e.player=void 0,e.sceneIndex=0,e.disconnected=!0,e.initPlugins(a.identity),e.init(),e}return Object(C.a)(r,[{key:"initPlugins",value:function(e){var t=Object(yr.createPlugins)({video:ra.videoPlugin,audio:aa.audioPlugin});t.setPluginContext("video",{identity:e}),t.setPluginContext("audio",{identity:e}),this.plugins=t}},{key:"init",value:function(){this.client=new yr.WhiteWebSdk({deviceType:yr.DeviceType.Surface,plugins:this.plugins,appIdentifier:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",loggerOptions:{disableReportLog:!0,reportLevelMask:"debug",printLevelMask:"debug"}}),this.disconnected=!0}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[breakout board] before board client join",t),e.next=3,this.client.joinRoom(t,{onPhaseChanged:function(e){r.emit("onPhaseChanged",e)},onRoomStateChanged:function(e){r.emit("onRoomStateChanged",e)},onDisconnectWithError:function(e){r.emit("onDisconnectWithError",e)},onKickedWithReason:function(e){r.emit("onKickedWithReason",e)},onKeyDown:function(e){r.emit("onKeyDown",e)},onKeyUp:function(e){r.emit("onKeyUp",e)},onHandToolActive:function(e){r.emit("onHandToolActive",e)},onPPTLoadProgress:function(e,t){r.emit("onPPTLoadProgress",{uuid:e,progress:t})}});case 3:this.room=e.sent,console.log("[breakout board] board client join"),this.disconnected=!1;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replay",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.replayRoom(t,{onPhaseChanged:function(e){r.emit("onPhaseChanged",e)},onLoadFirstFrame:function(){console.log("onLoadFirstFrame"),r.emit("onLoadFirstFrame")},onSliceChanged:function(){console.log("onSliceChanged"),r.emit("onSliceChanged")},onPlayerStateChanged:function(e){r.emit("onPlayerStateChanged",e)},onStoppedWithError:function(e){r.emit("onStoppedWithError",e)},onProgressTimeChanged:function(e){r.emit("onProgressTimeChanged",e)}});case 2:this.player=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"followMode",value:function(){this.room&&!this.disconnected&&this.room.setViewMode(yr.ViewMode.Broadcaster)}},{key:"startFollow",value:function(){this.room&&!this.disconnected&&(this.room.setGlobalState({follow:1}),console.log("[board] set start follow"))}},{key:"cancelFollow",value:function(){this.room&&!this.disconnected&&(this.room.setGlobalState({follow:0}),console.log("[board] set cancel follow"))}},{key:"grantPermission",value:function(e){if(this.room&&!this.disconnected){var t=Object(E.get)(this.room.state.globalState,"grantUsers",[]);t.find((function(t){return t===e}))||(t.push(e),this.room.setGlobalState({grantUsers:t}),console.log("[board] grantUsers ",JSON.stringify(t)))}}},{key:"revokePermission",value:function(e){if(this.room&&!this.disconnected){var t=Object(E.get)(this.room.state.globalState,"grantUsers",[]),r=t.findIndex((function(t){return t===e}));-1!==r&&(t.splice(r,1),this.room.setGlobalState({grantUsers:t}),console.log("[board] grantUsers ",JSON.stringify(t)))}}},{key:"destroy",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.room||this.disconnected){e.next=4;break}return e.next=3,this.room.disconnect();case 3:this.disconnected=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(ie.EventEmitter),oa=function(e){var t=encodeURI(e.name),r=t.substring(t.length,t.lastIndexOf("."));return{fileName:t,fileType:r}},ia={accessKeyId:Object(E.get)(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_KEY","empty-placeholder"),accessKeySecret:Object(E.get)(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET","empty-placeholder"),bucket:Object(E.get)(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_NAME","empty-placeholder"),endpoint:Object(E.get)(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE","empty-placeholder"),folder:Object(E.get)(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}),"REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER","empty-placeholder")},sa=function(e){return/\/([^/]*)\//g.exec(e),"aria"===RegExp.$1?"":RegExp.$1};!function(e){e[e.Follow=1]="Follow",e[e.Freedom=0]="Freedom"}(ea||(ea={}));var ca,ua,la,pa,da,ha,ma,fa,va,ba,ga,ya,ka,Sa,_a,Oa,wa,ja,xa,Ta,Ca,Ea,Ua,Ra,Pa,Aa,Ia,La,Na,Ma,Da,Va,Wa,Fa,Ba,za,qa,Ga,Ka,Ja,Ya,Ha,Qa,Xa,Za,$a,en,tn,rn,an,nn,on,sn,cn,un,ln,pn,dn,hn,mn,fn,vn,bn,gn,yn,kn,Sn,_n,On,wn,jn,xn,Tn,Cn,En,Un,Rn,Pn,An,In,Ln,Nn,Mn,Dn,Vn,Wn,Fn,Bn,zn,qn,Gn,Kn,Jn,Yn,Hn,Qn,Xn,Zn,$n,eo,to,ro,ao,no,oo,io,so,co,uo,lo,po,ho,mo,fo,vo,bo,go,yo,ko,So,_o,Oo,wo,jo,xo,To,Co,Eo=($r=Zr=function(){function e(t){Object(T.a)(this,e),this.scenes=[],Object(te.a)(this,"loading",Sr,this),Object(te.a)(this,"converting",_r,this),Object(te.a)(this,"currentPage",Or,this),Object(te.a)(this,"totalPage",wr,this),Object(te.a)(this,"currentScene",jr,this),Object(te.a)(this,"hasBoardPermission",xr,this),Object(te.a)(this,"selector",Tr,this),Object(te.a)(this,"showFolder",Cr,this),Object(te.a)(this,"lock",Er,this),Object(te.a)(this,"showUpload",Ur,this),Object(te.a)(this,"activeFooterItem",Rr,this),Object(te.a)(this,"uuid",Pr,this),Object(te.a)(this,"roomToken",Ar,this),Object(te.a)(this,"sceneItems",Ir,this),Object(te.a)(this,"activeScenePath",Lr,this),this.menuTitle="\u8bfe\u4ef6\u76ee\u5f55",this.appStore=void 0,Object(te.a)(this,"_boardClient",Nr,this),this.ossClient=void 0,Object(te.a)(this,"ready",Mr,this),Object(te.a)(this,"online",Dr,this),Object(te.a)(this,"follow",Vr,this),Object(te.a)(this,"grantUsers",Wr,this),Object(te.a)(this,"permission",Fr,this),Object(te.a)(this,"showColorPicker",Br,this),Object(te.a)(this,"strokeColor",zr,this),Object(te.a)(this,"scale",qr,this),Object(te.a)(this,"uploadingPhase",Gr,this),Object(te.a)(this,"convertingPhase",Kr,this),Object(te.a)(this,"sceneType",Jr,this),Object(te.a)(this,"convertPhase",Yr,this),Object(te.a)(this,"uploadPhase",Hr,this),Object(te.a)(this,"notices",Qr,this),Object(te.a)(this,"_grantPermission",Xr,this),this.appStore=t,this._boardClient=void 0,this.ossClient=new he.a(ia)}return Object(C.a)(e,[{key:"closeFolder",value:function(){this.showFolder=!1}},{key:"openFolder",value:function(){this.showFolder=!0}},{key:"changeScenePath",value:function(e){this.activeScenePath=e,this.online&&this.room&&this.room.setScenePath(this.activeScenePath)}},{key:"boardClient",get:function(){return this._boardClient}},{key:"room",get:function(){return this.boardClient.room}},{key:"localUser",get:function(){return this.appStore.roomStore.roomManager.localUser.user}},{key:"localUserUuid",get:function(){return this.appStore.userUuid}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.boardService.getBoardInfo();case 2:return t=e.sent,r=t.info,a=r.boardId,n=r.boardToken,e.next=8,this.join({uuid:a,roomToken:n,role:this.userRole,isWritable:!0,disableDeviceInputs:!0,disableCameraTransform:!0,disableAutoResize:!1});case 8:if(o=Object(E.get)(this.room.state.globalState,"grantUsers",[]),i=Object(E.get)(this.room.state.globalState,"follow",0),this.grantUsers=o,this.grantUsers.includes(this.localUserUuid)&&(this._grantPermission=!0),this.follow=i,"teacher"!==this.userRole?this.boardClient.room&&this.boardClient.room.isWritable&&(this.follow===ea.Follow&&(this.room.setViewMode(yr.ViewMode.Broadcaster),this.room.disableCameraTransform=!0,this.room.disableDeviceInputs=!0,this.lock=!0),this.follow===ea.Freedom&&(this.room.setViewMode(yr.ViewMode.Freedom),this.room.disableCameraTransform=!1,this.room.disableDeviceInputs=!1,this.lock=!1)):this.room.disableCameraTransform=!1,!this.hasPermission){e.next=20;break}return e.next=18,this.setWritable(!0);case 18:e.next=22;break;case 20:return e.next=22,this.setWritable(this._grantPermission);case 22:this.ready=!0;case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setFollow",value:function(e){this.follow=e,this.follow===ea.Follow?this.lock=!0:this.lock=!1,"teacher"===this.userRole?this.online&&this.room&&(this.follow===ea.Follow?(this.appStore.uiStore.addToast(A("toast.open_whiteboard_follow")),this.room.setViewMode(yr.ViewMode.Broadcaster)):(this.appStore.uiStore.addToast(A("toast.close_whiteboard_follow")),this.room.setViewMode(yr.ViewMode.Freedom))):this.online&&this.room&&(this.follow===ea.Follow?(this.room.disableCameraTransform=!0,this.room.setViewMode(yr.ViewMode.Follower),this.room.disableDeviceInputs=!0):(this.room.disableCameraTransform=!1,this.room.setViewMode(yr.ViewMode.Freedom),this.room.disableDeviceInputs=!1))}},{key:"setGrantPermission",value:function(e){this._grantPermission=e,this.setWritable(e)}},{key:"setGrantUsers",value:function(e){this.grantUsers=e}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.role,a=Object(Nt.a)(t,["role"]),n="teacher"===r?"host":"guest",this._boardClient=new na({identity:n}),this.boardClient.on("onPhaseChanged",(function(e){"disconnected"===e&&(o.online=!1)})),this.boardClient.on("onRoomStateChanged",(function(e){e.zoomScale&&Object(Ee.p)((function(){o.scale=e.zoomScale})),(e.sceneState||e.globalState)&&o.updateSceneItems(),e.globalState&&o.updateBoardState()})),console.log("[breakout board] join",a),e.next=8,this.boardClient.join(a);case 8:console.log("[breakout board] after join",a),this.online=!0,this.room.bindHtmlElement(null),window.addEventListener("resize",(function(){o.online&&o.room&&o.room.isWritable&&(o.room.moveCamera({centerX:0,centerY:0}),o.room.refreshViewSize())})),this.updateSceneItems();case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.boardClient||!this.room){e.next=5;break}return e.next=3,this.boardClient.destroy();case 3:this.room.bindHtmlElement(null),this.reset();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeFooterMenu",value:function(e){this.activeFooterItem=e;var t=this.room;if(t&&t.isWritable)switch(this.activeFooterItem){case"first_page":return void this.changePage(0,!0);case"last_page":return void this.changePage(this.totalPage-1,!0);case"next_page":return void this.changePage(t.state.sceneState.index+1);case"prev_page":return void this.changePage(t.state.sceneState.index-1)}}},{key:"setTool",value:function(e){if(this.selector=e,"upload"===this.selector?this.showUpload=!0:this.showUpload&&(this.showUpload=!1),"color_picker"===this.selector?this.showColorPicker=!0:this.showColorPicker&&(this.showColorPicker=!1),this.room&&this.room.isWritable)switch(this.selector){case"eraser":case"ellipse":case"rectangle":case"pencil":case"text":case"selector":this.room.handToolActive=!1,this.room.setMemberState({currentApplianceName:this.selector});break;case"color_picker":this.room.setMemberState({currentApplianceName:"selector"});break;case"hand_tool":this.room.setMemberState({currentApplianceName:"hand"});break;case"add":var t=this.room,r=t.state.sceneState.index+1,a=t.state.sceneState.scenePath,n="/".concat(sa(a));t.isWritable&&(t.putScenes(n,[{}],r),t.setSceneIndex(r));break;default:this.room.handToolActive=!1,this.room.setMemberState({currentApplianceName:"selector"})}}},{key:"changeColor",value:function(e){var t=e.rgb,r=t.r,a=t.g,n=t.b;if(this.room){this.room.setMemberState({strokeColor:[r,a,n]});var o=Object(b.a)(this.room.state.memberState.strokeColor,3),i=o[0],s=o[1],c=o[2];this.strokeColor={r:i,g:s,b:c}}}},{key:"updateScale",value:function(e){this.room&&this.online&&this.room.moveCamera({scale:e}),this.scale=e}},{key:"toggleLockBoard",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.boardClient&&this.room&&(this.follow?(this.boardClient.cancelFollow(),this.room.setViewMode(yr.ViewMode.Freedom)):(this.boardClient.startFollow(),this.room.setViewMode(yr.ViewMode.Broadcaster)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleProgress",value:function(e,t){var r=this;e!==gr.Uploading?e!==gr.Converting||(t<1?Object(Ee.p)((function(){"converting"!==r.convertingPhase&&(r.convertingPhase="uploading")})):this.convertingPhase="converting_done"):t<1?Object(Ee.p)((function(){"uploading"!==r.uploadingPhase&&r.uploadingPhase})):Object(Ee.p)((function(){r.uploadingPhase="upload_finished"}))}},{key:"handleSuccess",value:function(){this.uploadingPhase&&(this.uploadingPhase=""),this.convertingPhase&&(this.convertingPhase="")}},{key:"handleFailure",value:function(){"uploading"===this.uploadingPhase&&(this.uploadingPhase="upload_failure"),"converting"==this.convertingPhase&&(this.convertingPhase="upload_failure")}},{key:"loadingType",get:function(){return this._boardClient?this.converting?"converting":this.loading?"loading":"":"loading"}},{key:"changePage",value:function(e,t){var r=this.room;if(r&&r.isWritable){var a=e;if(a<0||a>=this.totalPage)console.warn(a<0,a>=this.totalPage);else{if(t)return r.setSceneIndex(a),void this.updateSceneItems();"dynamic"===this.sceneType?a>this.currentPage?r.pptNextStep():r.pptPreviousStep():r.setSceneIndex(a),this.updateSceneItems()}}}},{key:"addScenes",value:function(e,t){}},{key:"removeScenes",value:function(e,t){var r=this.room;if(this.online&&r){r.removeScenes(e);var a=r.state.globalState.sceneMap,n=Object(E.omit)(a,["".concat(e)]);t?r.setGlobalState({sceneMap:""}):r.setGlobalState({sceneMap:n}),this.updateSceneItems()}}},{key:"getNameByScenePath",value:function(e){var t=this.room,r=Object(E.get)(t,"state.globalState.sceneMap",{});return Object(E.get)(r,e,"default name")}},{key:"updateBoardState",value:function(){var e=Object(E.get)(this.room.state.globalState,"follow",0);e!==this.follow&&(this.setFollow(e),"student"===this.userRole&&(this.follow?this.appStore.uiStore.addToast(A("toast.whiteboard_lock")):this.appStore.uiStore.addToast(A("toast.whiteboard_unlock")))),this.grantUsers=Object(E.get)(this.room.state.globalState,"grantUsers",[]);var t=this.grantUsers;if(t&&Array.isArray(t)){var r=!(!t.includes(this.localUserUuid)&&0!==this.roomType);if("student"===this.userRole&&r!==this.hasPermission){var a=r?"toast.teacher_accept_whiteboard":"toast.teacher_cancel_whiteboard";this.appStore.uiStore.addToast(A(a))}this.setGrantUsers(t),"student"===this.userRole&&this.setGrantPermission(r)}}},{key:"updateSceneItems",value:function(){for(var e=this.room,t=e.state.sceneState.scenePath,r=e.state.sceneState.scenes[0].ppt,a=(Object(E.isEmpty)(r),e?e.entireScenes():{}),n=[],o=0,i=Object.keys(a);o<i.length;o++){var s=i[o],c={path:s,file:{name:this.getNameByScenePath(s),type:"whiteboard"},type:"static",rootPath:""};a[s]&&(c.rootPath=-1!==["/","/init"].indexOf(s)?"/init":"".concat(s,"/").concat(a[s][0].name),c.type=a[s][0].ppt?"dynamic":"static","dynamic"===c.type&&(c.file.type="ppt")),n.push(c)}var u=sa(t),l=""===u?"/":"/".concat(u),p=[];n.forEach((function(e){p.push({path:e.path,rootPath:e.rootPath,file:e.file})})),this.currentScene=l,this.sceneItems=n,this.updatePagination()}},{key:"updatePagination",value:function(){var e=this.room;this.online&&e&&(this.currentPage=e.state.sceneState.index+1,this.totalPage=e.state.sceneState.scenes.length)}},{key:"updateConvertPhase",value:function(e){this.convertPhase=e,"converting"===this.convertPhase?this.converting=!0:this.converting=!1,"convert_success"===this.uploadPhase&&this.addNotice({title:A("room.convert_success"),type:"ok"}),"convert_failure"===this.uploadPhase&&this.addNotice({title:A("room.convert_failure"),type:"error"})}},{key:"updateUploadPhase",value:function(e){this.uploadPhase=e,"uploading"===this.uploadPhase?this.loading=!0:this.loading=!1,"upload_success"===this.uploadPhase&&this.addNotice({title:A("room.upload_success"),type:"ok"}),"upload_failure"===this.uploadPhase&&this.addNotice({title:A("room.upload_failure"),type:"error"})}},{key:"uploadDynamicPPT",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!this.online){e.next=15;break}return e.prev=1,r=this.room,a=new ta(this.ossClient,r),n=this.boardClient.client.pptConverter(r.roomToken),o=function(e,t){e===gr.Uploading&&(t<1?"uploading"!==i.uploadPhase&&i.updateUploadPhase("uploading"):i.updateUploadPhase("upload_success")),e===gr.Converting&&(t<1?"converting"!==i.convertPhase&&i.updateConvertPhase("converting"):i.updateConvertPhase("convert_success"))},e.next=8,a.convertFile(t,n,yr.PPTKind.Dynamic,ia.folder,r.uuid,o);case 8:e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),"uploading"===this.uploadPhase&&this.updateUploadPhase("upload_failure"),"converting"===this.convertPhase&&this.updateConvertPhase("convert_failure"),console.warn(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadStaticFile",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t||!this.online){e.next=8;break}return r=this.room,a=new ta(this.ossClient,r),n=this.boardClient.client.pptConverter(r.roomToken),o=function(e,t){e===gr.Uploading&&(t<1?"uploading"!==i.uploadPhase&&i.updateUploadPhase("uploading"):i.updateUploadPhase("upload_success")),e===gr.Converting&&(t<1?"converting"!==i.convertPhase&&i.updateConvertPhase("converting"):i.updateConvertPhase("convert_success"))},e.next=8,a.convertFile(t,n,yr.PPTKind.Static,ia.folder,r.uuid,o);case 8:e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),"uploading"===this.uploadPhase&&this.updateUploadPhase("upload_failure"),"converting"===this.convertPhase&&this.updateConvertPhase("convert_failure"),console.warn(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadAudioVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p,d,h,m=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!this.online){e.next=25;break}return r=this.room,a=new ta(this.ossClient,r),e.prev=3,n=oa(t),o=n.fileName,i=n.fileType,s="/".concat(ia.folder),c=Yt()(),u=function(e,t){e===gr.Uploading&&(t<1?"uploading"!==m.uploadPhase&&m.updateUploadPhase("uploading"):m.updateUploadPhase("upload_success")),e===gr.Converting&&(t<1?"converting"!==m.convertPhase&&m.updateConvertPhase("converting"):m.updateConvertPhase("convert_success"))},e.next=10,a.addFile("".concat(s,"/video-").concat(o).concat(c),t,u);case 10:if(l=e.sent,p=-1!==l.indexOf("https"),d=p?l:l.replace("http","https"),h=i.split(".")[1],!(d&&this.online&&r)){e.next=18;break}return"mp4"===h.toLowerCase()&&r.insertPlugin("video",{originX:0,originY:0,width:480,height:270,attributes:{pluginVideoUrl:d,isNavigationDisable:!1}}),"mp3"===h.toLowerCase()&&r.insertPlugin("audio",{originX:0,originY:0,width:480,height:86,attributes:{pluginAudioUrl:d,isNavigationDisable:!1}}),e.abrupt("return");case 18:e.next=25;break;case 20:e.prev=20,e.t0=e.catch(3),"uploading"===this.uploadPhase&&this.updateUploadPhase("upload_failure"),"converting"===this.convertPhase&&this.updateConvertPhase("convert_failure"),console.warn(e.t0);case 25:case"end":return e.stop()}}),e,this,[[3,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadImage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p=this,d=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:null,!this.online||!t){e.next=25;break}if(a=this.room,(n=[]).push(t),o=function(e,t){e===gr.Uploading&&(t<1?"uploading"!==p.uploadPhase&&p.updateUploadPhase("uploading"):p.updateUploadPhase("upload_success")),e===gr.Converting&&(t<1?"converting"!==p.convertPhase&&p.updateConvertPhase("converting"):p.updateConvertPhase("convert_success"))},e.prev=6,i=new ta(this.ossClient,a),!r){e.next=14;break}return s=r.clientWidth,c=r.clientHeight,e.next=12,i.uploadImageFiles(ia.folder,n,s/2,c/2,o);case 12:e.next=18;break;case 14:return u=window.innerWidth,l=window.innerHeight,e.next=18,i.uploadImageFiles(ia.folder,n,u/2,l/2,o);case 18:e.next=25;break;case 20:e.prev=20,e.t0=e.catch(6),"uploading"===this.uploadPhase&&this.updateUploadPhase("upload_failure"),"converting"===this.convertPhase&&this.updateConvertPhase("convert_failure"),console.warn(e.t0);case 25:case"end":return e.stop()}}),e,this,[[6,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addNotice",value:function(e){this.notices.push({title:e.title,type:e.type})}},{key:"removeNotice",value:function(e){var t=this.notices.findIndex((function(t){return t.title===e.title}));-1!==t&&this.notices.splice(t,1)}},{key:"reset",value:function(){this.scenes=[],this.currentPage=0,this.totalPage=0,this.currentScene="/init",this.hasBoardPermission=0,this.selector="",this.notices=[],this.converting=!1,this.loading=!1,this.uploadPhase="",this.convertingPhase="",this.permission=0,this.follow=0,this.grantUsers=[],this._grantPermission=!1,this.ready=!1}},{key:"roomIsWritable",value:function(e){return!!e&&e.isWritable}},{key:"setWritable",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.online||!this.room){e.next=6;break}return e.next=3,this.room.setWritable(t);case 3:if(!this.lock){e.next=5;break}return e.abrupt("return");case 5:this.room.disableDeviceInputs=!t;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"grantUserPermission",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.boardService.updateBoardUserState(t,lr.grantPermission);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"revokeUserPermission",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.boardService.updateBoardUserState(t,lr.revokePermission);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"userRole",get:function(){return this.appStore.userRole}},{key:"roomType",get:function(){return this.appStore.roomType}},{key:"boardService",get:function(){return this.appStore.boardService}},{key:"hasPermission",get:function(){return"teacher"===this.userRole||0===this.roomType||this._grantPermission}},{key:"checkUserPermission",value:function(e){return this.grantUsers.includes(e)}},{key:"grantBoardPermission",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.boardClient.grantPermission(t),this.appStore.uiStore.addToast("\u6388\u6743\u767d\u677f\u6210\u529f")}catch(r){this.appStore.uiStore.addToast(A("toast.failed_to_authorize_whiteboard")+"".concat(r.msg))}case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"revokeBoardPermission",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.boardClient.revokePermission(t),this.appStore.uiStore.addToast("\u53d6\u6d88\u6388\u6743\u767d\u677f\u6210\u529f")}catch(r){this.appStore.uiStore.addToast(A("toast.failed_to_deauthorize_whiteboard")+"".concat(r.msg))}case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mount",value:function(e){console.log("mounted",e,this.boardClient&&this.boardClient.room),this.boardClient&&this.boardClient.room&&this.boardClient.room.bindHtmlElement(e)}},{key:"unmount",value:function(){this.boardClient&&this.boardClient.room&&this.boardClient.room.bindHtmlElement(null)}}]),e}(),Zr.items=[{name:"selector",text:A("tool.selector")},{name:"pencil",text:A("tool.pencil")},{name:"rectangle",text:A("tool.rectangle")},{name:"ellipse",text:A("tool.ellipse")},{name:"text",text:A("tool.text")},{name:"eraser",text:A("tool.eraser")},{name:"color_picker",text:A("tool.color_picker")},{name:"add",text:A("tool.add")},{name:"upload",text:A("tool.upload")},{name:"hand_tool",text:A("tool.hand_tool")}],kr=$r,Sr=Object(re.a)(kr.prototype,"loading",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_r=Object(re.a)(kr.prototype,"converting",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Or=Object(re.a)(kr.prototype,"currentPage",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wr=Object(re.a)(kr.prototype,"totalPage",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jr=Object(re.a)(kr.prototype,"currentScene",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"/init"}}),xr=Object(re.a)(kr.prototype,"hasBoardPermission",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tr=Object(re.a)(kr.prototype,"selector",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Cr=Object(re.a)(kr.prototype,"showFolder",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(kr.prototype,"closeFolder",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"closeFolder"),kr.prototype),Object(re.a)(kr.prototype,"openFolder",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"openFolder"),kr.prototype),Er=Object(re.a)(kr.prototype,"lock",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ur=Object(re.a)(kr.prototype,"showUpload",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rr=Object(re.a)(kr.prototype,"activeFooterItem",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Pr=Object(re.a)(kr.prototype,"uuid",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ar=Object(re.a)(kr.prototype,"roomToken",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ir=Object(re.a)(kr.prototype,"sceneItems",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lr=Object(re.a)(kr.prototype,"activeScenePath",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"/init"}}),Object(re.a)(kr.prototype,"changeScenePath",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"changeScenePath"),kr.prototype),Nr=Object(re.a)(kr.prototype,"_boardClient",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(kr.prototype,"boardClient",[Ee.h],Object.getOwnPropertyDescriptor(kr.prototype,"boardClient"),kr.prototype),Mr=Object(re.a)(kr.prototype,"ready",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Dr=Object(re.a)(kr.prototype,"online",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vr=Object(re.a)(kr.prototype,"follow",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wr=Object(re.a)(kr.prototype,"grantUsers",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fr=Object(re.a)(kr.prototype,"permission",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(kr.prototype,"init",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"init"),kr.prototype),Object(re.a)(kr.prototype,"setFollow",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"setFollow"),kr.prototype),Object(re.a)(kr.prototype,"setGrantPermission",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"setGrantPermission"),kr.prototype),Object(re.a)(kr.prototype,"setGrantUsers",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"setGrantUsers"),kr.prototype),Object(re.a)(kr.prototype,"join",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"join"),kr.prototype),Object(re.a)(kr.prototype,"leave",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"leave"),kr.prototype),Object(re.a)(kr.prototype,"changeFooterMenu",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"changeFooterMenu"),kr.prototype),Br=Object(re.a)(kr.prototype,"showColorPicker",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zr=Object(re.a)(kr.prototype,"strokeColor",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{r:0,g:0,b:0}}}),Object(re.a)(kr.prototype,"setTool",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"setTool"),kr.prototype),qr=Object(re.a)(kr.prototype,"scale",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Object(re.a)(kr.prototype,"changeColor",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"changeColor"),kr.prototype),Object(re.a)(kr.prototype,"updateScale",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updateScale"),kr.prototype),Object(re.a)(kr.prototype,"toggleLockBoard",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"toggleLockBoard"),kr.prototype),Gr=Object(re.a)(kr.prototype,"uploadingPhase",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kr=Object(re.a)(kr.prototype,"convertingPhase",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(kr.prototype,"handleSuccess",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"handleSuccess"),kr.prototype),Object(re.a)(kr.prototype,"handleFailure",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"handleFailure"),kr.prototype),Object(re.a)(kr.prototype,"loadingType",[Ee.h],Object.getOwnPropertyDescriptor(kr.prototype,"loadingType"),kr.prototype),Jr=Object(re.a)(kr.prototype,"sceneType",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(kr.prototype,"addScenes",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"addScenes"),kr.prototype),Object(re.a)(kr.prototype,"removeScenes",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"removeScenes"),kr.prototype),Object(re.a)(kr.prototype,"updateBoardState",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updateBoardState"),kr.prototype),Object(re.a)(kr.prototype,"updateSceneItems",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updateSceneItems"),kr.prototype),Object(re.a)(kr.prototype,"updatePagination",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updatePagination"),kr.prototype),Yr=Object(re.a)(kr.prototype,"convertPhase",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(kr.prototype,"updateConvertPhase",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updateConvertPhase"),kr.prototype),Object(re.a)(kr.prototype,"updateUploadPhase",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"updateUploadPhase"),kr.prototype),Hr=Object(re.a)(kr.prototype,"uploadPhase",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(kr.prototype,"uploadDynamicPPT",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"uploadDynamicPPT"),kr.prototype),Object(re.a)(kr.prototype,"uploadStaticFile",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"uploadStaticFile"),kr.prototype),Object(re.a)(kr.prototype,"uploadAudioVideo",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"uploadAudioVideo"),kr.prototype),Object(re.a)(kr.prototype,"uploadImage",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"uploadImage"),kr.prototype),Qr=Object(re.a)(kr.prototype,"notices",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(kr.prototype,"addNotice",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"addNotice"),kr.prototype),Object(re.a)(kr.prototype,"removeNotice",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"removeNotice"),kr.prototype),Object(re.a)(kr.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"reset"),kr.prototype),Object(re.a)(kr.prototype,"grantUserPermission",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"grantUserPermission"),kr.prototype),Object(re.a)(kr.prototype,"revokeUserPermission",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"revokeUserPermission"),kr.prototype),Xr=Object(re.a)(kr.prototype,"_grantPermission",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(kr.prototype,"hasPermission",[Ee.h],Object.getOwnPropertyDescriptor(kr.prototype,"hasPermission"),kr.prototype),Object(re.a)(kr.prototype,"grantBoardPermission",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"grantBoardPermission"),kr.prototype),Object(re.a)(kr.prototype,"revokeBoardPermission",[Ee.f],Object.getOwnPropertyDescriptor(kr.prototype,"revokeBoardPermission"),kr.prototype),kr),Uo=function(){function e(){Object(T.a)(this,e),this.mutex=Promise.resolve()}return Object(C.a)(e,[{key:"lock",value:function(){var e=function(e){};return this.mutex=this.mutex.then((function(){return new Promise(e)})),new Promise((function(t){e=t}))}},{key:"dispatch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.lock();case 2:return r=e.sent,e.prev=3,e.next=6,Promise.resolve(t());case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,r(),e.finish(7);case 10:case"end":return e.stop()}}),e,this,[[3,,7,10]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ro=function(){function e(){Object(T.a)(this,e),this._intervalMap={}}return Object(C.a)(e,[{key:"addInterval",value:function(e,t,r){this._intervalMap.hasOwnProperty(e)&&this.delInterval(e),this._intervalMap[e]=setInterval(t,r)}},{key:"delInterval",value:function(e){clearInterval(this._intervalMap[e]),delete this._intervalMap[e]}}]),e}(),Po=function(){function e(t,r){Object(T.a)(this,e),this._board_prefix="".concat("https://api.agora.io","/board/apps/%app_id").replace("%app_id",ve),this.userToken=void 0,this.roomUuid=void 0,this.userToken=t,this.roomUuid=r}return Object(C.a)(e,[{key:"board_prefix",get:function(){return this._board_prefix}},{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.method,t.token,a=t.data,t.full_url,n=t.url,t.type,o={method:r,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(be.replace(/basic\s+|basic/i,""))}},this.userToken&&(o.headers.token=this.userToken),a&&(o.body=JSON.stringify(a)),e.next=6,ir("".concat(this.board_prefix).concat(n),o);case 6:if(0===(i=e.sent).code){e.next=9;break}throw{msg:i.msg};case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBoardInfo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBoardRoomInfo(t);case 2:return r=e.sent,e.abrupt("return",{info:{boardId:Object(E.get)(r,"info.boardId"),boardToken:Object(E.get)(r,"info.boardToken")},state:{follow:Object(E.get)(r,"state.follow"),grantUsers:Object(E.get)(r,"state.grantUsers",[])}});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCurrentBoardInfo",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBoardInfo(this.roomUuid);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getBoardRoomInfo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({type:"board",url:"/v1/rooms/".concat(t),method:"GET"});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateBoardUserState",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({type:"board",url:"/v1/rooms/".concat(t,"/users/").concat(r),method:"PUT",data:{grantPermission:a}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"updateBoardRoomState",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({type:"board",url:"/v1/rooms/".concat(t,"/state"),method:"PUT",data:{follow:r}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateCurrentBoardUserState",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateBoardUserState(this.roomUuid,t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateCurrentBoardState",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateBoardRoomState(this.roomUuid,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ao=function(){function e(t,r){Object(T.a)(this,e),this.apiService=void 0,this.apiService=new Po(t,r)}return Object(C.a)(e,[{key:"getBoardInfo",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.getCurrentBoardInfo();case 2:return t=e.sent,console.log(">>> info",t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateBoardUserState",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.updateCurrentBoardUserState(t,r);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateBoardRoomState",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.updateCurrentBoardState(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Io=function(){function e(t){Object(T.a)(this,e),this.userToken=void 0,this.record_prefix="".concat("https://api.agora.io","/recording/apps/%app_id").replace("%app_id",ve),this.userToken=t}return Object(C.a)(e,[{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.method,a=t.data,n=t.full_url,o=t.url,i={method:r,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(be.replace(/basic\s+|basic/i,""))}},this.userToken&&(i.headers.token=this.userToken),a&&(i.body=JSON.stringify(a)),!n){e.next=10;break}return e.next=7,ir("".concat(n),i);case 7:s=e.sent,e.next=13;break;case 10:return e.next=12,ir("".concat(this.record_prefix).concat(o),i);case 12:s=e.sent;case 13:if(0===s.code){e.next=15;break}throw{msg:s.msg};case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryRoomRecordBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,a=[];case 2:return n=r>0?"/v1/rooms/".concat(t,"/records?nextId=").concat(r):"/v1/rooms/".concat(t,"/records"),e.next=5,this.fetch({url:n,method:"GET"});case 5:o=e.sent,i=o.data,r=i.nextId,a=a.concat(i.list);case 9:if(r){e.next=2;break}case 10:return e.abrupt("return",{list:a});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/records/start"),method:"POST",data:{recordingConfig:{maxIdleTime:900}}});case 2:return r=e.sent,e.abrupt("return",{recordId:r.data.recordId});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/records/").concat(r,"/stop"),method:"POST"});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),Lo=function(){function e(t){Object(T.a)(this,e),this.apiService=void 0,this.apiService=new Io(t)}return Object(C.a)(e,[{key:"getCourseRecordBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.queryRoomRecordBy(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.startRecording(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.stopRecording(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),No=function(){function e(){Object(T.a)(this,e)}return Object(C.a)(e,[{key:"prefix",get:function(){return"".concat("https://api.agora.io","/scene/apps/%app_id").replace("%app_id",ve)}},{key:"fetch",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.method,a=t.token,n=t.data,o=t.full_url,i=t.url,t.type,s={method:r,headers:{"Content-Type":"application/json",Authorization:"Basic ".concat(be.replace(/basic\s+|basic/i,""))}},n&&(s.body=JSON.stringify(n)),a&&(s.headers.token=a),!o){e.next=10;break}return e.next=7,ir("".concat(o),s);case 7:c=e.sent,e.next=13;break;case 10:return e.next=12,ir("".concat(this.prefix).concat(i),s);case 12:c=e.sent;case 13:if(0===c.code){e.next=15;break}throw{msg:c.msg};case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"acquireRoomGroupBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 4,e.prev=1,e.next=4,this.createGroup(t,4,r);case 4:return a=e.sent,e.abrupt("return",a);case 8:e.prev=8,e.t0=e.catch(1),console.warn("[breakout] ",e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={roomUuid:"".concat(t.roomName).concat(t.roomType),roomName:"".concat(t.roomName),roleConfig:{host:{limit:1},broadcaster:{limit:1}}},e.prev=1,t.roomType===ur.SceneType1v1&&(r.roleConfig={host:{limit:1},broadcaster:{limit:1}}),t.roomType===ur.SceneTypeSmallClass&&(r.roleConfig={host:{limit:1},broadcaster:{limit:16}}),t.roomType===ur.SceneTypeBigClass&&(r.roleConfig={host:{limit:1},audience:{limit:-1},broadcaster:{limit:1}}),t.roomType===ur.SceneTypeBreakoutClass&&(r.roleConfig={host:{limit:1},audience:{limit:-1},assistant:{limit:1}}),e.next=8,this.createRoom(r);case 8:e.next=14;break;case 10:if(e.prev=10,e.t0=e.catch(1),"Room conflict!"===e.t0.msg){e.next=14;break}throw e.t0;case 14:return e.next=16,this.queryRoom(r.roomUuid);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createGroup",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({full_url:"".concat("https://api.agora.io","/grouping/apps/").concat(ve,"/v1/rooms/").concat(t,"/groups"),method:"POST",data:{roleConfig:{broadcaster:{limit:4},assistant:{limit:1}},memberLimit:r},token:a});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"createRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomUuid,a=Object(Nt.a)(t,["roomUuid"]),e.next=3,this.fetch({url:"/v1/rooms/".concat(r,"/config"),method:"POST",data:a});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/config"),method:"GET"});case 2:return r=e.sent,a=r.data,e.abrupt("return",{roomName:a.roomName,roomUuid:a.roomUuid,roleConfig:a.roleConfig});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch({url:"/v1/rooms/".concat(t,"/config"),method:"POST"});case 2:return r=e.sent,a=r.data,e.abrupt("return",{uid:a.uid,channel:a.channel,token:a.token});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Mo={excellent:"network-good",good:"network-good",poor:"network-normal",bad:"network-normal","very bad":"network-bad",down:"network-bad",unknown:"network-normal"},Do=(Ja=Ka=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),a=t.call(this),Object(te.a)(a,"resolutionIdx",ua,Object(Kt.a)(a)),Object(te.a)(a,"deviceList",la,Object(Kt.a)(a)),Object(te.a)(a,"cameraLabel",pa,Object(Kt.a)(a)),Object(te.a)(a,"microphoneLabel",da,Object(Kt.a)(a)),a._totalVolume=void 0,Object(te.a)(a,"_cameraId",ha,Object(Kt.a)(a)),Object(te.a)(a,"_microphoneId",ma,Object(Kt.a)(a)),a._boardService=void 0,a._recordService=void 0,Object(te.a)(a,"resolution",fa,Object(Kt.a)(a)),Object(te.a)(a,"_playbackVolume",va,Object(Kt.a)(a)),Object(te.a)(a,"_microphoneTrack",ba,Object(Kt.a)(a)),Object(te.a)(a,"_cameraRenderer",ga,Object(Kt.a)(a)),Object(te.a)(a,"_screenVideoRenderer",ya,Object(Kt.a)(a)),Object(te.a)(a,"totalVolume",ka,Object(Kt.a)(a)),a.appStore=void 0,Object(te.a)(a,"currentWindowId",Sa,Object(Kt.a)(a)),Object(te.a)(a,"customScreenShareWindowVisible",_a,Object(Kt.a)(a)),Object(te.a)(a,"customScreenShareItems",Oa,Object(Kt.a)(a)),Object(te.a)(a,"settingVisible",wa,Object(Kt.a)(a)),a.autoplay=!1,Object(te.a)(a,"recordState",ja,Object(Kt.a)(a)),a.startTime=0,Object(te.a)(a,"sharing",xa,Object(Kt.a)(a)),a._hasCamera=void 0,a._hasMicrophone=void 0,a.mutex=new Uo,a.cameraLock=!1,a.microphoneLock=!1,Object(te.a)(a,"waitingShare",Ta,Object(Kt.a)(a)),Object(te.a)(a,"userList",Ca,Object(Kt.a)(a)),Object(te.a)(a,"streamList",Ea,Object(Kt.a)(a)),Object(te.a)(a,"unreadMessageCount",Ua,Object(Kt.a)(a)),Object(te.a)(a,"messages",Ra,Object(Kt.a)(a)),Object(te.a)(a,"joined",Pa,Object(Kt.a)(a)),Object(te.a)(a,"menuVisible",Aa,Object(Kt.a)(a)),Object(te.a)(a,"activeTab",Ia,Object(Kt.a)(a)),Object(te.a)(a,"classState",La,Object(Kt.a)(a)),Object(te.a)(a,"_delay",Na,Object(Kt.a)(a)),Object(te.a)(a,"time",Ma,Object(Kt.a)(a)),a._roomManager=void 0,Object(te.a)(a,"_cameraEduStream",Da,Object(Kt.a)(a)),Object(te.a)(a,"_screenEduStream",Va,Object(Kt.a)(a)),a.roomApi=void 0,Object(te.a)(a,"joiningRTC",Wa,Object(Kt.a)(a)),Object(te.a)(a,"isMuted",Fa,Object(Kt.a)(a)),a._unreadMessageCount=0,Object(te.a)(a,"roomChatMessages",Ba,Object(Kt.a)(a)),Object(te.a)(a,"recordId",za,Object(Kt.a)(a)),Object(te.a)(a,"recording",qa,Object(Kt.a)(a)),Object(te.a)(a,"notice",Ga,Object(Kt.a)(a)),a.appStore=e,a}return Object(C.a)(r,[{key:"cameraId",get:function(){var e=this,t=this.cameraList.findIndex((function(t){return t.label===e.cameraLabel}));return this.cameraList[t]?this.cameraList[t].deviceId:""}},{key:"microphoneId",get:function(){var e=this,t=this.microphoneList.findIndex((function(t){return t.label===e.microphoneLabel}));return this.microphoneList[t]?this.microphoneList[t].deviceId:""}},{key:"playbackVolume",get:function(){return this._playbackVolume?this._playbackVolume:this.mediaService.getPlaybackVolume()}},{key:"changePlaybackVolume",value:function(e){this.mediaService.changePlaybackVolume(e),this._playbackVolume=e}},{key:"cameraRenderer",get:function(){return this._cameraRenderer}},{key:"screenVideoRenderer",get:function(){return this._screenVideoRenderer}},{key:"remoteUsersRenderer",get:function(){return this.appStore.mediaStore.remoteUsersRenderer}},{key:"boardService",get:function(){return this.appStore.boardService}},{key:"recordService",get:function(){return this.appStore.recordService}},{key:"showSetting",value:function(){this.settingVisible=!0}},{key:"hideSetting",value:function(){this.settingVisible=!1}},{key:"resetCameraTrack",value:function(){this._cameraRenderer=void 0}},{key:"resetMicrophoneTrack",value:function(){this._microphoneTrack=void 0}},{key:"resetScreenTrack",value:function(){this._screenVideoRenderer=void 0}},{key:"resetScreenStream",value:function(){this.screenVideoRenderer&&(this.screenVideoRenderer.stop(),this._screenVideoRenderer=void 0),this.screenEduStream&&(this._screenEduStream=void 0)}},{key:"reset",value:function(){this.appStore.mediaStore.resetRoomState(),this.appStore.resetTime(),this.recording=!1,this.resolutionIdx=0,this.totalVolume=0,this.cameraLabel="",this.microphoneLabel="",this.mediaService.reset(),this.resetScreenStream(),this.streamList=[],this.userList=[],this.customScreenShareWindowVisible=!1,this.currentWindowId="",this.customScreenShareItems=[],this.roomChatMessages=[],this.isMuted=void 0,this._cameraEduStream=void 0,this._screenEduStream=void 0,this._microphoneTrack=void 0,this.recordId="",this.joined=!1,this._hasCamera=void 0,this._hasMicrophone=void 0,this.microphoneLock=!1,this.cameraLock=!1,this.recordState=!1}},{key:"showScreenShareWindowWithItems",value:function(){var e=this;this.isElectron&&this.mediaService.prepareScreenShare().then((function(t){Object(Ee.p)((function(){e.customScreenShareWindowVisible=!0,e.customScreenShareItems=t}))})).catch((function(t){console.warn("show screen share window with items",t),"ELECTRON_PERMISSION_DENIED"===t.code?e.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing_permission_denied")):e.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing")+" code: ".concat(t.code,", msg: ").concat(t.msg))}))}},{key:"roomUuid",get:function(){var e;return null===(e=this.roomManager)||void 0===e?void 0:e.roomUuid}},{key:"startNativeScreenShareBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,null===(r=this.roomManager)||void 0===r?void 0:r.userService.startShareScreen();case 4:return i={channel:null===(a=this.roomManager)||void 0===a?void 0:a.roomUuid,uid:+(null===(n=this.roomManager)||void 0===n?void 0:n.userService.screenStream.stream.streamUuid),token:null===(o=this.roomManager)||void 0===o?void 0:o.userService.screenStream.token},e.next=7,this.mediaService.startScreenShare({windowId:t,params:i});case 7:if(this.mediaService.screenRenderer){e.next=12;break}return this.appStore.uiStore.addToast(A("create_screen_share_failed")),e.abrupt("return");case 12:this._screenVideoRenderer=this.mediaService.screenRenderer;case 13:this.removeScreenShareWindow(),this.sharing=!0,e.next=22;break;case 17:e.prev=17,e.t0=e.catch(0),console.warn(e.t0),this.waitingShare=!1,this.appStore.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing")+"".concat(e.t0.msg));case 22:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeScreenShareWindow",value:function(){this.isElectron&&(this.customScreenShareWindowVisible=!1,this.customScreenShareItems=[])}},{key:"cameraList",get:function(){return this.deviceList.filter((function(e){return"videoinput"===e.kind}))}},{key:"microphoneList",get:function(){return this.deviceList.filter((function(e){return"audioinput"===e.kind}))}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};t.video&&this.mediaService.getCameras().then((function(t){Object(Ee.p)((function(){e.deviceList=t}))})),t.audio&&this.mediaService.getMicrophones().then((function(t){Object(Ee.p)((function(){e.deviceList=t}))}))}},{key:"release",value:function(){}},{key:"mediaService",get:function(){return this.appStore.eduManager.mediaService}},{key:"web",get:function(){return this.mediaService.sdkWrapper}},{key:"isWeb",get:function(){return this.mediaService.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.mediaService.sdkWrapper instanceof At}},{key:"lockCamera",value:function(){this.cameraLock=!0,console.log("[demo] lockCamera ")}},{key:"unLockCamera",value:function(){this.cameraLock=!1,console.log("[demo] unlockCamera ")}},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._cameraRenderer){e.next=2;break}return e.abrupt("return",console.warn("[demo] Camera already exists"));case 2:if(!this.cameraLock){e.next=4;break}return e.abrupt("return",console.warn("[demo] openCamera locking"));case 4:return this.lockCamera(),e.prev=5,t=this._cameraId,e.next=9,this.mediaService.openCamera({deviceId:t});case 9:this._cameraRenderer=this.mediaService.cameraRenderer,this.cameraLabel=this.mediaService.getCameraLabel(),this._cameraId=this.cameraId,console.log("[demo] action in openCamera >>> openCamera"),this.unLockCamera(),e.next=22;break;case 16:throw e.prev=16,e.t0=e.catch(5),this.unLockCamera(),console.log("[demo] action in openCamera >>> openCamera"),console.warn(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"muteLocalCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraLock){e.next=2;break}return e.abrupt("return",console.warn("[demo] openCamera locking"));case 2:if(console.log("[demo] [local] muteLocalCamera"),!this._cameraRenderer){e.next=7;break}return e.next=6,this.closeCamera();case 6:this.unLockCamera();case 7:return e.next=9,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({videoState:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteLocalCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] unmuteLocalCamera"),!this.cameraLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] unmuteLocalCamera"));case 3:return e.next=5,this.openCamera();case 5:return e.next=7,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({videoState:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"muteLocalMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] muteLocalMicrophone"),!this.microphoneLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] muteLocalMicrophone"));case 3:return e.next=5,this.closeMicrophone();case 5:return this.unLockMicrophone(),e.next=8,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({audioState:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteLocalMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] unmuteLocalMicrophone"),!this.microphoneLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] unmuteLocalMicrophone"));case 3:return e.next=5,this.openMicrophone();case 5:return e.next=7,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({audioState:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"closeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.closeCamera();case 2:this.resetCameraTrack();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeCamera(t);case 2:this.cameraLabel=this.mediaService.getCameraLabel(),this._cameraId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lockMicrophone",value:function(){this.microphoneLock=!0,console.log("[demo] lockMicrophone ")}},{key:"unLockMicrophone",value:function(){this.microphoneLock=!1,console.log("[demo] unLockMicrophone ")}},{key:"openMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._microphoneTrack){e.next=2;break}return e.abrupt("return",console.warn("[demo] Microphone already exists"));case 2:if(!this.microphoneLock){e.next=4;break}return e.abrupt("return",console.warn("[demo] openMicrophone locking 1"));case 4:return this.lockMicrophone(),e.prev=5,t=this._microphoneId,e.next=9,this.mediaService.openMicrophone({deviceId:t});case 9:this._microphoneTrack=this.mediaService.microphoneTrack,this.microphoneLabel=this.mediaService.getMicrophoneLabel(),console.log("[demo] action in openMicrophone >>> openMicrophone"),this._microphoneId=this.microphoneId,this.unLockMicrophone(),e.next=22;break;case 16:throw e.prev=16,e.t0=e.catch(5),this.unLockMicrophone(),console.log("[demo] action in openMicrophone >>> openMicrophone"),console.warn(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneLock){e.next=2;break}return e.abrupt("return",console.warn("[demo] closeMicrophone microphone is locking"));case 2:return e.next=4,this.mediaService.closeMicrophone();case 4:this.resetMicrophoneTrack();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeMicrophone(t);case 2:this.microphoneLabel=this.mediaService.getMicrophoneLabel(),this._microphoneId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeResolution(t);case 2:Object(Ee.p)((function(){r.resolution=t}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.waitingShare=!0,!this._screenVideoRenderer){e.next=7;break}return e.next=5,this.mediaService.stopScreenShare();case 5:this.mediaService.screenRenderer&&this.mediaService.screenRenderer.stop(),this._screenVideoRenderer=void 0;case 7:if(!this._screenEduStream){e.next=11;break}return e.next=10,null===(t=this.roomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 10:this._screenEduStream=void 0;case 11:this.sharing=!1,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_screen_sharing")+"".concat(e.t0.msg));case 17:return e.prev=17,this.waitingShare=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[0,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"startWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,this.mediaService.prepareScreenShare({shareAudio:"auto",encoderConfig:"720p"});case 4:return e.next=6,null===(t=this.roomManager)||void 0===t?void 0:t.userService.startShareScreen();case 6:return i={channel:null===(r=this.roomManager)||void 0===r?void 0:r.roomUuid,uid:+(null===(a=this.roomManager)||void 0===a?void 0:a.userService.screenStream.stream.streamUuid),token:null===(n=this.roomManager)||void 0===n?void 0:n.userService.screenStream.token},e.next=9,this.mediaService.startScreenShare({params:i});case 9:this._screenEduStream=null===(o=this.roomManager)||void 0===o?void 0:o.userService.screenStream.stream,this._screenVideoRenderer=this.mediaService.screenRenderer,this.sharing=!0,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),this.mediaService.screenRenderer?(this.mediaService.screenRenderer.stop(),this.mediaService.screenRenderer=void 0,this._screenVideoRenderer=void 0,this.appStore.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing_to_remote")+"".concat(e.t0.msg))):"PERMISSION_DENIED"===e.t0.code?this.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing_permission_denied")):this.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing")+" code: ".concat(e.t0.code,", msg: ").concat(e.t0.msg)),console.warn(e.t0);case 18:return e.prev=18,this.waitingShare=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[0,14,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"startOrStopSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=8;break}if(!this.sharing){e.next=6;break}return e.next=4,this.stopWebSharing();case 4:e.next=8;break;case 6:return e.next=8,this.startWebSharing();case 8:if(!this.isElectron){e.next=16;break}if(!this.sharing){e.next=14;break}return e.next=12,this.stopNativeSharing();case 12:e.next=16;break;case 14:return e.next=16,this.showScreenShareWindowWithItems();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.mediaService.prepareScreenShare(t);case 3:e.sent,this.mediaService.screenRenderer&&(this._screenVideoRenderer=this.mediaService.screenRenderer);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopNativeSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.screenEduStream){e.next=4;break}return e.next=3,null===(t=this.roomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 3:this._screenEduStream=void 0;case 4:if(!this._screenVideoRenderer){e.next=9;break}return e.next=7,this.mediaService.stopScreenShare();case 7:this._screenVideoRenderer&&this._screenVideoRenderer.stop(),this._screenVideoRenderer=void 0;case 9:this.customScreenShareWindowVisible&&(this.customScreenShareWindowVisible=!1),this.customScreenShareItems=[],this.sharing=!1;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resetWebPrepareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mediaService.screenRenderer&&(this.mediaService.screenRenderer,this._screenVideoRenderer=void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(r=this.roomManager)||void 0===r?void 0:r.userService.sendRoomChatMessage(t);case 3:this.addChatMessage({id:this.userUuid,ts:+Date.now(),text:t,account:this.roomInfo.userName,sender:!0}),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_send_chat")),console.warn(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleMenu",value:function(){this.menuVisible=!this.menuVisible}},{key:"switchTab",value:function(e){this.activeTab=e}},{key:"roomInfo",get:function(){return this.appStore.roomInfo}},{key:"resetRoomInfo",value:function(){this.appStore.resetRoomInfo()}},{key:"delay",get:function(){return"".concat(this.appStore.mediaStore.delay)}},{key:"roomManager",get:function(){return this._roomManager}},{key:"screenEduStream",get:function(){return this._screenEduStream}},{key:"cameraEduStream",get:function(){return this._cameraEduStream}},{key:"joinRTC",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.mediaService.join(t);case 3:this.joiningRTC=!0,e.next=11;break;case 6:throw e.prev=6,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_join_rtc_please_refresh_and_try_again")),console.warn(e.t0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveRtc",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.joiningRTC=!1,e.next=4,this.closeCamera();case 4:return e.next=6,this.closeMicrophone();case 6:return e.next=8,this.mediaService.leave();case 8:this.appStore.uiStore.addToast(A("toast.leave_rtc_channel")),this.appStore.reset(),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_leave_rtc")),console.warn(e.t0);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"prepareCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hasCamera){e.next=6;break}return e.next=3,this.mediaService.getCameras();case 3:t=e.sent,this._hasCamera=!!t.length,this._hasCamera&&this.mediaService.isWeb&&(this.mediaService.web.publishedVideo=!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hasMicrophone){e.next=6;break}return e.next=3,this.mediaService.getMicrophones();case 3:t=e.sent,this._hasMicrophone=!!t.length,this._hasMicrophone&&this.mediaService.isWeb&&(this.mediaService.web.publishedAudio=!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isBigClassStudent",value:function(){var e=this.roomInfo.userRole;return 2===+this.roomInfo.roomType&&"student"===e}},{key:"eduManager",get:function(){return this.appStore.eduManager}},{key:"promiseLock",value:function(){var e;return function(t){return function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];if(e){var o=e.then((function(){return t.apply(void 0,a)}));return e=o.then((function(){})),o}return e=t.apply(void 0,a)}}}},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s,c,u,l,p,d=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.appStore.uiStore.startLoading(),this.roomApi=new No,e.next=5,this.roomApi.fetchRoom({roomName:"".concat(this.roomInfo.roomName),roomType:+this.roomInfo.roomType});case 5:return t=e.sent,r=t.roomUuid,e.next=9,this.eduManager.login(this.userUuid);case 9:if((a=this.eduManager.createClassroom({roomUuid:r,roomName:this.roomInfo.roomName})).on("seqIdChanged",(function(e){console.log("seqIdChanged",e),d.appStore.uiStore.updateCurSeqId(e.curSeqId),d.appStore.uiStore.updateLastSeqId(e.latestSeqId)})),a.on("local-user-updated",(function(e){d.userList=a.getFullUserList(),console.log("local-user-updated",e)})),a.on("local-stream-removed",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.mutex.dispatch(Object(v.a)(f.a.mark((function e(){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,r=Yt()(),console.log("[demo] tag: ".concat(r,", [").concat(Date.now(),"], handle event: local-stream-removed, "),JSON.stringify(t)),"main"!==t.type){e.next=12;break}return d._cameraEduStream=void 0,e.next=9,d.closeCamera();case 9:return e.next=11,d.closeMicrophone();case 11:console.log("[demo] tag: ".concat(r,", [").concat(Date.now(),"], main stream closed local-stream-removed, "),JSON.stringify(t));case 12:console.log("[demo] local-stream-removed emit done",t),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.error("[demo] local-stream-removed async handler failed"),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("local-stream-updated",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.mutex.dispatch(Object(v.a)(f.a.mark((function e(){var r,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(r=Yt()(),console.log("[demo] tag: ".concat(r,", seq[").concat(t.seqId,"] time: ").concat(Date.now()," local-stream-updated, "),JSON.stringify(t)),"main"!==t.type){e.next=42;break}if(n=a.getLocalStreamData(),console.log("[demo] local-stream-updated tag: ".concat(r,", time: ").concat(Date.now()," local-stream-updated, main stream "),JSON.stringify(n),d.joiningRTC),!n||0===n.state){e.next=40;break}return console.log("[demo] local-stream-updated tag: ".concat(r,", time: ").concat(Date.now()," local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC),d._cameraEduStream=n.stream,e.next=12,d.prepareCamera();case 12:return e.next=14,d.prepareMicrophone();case 14:if(console.log("[demo] tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now()," local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream)),!d.joiningRTC){e.next=38;break}if(!d._hasCamera){e.next=26;break}if(!d.cameraEduStream.hasVideo){e.next=23;break}return e.next=20,d.openCamera();case 20:console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now(),"  after openCamera  local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream)),e.next=26;break;case 23:return e.next=25,d.closeCamera();case 25:console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now(),"  after closeCamera  local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream));case 26:if(!d._hasMicrophone){e.next=38;break}if(!d.cameraEduStream.hasAudio){e.next=34;break}return console.log("open microphone"),e.next=31,d.openMicrophone();case 31:console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now()," after openMicrophone  local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream)),e.next=38;break;case 34:return console.log("close local-stream-updated microphone"),e.next=37,d.closeMicrophone();case 37:console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now(),"  after closeMicrophone  local-stream-updated, main stream is online")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream));case 38:e.next=42;break;case 40:console.log("reset camera edu stream",JSON.stringify(n),n&&n.state),d._cameraEduStream=void 0;case 42:"screen"===t.type&&"teacher"===d.roomInfo.userRole&&(o=a.getLocalScreenData(),console.log("local-stream-updated getLocalScreenData#screenStream ",JSON.stringify(o)),o&&0!==o.state?(d._screenEduStream=o.stream,d.sharing=!0):(console.log("local-stream-updated reset screen edu stream",o,o&&o.state),d._screenEduStream=void 0,d.sharing=!1)),console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now()," local-stream-updated emit done"),t),console.log("[demo] local-stream-updated tag: ".concat(r,", seq[").concat(t.seqId,"], time: ").concat(Date.now()," local-stream-updated emit done")," _hasCamera",d._hasCamera," _hasMicrophone ",d._hasMicrophone,d.joiningRTC," _eduStream",JSON.stringify(d._cameraEduStream));case 45:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("remote-user-added",(function(e){Object(Ee.p)((function(){d.userList=a.getFullUserList()})),console.log("remote-user-added",e)})),a.on("remote-user-updated",(function(e){Object(Ee.p)((function(){d.userList=a.getFullUserList()})),console.log("remote-user-updated",e)})),a.on("remote-user-removed",(function(e){Object(Ee.p)((function(){d.userList=a.getFullUserList()})),console.log("remote-user-removed",e)})),a.on("remote-stream-added",(function(e){Object(Ee.p)((function(){d.streamList=a.getFullStreamList(),"teacher"!==d.roomInfo.userRole&&(d.streamList.find((function(e){return e.videoSourceType===wt.screen}))?d.sharing=!0:d.sharing=!1)})),console.log("remote-stream-added",e)})),a.on("remote-stream-removed",(function(e){Object(Ee.p)((function(){d.streamList=a.getFullStreamList(),"teacher"!==d.roomInfo.userRole&&(d.streamList.find((function(e){return e.videoSourceType===wt.screen}))?d.sharing=!0:d.sharing=!1)})),console.log("remote-stream-removed",e)})),a.on("remote-stream-updated",(function(e){Object(Ee.p)((function(){d.streamList=a.getFullStreamList(),"teacher"!==d.roomInfo.userRole&&(d.streamList.find((function(e){return e.videoSourceType===wt.screen}))?d.sharing=!0:d.sharing=!1)})),console.log("remote-stream-updated",e)})),n=function(e){try{return JSON.parse(e)}catch(t){return console.warn(t),null}},this.eduManager.on("user-message",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.mutex.dispatch(Object(v.a)(f.a.mark((function e(){var r,a,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,console.log("[rtm] user-message",t),r=t.message.fromUser.userUuid,a=t.message.fromUser.userName,o=n(t.message.message),console.log("user-message",o),!o){e.next=48;break}if(o.cmd,i=o.data,s=i.type,i.userName,console.log("data",i),d.showNotice(s,r),s===er.studentApply&&d.showDialog(a,r),s!==er.teacherStop){e.next=27;break}return e.prev=15,e.next=18,d.closeCamera();case 18:return e.next=20,d.closeMicrophone();case 20:d.appStore.uiStore.addToast(A("toast.co_video_close_success")),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(15),d.appStore.uiStore.addToast(A("toast.co_video_close_failed")),console.warn(e.t0);case 27:if(s!==er.teacherAccept||!d.isBigClassStudent()){e.next=48;break}return e.prev=28,e.next=31,d.prepareCamera();case 31:return e.next=33,d.prepareMicrophone();case 33:if(console.log("propertys ",d._hasCamera,d._hasMicrophone),!d._hasCamera){e.next=37;break}return e.next=37,d.openCamera();case 37:if(!d._hasMicrophone){e.next=41;break}return console.log("open microphone"),e.next=41,d.openMicrophone();case 41:e.next=47;break;case 43:throw e.prev=43,e.t1=e.catch(28),console.warn("published failed",e.t1),e.t1;case 47:d.appStore.uiStore.addToast(A("toast.publish_rtc_success"));case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(2),console.error("[demo] user-message async handler failed"),console.error(e.t2);case 54:case"end":return e.stop()}}),e,null,[[2,50],[15,23],[28,43]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("classroom-property-updated",(function(e){console.log("classroom-property-updated",e);var t=Object(E.get)(e,"roomProperties.record");if(t){var r=t.state;1===r?d.recordState=!0:0===r&&d.recordState&&(d.addChatMessage({id:"system",ts:Date.now(),text:"",account:"system",link:d.roomUuid,sender:!1}),d.recordState=!1,d.recordId="")}var a=e.roomStatus.courseState;d.classState!==a&&(d.classState=a,1===d.classState?(d.startTime=Object(E.get)(e,"roomStatus.startTime",0),d.addInterval("timer",(function(){d.appStore.updateTime(+Object(E.get)(e,"roomStatus.startTime",0))}),500)):(d.startTime=Object(E.get)(e,"roomStatus.startTime",0),console.log("end timeer",d.startTime),d.delInterval("timer"))),d.isMuted=!e.roomStatus.isStudentChatAllowed})),a.on("room-chat-message",(function(e){var t=e.textMessage;d.addChatMessage({id:t.fromUser.userUuid,ts:t.timestamp,text:t.message,account:t.fromUser.userName,sender:!1}),console.log("room-chat-message",e)})),"teacher"!==this.roomInfo.userRole){e.next=29;break}return e.next=27,a.join({userRole:"host",roomUuid:r,userName:"".concat(this.roomInfo.userName),userUuid:"".concat(this.userUuid),autoPublish:!0});case 27:e.next=33;break;case 29:return o=2===+this.roomInfo.roomType?Et.SceneLarge:+this.roomInfo.roomType,i=o===Et.SceneLarge?"audience":"broadcaster",e.next=33,a.join({userRole:i,roomUuid:r,userName:"".concat(this.roomInfo.userName),userUuid:"".concat(this.userUuid),autoPublish:!0,sceneType:o});case 33:return this._roomManager=a,this.appStore._boardService=new Ao(a.userToken,a.roomUuid),this.appStore._recordService=new Lo(a.userToken),s=a.getClassroomInfo(),this.startTime=+Object(E.get)(s,"roomStatus.startTime",0),c=a.data.streamMap.main,this.classState=s.roomStatus.courseState,1===this.classState&&this.addInterval("timer",(function(){d.appStore.updateTime(+Object(E.get)(s,"roomStatus.startTime",0))}),500),this.isMuted=!s.roomStatus.isStudentChatAllowed,e.next=44,this.joinRTC({uid:+c.streamUuid,channel:s.roomInfo.roomUuid,token:c.rtcToken});case 44:if(u=a.data.localStreamData,!("teacher"===this.roomInfo.userRole||u&&!!+u.state||"student"===this.roomInfo.userRole&&2!==+this.roomInfo.roomType)){e.next=81;break}return l=a.data.localStreamData,console.log("localStreamData",l),e.next=51,a.userService.publishStream({videoSourceType:wt.camera,audioSourceType:Ot.mic,streamUuid:c.streamUuid,streamName:"",hasVideo:!l||!l.stream||l.stream.hasVideo,hasAudio:!l||!l.stream||l.stream.hasAudio,userInfo:{}});case 51:return this.appStore.uiStore.addToast(A("toast.publish_business_flow_successfully")),this._cameraEduStream=this.roomManager.userService.localStream.stream,e.prev=53,e.next=56,this.prepareCamera();case 56:return e.next=58,this.prepareMicrophone();case 58:if(!this._cameraEduStream){e.next=75;break}if(!this._cameraEduStream.hasVideo){e.next=64;break}return e.next=62,this.openCamera();case 62:e.next=66;break;case 64:return e.next=66,this.closeCamera();case 66:if(!this._cameraEduStream.hasAudio){e.next=72;break}return console.log("open microphone"),e.next=70,this.openMicrophone();case 70:e.next=75;break;case 72:return console.log("close microphone"),e.next=75,this.closeMicrophone();case 75:e.next=81;break;case 77:e.prev=77,e.t0=e.catch(53),this.appStore.uiStore.addToast(A("toast.media_method_call_failed")+": ".concat(e.t0.msg)),console.warn(e.t0);case 81:return e.next=83,this.appStore.boardStore.init();case 83:p=a.getClassroomInfo().roomProperties,this.recordId=p?Object(E.get)(p,"record.recordId",""):"",this.userList=a.getFullUserList(),this.streamList=a.getFullStreamList(),"teacher"!==this.roomInfo.userRole&&(this.streamList.find((function(e){return e.videoSourceType===wt.screen}))?this.sharing=!0:this.sharing=!1),this.appStore.uiStore.stopLoading(),this.joined=!0,e.next=96;break;case 92:throw e.prev=92,e.t1=e.catch(0),this.appStore.uiStore.stopLoading(),e.t1;case 96:case"end":return e.stop()}}),e,this,[[0,92],[53,77]])})));return function(){return e.apply(this,arguments)}}()},{key:"teacherUuid",get:function(){var e=this.userList.find((function(e){return e.role===_t.teacher}));return e?e.userUuid:""}},{key:"localUser",get:function(){return this.roomInfo}},{key:"teacherStream",get:function(){var e=this,t=this.localUser;if(t&&"teacher"===t.userRole&&this.cameraEduStream)return{local:!0,userUuid:this.appStore.userUuid,account:t.userName,streamUuid:this.cameraEduStream.streamUuid,video:this.cameraEduStream.hasVideo,audio:this.cameraEduStream.hasAudio,renderer:this.cameraRenderer,showControls:this.canControl(this.appStore.userUuid)};var r=this.streamList.find((function(t){return"host"===t.userInfo.role&&t.userInfo.userUuid===e.teacherUuid&&t.videoSourceType!==wt.screen}));if(r){var a=this.getUserBy(r.userInfo.userUuid);return{local:!1,account:a.userName,userUuid:a.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:this.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:this.canControl(a.userUuid)}}return{account:"teacher",streamUuid:"",userUuid:"",local:!1,video:!1,audio:!1,renderer:void 0,showControls:!1}}},{key:"getUserBy",value:function(e){return this.userList.find((function(t){return t.userUuid===e}))}},{key:"getStreamBy",value:function(e){return this.streamList.find((function(t){return t.userInfo.userUuid===e}))}},{key:"screenShareStream",get:function(){var e=this;return this.screenEduStream?{local:!0,account:"",userUuid:this.screenEduStream.userInfo.userUuid,streamUuid:this.screenEduStream.streamUuid,video:this.screenEduStream.hasVideo,audio:this.screenEduStream.hasAudio,renderer:this._screenVideoRenderer,showControls:!1}:this.streamList.reduce((function(t,r){var a=e.userList.find((function(e){return"host"===e.role}));return a&&r.userInfo.userUuid===a.userUuid&&r.videoSourceType===wt.screen?(t.push({local:!1,account:"",userUuid:r.userInfo.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:e.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:!1}),t):t}),[])[0]}},{key:"isLocalStream",value:function(e){return this.appStore.userUuid===e.userInfo.userUuid}},{key:"studentStreams",get:function(){var e=this,t=this.streamList.reduce((function(t,r){var a=e.userList.find((function(e){return e.userUuid===r.userInfo.userUuid&&["broadcaster","audience"].includes(e.role)}));return!a||e.isLocalStream(r)||t.push({local:!1,account:a.userName,userUuid:r.userInfo.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:e.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:e.canControl(a.userUuid)}),t}),[]),r=this.localUser,a=["student"].includes(r.userRole);return this.cameraEduStream&&a&&(t=[{local:!0,account:r.userName,userUuid:this.cameraEduStream.userInfo.userUuid,streamUuid:this.cameraEduStream.streamUuid,video:this.cameraEduStream.hasVideo,audio:this.cameraEduStream.hasAudio,renderer:this.cameraRenderer,showControls:this.canControl(this.appStore.userUuid)}].concat(t.filter((function(t){return t.userUuid!==e.appStore.userUuid})))),t}},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.joiningRTC=!0,e.next=4,this.leaveRtc();case 4:return e.next=6,this.appStore.boardStore.leave();case 6:return e.next=8,this.eduManager.logout();case 8:return e.next=10,null===(t=this.roomManager)||void 0===t?void 0:t.leave();case 10:this.appStore.uiStore.addToast(A("toast.successfully_left_the_business_channel")),this.delInterval("timer"),this.reset(),this.resetRoomInfo(),this.appStore.uiStore.updateCurSeqId(0),this.appStore.uiStore.updateLastSeqId(0),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),this.reset(),console.error(e.t0);case 22:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"startClass",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateCourseState(Pt.EduCourseStateStart);case 3:this.appStore.uiStore.addToast(A("toast.course_started_successfully")),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.appStore.uiStore.addToast(A("toast.setting_start_failed"));case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopClass",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateCourseState(Pt.EduCourseStateStop);case 3:this.appStore.uiStore.addToast(A("toast.the_course_ends_successfully")),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.appStore.uiStore.addToast(A("toast.setting_ended_failed"));case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"mutedChat",get:function(){var e;if(void 0!==this.isMuted)return this.isMuted;var t=null===(e=this.roomManager)||void 0===e?void 0:e.getClassroomInfo();return!t||!t.roomStatus||!t.roomStatus.isStudentChatAllowed}},{key:"muteChat",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2===+this.roomInfo.roomType?Et.SceneLarge:+this.roomInfo.roomType,a=["broadcaster"],r===Et.SceneLarge&&a.push("audience"),e.next=5,null===(t=this.roomManager)||void 0===t?void 0:t.userService.muteStudentChatByRoles(a);case 5:this.isMuted=!0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteChat",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2===+this.roomInfo.roomType?Et.SceneLarge:+this.roomInfo.roomType,a=["broadcaster"],r===Et.SceneLarge&&a.push("audience"),e.next=5,null===(t=this.roomManager)||void 0===t?void 0:t.userService.unmuteStudentChatByRoles(a);case 5:this.isMuted=!1;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canControl",value:function(e){return"teacher"===this.roomInfo.userRole||this.userUuid===e}},{key:"addChatMessage",value:function(e){this.roomChatMessages.push(e)}},{key:"muteControl",get:function(){return!!this.roomInfo&&"teacher"===this.roomInfo.userRole}},{key:"userUuid",get:function(){return"".concat(this.appStore.userUuid)}},{key:"closeStream",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("closeStream",t,r),!r){e.next=17;break}if(!this.cameraEduStream){e.next=15;break}return e.next=5,null===(a=this.roomManager)||void 0===a?void 0:a.userService.unpublishStream({streamUuid:this.cameraEduStream.streamUuid});case 5:if(console.log("closeStream ",this.userUuid),this.userUuid!==t){e.next=15;break}return console.log("\u51c6\u5907\u7ed3\u675f\u6444\u50cf\u5934"),this._cameraEduStream=void 0,e.next=11,this.mediaService.unpublish();case 11:return e.next=13,this.mediaService.closeCamera();case 13:return e.next=15,this.mediaService.closeMicrophone();case 15:e.next=25;break;case 17:if(!(null===(n=this.roomManager)||void 0===n?void 0:n.userService)){e.next=25;break}if(o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),!(i=this.userList.find((function(e){return e.userUuid===(null===o||void 0===o?void 0:o.userInfo.userUuid)})))){e.next=25;break}return e.next=23,null===(s=this.roomManager)||void 0===s?void 0:s.userService.teacherCloseStream(i);case 23:return e.next=25,null===(c=this.roomManager)||void 0===c?void 0:c.userService.remoteCloseStudentStream(o);case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return console.log("before muteLocalAudio",this.microphoneLock),e.next=4,this.muteLocalMicrophone();case 4:console.log("after muteLocalAudio",this.microphoneLock),e.next=11;break;case 7:return this.getStreamBy(t),n=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=11,null===(a=this.roomManager)||void 0===a?void 0:a.userService.remoteStopStudentMicrophone(n);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unmuteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("unmuteAudio",t,r),!r){e.next=6;break}return e.next=4,this.unmuteLocalMicrophone();case 4:e.next=13;break;case 6:if(!(n=this.getStreamBy(t))||!this.mediaService.isElectron){e.next=10;break}return e.next=10,this.mediaService.muteRemoteAudio(+n.streamUuid,!1);case 10:return o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=13,null===(a=this.roomManager)||void 0===a?void 0:a.userService.remoteStartStudentMicrophone(o);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("muteVideo",t,r),!r){e.next=8;break}return console.log("before muteLocalCamera",this.cameraLock),e.next=5,this.muteLocalCamera();case 5:console.log("after muteLocalCamera",this.cameraLock),e.next=12;break;case 8:return this.getStreamBy(t),n=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=12,null===(a=this.roomManager)||void 0===a?void 0:a.userService.remoteStopStudentCamera(n);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unmuteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("unmuteVideo",t,r),!r){e.next=8;break}return console.log("before unmuteLocalCamera",this.cameraLock),e.next=5,this.unmuteLocalCamera();case 5:console.log("after unmuteLocalCamera",this.cameraLock),e.next=15;break;case 8:if(!(n=this.getStreamBy(t))||!this.mediaService.isElectron){e.next=12;break}return e.next=12,this.mediaService.muteRemoteVideo(+n.streamUuid,!1);case 12:return o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=15,null===(a=this.roomManager)||void 0===a?void 0:a.userService.remoteStartStudentCamera(o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"isRecording",get:function(){return!!this.recordId}},{key:"startOrStopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.recording=!0,!this.isRecording){e.next=7;break}return e.next=5,this.stopRecording();case 5:e.next=9;break;case 7:return e.next=9,this.startRecording();case 9:this.recording=!1,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.recording=!1;case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.recordService.startRecording(this.roomUuid);case 3:t=e.sent,r=t.recordId,this.recordId=r,this.appStore.uiStore.addToast(A("toast.start_recording_successfully")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.start_recording_failed")+", ".concat(e.t0.msg));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.recordService.stopRecording(this.roomUuid,this.recordId);case 3:this.appStore.uiStore.addToast(A("toast.successfully_ended_recording")),this.recordId="",e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_recording")+", ".concat(e.t0.msg));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"showNotice",value:function(e,t){var r=A("toast.you_have_a_default_message");switch(e){case er.teacherAccept:r=A("toast.the_teacher_agreed");break;case er.studentApply:r=A("toast.student_applied");break;case er.teacherStop:r=A("toast.you_were_dismissed_by_the_teacher");break;case er.studentStop:case er.studentCancel:r=A("toast.student_canceled"),this.removeDialogBy(t);break;case er.teacherReject:r=A("toast.the_teacher_refused")}this.notice={reason:r,userUuid:t},this.appStore.uiStore.addToast(this.notice.reason)}},{key:"callApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r=null===(t=this.roomManager)||void 0===t?void 0:t.getFullUserList().find((function(e){return e.userUuid===n.teacherStream.userUuid})))){e.next=5;break}return e.next=5,null===(a=this.roomManager)||void 0===a?void 0:a.userService.sendCoVideoApply(r);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_initiate_a_raise_of_hand_application")+" ".concat(e.t0.msg));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"callEnded",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.closeStream(this.roomInfo.userUuid,!0);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_the_call")+" ".concat(e.t0.msg));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"showDialog",value:function(e,t){this.appStore.uiStore.dialogs.filter((function(e){return e.dialog.userUuid})).find((function(e){return e.dialog.userUuid===t}))||this.appStore.uiStore.showDialog({type:"apply",userUuid:t,message:"".concat(e)+A("icon.requests_to_connect_the_microphone")})}},{key:"removeDialogBy",value:function(e){var t=this.appStore.uiStore.dialogs.filter((function(e){return e.dialog.userUuid})).find((function(t){return t.dialog.userUuid===e}));t&&this.appStore.uiStore.removeDialog(t.id)}},{key:"teacherRejectApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.notice.userUuid,!(a=null===(t=this.roomManager)||void 0===t?void 0:t.getFullUserList().find((function(e){return e.userUuid===r})))){e.next=5;break}return e.next=5,null===(n=this.roomManager)||void 0===n?void 0:n.userService.rejectCoVideoApply(a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"teacherAcceptApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.notice.userUuid,!(a=null===(t=this.roomManager)||void 0===t?void 0:t.data.userList.find((function(e){return e.user.userUuid===r})))){e.next=7;break}return e.next=5,null===(n=this.roomManager)||void 0===n?void 0:n.userService.acceptCoVideoApply(a.user);case 5:return e.next=7,null===(o=this.roomManager)||void 0===o?void 0:o.userService.inviteStreamBy({roomUuid:this.roomUuid,streamUuid:a.streamUuid,userUuid:a.user.userUuid});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Ro),Ka.resolutions=[{name:"480p",value:"480p_1"},{name:"720p",value:"720p_1"},{name:"1080p",value:"1080p_1"}],ca=Ja,ua=Object(re.a)(ca.prototype,"resolutionIdx",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),la=Object(re.a)(ca.prototype,"deviceList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pa=Object(re.a)(ca.prototype,"cameraLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),da=Object(re.a)(ca.prototype,"microphoneLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ha=Object(re.a)(ca.prototype,"_cameraId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ma=Object(re.a)(ca.prototype,"_microphoneId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(ca.prototype,"cameraId",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"cameraId"),ca.prototype),Object(re.a)(ca.prototype,"microphoneId",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"microphoneId"),ca.prototype),fa=Object(re.a)(ca.prototype,"resolution",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"480p_1"}}),Object(re.a)(ca.prototype,"playbackVolume",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"playbackVolume"),ca.prototype),va=Object(re.a)(ca.prototype,"_playbackVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(ca.prototype,"changePlaybackVolume",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"changePlaybackVolume"),ca.prototype),ba=Object(re.a)(ca.prototype,"_microphoneTrack",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),ga=Object(re.a)(ca.prototype,"_cameraRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),ya=Object(re.a)(ca.prototype,"_screenVideoRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(ca.prototype,"cameraRenderer",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"cameraRenderer"),ca.prototype),ka=Object(re.a)(ca.prototype,"totalVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(ca.prototype,"screenVideoRenderer",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"screenVideoRenderer"),ca.prototype),Sa=Object(re.a)(ca.prototype,"currentWindowId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_a=Object(re.a)(ca.prototype,"customScreenShareWindowVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oa=Object(re.a)(ca.prototype,"customScreenShareItems",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wa=Object(re.a)(ca.prototype,"settingVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ja=Object(re.a)(ca.prototype,"recordState",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"remoteUsersRenderer",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"remoteUsersRenderer"),ca.prototype),xa=Object(re.a)(ca.prototype,"sharing",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"showSetting",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"showSetting"),ca.prototype),Object(re.a)(ca.prototype,"hideSetting",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"hideSetting"),ca.prototype),Object(re.a)(ca.prototype,"resetCameraTrack",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetCameraTrack"),ca.prototype),Object(re.a)(ca.prototype,"resetMicrophoneTrack",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetMicrophoneTrack"),ca.prototype),Object(re.a)(ca.prototype,"resetScreenTrack",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetScreenTrack"),ca.prototype),Object(re.a)(ca.prototype,"resetScreenStream",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetScreenStream"),ca.prototype),Object(re.a)(ca.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"reset"),ca.prototype),Object(re.a)(ca.prototype,"showScreenShareWindowWithItems",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"showScreenShareWindowWithItems"),ca.prototype),Object(re.a)(ca.prototype,"startNativeScreenShareBy",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"startNativeScreenShareBy"),ca.prototype),Object(re.a)(ca.prototype,"removeScreenShareWindow",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"removeScreenShareWindow"),ca.prototype),Object(re.a)(ca.prototype,"cameraList",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"cameraList"),ca.prototype),Object(re.a)(ca.prototype,"microphoneList",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"microphoneList"),ca.prototype),Object(re.a)(ca.prototype,"openCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"openCamera"),ca.prototype),Object(re.a)(ca.prototype,"muteLocalCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"muteLocalCamera"),ca.prototype),Object(re.a)(ca.prototype,"unmuteLocalCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"unmuteLocalCamera"),ca.prototype),Object(re.a)(ca.prototype,"muteLocalMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"muteLocalMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"unmuteLocalMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"unmuteLocalMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"closeCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"closeCamera"),ca.prototype),Object(re.a)(ca.prototype,"changeCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"changeCamera"),ca.prototype),Object(re.a)(ca.prototype,"openMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"openMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"closeMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"closeMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"changeMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"changeMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"changeResolution",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"changeResolution"),ca.prototype),Ta=Object(re.a)(ca.prototype,"waitingShare",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"stopWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"stopWebSharing"),ca.prototype),Object(re.a)(ca.prototype,"startWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"startWebSharing"),ca.prototype),Object(re.a)(ca.prototype,"prepareScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"prepareScreenShare"),ca.prototype),Object(re.a)(ca.prototype,"stopNativeSharing",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"stopNativeSharing"),ca.prototype),Object(re.a)(ca.prototype,"resetWebPrepareScreen",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetWebPrepareScreen"),ca.prototype),Ca=Object(re.a)(ca.prototype,"userList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ea=Object(re.a)(ca.prototype,"streamList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(ca.prototype,"stopScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"stopScreenShare"),ca.prototype),Ua=Object(re.a)(ca.prototype,"unreadMessageCount",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ra=Object(re.a)(ca.prototype,"messages",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(ca.prototype,"sendMessage",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"sendMessage"),ca.prototype),Pa=Object(re.a)(ca.prototype,"joined",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Aa=Object(re.a)(ca.prototype,"menuVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"toggleMenu",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"toggleMenu"),ca.prototype),Ia=Object(re.a)(ca.prototype,"activeTab",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"chatroom"}}),Object(re.a)(ca.prototype,"switchTab",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"switchTab"),ca.prototype),Object(re.a)(ca.prototype,"roomInfo",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"roomInfo"),ca.prototype),Object(re.a)(ca.prototype,"resetRoomInfo",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"resetRoomInfo"),ca.prototype),La=Object(re.a)(ca.prototype,"classState",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Na=Object(re.a)(ca.prototype,"_delay",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(ca.prototype,"delay",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"delay"),ca.prototype),Ma=Object(re.a)(ca.prototype,"time",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Da=Object(re.a)(ca.prototype,"_cameraEduStream",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Va=Object(re.a)(ca.prototype,"_screenEduStream",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(ca.prototype,"screenEduStream",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"screenEduStream"),ca.prototype),Object(re.a)(ca.prototype,"cameraEduStream",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"cameraEduStream"),ca.prototype),Wa=Object(re.a)(ca.prototype,"joiningRTC",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"prepareCamera",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"prepareCamera"),ca.prototype),Object(re.a)(ca.prototype,"prepareMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"prepareMicrophone"),ca.prototype),Object(re.a)(ca.prototype,"join",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"join"),ca.prototype),Object(re.a)(ca.prototype,"teacherStream",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"teacherStream"),ca.prototype),Object(re.a)(ca.prototype,"screenShareStream",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"screenShareStream"),ca.prototype),Object(re.a)(ca.prototype,"studentStreams",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"studentStreams"),ca.prototype),Object(re.a)(ca.prototype,"leave",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"leave"),ca.prototype),Object(re.a)(ca.prototype,"startClass",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"startClass"),ca.prototype),Object(re.a)(ca.prototype,"stopClass",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"stopClass"),ca.prototype),Object(re.a)(ca.prototype,"mutedChat",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"mutedChat"),ca.prototype),Fa=Object(re.a)(ca.prototype,"isMuted",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(ca.prototype,"muteChat",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"muteChat"),ca.prototype),Object(re.a)(ca.prototype,"unmuteChat",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"unmuteChat"),ca.prototype),Ba=Object(re.a)(ca.prototype,"roomChatMessages",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(ca.prototype,"addChatMessage",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"addChatMessage"),ca.prototype),Object(re.a)(ca.prototype,"muteControl",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"muteControl"),ca.prototype),za=Object(re.a)(ca.prototype,"recordId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qa=Object(re.a)(ca.prototype,"recording",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(ca.prototype,"isRecording",[Ee.h],Object.getOwnPropertyDescriptor(ca.prototype,"isRecording"),ca.prototype),Object(re.a)(ca.prototype,"startRecording",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"startRecording"),ca.prototype),Object(re.a)(ca.prototype,"stopRecording",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"stopRecording"),ca.prototype),Ga=Object(re.a)(ca.prototype,"notice",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(ca.prototype,"showNotice",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"showNotice"),ca.prototype),Object(re.a)(ca.prototype,"callApply",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"callApply"),ca.prototype),Object(re.a)(ca.prototype,"callEnded",[Ee.f],Object.getOwnPropertyDescriptor(ca.prototype,"callEnded"),ca.prototype),ca),Vo=(Ya=function(){function e(t){Object(T.a)(this,e),this.appStore=void 0,Object(te.a)(this,"isRecording",Ha,this),Object(te.a)(this,"loading",Qa,this),this.appStore=t}return Object(C.a)(e,[{key:"startOrStopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.loading=!0,e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),e.t0;case 7:return e.prev=7,this.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,this,[[0,4,7,10]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ha=Object(re.a)(Ya.prototype,"isRecording",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qa=Object(re.a)(Ya.prototype,"loading",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(Ya.prototype,"startOrStopRecording",[Ee.f],Object.getOwnPropertyDescriptor(Ya.prototype,"startOrStopRecording"),Ya.prototype),Ya),Wo=(Xa=function(){function e(t){Object(T.a)(this,e),Object(te.a)(this,"roomUuid",Za,this),Object(te.a)(this,"boardUuid",$a,this),Object(te.a)(this,"boardPreparing",en,this),Object(te.a)(this,"statusText",tn,this),Object(te.a)(this,"startTime",rn,this),Object(te.a)(this,"endTime",an,this),this.appStore=void 0,this.boardClient=void 0,this.recordService=void 0,Object(te.a)(this,"ready",nn,this),Object(te.a)(this,"online",on,this),Object(te.a)(this,"player",sn,this),Object(te.a)(this,"currentTime",cn,this),Object(te.a)(this,"playFailed",un,this),Object(te.a)(this,"phase",ln,this),Object(te.a)(this,"firstFrame",pn,this),Object(te.a)(this,"recordStatus",dn,this),Object(te.a)(this,"mediaUrl",hn,this),Object(te.a)(this,"boardId",mn,this),Object(te.a)(this,"boardToken",fn,this),Object(te.a)(this,"progress",vn,this),this.appStore=t,this.boardClient=new na({identity:"host"}),this.recordService=new Lo("")}return Object(C.a)(e,[{key:"duration",get:function(){return Math.abs(this.startTime-this.endTime)}},{key:"setCurrentTime",value:function(e){this.currentTime=e}},{key:"setReplayFail",value:function(e){this.playFailed=e}},{key:"updatePhaseState",value:function(e){this.phase=e}},{key:"loadFirstFrame",value:function(){this.firstFrame=!0,this.player&&this.player.seekToProgressTime(0)}},{key:"replay",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[replay] replayed",t),this.boardClient.on("onCatchErrorWhenRender",(function(e){console.warn("onCatchErrorWhenRender",e)})),this.boardClient.on("onCatchErrorWhenAppendFrame",(function(e){console.warn("onCatchErrorWhenAppendFrame",e)})),this.boardClient.on("onPhaseChanged",(function(e){r.updatePhaseState(e)})),this.boardClient.on("onLoadFirstFrame",(function(e){r.loadFirstFrame(),console.log("onLoadFirstFrame",e)})),this.boardClient.on("onSliceChanged",(function(){console.log("onSliceChanged")})),this.boardClient.on("onPlayerStateChanged",(function(e){console.log("onPlayerStateChanged",e)})),this.boardClient.on("onStoppedWithError",(function(e){r.appStore.uiStore.addToast(A("toast.replay_failed")),r.setReplayFail(!0),console.warn("onStoppedWithError",JSON.stringify(e))})),this.boardClient.on("onProgressTimeChanged",(function(e){r.setCurrentTime(e)})),e.prev=9,e.next=12,this.boardClient.replay({beginTimestamp:this.startTime,duration:this.duration,room:this.boardId,mediaURL:"".concat("https://agora-adc-artifacts.oss-accelerate.aliyuncs.com","/").concat(this.mediaUrl),roomToken:this.boardToken});case 12:this.player=this.boardClient.player,this.player.seekToProgressTime(0),e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(9),this.appStore.uiStore.addToast(A("toast.replay_failed")),e.t0;case 20:this.player.bindHtmlElement(t),this.online=!0,window.addEventListener("keydown",(function(e){if("Space"===e.code){var t=r.player;if(r.online&&t)switch(t.phase){case yr.PlayerPhase.WaitingFirstFrame:case yr.PlayerPhase.Pause:t.play();break;case yr.PlayerPhase.Playing:t.pause();break;case yr.PlayerPhase.Ended:t.seekToProgressTime(0)}}})),window.addEventListener("resize",(function(){r.online&&r.player&&r.player.refreshViewSize()}));case 24:case"end":return e.stop()}}),e,this,[[9,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"totalTime",get:function(){return Math.abs(this.startTime-this.endTime)}},{key:"pauseCurrentTime",value:function(){this.online&&this.player&&this.player.pause()}},{key:"seekToCurrentTime",value:function(){var e=this.player;this.online&&e&&(e.seekToProgressTime(this.currentTime),e.play())}},{key:"updateProgress",value:function(e){this.progress=e,this.currentTime=e}},{key:"handlePlayerClick",value:function(){var e=this.player;if(this.online&&e){if(e.phase===yr.PlayerPhase.Playing)return void e.pause();if(e.phase===yr.PlayerPhase.WaitingFirstFrame||e.phase===yr.PlayerPhase.Pause)return void e.play();if(e.phase===yr.PlayerPhase.Ended)return e.seekToProgressTime(0),void e.play()}}},{key:"getCourseRecordBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==this.recordStatus||!this.mediaUrl){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.recordService.getCourseRecordBy(t);case 5:r=e.sent,(a=r.list).sort((function(e,t){return e.startTime-t.startTime})),n=a.slice(-1)[0],(o=n)&&(this.recordStatus=o.status,this.boardId=o.boardId,this.boardToken=o.boardToken,this.statusText=o.statusText,this.startTime=o.startTime,this.endTime=o.endTime,this.mediaUrl=o.url,this.currentTime=0,console.log("record",o)),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),this.appStore.uiStore.addToast(A("toast.failed_to_query_playback_list")+"".concat(e.t0.msg)),e.t0;case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reset",value:function(){this.roomUuid="",this.boardUuid="",this.boardPreparing=!1,this.recordStatus=0,this.startTime=0,this.endTime=0,this.mediaUrl="",this.boardId="",this.boardToken="",this.statusText="",this.currentTime=0,this.player=void 0,window.removeEventListener("resize",(function(){})),window.removeEventListener("keydown",(function(){}))}}]),e}(),Za=Object(re.a)(Xa.prototype,"roomUuid",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$a=Object(re.a)(Xa.prototype,"boardUuid",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),en=Object(re.a)(Xa.prototype,"boardPreparing",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tn=Object(re.a)(Xa.prototype,"statusText",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rn=Object(re.a)(Xa.prototype,"startTime",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),an=Object(re.a)(Xa.prototype,"endTime",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nn=Object(re.a)(Xa.prototype,"ready",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),on=Object(re.a)(Xa.prototype,"online",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(Xa.prototype,"duration",[Ee.h],Object.getOwnPropertyDescriptor(Xa.prototype,"duration"),Xa.prototype),sn=Object(re.a)(Xa.prototype,"player",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),cn=Object(re.a)(Xa.prototype,"currentTime",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(Xa.prototype,"setCurrentTime",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"setCurrentTime"),Xa.prototype),un=Object(re.a)(Xa.prototype,"playFailed",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(Xa.prototype,"setReplayFail",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"setReplayFail"),Xa.prototype),ln=Object(re.a)(Xa.prototype,"phase",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(Xa.prototype,"updatePhaseState",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"updatePhaseState"),Xa.prototype),pn=Object(re.a)(Xa.prototype,"firstFrame",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(Xa.prototype,"loadFirstFrame",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"loadFirstFrame"),Xa.prototype),Object(re.a)(Xa.prototype,"replay",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"replay"),Xa.prototype),dn=Object(re.a)(Xa.prototype,"recordStatus",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hn=Object(re.a)(Xa.prototype,"mediaUrl",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mn=Object(re.a)(Xa.prototype,"boardId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fn=Object(re.a)(Xa.prototype,"boardToken",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(Xa.prototype,"totalTime",[Ee.h],Object.getOwnPropertyDescriptor(Xa.prototype,"totalTime"),Xa.prototype),vn=Object(re.a)(Xa.prototype,"progress",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(Xa.prototype,"updateProgress",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"updateProgress"),Xa.prototype),Object(re.a)(Xa.prototype,"getCourseRecordBy",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"getCourseRecordBy"),Xa.prototype),Object(re.a)(Xa.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(Xa.prototype,"reset"),Xa.prototype),Xa),Fo=(co=so=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),a=t.call(this),Object(te.a)(a,"resolutionIdx",gn,Object(Kt.a)(a)),Object(te.a)(a,"deviceList",yn,Object(Kt.a)(a)),Object(te.a)(a,"cameraLabel",kn,Object(Kt.a)(a)),Object(te.a)(a,"microphoneLabel",Sn,Object(Kt.a)(a)),a._totalVolume=void 0,Object(te.a)(a,"_cameraId",_n,Object(Kt.a)(a)),Object(te.a)(a,"_microphoneId",On,Object(Kt.a)(a)),a._boardService=void 0,a._recordService=void 0,Object(te.a)(a,"resolution",wn,Object(Kt.a)(a)),Object(te.a)(a,"_playbackVolume",jn,Object(Kt.a)(a)),Object(te.a)(a,"_microphoneTrack",xn,Object(Kt.a)(a)),Object(te.a)(a,"_cameraRenderer",Tn,Object(Kt.a)(a)),Object(te.a)(a,"_screenVideoRenderer",Cn,Object(Kt.a)(a)),Object(te.a)(a,"totalVolume",En,Object(Kt.a)(a)),a.appStore=void 0,Object(te.a)(a,"currentWindowId",Un,Object(Kt.a)(a)),Object(te.a)(a,"customScreenShareWindowVisible",Rn,Object(Kt.a)(a)),Object(te.a)(a,"customScreenShareItems",Pn,Object(Kt.a)(a)),Object(te.a)(a,"settingVisible",An,Object(Kt.a)(a)),Object(te.a)(a,"recordState",In,Object(Kt.a)(a)),Object(te.a)(a,"sharing",Ln,Object(Kt.a)(a)),Object(te.a)(a,"_courseList",Nn,Object(Kt.a)(a)),a._hasCamera=void 0,a._hasMicrophone=void 0,a.cameraLock=!1,a.microphoneLock=!1,Object(te.a)(a,"waitingShare",Mn,Object(Kt.a)(a)),Object(te.a)(a,"teacherRoomUserList",Dn,Object(Kt.a)(a)),Object(te.a)(a,"teacherRoomStreamList",Vn,Object(Kt.a)(a)),Object(te.a)(a,"unreadMessageCount",Wn,Object(Kt.a)(a)),Object(te.a)(a,"messages",Fn,Object(Kt.a)(a)),Object(te.a)(a,"joined",Bn,Object(Kt.a)(a)),Object(te.a)(a,"menuVisible",zn,Object(Kt.a)(a)),Object(te.a)(a,"activeTab",qn,Object(Kt.a)(a)),Object(te.a)(a,"classState",Gn,Object(Kt.a)(a)),Object(te.a)(a,"time",Kn,Object(Kt.a)(a)),Object(te.a)(a,"_cpuRate",Jn,Object(Kt.a)(a)),Object(te.a)(a,"_cameraEduStream",Yn,Object(Kt.a)(a)),Object(te.a)(a,"_screenEduStream",Hn,Object(Kt.a)(a)),a.roomApi=void 0,Object(te.a)(a,"joiningRTC",Qn,Object(Kt.a)(a)),a.mutex=new Uo,Object(te.a)(a,"studentRoomUserList",Xn,Object(Kt.a)(a)),Object(te.a)(a,"studentRoomStreamList",Zn,Object(Kt.a)(a)),a.startTime=0,Object(te.a)(a,"joinedGroup",$n,Object(Kt.a)(a)),Object(te.a)(a,"isMuted",eo,Object(Kt.a)(a)),a._unreadMessageCount=0,Object(te.a)(a,"_roomChatMessages",to,Object(Kt.a)(a)),Object(te.a)(a,"currentStudentRoomUuid",ro,Object(Kt.a)(a)),Object(te.a)(a,"mediaGroup",ao,Object(Kt.a)(a)),Object(te.a)(a,"recordId",no,Object(Kt.a)(a)),Object(te.a)(a,"recording",oo,Object(Kt.a)(a)),Object(te.a)(a,"notice",io,Object(Kt.a)(a)),a.appStore=e,a.handlePopState=a.handlePopState.bind(Object(Kt.a)(a)),a}return Object(C.a)(r,[{key:"cameraId",get:function(){var e=this,t=this.cameraList.findIndex((function(t){return t.label===e.cameraLabel}));return this.cameraList[t]?this.cameraList[t].deviceId:""}},{key:"microphoneId",get:function(){var e=this,t=this.microphoneList.findIndex((function(t){return t.label===e.microphoneLabel}));return this.microphoneList[t]?this.microphoneList[t].deviceId:""}},{key:"playbackVolume",get:function(){return this._playbackVolume?this._playbackVolume:this.mediaService.getPlaybackVolume()}},{key:"changePlaybackVolume",value:function(e){this.mediaService.changePlaybackVolume(e),this._playbackVolume=e}},{key:"cameraRenderer",get:function(){return this._cameraRenderer}},{key:"screenVideoRenderer",get:function(){return this._screenVideoRenderer}},{key:"remoteUsersRenderer",get:function(){return this.appStore.mediaStore.remoteUsersRenderer}},{key:"boardService",get:function(){return this.appStore.boardService}},{key:"recordService",get:function(){return this.appStore.recordService}},{key:"showSetting",value:function(){this.settingVisible=!0}},{key:"hideSetting",value:function(){this.settingVisible=!1}},{key:"resetCameraTrack",value:function(){this._cameraRenderer=void 0}},{key:"resetMicrophoneTrack",value:function(){this._microphoneTrack=void 0}},{key:"resetScreenTrack",value:function(){this._screenVideoRenderer=void 0}},{key:"resetScreenStream",value:function(){this.screenVideoRenderer&&(this.screenVideoRenderer.stop(),this._screenVideoRenderer=void 0),this.screenEduStream&&(this._screenEduStream=void 0)}},{key:"reset",value:function(){this.studentRoomUserList=[],this.teacherRoomUserList=[],this.studentRoomStreamList=[],this.teacherRoomStreamList=[],this.appStore.mediaStore.resetRoomState(),this.currentStudentRoomUuid="",this.delInterval("timer"),this.appStore.mediaStore.resetRoomState(),this.recording=!1,this.resolutionIdx=0,this.totalVolume=0,this.cameraLabel="",this.microphoneLabel="",this.mediaService.reset(),this.closeCamera(),this.closeMicrophone(),this.resetScreenStream(),this.customScreenShareWindowVisible=!1,this.currentWindowId="",this.customScreenShareItems=[],this._roomChatMessages=[],this.isMuted=void 0,this._cameraEduStream=void 0,this._screenEduStream=void 0,this._microphoneTrack=void 0,this.recordId="",this.joined=!1,this._hasCamera=void 0,this._hasMicrophone=void 0,this.microphoneLock=!1,this.cameraLock=!1,this.joiningRTC=!1,this.recordState=!1,this._courseList=[],this.joinedGroup=!1}},{key:"courseList",get:function(){return this._courseList}},{key:"showScreenShareWindowWithItems",value:function(){var e=this;this.isElectron&&this.mediaService.prepareScreenShare().then((function(t){Object(Ee.p)((function(){e.customScreenShareWindowVisible=!0,e.customScreenShareItems=t}))})).catch((function(t){console.warn("show screen share window with items",t),"ELECTRON_PERMISSION_DENIED"===t.code?e.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing_permission_denied")):e.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing")+" code: ".concat(t.code,", msg: ").concat(t.msg))}))}},{key:"roomUuid",get:function(){var e;return null===(e=this.largeClassroomManager)||void 0===e?void 0:e.roomUuid}},{key:"startNativeScreenShareBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,null===(r=this.largeClassroomManager)||void 0===r?void 0:r.userService.startShareScreen();case 4:return i={channel:null===(a=this.largeClassroomManager)||void 0===a?void 0:a.roomUuid,uid:+(null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.screenStream.stream.streamUuid),token:null===(o=this.largeClassroomManager)||void 0===o?void 0:o.userService.screenStream.token},e.next=7,this.mediaService.startScreenShare({windowId:t,params:i});case 7:if(this.mediaService.screenRenderer){e.next=12;break}return this.appStore.uiStore.addToast(A("create_screen_share_failed")),e.abrupt("return");case 12:this._screenVideoRenderer=this.mediaService.screenRenderer;case 13:this.removeScreenShareWindow(),this.sharing=!0,e.next=22;break;case 17:e.prev=17,e.t0=e.catch(0),console.warn(e.t0),this.waitingShare=!1,this.appStore.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing")+"".concat(e.t0.msg));case 22:case"end":return e.stop()}}),e,this,[[0,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeScreenShareWindow",value:function(){this.isElectron&&(this.customScreenShareWindowVisible=!1,this.customScreenShareItems=[])}},{key:"cameraList",get:function(){return this.deviceList.filter((function(e){return"videoinput"===e.kind}))}},{key:"microphoneList",get:function(){return this.deviceList.filter((function(e){return"audioinput"===e.kind}))}},{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0,audio:!0};t.video&&this.mediaService.getCameras().then((function(t){Object(Ee.p)((function(){e.deviceList=t}))})),t.audio&&this.mediaService.getMicrophones().then((function(t){Object(Ee.p)((function(){e.deviceList=t}))}))}},{key:"mediaService",get:function(){return this.appStore.eduManager.mediaService}},{key:"web",get:function(){return this.mediaService.sdkWrapper}},{key:"isWeb",get:function(){return this.mediaService.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.mediaService.sdkWrapper instanceof At}},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._cameraRenderer){e.next=2;break}return e.abrupt("return",console.warn("[demo] Camera already exists"));case 2:if(!this.cameraLock){e.next=4;break}return e.abrupt("return",console.warn("[demo] openCamera locking"));case 4:return this.lockCamera(),e.prev=5,t=this._cameraId,e.next=9,this.mediaService.openCamera({deviceId:t});case 9:this._cameraRenderer=this.mediaService.cameraRenderer,this.cameraLabel=this.mediaService.getCameraLabel(),this._cameraId=this.cameraId,console.log("[demo] action in openCamera >>> openCamera"),this.unLockCamera(),e.next=22;break;case 16:throw e.prev=16,e.t0=e.catch(5),this.unLockCamera(),console.log("[demo] action in openCamera >>> openCamera"),console.warn(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.mediaService)||void 0===t?void 0:t.closeCamera();case 3:this.resetCameraTrack(),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),this.resetCameraTrack(),console.log("[breakout-room] err",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeCamera(t);case 2:this.cameraLabel=this.mediaService.getCameraLabel(),this._cameraId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lockCamera",value:function(){this.cameraLock=!0,console.log("[demo] lockCamera ")}},{key:"unLockCamera",value:function(){this.cameraLock=!1,console.log("[demo] unlockCamera ")}},{key:"muteLocalCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cameraLock){e.next=2;break}return e.abrupt("return",console.warn("[demo] openCamera locking"));case 2:if(console.log("[demo] [local] muteLocalCamera"),!this._cameraRenderer){e.next=7;break}return e.next=6,this.closeCamera();case 6:this.unLockCamera();case 7:return e.next=9,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({videoState:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteLocalCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] unmuteLocalCamera"),!this.cameraLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] unmuteLocalCamera"));case 3:return e.next=5,this.openCamera();case 5:return e.next=7,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({videoState:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"muteLocalMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] muteLocalMicrophone"),!this.microphoneLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] muteLocalMicrophone"));case 3:return e.next=5,this.closeMicrophone();case 5:return this.unLockMicrophone(),e.next=8,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({audioState:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteLocalMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("[demo] [local] unmuteLocalMicrophone"),!this.microphoneLock){e.next=3;break}return e.abrupt("return",console.warn("[demo] [mic lock] unmuteLocalMicrophone"));case 3:return e.next=5,this.openMicrophone();case 5:return e.next=7,null===(t=this.roomManager)||void 0===t?void 0:t.userService.updateMainStreamState({audioState:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"lockMicrophone",value:function(){this.microphoneLock=!0,console.log("[demo] lockMicrophone ")}},{key:"unLockMicrophone",value:function(){this.microphoneLock=!1,console.log("[demo] unLockMicrophone ")}},{key:"openMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._microphoneTrack){e.next=2;break}return e.abrupt("return",console.warn("[demo] Microphone already exists"));case 2:if(!this.microphoneLock){e.next=4;break}return e.abrupt("return",console.warn("[demo] openMicrophone locking 1"));case 4:return this.lockMicrophone(),e.prev=5,t=this._microphoneId,e.next=9,this.mediaService.openMicrophone({deviceId:t});case 9:this._microphoneTrack=this.mediaService.microphoneTrack,this.microphoneLabel=this.mediaService.getMicrophoneLabel(),console.log("[breakout-demo] action in openMicrophone >>> openMicrophone"),this._microphoneId=this.microphoneId,this.unLockMicrophone(),e.next=22;break;case 16:throw e.prev=16,e.t0=e.catch(5),this.unLockMicrophone(),console.log("[demo] action in openMicrophone >>> openMicrophone"),console.warn(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.microphoneLock){e.next=2;break}return e.abrupt("return",console.warn("[demo] closeMicrophone microphone is locking"));case 2:return e.next=4,this.mediaService.closeMicrophone();case 4:this.resetMicrophoneTrack();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeMicrophone(t);case 2:this.microphoneLabel=this.mediaService.getMicrophoneLabel(),this._microphoneId=t;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeResolution",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mediaService.changeResolution(t);case 2:Object(Ee.p)((function(){r.resolution=t}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.waitingShare=!0,!this._screenVideoRenderer){e.next=7;break}return e.next=5,this.mediaService.stopScreenShare();case 5:this.mediaService.screenRenderer&&this.mediaService.screenRenderer.stop(),this._screenVideoRenderer=void 0;case 7:if(!this._screenEduStream){e.next=11;break}return e.next=10,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 10:this._screenEduStream=void 0;case 11:this.sharing=!1,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_screen_sharing")+"".concat(e.t0.msg));case 17:return e.prev=17,this.waitingShare=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[0,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"startWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,this.mediaService.prepareScreenShare({shareAudio:"auto",encoderConfig:"720p"});case 4:return e.next=6,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.startShareScreen();case 6:return s={channel:null===(r=this.largeClassroomManager)||void 0===r?void 0:r.roomUuid,uid:+(null===(a=this.largeClassroomManager)||void 0===a?void 0:a.userService.screenStream.stream.streamUuid),token:null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.screenStream.token},console.log("screenStreamData params >>>>>> ",s),console.log("screenStreamData >>>>>> ",null===(o=this.largeClassroomManager)||void 0===o?void 0:o.userService.screenStream),e.next=11,this.mediaService.startScreenShare({params:s});case 11:this._screenEduStream=null===(i=this.largeClassroomManager)||void 0===i?void 0:i.userService.screenStream.stream,this._screenVideoRenderer=this.mediaService.screenRenderer,this.sharing=!0,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),this.mediaService.screenRenderer?(this.mediaService.screenRenderer.stop(),this.mediaService.screenRenderer=void 0,this._screenVideoRenderer=void 0,this.appStore.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing_to_remote")+"".concat(e.t0.msg))):"PERMISSION_DENIED"===e.t0.code?this.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing_permission_denied")):this.appStore.uiStore.addToast(A("toast.failed_to_enable_screen_sharing")+" code: ".concat(e.t0.code,", msg: ").concat(e.t0.msg)),console.warn(e.t0);case 20:return e.prev=20,this.waitingShare=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[0,16,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"startOrStopSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=8;break}if(!this.sharing){e.next=6;break}return e.next=4,this.stopWebSharing();case 4:e.next=8;break;case 6:return e.next=8,this.startWebSharing();case 8:if(!this.isElectron){e.next=16;break}if(!this.sharing){e.next=14;break}return e.next=12,this.stopNativeSharing();case 12:e.next=16;break;case 14:return e.next=16,this.showScreenShareWindowWithItems();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.mediaService.prepareScreenShare(t);case 3:e.sent,this.mediaService.screenRenderer&&(this._screenVideoRenderer=this.mediaService.screenRenderer);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopNativeSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.screenEduStream){e.next=4;break}return e.next=3,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 3:this._screenEduStream=void 0;case 4:if(!this._screenVideoRenderer){e.next=9;break}return e.next=7,this.mediaService.stopScreenShare();case 7:this._screenVideoRenderer&&this._screenVideoRenderer.stop(),this._screenVideoRenderer=void 0;case 9:this.customScreenShareWindowVisible&&(this.customScreenShareWindowVisible=!1),this.customScreenShareItems=[],this.sharing=!1;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resetWebPrepareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mediaService.screenRenderer&&(this.mediaService.screenRenderer,this._screenVideoRenderer=void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"userList",get:function(){return this.teacherRoomUserList.concat(this.studentRoomUserList)}},{key:"streamList",get:function(){return this.teacherRoomStreamList.concat(this.studentRoomStreamList)}},{key:"stopScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessageToCurrentRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s,c,u,l,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("teacher"!==this.roomInfo.userRole){e.next=14;break}return e.prev=1,n=this.currentStudentRoomUuid||"",o=JSON.stringify({content:t,role:St.teacher,fromRoomName:(null===(r=this.groupClassroomManager)||void 0===r?void 0:r.roomName)||"",fromRoomUuid:n}),e.next=6,null===(a=this.largeClassroomManager)||void 0===a?void 0:a.userService.sendRoomChatMessage(o);case 6:this.addChatMessage({id:this.userUuid,ts:+Date.now(),text:t,account:this.roomInfo.userName,sender:!0,role:St.teacher,fromRoomName:"",fromRoomUuid:n}),console.log("[chat-message] teacher sent",n," isMain ",n?"true":"false"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),this.appStore.uiStore.addToast(A("toast.failed_to_send_chat")),console.warn(e.t0);case 14:if("assistant"!==this.roomInfo.userRole){e.next=30;break}return e.prev=15,l=this.currentStudentRoomUuid,p=JSON.stringify({content:t,role:St.assistant,fromRoomUuid:l,fromRoomName:(null===(i=this.groupClassroomManager)||void 0===i?void 0:i.roomName)||""}),e.next=20,null===(s=this.largeClassroomManager)||void 0===s?void 0:s.userService.sendRoomChatMessage(p);case 20:return e.next=22,null===(c=this.groupClassroomManager)||void 0===c?void 0:c.userService.sendRoomChatMessage(p);case 22:this.addChatMessage({id:this.userUuid,ts:+Date.now(),text:t,account:this.roomInfo.userName,sender:!0,role:St.assistant,fromRoomName:(null===(u=this.groupClassroomManager)||void 0===u?void 0:u.roomName)||"",fromRoomUuid:l}),console.log("[chat-message] assistant sent",l),e.next=30;break;case 26:e.prev=26,e.t1=e.catch(15),this.appStore.uiStore.addToast(A("toast.failed_to_send_chat")),console.warn(e.t1);case 30:case"end":return e.stop()}}),e,this,[[1,10],[15,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.groupClassroomManager.roomUuid,n=JSON.stringify({content:t,role:St.student,fromRoomUuid:this.groupClassroomManager.roomUuid,fromRoomName:(null===(r=this.groupClassroomManager)||void 0===r?void 0:r.roomName)||""}),"student"!==this.roomInfo.userRole){e.next=16;break}return e.prev=3,e.next=6,null===(o=this.largeClassroomManager)||void 0===o?void 0:o.userService.sendRoomChatMessage(n);case 6:return e.next=8,null===(i=this.groupClassroomManager)||void 0===i?void 0:i.userService.sendRoomChatMessage(n);case 8:this.addChatMessage({id:this.userUuid,ts:+Date.now(),text:t,account:this.roomInfo.userName,sender:!0,role:St.student,fromRoomName:(null===(s=this.groupClassroomManager)||void 0===s?void 0:s.roomName)||"",fromRoomUuid:a}),console.log("[chat-message] student sent",a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),this.appStore.uiStore.addToast(A("toast.failed_to_send_chat")),console.warn(e.t0);case 16:case"end":return e.stop()}}),e,this,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleMenu",value:function(){this.menuVisible=!this.menuVisible}},{key:"resetTab",value:function(){this.currentStudentRoomUuid="",this.switchTab("first")}},{key:"switchTab",value:function(e){this.activeTab=e}},{key:"switchTabToRoom",value:function(e){this.switchTab("second"),this.currentStudentRoomUuid=e}},{key:"roomInfo",get:function(){return this.appStore.roomInfo}},{key:"resetRoomInfo",value:function(){this.appStore.resetRoomInfo()}},{key:"userUuid",get:function(){return"".concat(this.appStore.userUuid)}},{key:"delay",get:function(){return"".concat(this.appStore.mediaStore._delay)}},{key:"networkQuality",get:function(){return this.appStore.mediaStore.networkQuality}},{key:"cpuRate",get:function(){return"".concat(this._cpuRate,"%")}},{key:"roomManager",get:function(){return"teacher"===this.roomInfo.userRole?this.largeClassroomManager:"student"===this.roomInfo.userRole?this.groupClassroomManager:void 0}},{key:"largeClassroomManager",get:function(){return this.appStore.roomManager}},{key:"groupClassroomManager",get:function(){return this.appStore.groupClassroomManager}},{key:"screenEduStream",get:function(){return this._screenEduStream}},{key:"cameraEduStream",get:function(){return this._cameraEduStream}},{key:"handlePopState",value:function(e){window.history.pushState(null,document.title,null);var t=this.appStore.uiStore,r=e.currentTarget.location.hash,a=r.match(/\/assistant\/courses\/\S+/);console.log("[popstate] isClass",a,r),a?this.joinedGroup&&!t.hasDialog("exitRoom")&&t.showDialog({type:"exitRoom",message:A("icon.exit-room")}):this.joined&&!t.hasDialog("exitRoom")&&t.showDialog({type:"exitRoom",message:A("icon.exit-room")})}},{key:"joinRtcAsTeacher",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.mediaService.isWeb){e.next=3;break}throw"electron not support";case 3:return e.next=5,this.mediaService.join(t);case 5:this.joiningRTC=!0,e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_join_rtc_please_refresh_and_try_again")),console.warn(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"joinRtcAsStudent",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("[breakout] ",t),this.mediaService.isWeb){e.next=4;break}throw"electron not supported";case 4:return e.next=6,this.mediaService.join(t.studentChannel);case 6:return e.next=8,this.mediaService.web.joinChannel(t.teacherChannel);case 8:this.mediaGroup=e.sent,this.joiningRTC=!0,e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_join_rtc_please_refresh_and_try_again")),console.warn(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"joinRtcAsAssistant",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.mediaService.isWeb){e.next=3;break}throw"electron not supported";case 3:return e.next=5,this.mediaService.join(t.studentChannel);case 5:return e.next=7,this.mediaService.web.joinChannel(t.teacherChannel);case 7:this.mediaGroup=e.sent,this.joiningRTC=!0,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_join_rtc_please_refresh_and_try_again")),console.warn(e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"leaveRtc",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.joiningRTC){e.next=3;break}return e.abrupt("return");case 3:if(this.joiningRTC=!1,!this.mediaGroup){e.next=10;break}return e.next=7,null===(t=this.mediaGroup)||void 0===t?void 0:t.leave();case 7:this.mediaGroup.removeAllListeners(),this.mediaGroup=null,console.log("[rtc] mediaGroup success");case 10:if(!this.mediaService){e.next=18;break}return e.next=13,this.closeCamera();case 13:return e.next=15,this.closeMicrophone();case 15:return e.next=17,this.mediaService.leave();case 17:this.appStore.uiStore.addToast(A("toast.leave_rtc_channel"));case 18:this.appStore.reset(),e.next=26;break;case 21:throw e.prev=21,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_leave_rtc")),console.warn(e.t0),e.t0;case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"prepareCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hasCamera){e.next=6;break}return e.next=3,this.mediaService.getCameras();case 3:t=e.sent,this._hasCamera=!!t.length,this._hasCamera&&this.mediaService.isWeb&&(this.mediaService.web.publishedVideo=!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareMicrophone",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hasMicrophone){e.next=6;break}return e.next=3,this.mediaService.getMicrophones();case 3:t=e.sent,this._hasMicrophone=!!t.length,this._hasMicrophone&&this.mediaService.isWeb&&(this.mediaService.web.publishedAudio=!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isBigClassStudent",value:function(){var e=this.roomInfo.userRole;return 2===+this.roomInfo.roomType&&"student"===e}},{key:"eduManager",get:function(){return this.appStore.eduManager}},{key:"handlePeerMessage",value:function(){var e=this,t=function(e){try{return JSON.parse(e)}catch(t){return console.warn(t),null}};this.eduManager.on("user-message",function(){var r=Object(v.a)(f.a.mark((function r(a){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.mutex.dispatch(Object(v.a)(f.a.mark((function r(){var n,o,i,s,c;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.joiningRTC){r.next=2;break}return r.abrupt("return");case 2:if(r.prev=2,console.log("[rtm] user-message",a),n=a.message.fromUser.userUuid,o=a.message.fromUser.userName,i=t(a.message.message),console.log("user-message",i),!i){r.next=47;break}if(i.cmd,s=i.data,c=s.type,s.userName,console.log("data",s),e.showNotice(c,n),c===er.studentApply&&e.showDialog(o),c!==er.teacherStop){r.next=27;break}return r.prev=15,r.next=18,e.closeCamera();case 18:return r.next=20,e.closeMicrophone();case 20:e.appStore.uiStore.addToast(A("toast.co_video_close_success")),r.next=27;break;case 23:r.prev=23,r.t0=r.catch(15),e.appStore.uiStore.addToast(A("toast.co_video_close_failed")),console.warn(r.t0);case 27:if(c!==er.teacherAccept||!e.isBigClassStudent()){r.next=47;break}return r.prev=28,r.next=31,e.prepareCamera();case 31:return r.next=33,e.prepareMicrophone();case 33:if(console.log("propertys ",e._hasCamera,e._hasMicrophone),!e._hasCamera){r.next=37;break}return r.next=37,e.openCamera();case 37:if(!e._hasMicrophone){r.next=40;break}return r.next=40,e.openMicrophone();case 40:r.next=46;break;case 42:throw r.prev=42,r.t1=r.catch(28),console.warn("published failed",r.t1),r.t1;case 46:e.appStore.uiStore.addToast(A("toast.publish_rtc_success"));case 47:r.next=53;break;case 49:r.prev=49,r.t2=r.catch(2),console.error("[demo] [breakout] user-message async handler failed"),console.error(r.t2);case 53:case"end":return r.stop()}}),r,null,[[2,49],[15,23],[28,42]])}))));case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"prepareLargeClassroom",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i,s,c=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=this.eduManager.createClassroom({roomUuid:t,roomName:this.roomInfo.roomName})).on("seqIdChanged",(function(e){console.log("seqIdChanged",e),"teacher"===c.roomInfo.userRole&&(c.appStore.uiStore.updateCurSeqId(e.curSeqId),c.appStore.uiStore.updateLastSeqId(e.latestSeqId))})),a.on("local-user-updated",(function(e){c.teacherRoomUserList=a.getFullUserList(),console.log("local-user-updated",e)})),a.on("local-stream-updated",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.mutex.dispatch(Object(v.a)(f.a.mark((function e(){var r,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"teacher"===c.roomInfo.userRole){e.next=5;break}return e.abrupt("return");case 5:if("main"!==t.type){e.next=36;break}if(r=a.getLocalStreamData(),console.log("[demo] [breakout] largeClassroom local-stream-updated# localStream ",r,c.joiningRTC),!r||0===r.state){e.next=34;break}return c._cameraEduStream=r.stream,e.next=12,c.prepareCamera();case 12:return e.next=14,c.prepareMicrophone();case 14:if(console.log("[demo] [breakout] largeClassroom this._cameraEduStream",c._cameraEduStream),!c.joiningRTC){e.next=32;break}if(!c._hasCamera){e.next=24;break}if(!c.cameraEduStream.hasVideo){e.next=22;break}return e.next=20,c.openCamera();case 20:e.next=24;break;case 22:return e.next=24,c.closeCamera();case 24:if(!c._hasMicrophone){e.next=32;break}if(!c.cameraEduStream.hasAudio){e.next=30;break}return e.next=28,c.openMicrophone();case 28:e.next=32;break;case 30:return e.next=32,c.closeMicrophone();case 32:e.next=36;break;case 34:console.log("[demo] [breakout] largeClassroom reset camera edu stream",r,r&&r.state),c._cameraEduStream=void 0;case 36:"screen"===t.type&&(n=a.getLocalScreenData(),console.log("[demo] [breakout] largeClassroom getLocalScreenData#screenStream ",n),n&&0!==n.state?(c._screenEduStream=n.stream,c.sharing=!0):(console.log("reset screen edu stream",n,n&&n.state),c._screenEduStream=void 0,c.sharing=!1)),console.log("[demo] [breakout] largeClassroom# local-stream-updated",t),e.next=44;break;case 40:e.prev=40,e.t0=e.catch(2),console.error("[demo] [breakout] largeClassroom# local-stream-updated ",e.t0.msg),console.error(e.t0);case 44:case"end":return e.stop()}}),e,null,[[2,40]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("local-stream-removed",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.mutex.dispatch(Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"teacher"===c.roomInfo.userRole){e.next=5;break}return e.abrupt("return");case 5:if("main"!==t.type){e.next=11;break}return c._cameraEduStream=void 0,e.next=9,c.closeCamera();case 9:return e.next=11,c.closeMicrophone();case 11:console.log("local-stream-removed",t),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),console.error("[demo] [breakout] LargeClassroom# local-stream-removed ",e.t0.msg),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("remote-user-added",(function(e){Object(Ee.p)((function(){c.teacherRoomUserList=a.getFullUserList()})),console.log("remote-user-added",e)})),a.on("remote-user-updated",(function(e){Object(Ee.p)((function(){c.teacherRoomUserList=a.getFullUserList()})),console.log("remote-user-updated",e)})),a.on("remote-user-removed",(function(e){Object(Ee.p)((function(){c.teacherRoomUserList=a.getFullUserList()})),console.log("remote-user-removed",e)})),a.on("remote-stream-added",(function(e){Object(Ee.p)((function(){c.teacherRoomStreamList=a.getFullStreamList(),"teacher"!==c.roomInfo.userRole&&(c.streamList.find((function(e){return e.videoSourceType===wt.screen}))?c.sharing=!0:c.sharing=!1)})),console.log("remote-stream-added",e)})),a.on("remote-stream-removed",(function(e){Object(Ee.p)((function(){c.teacherRoomStreamList=a.getFullStreamList(),"teacher"!==c.roomInfo.userRole&&(c.streamList.find((function(e){return e.videoSourceType===wt.screen}))?c.sharing=!0:c.sharing=!1)})),console.log("remote-stream-removed",e)})),a.on("remote-stream-updated",(function(e){Object(Ee.p)((function(){c.teacherRoomStreamList=a.getFullStreamList(),"teacher"!==c.roomInfo.userRole&&(c.streamList.find((function(e){return e.videoSourceType===wt.screen}))?c.sharing=!0:c.sharing=!1)})),console.log("remote-stream-updated",e)})),a.on("classroom-property-updated",(function(e){console.log("classroom-property-updated",e);var t=Object(E.get)(e,"roomProperties.groups");t&&(c._courseList=t);var r=Object(E.get)(e,"roomProperties.record");if(r){var a=r.state;1===a?c.recordState=!0:0===a&&c.recordState&&(c.addChatMessage({id:"system",ts:Date.now(),text:"",account:"system",link:c.roomUuid,sender:!1,fromRoomUUid:"",role:St.teacher}),c.recordState=!1,c.recordId="")}var n=c.classState,o=e.roomStatus.courseState;n!==o&&(c.classState=o,1===c.classState?(c.startTime=Object(E.get)(e,"roomStatus.startTime",0),c.addInterval("timer",(function(){c.appStore.updateTime(+c.startTime)}),500)):(c.startTime=Object(E.get)(e,"roomStatus.startTime",0),c.delInterval("timer"))),c.isMuted=!e.roomStatus.isStudentChatAllowed})),a.on("room-chat-message",(function(e){console.log("[teacher] room-chat-message ",JSON.stringify(e));var t=e.textMessage,r=JSON.parse(t.message);"teacher"!==c.roomInfo.userRole&&+r.role===St.teacher&&c.addChatMessage({id:t.fromUser.userUuid,ts:t.timestamp,text:r.content,account:t.fromUser.userName,sender:!1,role:+r.role,fromRoomName:r.fromRoomName,fromRoomUuid:r.fromRoomUuid}),"teacher"===c.roomInfo.userRole&&c.addChatMessage({id:t.fromUser.userUuid,ts:t.timestamp,text:r.content,account:t.fromUser.userName,sender:!1,role:+r.role,fromRoomName:r.fromRoomName,fromRoomUuid:r.fromRoomUuid})})),n={teacher:"host",student:"audience",assistant:"assistant"},console.log("[rules] current Role",n[r]),e.next=17,a.join({userRole:n[r],roomUuid:t,userName:"".concat(this.roomInfo.userName),userUuid:"".concat(this.userUuid),autoPublish:!0});case 17:return o=a.getClassroomInfo(),this.classState=o.roomStatus.courseState,this.startTime=Object(E.get)(o,"roomStatus.startTime",0),1===this.classState?this.addInterval("timer",(function(){c.appStore.updateTime(+c.startTime)}),500):this.appStore.resetTime(),this.isMuted=!o.roomStatus.isStudentChatAllowed,i=a.getClassroomInfo(),(s=Object(E.get)(i,"roomProperties.groups",null))&&(this._courseList=s),e.abrupt("return",a);case 26:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"prepareStudentClassroom",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o,i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.eduManager.createClassroom({roomUuid:t,roomName:r}),o={student:"broadcaster",assistant:"assistant"},n.on("seqIdChanged",(function(e){"student"===i.roomInfo.userRole&&(i.appStore.uiStore.updateCurSeqId(e.curSeqId),i.appStore.uiStore.updateLastSeqId(e.latestSeqId))})),n.on("local-user-updated",(function(e){i.teacherRoomUserList=n.getFullUserList(),console.log("[student] local-user-updated",e)})),n.on("local-stream-updated",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.dispatch(Object(v.a)(f.a.mark((function e(){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"student"===i.roomInfo.userRole){e.next=5;break}return e.abrupt("return");case 5:if("main"!==t.type){e.next=36;break}if(r=n.getLocalStreamData(),console.log("[demo] [breakout] [student] local-stream-updated# localStream ",r,i.joiningRTC),!r||0===r.state){e.next=34;break}return i._cameraEduStream=r.stream,e.next=12,i.prepareCamera();case 12:return e.next=14,i.prepareMicrophone();case 14:if(console.log("[demo] [breakout] [student] this._cameraEduStream",i._cameraEduStream),!i.joiningRTC){e.next=32;break}if(!i._hasCamera){e.next=24;break}if(!i.cameraEduStream.hasVideo){e.next=22;break}return e.next=20,i.openCamera();case 20:e.next=24;break;case 22:return e.next=24,i.closeCamera();case 24:if(!i._hasMicrophone){e.next=32;break}if(!i.cameraEduStream.hasAudio){e.next=30;break}return e.next=28,i.openMicrophone();case 28:e.next=32;break;case 30:return e.next=32,i.closeMicrophone();case 32:e.next=36;break;case 34:console.log("[demo] [breakout] [student] reset camera edu stream",r,r&&r.state),i._cameraEduStream=void 0;case 36:"screen"===t.type&&(a=n.getLocalScreenData(),console.log("[demo] [breakout] [student] getLocalScreenData#screenStream ",a),a&&0!==a.state?(i._screenEduStream=a.stream,i.sharing=!0):(console.log("[demo] [breakout] [student] reset screen edu stream",a,a&&a.state),i._screenEduStream=void 0,i.sharing=!1)),console.log("[demo] [breakout] [student] local-stream-updated",t),e.next=44;break;case 40:e.prev=40,e.t0=e.catch(2),console.error("[demo] [breakout] [student] Classroom# local-stream-updated ",e.t0.msg),console.error(e.t0);case 44:case"end":return e.stop()}}),e,null,[[2,40]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.on("local-stream-removed",function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.mutex.dispatch(Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.joiningRTC){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"student"===i.roomInfo.userRole){e.next=5;break}return e.abrupt("return");case 5:if("main"!==t.type){e.next=11;break}return i._cameraEduStream=void 0,e.next=9,i.closeCamera();case 9:return e.next=11,i.closeMicrophone();case 11:console.log("[demo] [breakout] [student] local-stream-removed",t),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),console.error("[demo] [breakout] [student] Classroom# local-stream-removed ",e.t0.msg),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.on("remote-user-added",(function(e){Object(Ee.p)((function(){i.studentRoomUserList=n.getFullUserList()})),console.log("[student] remote-stream-added",e)})),n.on("remote-user-updated",(function(e){Object(Ee.p)((function(){i.studentRoomUserList=n.getFullUserList()})),console.log("[student] remote-stream-updated",e)})),n.on("remote-user-removed",(function(e){Object(Ee.p)((function(){i.studentRoomUserList=n.getFullUserList()})),console.log("[student] remote-stream-removed",e)})),n.on("remote-stream-added",(function(e){Object(Ee.p)((function(){i.studentRoomStreamList=n.getFullStreamList()})),console.log("[student] remote-stream-added",e)})),n.on("remote-stream-removed",(function(e){Object(Ee.p)((function(){i.studentRoomStreamList=n.getFullStreamList()})),console.log("[student] remote-stream-removed",e)})),n.on("remote-stream-updated",(function(e){Object(Ee.p)((function(){i.studentRoomStreamList=n.getFullStreamList()})),console.log("[student] remote-stream-updated",e)})),n.on("room-chat-message",(function(e){console.log("[student] room-chat-message ",JSON.stringify(e));var t=e.textMessage,r=JSON.parse(t.message);i.addChatMessage({id:t.fromUser.userUuid,ts:t.timestamp,text:r.content,account:t.fromUser.userName,sender:!1,role:+r.role,fromRoomUuid:r.fromRoomUuid})})),e.next=15,n.join({userRole:o[a],roomUuid:t,userName:"".concat(this.roomInfo.userName),userUuid:"".concat(this.userUuid),autoPublish:!0});case 15:return console.log("EDU-STATE #EduClassroomManager#join ",JSON.stringify(n.getClassroomInfo())),e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"getLargeClassroomRole",value:function(e){return"teacher"===e?"host":"assistant"===e?"assistant":"audience"}},{key:"prepareClassroom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomApi=new No,e.next=3,this.roomApi.fetchRoom({roomName:"".concat(this.roomInfo.roomName),roomType:+this.roomInfo.roomType});case 3:return r=e.sent,a=r.roomUuid,console.log("[breakout] uuid",this.userUuid),this.handlePeerMessage(),e.next=9,this.eduManager.login(this.userUuid);case 9:return console.log("[breakout] login succeed",this.userUuid),e.next=12,this.prepareLargeClassroom(a,t);case 12:if(n=e.sent,console.log("[breakout] prepareLargeClassroom succeed"),!["student"].includes(t)){e.next=23;break}return e.next=17,this.prepareGroup(a,n.userToken);case 17:return o=e.sent,e.next=20,this.prepareStudentClassroom(o.roomUuid,o.roomName,t);case 20:i=e.sent,this.appStore.groupClassroomManager=i,console.log("[breakout] prepareStudentClassroom succeed");case 23:this.appStore.roomManager=n,s=this.largeClassroomManager.getClassroomInfo(),this.classState=s.roomStatus.courseState,this.isMuted=!s.roomStatus.isStudentChatAllowed;case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"joinAsStudent",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.prepareClassroom(this.roomInfo.userRole);case 3:return console.log("[breakout] joinAsStudent"),t=this.groupClassroomManager,r=this.largeClassroomManager,console.log("[breakout] groupManager",t),this.appStore._boardService=new Ao(r.userToken,r.roomUuid),console.log("[breakout whiteboard] invoke init"),e.next=11,this.appStore.boardStore.init();case 11:return console.log("[breakout whiteboard] after invoke init"),this.appStore._recordService=new Lo(r.userToken),a=t.data.streamMap.main,n=r.data.streamMap.main,o=this.largeClassroomManager.getClassroomInfo(),i=t.getClassroomInfo(),console.log("[breakout], groupRoom",i," roomInfo ",o),s=t.data.localStreamData,e.next=21,t.userService.publishStream({videoSourceType:wt.camera,audioSourceType:Ot.mic,streamUuid:a.streamUuid,streamName:"",hasVideo:!s||!s.stream||s.stream.hasVideo,hasAudio:!s||!s.stream||s.stream.hasAudio,userInfo:{}});case 21:return e.next=23,this.joinRtcAsStudent({studentChannel:{uid:+a.streamUuid,channel:i.roomInfo.roomUuid,token:a.rtcToken},teacherChannel:{uid:+n.streamUuid,channel:o.roomInfo.roomUuid,token:n.rtcToken}});case 23:return this.currentStudentRoomUuid=i.roomInfo.roomUuid,(c=Object(E.get)(i,"roomProperties.groups",null))&&(this._courseList=c),this.appStore.uiStore.addToast(A("toast.publish_business_flow_successfully")),this._cameraEduStream=this.groupClassroomManager.userService.localStream.stream,e.prev=28,e.next=31,this.prepareCamera();case 31:return e.next=33,this.prepareMicrophone();case 33:if(!this._cameraEduStream){e.next=48;break}if(!this._cameraEduStream.hasVideo){e.next=39;break}return e.next=37,this.openCamera();case 37:e.next=41;break;case 39:return e.next=41,this.closeCamera();case 41:if(!this._cameraEduStream.hasAudio){e.next=46;break}return e.next=44,this.openMicrophone();case 44:e.next=48;break;case 46:return e.next=48,this.closeMicrophone();case 48:e.next=54;break;case 50:e.prev=50,e.t0=e.catch(28),this.appStore.uiStore.addToast(A("toast.media_method_call_failed")+": ".concat(e.t0.msg)),console.warn(e.t0);case 54:u=t.getClassroomInfo().roomProperties,this.recordId=u?Object(E.get)(u,"record.recordId",""):"",this.studentRoomUserList=t.getFullUserList(),this.teacherRoomUserList=r.getFullUserList(),this.studentRoomStreamList=t.getFullStreamList(),this.teacherRoomStreamList=r.getFullStreamList(),e.next=66;break;case 62:throw e.prev=62,e.t1=e.catch(0),console.error(e.t1),e.t1;case 66:case"end":return e.stop()}}),e,this,[[0,62],[28,50]])})));return function(){return e.apply(this,arguments)}}()},{key:"joinAsTeacher",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.prepareClassroom(this.roomInfo.userRole);case 2:return console.log("[breakout] classroom as teacher"),t=this.largeClassroomManager,this.appStore._boardService=new Ao(t.userToken,t.roomUuid),console.log("[breakout whiteboard] invoke init"),e.next=8,this.appStore.boardStore.init();case 8:return console.log("[breakout whiteboard] after invoke init"),this.appStore._recordService=new Lo(t.userToken),r=t.data.streamMap.main,a=this.largeClassroomManager.getClassroomInfo(),console.log("[breakout] joinAsTeacher ",JSON.stringify({mainStream:r,roomInfo:a})),e.next=15,this.joinRtcAsTeacher({uid:+r.streamUuid,channel:a.roomInfo.roomUuid,token:r.rtcToken});case 15:return n=t.data.localStreamData,console.log("localStreamData",n),e.next=19,t.userService.publishStream({videoSourceType:wt.camera,audioSourceType:Ot.mic,streamUuid:r.streamUuid,streamName:"",hasVideo:!n||!n.stream||n.stream.hasVideo,hasAudio:!n||!n.stream||n.stream.hasAudio,userInfo:{}});case 19:return this.appStore.uiStore.addToast(A("toast.publish_business_flow_successfully")),this._cameraEduStream=this.largeClassroomManager.userService.localStream.stream,e.prev=21,e.next=24,this.prepareCamera();case 24:return e.next=26,this.prepareMicrophone();case 26:if(!this._cameraEduStream){e.next=41;break}if(!this._cameraEduStream.hasVideo){e.next=32;break}return e.next=30,this.openCamera();case 30:e.next=34;break;case 32:return e.next=34,this.closeCamera();case 34:if(!this._cameraEduStream.hasAudio){e.next=39;break}return e.next=37,this.openMicrophone();case 37:e.next=41;break;case 39:return e.next=41,this.closeMicrophone();case 41:e.next=47;break;case 43:e.prev=43,e.t0=e.catch(21),this.appStore.uiStore.addToast(A("toast.media_method_call_failed")+": ".concat(e.t0.msg)),console.warn(e.t0);case 47:o=t.getClassroomInfo().roomProperties,this.recordId=o?Object(E.get)(o,"record.recordId",""):"",i=t.getClassroomInfo(),(s=Object(E.get)(i,"roomProperties.groups",null))&&(this._courseList=s),this.teacherRoomUserList=t.getFullUserList(),this.teacherRoomStreamList=t.getFullStreamList();case 54:case"end":return e.stop()}}),e,this,[[21,43]])})));return function(){return e.apply(this,arguments)}}()},{key:"assistantJoinLargeClassroom",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomApi=new No,e.next=3,this.roomApi.fetchRoom({roomName:"".concat(this.roomInfo.roomName),roomType:+this.roomInfo.roomType});case 3:return t=e.sent,r=t.roomUuid,console.log("[breakout] uuid",this.userUuid),this.handlePeerMessage(),e.next=9,this.eduManager.login(this.userUuid);case 9:return console.log("[breakout] login succeed",this.userUuid),a=this.roomInfo.userRole,e.next=13,this.prepareLargeClassroom(r,a);case 13:n=e.sent,console.log("[breakout] prepareLargeClassroom succeed"),this.appStore.roomManager=n;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"assistantJoinGroupClassroomByCourse",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.prepareStudentClassroom(t,r,this.roomInfo.userRole);case 2:a=e.sent,this.appStore.groupClassroomManager=a;case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"loginAsAssistant",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.addEventListener("popstate",this.handlePopState,!1),this.appStore.uiStore.startLoading(),!this.roomInfo){e.next=8;break}if("assistant"!==this.roomInfo.userRole){e.next=8;break}if(this.largeClassroomManager){e.next=8;break}return e.next=8,this.assistantJoinLargeClassroom();case 8:this.appStore.uiStore.stopLoading(),this.joined=!0,e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(0),window.removeEventListener("popstate",this.handlePopState,!1),this.appStore.uiStore.stopLoading(),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"joinAsAssistant",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("[breakout] joinAsAssistant ",JSON.stringify({groupUuid:t,groupName:r})),this.largeClassroomManager){e.next=5;break}return e.next=5,this.assistantJoinLargeClassroom();case 5:return e.next=7,this.joinGroupAsAssistant(t,r);case 7:this.currentStudentRoomUuid=t,this.joinedGroup=!0,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(0),console.warn(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"leaveGroupBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.appStore.uiStore.startLoading(),!this.roomInfo){e.next=6;break}if("assistant"!==this.roomInfo.userRole){e.next=6;break}return e.next=6,this.leaveGroupAsAssistant(t);case 6:this.appStore.uiStore.stopLoading(),this.joined=!0,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.appStore.uiStore.stopLoading(),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"resetAssistantState",value:function(){this.currentStudentRoomUuid="",this.appStore.mediaStore.resetRoomState(),this.recording=!1,this.resolutionIdx=0,this.totalVolume=0,this.cameraLabel="",this.microphoneLabel="",this.mediaService.reset(),this.resetScreenStream(),this.teacherRoomStreamList=[],this.teacherRoomUserList=[],this.customScreenShareWindowVisible=!1,this.currentWindowId="",this.customScreenShareItems=[],this._roomChatMessages=[],this.isMuted=void 0,this._cameraEduStream=void 0,this._screenEduStream=void 0,this._microphoneTrack=void 0,this.recordId="",this.joined=!1,this._hasCamera=void 0,this._hasMicrophone=void 0,this.joiningRTC=!1,this.recordState=!1,this._courseList=[]}},{key:"leaveGroupAsAssistant",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.leaveRtc();case 3:return e.next=5,this.appStore.boardStore.leave();case 5:return e.next=7,null===(r=this.groupClassroomManager)||void 0===r?void 0:r.leave();case 7:this.appStore.uiStore.addToast(A("toast.successfully_left_the_business_channel")),this.resetAssistantState(),this.appStore.uiStore.updateCurSeqId(0),this.appStore.uiStore.updateLastSeqId(0),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(0),console.warn(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"joinGroupAsAssistant",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i,s,c,u,l,p,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[assistant] ",t,r),e.next=4,this.assistantJoinGroupClassroomByCourse(t,r);case 4:return a=this.groupClassroomManager,n=this.largeClassroomManager,this.appStore._boardService=new Ao(n.userToken,n.roomUuid),console.log("[breakout whiteboard] invoke init"),e.next=10,this.appStore.boardStore.init();case 10:return console.log("[breakout whiteboard] after invoke init"),this.appStore._recordService=new Lo(n.userToken),o=a.data.streamMap.main,i=n.data.streamMap.main,s=this.largeClassroomManager.getClassroomInfo(),c=a.getClassroomInfo(),u={studentChannel:{uid:+o.streamUuid,channel:c.roomInfo.roomUuid,token:o.rtcToken},teacherChannel:{uid:+i.streamUuid,channel:s.roomInfo.roomUuid,token:i.rtcToken}},console.log("[breakout] joinRtcAsAssistant ",JSON.stringify(u)," largeRoomMainStream ",JSON.stringify(i)," groupRoom ",JSON.stringify(c.roomInfo)," mainStream ",JSON.stringify(o)),e.next=20,this.joinRtcAsAssistant(u);case 20:l=a.getClassroomInfo().roomProperties,this.recordId=l?Object(E.get)(l,"record.recordId",""):"",p=n.getClassroomInfo(),(d=Object(E.get)(p,"roomProperties.groups",null))&&(this._courseList=d),this.studentRoomUserList=a.getFullUserList(),this.teacherRoomUserList=n.getFullUserList(),this.studentRoomStreamList=a.getFullStreamList(),this.teacherRoomStreamList=n.getFullStreamList(),e.next=35;break;case 31:throw e.prev=31,e.t0=e.catch(0),console.error(e.t0),e.t0;case 35:case"end":return e.stop()}}),e,this,[[0,31]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"prepareGroup",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomApi.acquireRoomGroupBy(t,r);case 2:return a=e.sent,this.roomInfo.groupName=a.roomName,this.roomInfo.groupUuid=a.groupUuid,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"assistantJoinRoom",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.appStore.uiStore.startLoading(),!this.roomInfo){e.next=6;break}if("assistant"!==this.roomInfo.userRole){e.next=6;break}return e.next=6,this.joinAsAssistant(t,this.roomInfo.groupName);case 6:this.appStore.uiStore.stopLoading(),this.joined=!0,e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.appStore.uiStore.stopLoading(),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"join",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.addEventListener("popstate",this.handlePopState,!1),this.appStore.uiStore.startLoading(),!this.roomInfo){e.next=10;break}if("teacher"!==this.roomInfo.userRole){e.next=7;break}return e.next=7,this.joinAsTeacher();case 7:if("student"!==this.roomInfo.userRole){e.next=10;break}return e.next=10,this.joinAsStudent();case 10:this.appStore.uiStore.stopLoading(),this.joined=!0,e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(0),this.appStore.uiStore.stopLoading(),window.removeEventListener("popstate",this.handlePopState,!1),e.t0;case 19:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"teacherUuid",get:function(){var e=this.userList.find((function(e){return e.role===_t.teacher}));return e?e.userUuid:""}},{key:"localUser",get:function(){return this.roomInfo}},{key:"teacherStream",get:function(){var e=this,t=this.localUser;if(t&&"teacher"===t.userRole&&this.cameraEduStream)return{local:!0,userUuid:this.appStore.userUuid,account:t.userName,streamUuid:this.cameraEduStream.streamUuid,video:this.cameraEduStream.hasVideo,audio:this.cameraEduStream.hasAudio,renderer:this.cameraRenderer,showControls:this.canControl(this.appStore.userUuid)};var r=this.streamList.find((function(t){return"host"===t.userInfo.role&&t.userInfo.userUuid===e.teacherUuid&&t.videoSourceType!==wt.screen}));if(r){var a=this.getUserBy(r.userInfo.userUuid);return{local:!1,account:a.userName,userUuid:a.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:this.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:this.canControl(a.userUuid)}}return{account:"teacher",streamUuid:"",userUuid:"",local:!1,video:!1,audio:!1,renderer:void 0,showControls:!1}}},{key:"getUserBy",value:function(e){return this.userList.find((function(t){return t.userUuid===e}))}},{key:"getStreamBy",value:function(e){return this.streamList.find((function(t){return t.userInfo.userUuid===e}))}},{key:"screenShareStream",get:function(){var e=this;return this.screenEduStream?{local:!0,account:"",userUuid:this.screenEduStream.userInfo.userUuid,streamUuid:this.screenEduStream.streamUuid,video:this.screenEduStream.hasVideo,audio:this.screenEduStream.hasAudio,renderer:this._screenVideoRenderer,showControls:!1}:this.teacherRoomStreamList.reduce((function(t,r){var a=e.teacherRoomUserList.find((function(e){return"host"===e.role}));return a&&r.userInfo.userUuid===a.userUuid&&r.videoSourceType===wt.screen?(t.push({local:!1,account:"",userUuid:r.userInfo.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:e.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:!1}),t):t}),[])[0]}},{key:"isLocalStream",value:function(e){return this.appStore.userUuid===e.userInfo.userUuid}},{key:"studentStreams",get:function(){var e=this,t=this.studentRoomStreamList.reduce((function(t,r){var a=e.studentRoomUserList.find((function(e){return e.userUuid===r.userInfo.userUuid&&["broadcaster"].includes(e.role)}));return!a||e.isLocalStream(r)||t.push({local:!1,account:a.userName,userUuid:r.userInfo.userUuid,streamUuid:r.streamUuid,video:r.hasVideo,audio:r.hasAudio,renderer:e.remoteUsersRenderer.find((function(e){return+e.uid===+r.streamUuid})),showControls:e.canControl(a.userUuid)}),t}),[]);console.log("[rtm] streamList",t);var r=this.localUser,a=["student"].includes(r.userRole);return this.cameraEduStream&&a&&(t=[{local:!0,account:r.userName,userUuid:this.cameraEduStream.userInfo.userUuid,streamUuid:this.cameraEduStream.streamUuid,video:this.cameraEduStream.hasVideo,audio:this.cameraEduStream.hasAudio,renderer:this.cameraRenderer,showControls:this.canControl(this.appStore.userUuid)}].concat(t)),t}},{key:"leaveCourse",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.leaveRtc();case 3:return e.next=5,this.appStore.boardStore.leave();case 5:return e.next=7,this.eduManager.logout();case 7:return e.next=9,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.leave();case 9:return e.next=11,null===(r=this.groupClassroomManager)||void 0===r?void 0:r.leave();case 11:return e.next=13,null===(a=this.largeClassroomManager)||void 0===a?void 0:a.removeAllListeners();case 13:return e.next=15,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.removeAllListeners();case 15:this.appStore.groupClassroomManager=void 0,this.appStore.roomManager=void 0,this.appStore.uiStore.addToast(A("toast.successfully_left_the_business_channel")),this.reset(),this.appStore.uiStore.updateCurSeqId(0),this.appStore.uiStore.updateLastSeqId(0),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),this.reset(),console.error(e.t0);case 27:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,window.removeEventListener("popstate",this.handlePopState,!1),e.next=4,this.leaveRtc();case 4:return e.next=6,this.appStore.boardStore.leave();case 6:return e.next=8,this.eduManager.logout();case 8:return e.next=10,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.leave();case 10:return e.next=12,null===(r=this.groupClassroomManager)||void 0===r?void 0:r.leave();case 12:return e.next=14,null===(a=this.largeClassroomManager)||void 0===a?void 0:a.removeAllListeners();case 14:return e.next=16,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.removeAllListeners();case 16:this.appStore.groupClassroomManager=void 0,this.appStore.roomManager=void 0,this.appStore.uiStore.addToast(A("toast.successfully_left_the_business_channel")),this.reset(),this.resetRoomInfo(),this.appStore.uiStore.updateCurSeqId(0),this.appStore.uiStore.updateLastSeqId(0),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(0),this.reset(),console.error(e.t0);case 29:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(){return e.apply(this,arguments)}}()},{key:"startClass",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.updateCourseState(Pt.EduCourseStateStart);case 3:this.appStore.uiStore.addToast(A("toast.course_started_successfully")),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.appStore.uiStore.addToast(A("toast.setting_start_failed"));case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopClass",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.updateCourseState(Pt.EduCourseStateStop);case 3:this.appStore.uiStore.addToast(A("toast.the_course_ends_successfully")),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.appStore.uiStore.addToast(A("toast.setting_ended_failed"));case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"mutedChat",get:function(){var e;if(void 0!==this.isMuted)return this.isMuted;var t=null===(e=this.largeClassroomManager)||void 0===e?void 0:e.getClassroomInfo();return!t||!t.roomStatus||!t.roomStatus.isStudentChatAllowed}},{key:"muteChat",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=3===+this.roomInfo.roomType?Et.SceneLarge:+this.roomInfo.roomType,a=["broadcaster"],r===Et.SceneLarge&&a.push("audience"),e.next=5,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.muteStudentChatByRoles(a);case 5:this.isMuted=!0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unmuteChat",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=3===+this.roomInfo.roomType?Et.SceneLarge:+this.roomInfo.roomType,a=["broadcaster"],r===Et.SceneLarge&&a.push("audience"),e.next=5,null===(t=this.largeClassroomManager)||void 0===t?void 0:t.userService.unmuteStudentChatByRoles(a);case 5:this.isMuted=!1;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canControl",value:function(e){return["teacher","assistant"].includes(this.roomInfo.userRole)||this.userUuid===e}},{key:"addChatMessage",value:function(e){this._roomChatMessages.push(e)}},{key:"currentStudentRoomName",get:function(){var e,t=this;return this.currentStudentRoomUuid?null===(e=this._courseList.find((function(e){return e.roomUuid===t.currentStudentRoomUuid})))||void 0===e?void 0:e.roomName:""}},{key:"roomChatMessages",get:function(){var e=this;return["student","assistant"].includes(this.roomInfo.userRole)&&this.currentStudentRoomUuid?this._roomChatMessages.filter((function(t){return"".concat(t.fromRoomUuid)==="".concat(e.currentStudentRoomUuid)||!t.fromRoomUuid})):"teacher"===this.roomInfo.userRole&&this.currentStudentRoomUuid?this._roomChatMessages.filter((function(t){return"".concat(t.fromRoomUuid)==="".concat(e.currentStudentRoomUuid)})):this._roomChatMessages}},{key:"muteControl",get:function(){return!!this.roomInfo&&"teacher"===this.roomInfo.userRole}},{key:"muteStudentChat",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r||this.getUserBy(t);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unmuteStudentChat",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r||this.getUserBy(t);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteStudentVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return e.next=3,this.closeCamera();case 3:return e.next=5,null===(a=this.groupClassroomManager)||void 0===a?void 0:a.userService.updateMainStreamState({videoState:!1});case 5:e.next=14;break;case 7:if(!(o=this.getStreamBy(t))){e.next=11;break}return e.next=11,this.mediaService.muteRemoteVideoByClient(this.mediaGroup,+o.streamUuid,!0);case 11:return i=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=14,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.userService.remoteStopStudentCamera(i);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unmuteStudentVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return e.next=3,this.openCamera();case 3:return e.next=5,null===(a=this.groupClassroomManager)||void 0===a?void 0:a.userService.updateMainStreamState({videoState:!0});case 5:e.next=11;break;case 7:return this.getStreamBy(t),o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=11,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.userService.remoteStartStudentCamera(o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteStudentAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return e.next=3,this.closeMicrophone();case 3:return e.next=5,null===(a=this.groupClassroomManager)||void 0===a?void 0:a.userService.updateMainStreamState({audioState:!1});case 5:e.next=14;break;case 7:if(!(o=this.getStreamBy(t))){e.next=11;break}return e.next=11,this.mediaService.muteRemoteAudioByClient(this.mediaGroup,+o.streamUuid,!0);case 11:return i=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=14,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.userService.remoteStopStudentMicrophone(i);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"unmuteStudentAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r){var a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,null===(a=this.groupClassroomManager)||void 0===a?void 0:a.userService.updateMainStreamState({audioState:!0});case 3:e.next=9;break;case 5:return this.getStreamBy(t),o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=9,null===(n=this.groupClassroomManager)||void 0===n?void 0:n.userService.remoteStartStudentMicrophone(o);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"muteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("teacher"!==a){e.next=11;break}if(!r){e.next=8;break}return console.log("before muteLocalAudio",this.microphoneLock),e.next=5,this.muteLocalMicrophone();case 5:console.log("after muteLocalAudio",this.microphoneLock),e.next=11;break;case 8:return o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=11,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.remoteStopStudentMicrophone(o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"unmuteAudio",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("teacher"!==a){e.next=12;break}if(!r){e.next=8;break}return console.log("before unmuteLocalMicrophone",this.microphoneLock),e.next=5,this.unmuteLocalMicrophone();case 5:console.log("after unmuteLocalMicrophone",this.microphoneLock),e.next=12;break;case 8:return this.getStreamBy(t),o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=12,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.remoteStartStudentMicrophone(o);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"muteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return console.log("before muteLocalCamera",this.cameraLock),e.next=4,this.muteLocalCamera();case 4:console.log("after muteLocalCamera",this.cameraLock),e.next=10;break;case 7:return o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=10,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.remoteStopStudentCamera(o);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"unmuteVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,r,a){var n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return console.log("before unmuteLocalCamera",this.cameraLock),e.next=4,this.unmuteLocalCamera();case 4:console.log("after unmuteLocalCamera",this.cameraLock),e.next=11;break;case 7:return this.getStreamBy(t),o=this.streamList.find((function(e){return e.userInfo.userUuid===t})),e.next=11,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.remoteStartStudentCamera(o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"isRecording",get:function(){return!!this.recordId}},{key:"startOrStopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.recording=!0,!this.isRecording){e.next=7;break}return e.next=5,this.stopRecording();case 5:e.next=9;break;case 7:return e.next=9,this.startRecording();case 9:this.recording=!1,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.recording=!1;case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"startRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.recordService.startRecording(this.roomUuid);case 3:t=e.sent,r=t.recordId,this.recordId=r,this.appStore.uiStore.addToast(A("toast.start_recording_successfully")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.start_recording_failed")+", ".concat(e.t0.msg));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopRecording",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.recordService.stopRecording(this.roomUuid,this.recordId);case 3:this.appStore.uiStore.addToast(A("toast.successfully_ended_recording")),this.recordId="",e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_recording")+", ".concat(e.t0.msg));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"removeDialogBy",value:function(e){var t=this.appStore.uiStore.dialogs.filter((function(e){return e.dialog.userUuid})).find((function(t){return t.dialog.userUuid===e}));t&&this.appStore.uiStore.removeDialog(t.id)}},{key:"showNotice",value:function(e,t){var r=A("toast.you_have_a_default_message");switch(e){case er.teacherAccept:r=A("toast.the_teacher_agreed");break;case er.studentApply:r=A("toast.student_applied");break;case er.teacherStop:r=A("toast.you_were_dismissed_by_the_teacher");break;case er.studentStop:case er.studentCancel:r=A("toast.student_canceled"),this.removeDialogBy(t);break;case er.teacherReject:case er.teacherReject:r=A("toast.the_teacher_refused")}this.notice={reason:r,userUuid:t},this.appStore.uiStore.addToast(this.notice.reason)}},{key:"callApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r=null===(t=this.largeClassroomManager)||void 0===t?void 0:t.getFullUserList().find((function(e){return e.userUuid===n.teacherStream.userUuid})))){e.next=5;break}return e.next=5,null===(a=this.largeClassroomManager)||void 0===a?void 0:a.userService.sendCoVideoApply(r);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_initiate_a_raise_of_hand_application")+" ".concat(e.t0.msg));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"callEnded",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r=null===(t=this.largeClassroomManager)||void 0===t?void 0:t.getFullUserList().find((function(e){return e.userUuid===n.teacherStream.userUuid})))){e.next=5;break}return e.next=5,null===(a=this.largeClassroomManager)||void 0===a?void 0:a.userService.studentCancelApply(r);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.appStore.uiStore.addToast(A("toast.failed_to_end_the_call")+" ".concat(e.t0.msg));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"showDialog",value:function(e){this.appStore.uiStore.showDialog({type:"apply",message:"".concat(e)+A("icon.requests_to_connect_the_microphone")})}},{key:"teacherRejectApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.notice.userUuid,!(a=null===(t=this.largeClassroomManager)||void 0===t?void 0:t.getFullUserList().find((function(e){return e.userUuid===r})))){e.next=5;break}return e.next=5,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.rejectCoVideoApply(a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"teacherAcceptApply",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.notice.userUuid,!(a=null===(t=this.largeClassroomManager)||void 0===t?void 0:t.data.userList.find((function(e){return e.user.userUuid===r})))){e.next=7;break}return e.next=5,null===(n=this.largeClassroomManager)||void 0===n?void 0:n.userService.acceptCoVideoApply(a.user);case 5:return e.next=7,null===(o=this.largeClassroomManager)||void 0===o?void 0:o.userService.inviteStreamBy({roomUuid:this.roomUuid,streamUuid:a.streamUuid,userUuid:a.user.userUuid});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Ro),so.resolutions=[{name:"480p",value:"480p_1"},{name:"720p",value:"720p_1"},{name:"1080p",value:"1080p_1"}],bn=co,gn=Object(re.a)(bn.prototype,"resolutionIdx",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yn=Object(re.a)(bn.prototype,"deviceList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kn=Object(re.a)(bn.prototype,"cameraLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Sn=Object(re.a)(bn.prototype,"microphoneLabel",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_n=Object(re.a)(bn.prototype,"_cameraId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),On=Object(re.a)(bn.prototype,"_microphoneId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(bn.prototype,"cameraId",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"cameraId"),bn.prototype),Object(re.a)(bn.prototype,"microphoneId",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"microphoneId"),bn.prototype),wn=Object(re.a)(bn.prototype,"resolution",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"480p_1"}}),Object(re.a)(bn.prototype,"playbackVolume",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"playbackVolume"),bn.prototype),jn=Object(re.a)(bn.prototype,"_playbackVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(bn.prototype,"changePlaybackVolume",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"changePlaybackVolume"),bn.prototype),xn=Object(re.a)(bn.prototype,"_microphoneTrack",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Tn=Object(re.a)(bn.prototype,"_cameraRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Cn=Object(re.a)(bn.prototype,"_screenVideoRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(bn.prototype,"cameraRenderer",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"cameraRenderer"),bn.prototype),En=Object(re.a)(bn.prototype,"totalVolume",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(bn.prototype,"screenVideoRenderer",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"screenVideoRenderer"),bn.prototype),Un=Object(re.a)(bn.prototype,"currentWindowId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Rn=Object(re.a)(bn.prototype,"customScreenShareWindowVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pn=Object(re.a)(bn.prototype,"customScreenShareItems",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),An=Object(re.a)(bn.prototype,"settingVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),In=Object(re.a)(bn.prototype,"recordState",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"remoteUsersRenderer",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"remoteUsersRenderer"),bn.prototype),Ln=Object(re.a)(bn.prototype,"sharing",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"showSetting",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"showSetting"),bn.prototype),Object(re.a)(bn.prototype,"hideSetting",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"hideSetting"),bn.prototype),Object(re.a)(bn.prototype,"resetCameraTrack",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetCameraTrack"),bn.prototype),Object(re.a)(bn.prototype,"resetMicrophoneTrack",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetMicrophoneTrack"),bn.prototype),Object(re.a)(bn.prototype,"resetScreenTrack",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetScreenTrack"),bn.prototype),Object(re.a)(bn.prototype,"resetScreenStream",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetScreenStream"),bn.prototype),Object(re.a)(bn.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"reset"),bn.prototype),Nn=Object(re.a)(bn.prototype,"_courseList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(bn.prototype,"courseList",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"courseList"),bn.prototype),Object(re.a)(bn.prototype,"showScreenShareWindowWithItems",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"showScreenShareWindowWithItems"),bn.prototype),Object(re.a)(bn.prototype,"startNativeScreenShareBy",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"startNativeScreenShareBy"),bn.prototype),Object(re.a)(bn.prototype,"removeScreenShareWindow",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"removeScreenShareWindow"),bn.prototype),Object(re.a)(bn.prototype,"cameraList",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"cameraList"),bn.prototype),Object(re.a)(bn.prototype,"microphoneList",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"microphoneList"),bn.prototype),Object(re.a)(bn.prototype,"openCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"openCamera"),bn.prototype),Object(re.a)(bn.prototype,"closeCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"closeCamera"),bn.prototype),Object(re.a)(bn.prototype,"changeCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"changeCamera"),bn.prototype),Object(re.a)(bn.prototype,"muteLocalCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteLocalCamera"),bn.prototype),Object(re.a)(bn.prototype,"unmuteLocalCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteLocalCamera"),bn.prototype),Object(re.a)(bn.prototype,"muteLocalMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteLocalMicrophone"),bn.prototype),Object(re.a)(bn.prototype,"unmuteLocalMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteLocalMicrophone"),bn.prototype),Object(re.a)(bn.prototype,"openMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"openMicrophone"),bn.prototype),Object(re.a)(bn.prototype,"closeMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"closeMicrophone"),bn.prototype),Object(re.a)(bn.prototype,"changeMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"changeMicrophone"),bn.prototype),Object(re.a)(bn.prototype,"changeResolution",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"changeResolution"),bn.prototype),Mn=Object(re.a)(bn.prototype,"waitingShare",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"stopWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"stopWebSharing"),bn.prototype),Object(re.a)(bn.prototype,"startWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"startWebSharing"),bn.prototype),Object(re.a)(bn.prototype,"prepareScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"prepareScreenShare"),bn.prototype),Object(re.a)(bn.prototype,"stopNativeSharing",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"stopNativeSharing"),bn.prototype),Object(re.a)(bn.prototype,"resetWebPrepareScreen",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetWebPrepareScreen"),bn.prototype),Object(re.a)(bn.prototype,"startScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"startScreenShare"),bn.prototype),Object(re.a)(bn.prototype,"userList",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"userList"),bn.prototype),Object(re.a)(bn.prototype,"streamList",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"streamList"),bn.prototype),Dn=Object(re.a)(bn.prototype,"teacherRoomUserList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vn=Object(re.a)(bn.prototype,"teacherRoomStreamList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(bn.prototype,"stopScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"stopScreenShare"),bn.prototype),Wn=Object(re.a)(bn.prototype,"unreadMessageCount",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fn=Object(re.a)(bn.prototype,"messages",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(bn.prototype,"sendMessageToCurrentRoom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"sendMessageToCurrentRoom"),bn.prototype),Object(re.a)(bn.prototype,"sendMessage",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"sendMessage"),bn.prototype),Bn=Object(re.a)(bn.prototype,"joined",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zn=Object(re.a)(bn.prototype,"menuVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"toggleMenu",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"toggleMenu"),bn.prototype),Object(re.a)(bn.prototype,"resetTab",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetTab"),bn.prototype),qn=Object(re.a)(bn.prototype,"activeTab",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"first"}}),Object(re.a)(bn.prototype,"switchTab",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"switchTab"),bn.prototype),Object(re.a)(bn.prototype,"switchTabToRoom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"switchTabToRoom"),bn.prototype),Object(re.a)(bn.prototype,"roomInfo",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"roomInfo"),bn.prototype),Object(re.a)(bn.prototype,"resetRoomInfo",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetRoomInfo"),bn.prototype),Gn=Object(re.a)(bn.prototype,"classState",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(bn.prototype,"delay",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"delay"),bn.prototype),Kn=Object(re.a)(bn.prototype,"time",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(bn.prototype,"networkQuality",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"networkQuality"),bn.prototype),Jn=Object(re.a)(bn.prototype,"_cpuRate",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(bn.prototype,"cpuRate",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"cpuRate"),bn.prototype),Yn=Object(re.a)(bn.prototype,"_cameraEduStream",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Hn=Object(re.a)(bn.prototype,"_screenEduStream",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(bn.prototype,"screenEduStream",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"screenEduStream"),bn.prototype),Object(re.a)(bn.prototype,"cameraEduStream",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"cameraEduStream"),bn.prototype),Qn=Object(re.a)(bn.prototype,"joiningRTC",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"joinRtcAsTeacher",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinRtcAsTeacher"),bn.prototype),Object(re.a)(bn.prototype,"joinRtcAsStudent",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinRtcAsStudent"),bn.prototype),Object(re.a)(bn.prototype,"joinRtcAsAssistant",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinRtcAsAssistant"),bn.prototype),Object(re.a)(bn.prototype,"prepareCamera",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"prepareCamera"),bn.prototype),Object(re.a)(bn.prototype,"prepareMicrophone",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"prepareMicrophone"),bn.prototype),Xn=Object(re.a)(bn.prototype,"studentRoomUserList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zn=Object(re.a)(bn.prototype,"studentRoomStreamList",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(bn.prototype,"prepareStudentClassroom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"prepareStudentClassroom"),bn.prototype),Object(re.a)(bn.prototype,"prepareClassroom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"prepareClassroom"),bn.prototype),Object(re.a)(bn.prototype,"joinAsStudent",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinAsStudent"),bn.prototype),Object(re.a)(bn.prototype,"joinAsTeacher",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinAsTeacher"),bn.prototype),Object(re.a)(bn.prototype,"assistantJoinLargeClassroom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"assistantJoinLargeClassroom"),bn.prototype),Object(re.a)(bn.prototype,"assistantJoinGroupClassroomByCourse",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"assistantJoinGroupClassroomByCourse"),bn.prototype),Object(re.a)(bn.prototype,"loginAsAssistant",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"loginAsAssistant"),bn.prototype),$n=Object(re.a)(bn.prototype,"joinedGroup",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"joinAsAssistant",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinAsAssistant"),bn.prototype),Object(re.a)(bn.prototype,"leaveGroupBy",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"leaveGroupBy"),bn.prototype),Object(re.a)(bn.prototype,"resetAssistantState",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"resetAssistantState"),bn.prototype),Object(re.a)(bn.prototype,"leaveGroupAsAssistant",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"leaveGroupAsAssistant"),bn.prototype),Object(re.a)(bn.prototype,"joinGroupAsAssistant",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"joinGroupAsAssistant"),bn.prototype),Object(re.a)(bn.prototype,"assistantJoinRoom",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"assistantJoinRoom"),bn.prototype),Object(re.a)(bn.prototype,"join",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"join"),bn.prototype),Object(re.a)(bn.prototype,"teacherStream",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"teacherStream"),bn.prototype),Object(re.a)(bn.prototype,"screenShareStream",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"screenShareStream"),bn.prototype),Object(re.a)(bn.prototype,"studentStreams",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"studentStreams"),bn.prototype),Object(re.a)(bn.prototype,"leaveCourse",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"leaveCourse"),bn.prototype),Object(re.a)(bn.prototype,"leave",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"leave"),bn.prototype),Object(re.a)(bn.prototype,"startClass",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"startClass"),bn.prototype),Object(re.a)(bn.prototype,"stopClass",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"stopClass"),bn.prototype),Object(re.a)(bn.prototype,"mutedChat",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"mutedChat"),bn.prototype),eo=Object(re.a)(bn.prototype,"isMuted",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(bn.prototype,"muteChat",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteChat"),bn.prototype),Object(re.a)(bn.prototype,"unmuteChat",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteChat"),bn.prototype),to=Object(re.a)(bn.prototype,"_roomChatMessages",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(bn.prototype,"addChatMessage",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"addChatMessage"),bn.prototype),Object(re.a)(bn.prototype,"currentStudentRoomName",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"currentStudentRoomName"),bn.prototype),ro=Object(re.a)(bn.prototype,"currentStudentRoomUuid",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(re.a)(bn.prototype,"roomChatMessages",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"roomChatMessages"),bn.prototype),Object(re.a)(bn.prototype,"muteControl",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"muteControl"),bn.prototype),ao=Object(re.a)(bn.prototype,"mediaGroup",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Object(re.a)(bn.prototype,"muteStudentChat",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteStudentChat"),bn.prototype),Object(re.a)(bn.prototype,"unmuteStudentChat",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteStudentChat"),bn.prototype),Object(re.a)(bn.prototype,"muteStudentVideo",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteStudentVideo"),bn.prototype),Object(re.a)(bn.prototype,"unmuteStudentVideo",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteStudentVideo"),bn.prototype),Object(re.a)(bn.prototype,"muteStudentAudio",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteStudentAudio"),bn.prototype),Object(re.a)(bn.prototype,"unmuteStudentAudio",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteStudentAudio"),bn.prototype),Object(re.a)(bn.prototype,"muteAudio",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"muteAudio"),bn.prototype),no=Object(re.a)(bn.prototype,"recordId",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oo=Object(re.a)(bn.prototype,"recording",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(re.a)(bn.prototype,"isRecording",[Ee.h],Object.getOwnPropertyDescriptor(bn.prototype,"isRecording"),bn.prototype),Object(re.a)(bn.prototype,"startRecording",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"startRecording"),bn.prototype),Object(re.a)(bn.prototype,"stopRecording",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"stopRecording"),bn.prototype),io=Object(re.a)(bn.prototype,"notice",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(bn.prototype,"showNotice",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"showNotice"),bn.prototype),Object(re.a)(bn.prototype,"callApply",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"callApply"),bn.prototype),Object(re.a)(bn.prototype,"callEnded",[Ee.f],Object.getOwnPropertyDescriptor(bn.prototype,"callEnded"),bn.prototype),bn),Bo=["unknown","excellent","good","poor","bad","very bad","down"],zo=(uo=function(){function e(t){var r=this;Object(T.a)(this,e),Object(te.a)(this,"autoplay",lo,this),Object(te.a)(this,"remoteUsersRenderer",po,this),Object(te.a)(this,"_delay",ho,this),this.appStore=void 0,Object(te.a)(this,"networkQuality",mo,this),Object(te.a)(this,"_microphoneTrack",fo,this),Object(te.a)(this,"_cameraRenderer",vo,this),Object(te.a)(this,"_screenVideoRenderer",bo,this),this.appStore=t,this.mediaService.on("rtcStats",(function(e){r.appStore.updateCpuRate(e.cpuTotalUsage)})),this.mediaService.on("audio-device-changed",Object(E.debounce)(function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("audio device changed"),r.appStore.uiStore.addToast(A("toast.audio_equipment_has_changed")),e.next=4,r.appStore.deviceStore.init({audio:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3)),this.mediaService.on("video-device-changed",Object(E.debounce)(function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("video device changed"),r.appStore.uiStore.addToast(A("toast.video_equipment_has_changed")),e.next=4,r.appStore.deviceStore.init({video:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3)),this.mediaService.on("audio-autoplay-failed",(function(){r.autoplay||(r.autoplay=!0,r.appStore.uiStore.showAutoplayNotification())})),this.mediaService.on("watch-rtt",(function(e){r._delay=e.RTT})),this.mediaService.on("user-published",(function(e){r.remoteUsersRenderer=r.mediaService.remoteUsersRenderer,console.log("sdkwrapper update user-pubilshed")})),this.mediaService.on("user-unpublished",(function(e){r.remoteUsersRenderer=r.mediaService.remoteUsersRenderer})),this.mediaService.on("network-quality",(function(e){var t,a=+e.downlinkNetworkQuality,n=+e.uplinkNetworkQuality,o=Math.max(a,n);t=Bo[o],r.updateNetworkQuality(t||"unknown")})),this.mediaService.on("connection-state-change",(function(e){console.log("connection-state-change",JSON.stringify(e))}))}return Object(C.a)(e,[{key:"mediaService",get:function(){return this.appStore.mediaService}},{key:"delay",get:function(){return"".concat(this._delay)}},{key:"updateNetworkQuality",value:function(e){this.networkQuality=e}},{key:"reset",value:function(){this.remoteUsersRenderer=[],this.networkQuality="unknown",this.autoplay=!1}},{key:"cameraRenderer",get:function(){return this._cameraRenderer}},{key:"screenVideoRenderer",get:function(){return this._screenVideoRenderer}},{key:"openCamera",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"startWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stopWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stopNativeSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"showScreenShareWindowWithItems",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"resetRoomState",value:function(){this.remoteUsersRenderer=[],this.networkQuality="unknown",this.autoplay=!1,this._delay=0}}]),e}(),lo=Object(re.a)(uo.prototype,"autoplay",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),po=Object(re.a)(uo.prototype,"remoteUsersRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ho=Object(re.a)(uo.prototype,"_delay",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(uo.prototype,"delay",[Ee.h],Object.getOwnPropertyDescriptor(uo.prototype,"delay"),uo.prototype),mo=Object(re.a)(uo.prototype,"networkQuality",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"unknown"}}),Object(re.a)(uo.prototype,"updateNetworkQuality",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"updateNetworkQuality"),uo.prototype),fo=Object(re.a)(uo.prototype,"_microphoneTrack",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),vo=Object(re.a)(uo.prototype,"_cameraRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),bo=Object(re.a)(uo.prototype,"_screenVideoRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(re.a)(uo.prototype,"cameraRenderer",[Ee.h],Object.getOwnPropertyDescriptor(uo.prototype,"cameraRenderer"),uo.prototype),Object(re.a)(uo.prototype,"screenVideoRenderer",[Ee.h],Object.getOwnPropertyDescriptor(uo.prototype,"screenVideoRenderer"),uo.prototype),Object(re.a)(uo.prototype,"openCamera",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"openCamera"),uo.prototype),Object(re.a)(uo.prototype,"startWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"startWebSharing"),uo.prototype),Object(re.a)(uo.prototype,"stopWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"stopWebSharing"),uo.prototype),Object(re.a)(uo.prototype,"stopNativeSharing",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"stopNativeSharing"),uo.prototype),Object(re.a)(uo.prototype,"showScreenShareWindowWithItems",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"showScreenShareWindowWithItems"),uo.prototype),Object(re.a)(uo.prototype,"prepareScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"prepareScreenShare"),uo.prototype),Object(re.a)(uo.prototype,"resetRoomState",[Ee.f],Object.getOwnPropertyDescriptor(uo.prototype,"resetRoomState"),uo.prototype),uo),qo="c5fe1ae528154b5fa97f26c6c82b6575";console.log("APP_ID ",qo);var Go=(go=function(){function e(){var t=this;Object(T.a)(this,e),this.uiStore=void 0,this.boardStore=void 0,this.roomStore=void 0,this.deviceStore=void 0,this.recordingStore=void 0,this.breakoutRoomStore=void 0,this.replayStore=void 0,this.mediaStore=void 0,this.eduManager=void 0,this.userService=void 0,this._boardService=void 0,this._recordService=void 0,Object(te.a)(this,"roomInfo",yo,this),this.roomManager=void 0,this.groupClassroomManager=void 0,Object(te.a)(this,"delay",ko,this),Object(te.a)(this,"time",So,this),Object(te.a)(this,"cpuRate",_o,this),Object(te.a)(this,"waitingShare",Oo,this),Object(te.a)(this,"_screenVideoRenderer",wo,this),Object(te.a)(this,"_screenEduStream",jo,this),Object(te.a)(this,"sharing",xo,this),Object(te.a)(this,"customScreenShareWindowVisible",To,this),Object(te.a)(this,"customScreenShareItems",Co,this),this.load(),Object(Ee.g)((function(){var e=Object(Ee.r)(t);U.save("room",{roomInfo:e.roomInfo})})),this.eduManager=new vr({appId:qo,customerId:"8c9ba8213b0541c49bd9651bc71b6fc0",platform:"web",customerCertificate:"7bc716b34ecf49a5b4f2f0d05e80a00b",logLevel:"",logDirectoryPath:"",agoraRtc:$t.a,agoraRtm:Bt.a,codec:"vp8"}),this.mediaStore=new zo(this),this.uiStore=new Lt(this),this.boardStore=new Eo(this),this.recordingStore=new Vo(this),this.roomStore=new Do(this),this.deviceStore=new It(this),this.replayStore=new Wo(this),this.breakoutRoomStore=new Fo(this),this._screenVideoRenderer=void 0}return Object(C.a)(e,[{key:"boardService",get:function(){return this._boardService}},{key:"recordService",get:function(){return this._recordService}},{key:"mediaService",get:function(){return this.eduManager.mediaService}},{key:"isWeb",get:function(){return this.mediaService.sdkWrapper instanceof Ce}},{key:"isElectron",get:function(){return this.mediaService.sdkWrapper instanceof At}},{key:"load",value:function(){vr.enableDebugLog(!0);var e=U.read("room");e&&(this.roomInfo=e.roomInfo)}},{key:"userRole",get:function(){return Object(E.get)(this,"roomInfo.userRole")}},{key:"roomType",get:function(){return+Object(E.get)(this,"roomInfo.roomType",-1)}},{key:"resetRoomInfo",value:function(){this.roomInfo={}}},{key:"userUuid",get:function(){return"".concat(this.roomInfo.userName).concat(this.roomInfo.userRole)}},{key:"updateCpuRate",value:function(e){this.cpuRate=e}},{key:"updateTime",value:function(e){if(e){var t=Math.abs(Date.now()-e);this.time=t}}},{key:"resetTime",value:function(){this.time=0}},{key:"setRoomInfo",value:function(e){this.roomInfo={roomName:e.roomName,roomType:e.roomType,userName:e.userName,userRole:e.role,userUuid:"".concat(e.userName).concat(e.role)}}},{key:"stopWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.waitingShare=!0,!this._screenVideoRenderer){e.next=7;break}return e.next=5,this.mediaService.stopScreenShare();case 5:this.mediaService.screenRenderer&&this.mediaService.screenRenderer.stop(),this._screenVideoRenderer=void 0;case 7:if(!this._screenEduStream){e.next=11;break}return e.next=10,null===(t=this.roomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 10:this._screenEduStream=void 0;case 11:this.sharing=!1,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),this.uiStore.addToast(A("toast.failed_to_end_screen_sharing")+"".concat(e.t0.msg));case 17:return e.prev=17,this.waitingShare=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[0,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"startWebSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r,a,n,o,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,this.mediaService.prepareScreenShare({shareAudio:"auto",encoderConfig:"720p"});case 4:return e.next=6,null===(t=this.roomManager)||void 0===t?void 0:t.userService.startShareScreen();case 6:return i=this.roomManager.userService.screenStream.stream.streamUuid,s={channel:null===(r=this.roomManager)||void 0===r?void 0:r.roomUuid,uid:+i,token:null===(a=this.roomManager)||void 0===a?void 0:a.userService.screenStream.token},console.log("screenStreamData params >>>>>> ",JSON.stringify(s)),console.log("screenStreamData >>>>>> ",JSON.stringify(null===(n=this.roomManager)||void 0===n?void 0:n.userService.screenStream)),e.next=12,this.mediaService.startScreenShare({params:s});case 12:this._screenEduStream=null===(o=this.roomManager)||void 0===o?void 0:o.userService.screenStream.stream,this._screenVideoRenderer=this.mediaService.screenRenderer,this.sharing=!0,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),this.mediaService.screenRenderer?(this.mediaService.screenRenderer.stop(),this.mediaService.screenRenderer=void 0,this._screenVideoRenderer=void 0,this.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing_to_remote")+"".concat(e.t0.msg))):this.uiStore.addToast(A("toast.failed_to_enable_screen_sharing")+"".concat(e.t0.msg)),console.warn(e.t0);case 21:return e.prev=21,this.waitingShare=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[0,17,21,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"startOrStopSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isWeb){e.next=8;break}if(!this.sharing){e.next=6;break}return e.next=4,this.stopWebSharing();case 4:e.next=8;break;case 6:return e.next=8,this.startWebSharing();case 8:if(!this.isElectron){e.next=16;break}if(!this.sharing){e.next=14;break}return e.next=12,this.stopNativeSharing();case 12:e.next=16;break;case 14:return e.next=16,this.showScreenShareWindowWithItems();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"showScreenShareWindowWithItems",value:function(){var e=this;this.isElectron&&this.mediaService.prepareScreenShare().then((function(t){Object(Ee.p)((function(){e.customScreenShareWindowVisible=!0,e.customScreenShareItems=t}))})).catch((function(e){console.warn("show screen share window with items",e)}))}},{key:"resetWebPrepareScreen",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mediaService.screenRenderer&&(this.mediaService.screenRenderer,this._screenVideoRenderer=void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prepareScreenShare",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,r=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.mediaService.prepareScreenShare(t);case 3:e.sent,this.mediaService.screenRenderer&&(this._screenVideoRenderer=this.mediaService.screenRenderer);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"screenEduStream",get:function(){return this._screenEduStream}},{key:"stopNativeSharing",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.screenEduStream){e.next=4;break}return e.next=3,null===(t=this.roomManager)||void 0===t?void 0:t.userService.stopShareScreen();case 3:this._screenEduStream=void 0;case 4:if(!this._screenVideoRenderer){e.next=9;break}return e.next=7,this.mediaService.stopScreenShare();case 7:this._screenVideoRenderer&&this._screenVideoRenderer.stop(),this._screenVideoRenderer=void 0;case 9:this.customScreenShareWindowVisible&&(this.customScreenShareWindowVisible=!1),this.customScreenShareItems=[],this.sharing=!1;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startNativeScreenShareBy",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var r,a,n,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.waitingShare=!0,e.next=4,null===(r=this.roomManager)||void 0===r?void 0:r.userService.startShareScreen();case 4:return o=this.roomManager.userService.screenStream.stream.streamUuid,i={channel:null===(a=this.roomManager)||void 0===a?void 0:a.roomUuid,uid:+o,token:null===(n=this.roomManager)||void 0===n?void 0:n.userService.screenStream.token},e.next=8,this.mediaService.startScreenShare({windowId:t,params:i});case 8:if(this.mediaService.screenRenderer){e.next=13;break}return this.uiStore.addToast(A("create_screen_share_failed")),e.abrupt("return");case 13:this._screenVideoRenderer=this.mediaService.screenRenderer;case 14:this.removeScreenShareWindow(),this.sharing=!0,e.next=23;break;case 18:e.prev=18,e.t0=e.catch(0),console.warn(e.t0),this.waitingShare=!1,this.uiStore.addToast(A("toast.failed_to_initiate_screen_sharing")+"".concat(e.t0.msg));case 23:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeScreenShareWindow",value:function(){this.isElectron&&(this.customScreenShareWindowVisible=!1,this.customScreenShareItems=[])}},{key:"reset",value:function(){this._boardService=void 0,this._recordService=void 0,this.resetWebPrepareScreen(),this.removeScreenShareWindow()}}]),e}(),yo=Object(re.a)(go.prototype,"roomInfo",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Object(re.a)(go.prototype,"resetRoomInfo",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"resetRoomInfo"),go.prototype),ko=Object(re.a)(go.prototype,"delay",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),So=Object(re.a)(go.prototype,"time",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_o=Object(re.a)(go.prototype,"cpuRate",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(re.a)(go.prototype,"updateCpuRate",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"updateCpuRate"),go.prototype),Object(re.a)(go.prototype,"setRoomInfo",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"setRoomInfo"),go.prototype),Oo=Object(re.a)(go.prototype,"waitingShare",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wo=Object(re.a)(go.prototype,"_screenVideoRenderer",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),jo=Object(re.a)(go.prototype,"_screenEduStream",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),xo=Object(re.a)(go.prototype,"sharing",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),To=Object(re.a)(go.prototype,"customScreenShareWindowVisible",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Co=Object(re.a)(go.prototype,"customScreenShareItems",[Ee.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(re.a)(go.prototype,"stopWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"stopWebSharing"),go.prototype),Object(re.a)(go.prototype,"startWebSharing",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"startWebSharing"),go.prototype),Object(re.a)(go.prototype,"showScreenShareWindowWithItems",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"showScreenShareWindowWithItems"),go.prototype),Object(re.a)(go.prototype,"resetWebPrepareScreen",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"resetWebPrepareScreen"),go.prototype),Object(re.a)(go.prototype,"prepareScreenShare",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"prepareScreenShare"),go.prototype),Object(re.a)(go.prototype,"screenEduStream",[Ee.h],Object.getOwnPropertyDescriptor(go.prototype,"screenEduStream"),go.prototype),Object(re.a)(go.prototype,"stopNativeSharing",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"stopNativeSharing"),go.prototype),Object(re.a)(go.prototype,"startNativeScreenShareBy",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"startNativeScreenShareBy"),go.prototype),Object(re.a)(go.prototype,"removeScreenShareWindow",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"removeScreenShareWindow"),go.prototype),Object(re.a)(go.prototype,"reset",[Ee.f],Object.getOwnPropertyDescriptor(go.prototype,"reset"),go.prototype),go),Ko=Object(k.a)((function(e){return{formControl:{minWidth:"240px",maxWidth:"240px"}}})),Jo={roomName:"",roomType:0,role:"",userName:""},Yo=Lt.roomTypes;var Ho=n.a.memo((function(){document.title=A("home.short_title.title");var e=Ko(),t=Object(c.e)(),r=H(),o=Y(),i=function(e){t.push({pathname:"/setting"})},s=Object(a.useState)(!1),u=Object(b.a)(s,2),l=u[0],p=u[1],d=function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p(!0),e.next=4,vr.uploadLog("0");case 4:a=e.sent,r.showDialog({type:"feedLog",message:"id: ".concat(a)}),p(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),r.addToast(A("upload_log_failed")),p(!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),m=Object(a.useState)(Jo),k=Object(b.a)(m,2),S=k[0],O=k[1],w=Object(a.useState)({}),j=Object(b.a)(w,2),x=j[0],T=j[1];return n.a.createElement("div",{className:"flex-container ".concat(r.isElectron?"draggable":"home-cover-web")},r.isElectron?null:n.a.createElement("div",{className:"web-menu"},n.a.createElement("div",{className:"web-menu-container"},n.a.createElement("div",{className:"short-title"},n.a.createElement("span",{className:"title"},A("home.short_title.title")),n.a.createElement("span",{className:"build-version"},A("build_version"))),n.a.createElement("div",{className:"setting-container"},n.a.createElement("div",{className:"flex-row"},n.a.createElement(g.a,{title:A("icon.upload-log"),placement:"top"},n.a.createElement("span",null,n.a.createElement(N,{className:l?"icon-loading":"icon-upload",onClick:d}))),n.a.createElement(g.a,{title:A("icon.setting"),placement:"top"},n.a.createElement("span",null,n.a.createElement(N,{className:"icon-setting",onClick:i})))),n.a.createElement(K,{value:r.language.match(/^zh/)?0:1,onChange:function(e){var t=e.target.value;window.location.reload(),0===t?r.setLanguage("zh-CN"):r.setLanguage("en")},items:Lt.languages})))),n.a.createElement("div",{className:"custom-card"},n.a.createElement("div",{className:"flex-item cover"},r.isElectron?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"short-title ".concat(U.getLanguage())},n.a.createElement("span",{className:"title"},A("home.short_title.title"))),n.a.createElement("div",{className:"cover-placeholder ".concat(A("home.cover_class"))}),n.a.createElement("div",{className:"build-version"},A("build_version"))):n.a.createElement("div",{className:"cover-placeholder-web ".concat(A("home.cover_class"))})),n.a.createElement("div",{className:"flex-item card"},n.a.createElement("div",{className:"position-top card-menu"},r.isElectron&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.a,{title:A("icon.setting"),placement:"bottom"},n.a.createElement("span",null,n.a.createElement(N,{className:"icon-setting",onClick:i}))),n.a.createElement("div",{className:"icon-container"},n.a.createElement(N,{className:"icon-minimum",onClick:function(){r.windowMinimum()}}),n.a.createElement(N,{className:"icon-close",onClick:function(){r.windowClose()}})))),n.a.createElement("div",{className:"position-content flex-direction-column"},n.a.createElement(y.a,{className:e.formControl},n.a.createElement(B,{alphabetical:!0,Label:A("home.room_name"),value:S.roomName,onChange:function(e){O(Object(h.a)(Object(h.a)({},S),{},{roomName:e}))},requiredText:x.roomName})),n.a.createElement(y.a,{className:e.formControl},n.a.createElement(B,{alphabetical:!0,Label:A("home.nickname"),value:S.userName,onChange:function(e){O(Object(h.a)(Object(h.a)({},S),{},{userName:e}))},requiredText:x.userName})),n.a.createElement(y.a,{className:e.formControl},n.a.createElement(G,{Label:A("home.room_type"),value:S.roomType,onChange:function(e){O(Object(h.a)(Object(h.a)({},S),{},{roomType:e.target.value}))},items:Yo.map((function(e){return{value:e.value,text:A("".concat(e.text)),path:e.path}}))})),n.a.createElement(y.a,{className:e.formControl},n.a.createElement(L,{value:S.role,type:S.roomType,onChange:function(e){O(Object(h.a)(Object(h.a)({},S),{},{role:e.target.value}))},requiredText:x.role})),n.a.createElement(_,{name:A("home.room_join"),onClick:function(){if(S.roomName)if(S.userName)if(S.role){if(Yo[S.roomType]){o.setRoomInfo(Object(h.a)(Object(h.a)({},S),{},{roomType:Yo[S.roomType].value}));var e=Yo[S.roomType].path;"assistant"===S.role?t.push("/breakout-class/assistant/courses"):t.push("/classroom/".concat(e))}}else T(Object(h.a)(Object(h.a)({},x),{},{role:A("home.missing_role")}));else T(Object(h.a)(Object(h.a)({},x),{},{userName:A("home.missing_your_name")}));else T(Object(h.a)(Object(h.a)({},x),{},{roomName:A("home.missing_room_name")}))}})))))})),Qo=function(e){var t=Object(a.useRef)(null);return Object(a.useEffect)((function(){return t.current&&e.track&&e.track.play&&e.track.play(t.current,e.fitMode),function(){return e.track&&e.track.stop&&e.track.stop(e.preview)}}),[t,e.track,e.fitMode,e.preview]),n.a.createElement("div",{key:e.track&&e.track.videoTrack?e.track.videoTrack.getTrackId():"",id:e.id?e.id:"",className:e.className,ref:t})},Xo=Object(J.c)((function(e){H();var t=$();Object(a.useEffect)((function(){return t.init({video:!0}),t.openTestCamera(),function(){t.closeTestCamera()}}),[t]);return n.a.createElement("div",{className:"device-page-container"},n.a.createElement("div",{className:"items-columns space-between"},n.a.createElement("div",{className:"items-row camera"},n.a.createElement(M.a,{id:"camera"},"Camera"),n.a.createElement(z.a,{labelId:"camera",id:"camera",value:t.cameraId,onChange:function(e){t.changeTestCamera(e.target.value)}},t.cameraList.map((function(e,t){return n.a.createElement(q.a,{key:t,value:e.deviceId},e.label)})))),n.a.createElement("div",{className:"items-row resolution"},n.a.createElement(M.a,{id:"resolutions"},"Resolutions"),n.a.createElement(z.a,{labelId:"resolutions",id:"resolutions",value:t.resolution,onChange:function(e){t.changeTestResolution(e.target.value)}},Do.resolutions.map((function(e,t){return n.a.createElement(q.a,{key:t,value:e.value},e.name)}))))),n.a.createElement(Qo,{key:t.cameraId,id:"stream-player",track:t.cameraRenderer,preview:!0}),n.a.createElement("span",{style:{textAlign:"center"}},A("device.is_look")),n.a.createElement("div",{className:"footer"},n.a.createElement("div",{className:"button-group"},n.a.createElement("div",{className:"items-row"},n.a.createElement(_,{onClick:function(){t.setCameraTestResult("error"),t.setActiveItem("audio")},className:"unconfirm custom-button",name:A("device.no")}),n.a.createElement(_,{onClick:function(){t.setCameraTestResult("ok"),t.setActiveItem("audio")},name:A("device.yes")})))))})),Zo=(r(229),Object(k.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"},sliderRailClass:{height:"12px",color:"#44A2FC"},sliderMarkClass:{height:"12px",color:"#CCCCCC"}}));function $o(e){var t=e.totalVolumes;return n.a.createElement("div",{className:"voice-sliders"},Object(ae.a)(Array(t)).map((function(t,r){return n.a.createElement("span",{className:e.volume>r?"active":"",key:r})})))}function ei(e){var t=Zo(e),r=e.volume,a=e.totalVolumes?e.totalVolumes:52;return n.a.createElement("div",{className:t.root},e.hideIcon?null:n.a.createElement(N,{className:"icon-voice",disable:!0}),n.a.createElement($o,{totalVolumes:a,volume:r*a,className:t.sliderClass}))}var ti=function(e){return n.a.createElement("div",{className:"volume-container"},n.a.createElement(ei,{totalVolumes:e.totalVolumes,hideIcon:e.hideIcon,volume:e.volume}))},ri=Object(J.c)((function(e){var t=$();H();Object(a.useEffect)((function(){return t.init({audio:!0}),t.openTestMicrophone(),function(){t.closeTestMicrophone()}}),[t]);return n.a.createElement("div",{className:"device-page-container"},n.a.createElement("div",null,n.a.createElement("div",{className:"items-row microphone"},n.a.createElement(M.a,{id:"microphone"},"Microphone"),n.a.createElement(z.a,{labelId:"microphone",id:"microphone",value:t.microphoneId,onChange:function(e){t.changeTestMicrophone(e.target.value)}},t.microphoneList.map((function(e,t){return n.a.createElement(q.a,{key:t,value:e.deviceId},e.label)})))),n.a.createElement("div",{className:"items-row"},n.a.createElement("div",null,n.a.createElement(ti,{totalVolumes:110,hideIcon:!0,volume:t.totalVolume})))),n.a.createElement("div",null,n.a.createElement("div",{id:"microphone-player"})),n.a.createElement("div",{className:"footer"},n.a.createElement("div",{className:t.microphoneList.length>0?"microphone-icon-large":"microphone-icon-large-error"}),n.a.createElement("span",null,A("device.test_microphone")),n.a.createElement("div",{className:"button-group"},n.a.createElement("div",{className:"items-row"},n.a.createElement(_,{onClick:function(){t.setMicrophoneTestResult("error"),t.setActiveItem("speaker")},className:"unconfirm custom-button",name:"\u5426"}),n.a.createElement(_,{onClick:function(){t.setMicrophoneTestResult("ok"),t.setActiveItem("speaker")},name:"\u662f"})))))})),ai=r(682),ni=Object(k.a)({root:{display:"flex",marginTop:"8px"},sliderClass:{color:"#44A2FC",minWidth:"210px",marginLeft:"6px"}});function oi(e){var t=ni(e);return n.a.createElement("div",{className:"volume-container"},n.a.createElement("div",{className:t.root},e.hideIcon?null:n.a.createElement(N,{className:"icon-speaker",disable:!0}),n.a.createElement(ai.a,{className:e.siderClassName?e.siderClassName:t.sliderClass,value:e.volume,onChange:function(t,r){e.onChange(r)},"aria-labelledby":"continuous-slider"})))}var ii=r(661),si=Object(J.c)((function(e){var t=$(),r=(H(),Object(a.useState)(0)),o=Object(b.a)(r,2),i=o[0],s=o[1],c=Object(a.useState)(!1),u=Object(b.a)(c,2),l=u[0],p=u[1],d=Object(a.useRef)(null);Object(ii.a)((function(){if(d.current)if(l){var e=d.current.volume;s(e)}else s(0)}),300);var h=function(e){e&&(e.pause(),e.currentTime=0)};return n.a.createElement("div",{className:"device-page-container"},n.a.createElement("div",null,n.a.createElement("div",{className:"items-row"},n.a.createElement("div",null,n.a.createElement(ti,{totalVolumes:110,hideIcon:!0,volume:i})),n.a.createElement("div",null,n.a.createElement(oi,{totalVolume:255,hideIcon:!0,siderClassName:"maximum-sider",volume:t.playbackVolume,onChange:function(e){if(d.current){var r=e/100;d.current.volume=r}t.changePlaybackVolume(e)}}),"\u97f3\u91cf: ",t.playbackVolume))),n.a.createElement("div",{className:"footer"},n.a.createElement("div",{className:l?"pause-icon":"play-icon",onClick:function(){d.current&&(l?(h(d.current),p(!1)):(d.current.volume=t.playbackVolume/100,d.current.play(),p(!0)))}},n.a.createElement("audio",{id:"audio",src:"https://webdemo.agora.io/test_audio.mp3",ref:d})),n.a.createElement("span",{className:"margin-top-30"},A(l?"device.is_hear":"device.click_play")),l?n.a.createElement("div",{className:"button-group"},n.a.createElement("div",{className:"items-row"},n.a.createElement(_,{onClick:function(){d.current&&h(d.current),t.setSpeakerTestResult("error"),t.setActiveItem("test")},className:"unconfirm custom-button",name:A("device.no")}),n.a.createElement(_,{onClick:function(){d.current&&h(d.current),t.setSpeakerTestResult("ok"),t.setActiveItem("test")},name:A("device.yes")}))):null))})),ci=(r(406),Object(J.c)((function(){var e=Object(c.e)(),t=Object(c.f)(),r=(H(),$());return n.a.createElement("div",{className:"device-page-container"},n.a.createElement("div",{className:"test-box"},n.a.createElement("div",{className:"test-item"},n.a.createElement("div",{className:"camera-icon-test"}),n.a.createElement("div",{className:"text"},n.a.createElement("span",null,A("device.camera"),":"),n.a.createElement("div",{className:"ok"===r.cameraTestResult?"icon-success-test":"icon-error-test"}),n.a.createElement("span",null,r.cameraLabel))),n.a.createElement("div",{className:"test-item"},n.a.createElement("div",{className:"microphone-icon-test"}),n.a.createElement("div",{className:"text"},n.a.createElement("span",null,A("device.microphone"),":"),n.a.createElement("div",{className:"ok"===r.microphoneTestResult?"icon-success-test":"icon-error-test"}),n.a.createElement("span",null,r.microphoneLabel))),n.a.createElement("div",{className:"test-item"},n.a.createElement("div",{className:"speaker-icon-test"}),n.a.createElement("div",{className:"text"},n.a.createElement("span",null,A("device.speaker"),":"),n.a.createElement("div",{className:"ok"===r.speakerTestResult?"icon-success-test":"icon-error-test"}),n.a.createElement("span",null,r.speakerLabel)))),n.a.createElement("div",{className:"footer"},n.a.createElement("div",{className:"button-group"},n.a.createElement("div",{className:"items-row"},n.a.createElement(_,{onClick:function(){r.setActiveItem("video")},className:"unconfirm custom-button",name:A("device.test_again")}),n.a.createElement(_,{onClick:function(){r.setActiveItem("video"),"/setting"===t.pathname?e.push("/"):r.hideSetting()},name:A("device.close")})))))}))),ui=function(e){var t="test"===e.active?e.testReportTitle:e.headerTitle,r=function(t){e.onClick(t)};return n.a.createElement("div",{className:"device-menu"},n.a.createElement("div",{className:"header"},t),"test"===e.active?null:n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{onClick:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){r("video")})),className:"item link-item ".concat("video"===e.active?"active":"")},n.a.createElement("div",{className:"camera-icon"}),n.a.createElement("div",{className:"item-name"},e.cameraTitle)),n.a.createElement("a",{onClick:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){r("audio")})),className:"item link-item ".concat("audio"===e.active?"active":"")},n.a.createElement("div",{className:"microphone-icon"}),n.a.createElement("div",{className:"item-name"},e.microphoneTitle)),n.a.createElement("a",{onClick:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){r("speaker")})),className:"item link-item ".concat("speaker"===e.active?"active":"")},n.a.createElement("div",{className:"speaker-icon"}),n.a.createElement("div",{className:"item-name"},e.speakerTitle))))},li=function(e){var t=H(),r=$(),a=Object(c.f)(),o=Object(c.e)();return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"device-view"},t.isWeb&&n.a.createElement("div",{className:"web-menu-position-top"},n.a.createElement(N,{className:"icon-close",onClick:function(){"/setting"===a.pathname?o.push("/"):r.hideSetting()}})),t.isElectron&&n.a.createElement("div",{className:"electron-menu-position-top"},n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"icon-container"},n.a.createElement(N,{className:"icon-minimum",onClick:function(){t.windowMinimum()}}),n.a.createElement(N,{className:"icon-close",onClick:function(){o.push("/")}})))),"video"===e.active&&n.a.createElement(Xo,null),"audio"===e.active&&n.a.createElement(ri,null),"speaker"===e.active&&n.a.createElement(si,null),"test"===e.active&&n.a.createElement(ci,null)))},pi=function(e){return n.a.createElement("div",{className:"".concat(e.className?e.className:"")},n.a.createElement("div",{className:"device-container"},n.a.createElement(ui,{active:e.activeDeviceItem,headerTitle:A("device.detect"),cameraTitle:A("device.camera"),microphoneTitle:A("device.microphone"),speakerTitle:A("device.speaker"),testReportTitle:A("device.test_report"),onClick:e.onClick}),n.a.createElement(li,{active:e.activeDeviceItem})))},di=Object(J.c)((function(e){var t=$(),r=H();return n.a.createElement("div",{className:"flex-container ".concat(r.isElectron?"draggable":"home-cover-web")},n.a.createElement(pi,{onClick:function(e){t.setActiveItem(e)},activeDeviceItem:t.activeDeviceItem}))})),hi=Object(J.c)((function(){var e=$();return e.settingVisible?n.a.createElement(pi,{onClick:function(t){e.setActiveItem(t)},className:"internal-card",activeDeviceItem:e.activeDeviceItem}):null})),mi=(r(407),r(92)),fi=r.n(mi),vi=Object(J.c)((function(e){var t=X(),r=1===t.classState;return n.a.createElement(_,{className:"nav-button ".concat(r?"stop":"start"),name:A(r?"nav.class_end":"nav.class_start"),onClick:function(){var e=Object(v.a)(f.a.mark((function e(a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=5;break}return e.next=3,t.startClass();case 3:e.next=7;break;case 5:return e.next=7,t.stopClass();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})),bi=Object(J.c)((function(e){var t=Q(),r=1===t.classState;return n.a.createElement(_,{className:"nav-button ".concat(r?"stop":"start"),name:A(r?"nav.class_end":"nav.class_start"),onClick:function(){var e=Object(v.a)(f.a.mark((function e(a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=5;break}return e.next=3,t.startClass();case 3:e.next=7;break;case 5:return e.next=7,t.stopClass();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})),gi=function(e){return e.isBreakout?n.a.createElement(vi,null):n.a.createElement(bi,null)},yi=Object(J.c)((function(){var e=H(),t=X(),r=Object(a.useState)(!1),o=Object(b.a)(r,2),i=o[0],s=o[1],c=function(){var r=Object(v.a)(f.a.mark((function r(){var a;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,s(!0),r.next=4,vr.uploadLog(t.roomUuid);case 4:a=r.sent,e.showDialog({type:"feedLog",message:"id: ".concat(a)}),s(!1),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(0),e.addToast(A("upload_log_failed")),s(!1);case 13:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(){return r.apply(this,arguments)}}();return n.a.createElement(g.a,{title:A("icon.upload-log"),placement:"bottom"},n.a.createElement("span",null,n.a.createElement(N,{className:i?"icon-loading":"icon-upload",onClick:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})))})),ki=Object(J.c)((function(){var e=Q(),t=H(),r=Object(a.useState)(!1),o=Object(b.a)(r,2),i=o[0],s=o[1],c=function(){var r=Object(v.a)(f.a.mark((function r(){var a;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,s(!0),r.next=4,vr.uploadLog(e.roomUuid);case 4:a=r.sent,t.showDialog({type:"feedLog",message:"id: ".concat(a)}),s(!1),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(0),t.addToast(A("upload_log_failed")),s(!1);case 13:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(){return r.apply(this,arguments)}}();return n.a.createElement(g.a,{title:A("icon.upload-log"),placement:"bottom"},n.a.createElement("span",null,n.a.createElement(N,{className:i?"icon-loading":"icon-upload",onClick:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})))})),Si=function(e){return e.isBreakout?n.a.createElement(yi,null):n.a.createElement(ki,null)},_i=Object(J.c)((function(e){var t=H(),r=Y(),o=Object(a.useContext)(J.a).store.mediaStore,i=Object(c.f)(),s=r.roomInfo.userRole,u=r.roomInfo.roomName,l=o.delay,p=r.time,d=o.networkQuality,h=r.cpuRate,m=i.pathname.match(/courses/),f=i.pathname.match(/breakout/);return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"nav-container ".concat("")},n.a.createElement("div",{className:"class-title"},n.a.createElement("span",{className:"room-name"},u),"teacher"===s?n.a.createElement(gi,{isBreakout:f}):null),n.a.createElement("div",{className:"network-state"},n.a.createElement("div",null,m?null:n.a.createElement("div",{className:"nav-information"},n.a.createElement("span",null,t.isWeb?n.a.createElement("span",{className:"net-field"},A("nav.delay"),n.a.createElement("span",{className:"net-field-value"},l)):null),n.a.createElement("span",{className:"net-field net-field-container"},A("nav.network"),n.a.createElement("span",{className:"net-field-value ".concat(Mo[d]),style:{marginLeft:".2rem"}})),n.a.createElement("span",{className:"net-field net-field-container"},"curSeqId",n.a.createElement("span",{className:"net-field-value",style:{marginLeft:".2rem"}},t.curSeqId)),n.a.createElement("span",{className:"net-field net-field-container"},"lastSeqId",n.a.createElement("span",{className:"net-field-value",style:{marginLeft:".2rem"}},t.lastSeqId)),t.isElectron?n.a.createElement("span",{className:"net-field"},A("nav.cpu"),n.a.createElement("span",{className:"net-field-value"},h,"%")):null))),n.a.createElement("div",{className:"menu"},n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"timer"},n.a.createElement(N,{className:"icon-time",disable:!0}),n.a.createElement("span",{className:"time"},mi.utc(p).format("HH:mm:ss"))),n.a.createElement("span",{className:"menu-split"})),n.a.createElement("div",{className:"btn-group"},n.a.createElement(Si,{isBreakout:f}),n.a.createElement(g.a,{title:A("icon.exit-room"),placement:"bottom"},n.a.createElement("span",null,n.a.createElement(N,{className:"icon-exit",onClick:function(e){t.showDialog({type:"exitRoom",message:A("icon.exit-room")})}})))),t.isElectron&&n.a.createElement("div",{className:"menu-group"},n.a.createElement(N,{className:"icon-minimum",icon:!0,onClick:function(){t.windowMinimum()}}),n.a.createElement(N,{className:"icon-maximum",icon:!0,onClick:function(){t.windowMaximum()}}),n.a.createElement(N,{className:"icon-close",icon:!0,onClick:function(){t.windowClose()}})))))})),Oi=function(){return n.a.createElement(_i,null)},wi=(r(408),function(e){e.ownerName;var t=e.name,r=e.className,a=(e.windowId,e.image);return n.a.createElement("div",{className:r||""},n.a.createElement("div",{className:"screen-image"},n.a.createElement("div",{className:"content",style:{backgroundImage:"url(data:image/png;base64,".concat(a,")")}})),n.a.createElement("div",{className:"screen-meta"},t))}),ji=function(e){var t=e.title,r=e.items,a=e.windowId,o=e.selectWindow,i=e.confirm,s=e.cancel;return n.a.createElement("div",{className:"window-picker-mask"},n.a.createElement("div",{className:"window-picker"},n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"title"},t),n.a.createElement("div",{className:"cancelBtn",onClick:s})),n.a.createElement("div",{className:"screen-container"},r.map((function(e,t){return n.a.createElement("div",{className:"screen-item",key:t,onClick:function(){o(e.windowId)},onDoubleClick:i},n.a.createElement(wi,{ownerName:e.ownerName,name:e.name,className:"window-item ".concat(e.windowId===a?"active":""),windowId:e.windowId,image:e.image}))}))),n.a.createElement("div",{className:"footer"},n.a.createElement(_,{className:"share-confirm-btn",name:"start",onClick:i}))))},xi=Object(J.c)((function(){var e=Q(),t=Object(a.useState)(0),r=Object(b.a)(t,2),o=r[0],i=r[1];return e.customScreenShareWindowVisible?n.a.createElement(ji,{windowId:o,title:"Please select and click window for share",items:e.customScreenShareItems,cancel:function(){e.removeScreenShareWindow()},selectWindow:function(e){console.log("windowId",e),i(e)},confirm:function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=3;break}return console.warn("windowId is empty"),t.abrupt("return");case 3:return console.log("windowId confirm",o),t.next=6,e.startNativeScreenShareBy(o);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}):null}));function Ti(){return n.a.createElement(xi,null)}var Ci=r(683),Ei=r(675),Ui=r(284),Ri=function(e){return n.a.createElement(Ei.a,Object.assign({elevation:6,variant:"filled"},e))},Pi=r.n(Ui)()((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})),Ai=Object(J.c)((function(){Pi();var e=H();return n.a.createElement(Ci.a,{open:e.autoplayToast,onClose:function(){return e.removeAutoplayNotification()}},n.a.createElement(Ri,null,"autoplay audio failed"))})),Ii=r(663),Li=Object(k.a)((function(e){return{progress:{margin:e.spacing(2),color:"#44A2FC"},container:{position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"#ffffff",opacity:.8,zIndex:99999}}})),Ni=function(){var e=Li();return n.a.createElement("div",{className:e.container},n.a.createElement(Ii.a,{className:e.progress}))};function Mi(){return null}r(430);var Di=[{value:0,path:"one-to-one"},{value:1,path:"small-class"},{value:2,path:"big-class"}];function Vi(){return window.ipc}var Wi=Object(J.c)((function(e){var t=e.children;Object(a.useEffect)((function(){var e=Vi();return e&&e.send&&e.send("resize-window",{width:990,height:706}),function(){var e=Vi();e&&e.send&&e.send("resize-window",{width:700,height:500})}}),[Vi]);var r=H(),o=Object(c.f)(),i=Q(),s=Y(),u=Object(c.e)();Object(a.useEffect)((function(){if(s.userRole){window.history.pushState(null,document.title,window.location.href);var e=function(e){window.history.pushState(null,document.title,null),i.joined&&!r.hasDialog("exitRoom")&&r.showDialog({type:"exitRoom",message:A("icon.exit-room")})};window.addEventListener("popstate",e,!1);var t=o.pathname.split("/");t[t.length-1];return i.join().then((function(){r.addToast(A("toast.successfully_joined_the_room"))})).catch((function(e){console.warn(e.msg),r.addToast(A("toast.failed_to_join_the_room")+"".concat(JSON.stringify(e.msg)))})),function(){window.removeEventListener("popstate",e,!1)}}u.push("/")}),[]);var l=o.pathname.split("/"),p=l[l.length-1],d=Di.findIndex((function(e){return p===e.path})),h=Di[d].path;return n.a.createElement("div",{className:"classroom ".concat(h)},r.loading?n.a.createElement(Ni,null):null,n.a.createElement(Ai,null),n.a.createElement(hi,null),n.a.createElement(Ti,null),n.a.createElement(Oi,null),t)}));function Fi(e){var t=e.children;return n.a.createElement(Wi,null,t)}r(431);var Bi=function(){var e=Object(a.useRef)(!0);return Object(a.useEffect)((function(){return function(){e.current=!1}}),[]),e.current},zi=function(e,t){var r=Bi(),n=Object(a.useRef)(null);Object(a.useEffect)((function(){return n.current=setTimeout((function(){e&&r&&e()}),t),function(){n.current&&clearTimeout(n.current)}}),[n])},qi=function(e){return zi((function(){e&&e.closeToast()}),2500),n.a.createElement("div",{className:"custom-toast"},n.a.createElement("div",{className:"toast-container"},n.a.createElement("span",{className:"text"},e.message)))},Gi=Object(J.c)((function(){var e=H();return n.a.createElement("div",{className:"notice-message-container"},e.toastQueue.map((function(t,r){return n.a.createElement(qi,{message:t,key:"".concat(r).concat(t).concat(Date.now()),closeToast:function(){e.removeToast(t),console.log("close Toast",t)}})})))})),Ki=(r(432),r(433),function(e){var t=e.className,r=e.showClose,a=e.streamUuid,o=e.userUuid,i=e.account,s=e.renderer,c=e.local,u=void 0!==c&&c,l=e.role,p=e.audio,d=e.video,h=e.showControls,m=e.share,b=void 0!==m&&m,g=e.handleClickVideo,y=e.handleClickAudio,k=Q(),S=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.closeStream(o,u);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=2;break}return e.abrupt("return",y(o,u));case 2:if(!p){e.next=7;break}return e.next=5,k.muteAudio(o,u);case 5:e.next=9;break;case 7:return e.next=9,k.unmuteAudio(o,u);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=2;break}return e.abrupt("return",g(o,u));case 2:if(!d){e.next=7;break}return e.next=5,k.muteVideo(o,u);case 5:e.next=9;break;case 7:return e.next=9,k.unmuteVideo(o,u);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n.a.createElement("div",{className:"".concat(t||"agora-video-view")},r?n.a.createElement("div",{className:"icon-close",onClick:S}):null,!0===b?null:n.a.createElement("div",{className:"teacher"===l?"teacher-placeholder":"student-placeholder"}),b?n.a.createElement(Qo,{key:s&&s.videoTrack?s.videoTrack.getTrackId():"",track:s,id:a,fitMode:!0,className:"rtc-video"}):n.a.createElement(n.a.Fragment,null,s&&d?n.a.createElement(Qo,{key:s&&s.videoTrack?s.videoTrack.getTrackId():"",track:s,id:a,className:"rtc-video"}):null),i?n.a.createElement("div",{className:"video-profile"},n.a.createElement("span",{className:"account"},i),h?n.a.createElement("span",{className:"media-btn"},n.a.createElement(N,{onClick:_,className:p?"icon-speaker-on":"icon-speaker-off",data:"audio"}),n.a.createElement(N,{onClick:O,className:d?"icons-camera-unmute-s":"icons-camera-mute-s",data:"video"})):null):null)}),Ji=(r(434),function(){var e=document.querySelector(".video-marquee .agora-video-view");if(e){var t=e.clientWidth,r=document.querySelectorAll(".video-marquee .agora-video-view").length,a=document.querySelector(".video-marquee-mask");if(t&&a)if(a.clientWidth<=t*r)return!0}return!1}),Yi=Object(J.c)((function(){var e=Q(),t=e.teacherStream,r=e.studentStreams,o=Object(a.useRef)(null),i=function(e,t){e.scrollLeft+=t*e.childNodes[1].offsetWidth},s=Object(a.useRef)(!1);Object(a.useEffect)((function(){return function(){s.current=!0}}),[]);var c=Object(a.useState)(!1),u=Object(b.a)(c,2),l=u[0],p=u[1];return Object(a.useLayoutEffect)((function(){r.length&&!s.current&&p(Ji())}),[r]),Object(a.useEffect)((function(){return window.addEventListener("resize",(function(e){!s.current&&p(Ji())})),function(){window.removeEventListener("resize",(function(){}))}}),[]),n.a.createElement("div",{className:"video-marquee-container"},n.a.createElement("div",{className:"main"},n.a.createElement(Ki,Object.assign({showClose:!1,role:"teacher"},t))),n.a.createElement("div",{className:"video-marquee-mask"},n.a.createElement("div",{className:"video-marquee",ref:o},l?n.a.createElement("div",{className:"scroll-btn-group"},n.a.createElement("div",{className:"icon icon-left",onClick:function(e){i(o.current,1)}}),n.a.createElement("div",{className:"icon icon-right",onClick:function(e){i(o.current,-1)}})):null,r.map((function(e,t){return n.a.createElement(Ki,Object.assign({key:t,showClose:!1,role:"student"},e))})))))})),Hi=(r(435),function(e){var t=e.title;return n.a.createElement("div",{className:"progress-cover"},n.a.createElement("div",{className:"progress"},n.a.createElement("div",{className:"content"},n.a.createElement(Ii.a,{className:"circular"}),n.a.createElement("span",{className:"title"},t,"..."))))}),Qi=(n.a.memo(Hi),Object(J.c)((function(){var e=Z();return e.loadingType?n.a.createElement(Hi,{title:"converting"===e.loadingType?A("whiteboard.converting"):A("whiteboard.loading")}):null}))),Xi=r(662),Zi=Object(J.c)((function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),r=Object(a.useRef)(null),o=Object(a.useRef)(null),i=Z(),s=function(){var e=Object(v.a)(f.a.mark((function e(r){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.setTool(""),a=r.currentTarget.files[0],e.next=5,i.uploadDynamicPPT(a);case 5:return e.prev=5,t.current&&(t.current.value=""),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[0,,5,8]])})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.setTool(""),a=t.currentTarget.files[0],e.next=5,i.uploadStaticFile(a);case 5:return e.prev=5,r.current&&(r.current.value=""),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[0,,5,8]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var t=Object(v.a)(f.a.mark((function t(r){var a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.setTool(""),a=r.currentTarget.files[0],t.next=5,i.uploadImage(a);case 5:return t.prev=5,e.current&&(e.current.value=""),t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[0,,5,8]])})));return function(e){return t.apply(this,arguments)}}(),l=function(){var e=Object(v.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.setTool(""),r=t.currentTarget.files[0],e.next=5,i.uploadAudioVideo(r);case 5:return e.prev=5,o.current&&(o.current.value=""),e.finish(5);case 8:case"end":return e.stop()}}),e,null,[[0,,5,8]])})));return function(t){return e.apply(this,arguments)}}();return n.a.createElement("div",{className:"upload-btn"},n.a.createElement("div",{className:"upload-items"},n.a.createElement("label",{htmlFor:"upload-image"},n.a.createElement("div",{className:"upload-image-resource"}),n.a.createElement("div",{className:"text-container"},n.a.createElement("div",{className:"title"},A("upload_picture")),n.a.createElement("div",{className:"description"},"bmp, jpg, png, gif"))),n.a.createElement("input",{ref:e,id:"upload-image",accept:"image/*,.bmp,.jpg,.png,.gif",onChange:u,type:"file"})),n.a.createElement("div",{className:"slice-dash"}),n.a.createElement("div",{className:"upload-items"},n.a.createElement("label",{htmlFor:"upload-dynamic"},n.a.createElement("div",{className:"upload-dynamic-resource"}),n.a.createElement("div",{className:"text-container"},n.a.createElement("div",{className:"title"},A("convert_webpage")),n.a.createElement("div",{className:"description"},"pptx"))),n.a.createElement("input",{ref:t,id:"upload-dynamic",accept:".pptx",onChange:s,type:"file"})),n.a.createElement("div",{className:"slice-dash"}),n.a.createElement("div",{className:"upload-items"},n.a.createElement("label",{htmlFor:"upload-static"},n.a.createElement("div",{className:"upload-static-resource"}),n.a.createElement("div",{className:"text-container"},n.a.createElement("div",{className:"title"},A("convert_to_picture")),n.a.createElement("div",{className:"description"},"pptx, word, pdf support"))),n.a.createElement("input",{ref:r,id:"upload-static",accept:".doc,.docx,.ppt,.pptx,.pdf",onChange:c,type:"file"})),n.a.createElement("div",{className:"slice-dash"}),n.a.createElement("div",{className:"upload-items"},n.a.createElement("label",{htmlFor:"upload-video"},n.a.createElement("div",{className:"upload-static-resource"}),n.a.createElement("div",{className:"text-container"},n.a.createElement("div",{className:"title"},A("upload_audio_video")),n.a.createElement("div",{className:"description"},"mp4,mp3"))),n.a.createElement("input",{ref:o,id:"upload-video",accept:".mp4,.mp3",onChange:l,type:"file"})))})),$i=r(285),es=function(e){return n.a.createElement(g.a,{title:e.text,placement:"right"},n.a.createElement("span",null,n.a.createElement(N,{data:e.name,onClick:function(t){e.onClick(e.name)},className:"items ".concat(e.name," ").concat(e.active?"active":"")})))},ts=Object(J.c)((function(){var e=Eo.items,t=Z(),r=Q();return n.a.createElement(Xi.a,{onClickAway:function(){switch(t.selector){case"upload":t.setTool("");break;case"color_picker":t.setTool("pencil");break;case"text":t.setTool("")}}},n.a.createElement("div",{className:"tools"},n.a.createElement("div",{className:"board-tools-menu"},e.filter((function(e){return"student"!==Object(E.get)(r,"roomInfo.userRole","student")||-1===["add","upload","hand_tool"].indexOf(e.name)})).map((function(e,r){return n.a.createElement(es,{key:r,text:e.text,name:e.name,onClick:function(e){t.setTool(e)},active:t.selector===e.name})}))),t.showColorPicker?n.a.createElement($i.SketchPicker,{color:t.strokeColor,onChangeComplete:function(e){t.changeColor(e)}}):null,t.showUpload?n.a.createElement(Zi,null):null))})),rs=function(e){var t=function(t){e.onClick(e.name)};return e.text?n.a.createElement("div",{className:"control-btn control-".concat(e.name," ").concat(e.loading?"icon-loading":""),onClick:t},n.a.createElement("div",{className:"btn-icon ".concat(e.name," ").concat(e.active?"active":""),"data-name":e.name}),n.a.createElement("div",{className:"control-text"},e.text)):n.a.createElement(N,{loading:e.loading,data:e.name,onClick:t,className:"items ".concat(e.name," ").concat(e.active?"active":"")})},as=function(e){Object(ne.a)(r,e);var t=Object(oe.a)(r);function r(e){var a;return Object(T.a)(this,r),(a=t.call(this,e)).tempRuleIndex=void 0,a.syncRuleIndexTimer=null,a}return Object(C.a)(r,[{key:"delaySyncRuleIndex",value:function(){var e=this;null!==this.syncRuleIndexTimer&&(clearTimeout(this.syncRuleIndexTimer),this.syncRuleIndexTimer=null),this.syncRuleIndexTimer=setTimeout((function(){e.syncRuleIndexTimer=null,e.tempRuleIndex=void 0}),r.syncDuration)}},{key:"moveTo100",value:function(){this.tempRuleIndex=r.readRuleIndexByScale(1),this.delaySyncRuleIndex(),this.props.zoomChange(1)}},{key:"moveRuleIndex",value:function(e){void 0===this.tempRuleIndex&&(this.tempRuleIndex=r.readRuleIndexByScale(this.props.zoomScale)),this.tempRuleIndex+=e,this.tempRuleIndex>r.dividingRule.length-1?this.tempRuleIndex=r.dividingRule.length-1:this.tempRuleIndex<0&&(this.tempRuleIndex=0);var t=r.dividingRule[this.tempRuleIndex];this.delaySyncRuleIndex(),this.props.zoomChange(t)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"zoom-controls"},n.a.createElement(g.a,{title:A("zoom_control.folder"),placement:"top"},n.a.createElement("div",{className:"zoom-icon",onClick:function(){return e.props.onClick()}})),n.a.createElement("div",{className:"zoom-hold"}),n.a.createElement("div",{className:"zoom-size"},Math.ceil(100*this.props.zoomScale)," %"),n.a.createElement("div",{className:"zoom-items"},n.a.createElement("div",{className:"item zoom-in",onClick:function(){return e.moveRuleIndex(-1)}},"-"),n.a.createElement("div",{className:"item zoom-out",onClick:function(){return e.moveRuleIndex(1)}},"+")),n.a.createElement(g.a,{title:this.props.lockBoard?A("zoom_control.unlock_board"):A("zoom_control.lock_board"),placement:"top"},n.a.createElement("div",{className:"lock-board",onClick:function(){return e.props.onClickBoardLock()}})))}}],[{key:"readRuleIndexByScale",value:function(e){var t=r.dividingRule;if(e<t[0])return 0;for(var a=0;a<t.length;++a){var n=t[a-1],o=t[a],i=t[a+1],s=void 0===n?Number.MIN_SAFE_INTEGER:(n+o)/2,c=void 0===i?Number.MAX_SAFE_INTEGER:(i+o)/2;if(e>=s&&e<=c)return a}return t.length-1}}]),r}(n.a.Component);as.syncDuration=200,as.dividingRule=Object.freeze([.10737418240000011,.13421772800000012,.16777216000000014,.20971520000000016,.26214400000000015,.3276800000000002,.4096000000000002,.5120000000000001,.6400000000000001,.8,1,1.26,1.5876000000000001,2.000376,2.5204737600000002,3.1757969376000004,4.001504141376,5.041895218133761,6.352787974848539,8.00451284830916,10]);var ns=function(){return Object(c.f)().pathname.match("breakout-class")?n.a.createElement(is,null):n.a.createElement(os,null)},os=Object(J.c)((function(){var e=Z(),t=Q(),r=e.activeFooterItem,a=function(t){return e.changeFooterMenu(t)},o=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startOrStopRecording();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startOrStopSharing();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return"teacher"===t.roomInfo.userRole?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"pagination"},t.sharing?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(g.a,{title:A("control_items.first_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"first_page",active:"first_page"===r,onClick:a}))),n.a.createElement(g.a,{title:A("control_items.prev_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"prev_page",active:"prev_page"===r,onClick:a}))),n.a.createElement("div",{className:"current_page"},n.a.createElement("span",null,e.currentPage,"/",e.totalPage)),n.a.createElement(g.a,{title:A("control_items.next_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"next_page",active:"next_page"===r,onClick:a}))),n.a.createElement(g.a,{title:A("control_items.last_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"last_page",active:"last_page"===r,onClick:a}))),n.a.createElement("div",{className:"menu-split",style:{marginLeft:"7px",marginRight:"7px"}})),n.a.createElement(g.a,{title:A(t.recordId?"control_items.stop_recording":"control_items.recording"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{loading:t.recording,name:t.recording?"icon-loading ":t.recordId?"stop_recording":"recording",onClick:o,active:!1}))),n.a.createElement(g.a,{title:A(t.sharing?"control_items.quit_screen_sharing":"control_items.screen_sharing"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:t.sharing?"quit_screen_sharing":"screen_sharing",onClick:i,active:!1,text:t.sharing?"stop sharing":""})))),n.a.createElement(as,{lockBoard:e.lock,zoomScale:e.scale,onClick:function(){e.openFolder()},onClickBoardLock:function(){e.toggleLockBoard()},zoomChange:function(t){e.updateScale(t)}})):null})),is=Object(J.c)((function(){var e=Z(),t=X(),r=e.activeFooterItem,a=function(t){return e.changeFooterMenu(t)},o=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startOrStopRecording();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startOrStopSharing();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return"teacher"===t.roomInfo.userRole?n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"pagination"},t.sharing?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(g.a,{title:A("control_items.first_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"first_page",active:"first_page"===r,onClick:a}))),n.a.createElement(g.a,{title:A("control_items.prev_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"prev_page",active:"prev_page"===r,onClick:a}))),n.a.createElement("div",{className:"current_page"},n.a.createElement("span",null,e.currentPage,"/",e.totalPage)),n.a.createElement(g.a,{title:A("control_items.next_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"next_page",active:"next_page"===r,onClick:a}))),n.a.createElement(g.a,{title:A("control_items.last_page"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:"last_page",active:"last_page"===r,onClick:a}))),n.a.createElement("div",{className:"menu-split",style:{marginLeft:"7px",marginRight:"7px"}})),n.a.createElement(g.a,{title:A(t.recordId?"control_items.stop_recording":"control_items.recording"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{loading:t.recording,name:t.recording?"icon-loading ":t.recordId?"stop_recording":"recording",onClick:o,active:!1}))),n.a.createElement(g.a,{title:A(t.sharing?"control_items.quit_screen_sharing":"control_items.screen_sharing"),placement:"top"},n.a.createElement("span",null,n.a.createElement(rs,{name:t.sharing?"quit_screen_sharing":"screen_sharing",onClick:i,active:!1,text:t.sharing?"stop sharing":""})))),n.a.createElement(as,{lockBoard:e.lock,zoomScale:e.scale,onClick:function(){e.openFolder()},onClickBoardLock:function(){e.toggleLockBoard()},zoomChange:function(t){e.updateScale(t)}})):null})),ss=function(e){var t=Object(a.useState)(e.name),r=Object(b.a)(t,2);r[0],r[1];return n.a.createElement("div",{className:"item ".concat(e.activeClass?"active":"")},n.a.createElement(g.a,{title:"remove"},n.a.createElement("span",null,n.a.createElement(N,{className:"icon-delete",onClick:function(){e.onRemove()}}))),n.a.createElement("div",{className:"cover-item ".concat(e.coverType),onClick:function(){e.handleClick&&e.handleClick(e.item.rootPath)}}),n.a.createElement("span",null,n.a.createElement(D.a,{className:"title",onChange:function(e){},defaultValue:e.name})))},cs=Object(J.c)((function(){var e=Z(),t=function(t){return e.changeScenePath(t)};return e.showFolder?n.a.createElement("div",{className:"custom-netless-folder-menu"},n.a.createElement("div",{className:"menu-header"},n.a.createElement("div",{className:"menu-title"},e.menuTitle),n.a.createElement("div",{className:"menu-close",onClick:function(){return e.closeFolder()}})),n.a.createElement("div",{className:"menu-body"},n.a.createElement("div",{className:"menu-items"},e.sceneItems.map((function(r,a){return n.a.createElement(ss,{activeClass:e.activeScenePath===r.rootPath?"active":"",coverType:r.file.type.match(/ppt/)?"ppt-cover":"doc-cover",item:r,name:r.file.name,key:a+r.path+r.file.name,handleClick:t,onRemove:function(){return e.removeScenes(r.path,"/init"===r.rootPath)}})}))))):null})),us=(r(600),function(e){var t=e.type,r=e.title,a=e.onClose;return zi((function(){a&&a()}),2500),n.a.createElement("div",{className:"notice-container ".concat(t)},n.a.createElement("span",{className:"icon-".concat(t)}),n.a.createElement("span",{className:"title"},r))}),ls=Object(J.c)((function(){var e=Z();return n.a.createElement("div",{className:"upload-notice"},e.notices.map((function(t,r){return n.a.createElement(us,{key:"".concat(r).concat(t.key).concat(Date.now()),type:t.type,title:t.title,onClose:function(){return e.removeNotice(t)}})})))})),ps=(r(601),Object(J.c)((function(){var e=Z(),t=Object(a.useRef)(null),r=Object(a.useCallback)((function(t){t?e.mount(t):e.unmount()}),[t.current,e]);return n.a.createElement("div",{className:"board-container"},n.a.createElement(cs,null),n.a.createElement("div",{ref:r,className:"edu-demo-board",id:"netless-board"}),e.hasPermission?n.a.createElement(ts,null):null,n.a.createElement(ns,null),n.a.createElement(Qi,null),n.a.createElement(ls,null))}))),ds=Object(J.c)((function(e){return Z().ready?n.a.createElement(ps,null):n.a.createElement("div",{className:"board-container"})})),hs=(r(602),function(){return Object(c.f)().pathname.match("breakout-class")?n.a.createElement(fs,null):n.a.createElement(ms,null)}),ms=Object(J.c)((function(){var e=Q();return e.sharing?n.a.createElement(Ki,Object.assign({showClose:!1,role:"teacher",share:!0,className:"screen-sharing"},e.screenShareStream)):null})),fs=Object(J.c)((function(){var e=X();return e.sharing?n.a.createElement(Ki,Object.assign({showClose:!1,role:"teacher",share:!0,className:"screen-sharing"},e.screenShareStream)):null})),vs=(r(603),["unknown","teacher_role","student_role","assistant_role"]),bs=function(e){var t=e.nickname,r=e.content,a=e.link,o=e.sender,i=e.children,c=e.ref,u=e.role,l=e.className;return n.a.createElement("div",{ref:c,className:"message ".concat(o?"sent":"receive"," ").concat(l||"")},n.a.createElement("div",{className:"nickname"},!o&&u?A(vs[u]):"",t),n.a.createElement("div",{className:"content"},a?n.a.createElement(s.b,{to:"/replay/record/".concat(a),target:"_blank"},A("course_recording")):r),i||null)},gs=function(e){var t=e.nickname,r=e.roomName,a=e.content,o=e.link,i=e.sender,c=e.children,u=e.ref,l=e.role,p=e.className;return n.a.createElement("div",{ref:u,className:"message ".concat(i?"sent":"receive"," ").concat(p||"")},!i&&r&&n.a.createElement("div",{className:"roomname"},A("from_room"),r),n.a.createElement("div",{className:"nickname"},!i&&l?A(vs[l]):"",t),n.a.createElement("div",{className:"content"},o?n.a.createElement(s.b,{to:"/replay/record/".concat(o),target:"_blank"},A("course_recording")):a),c||null)},ys=(r(604),/^\s+/),ks=function(e){return e.replace(ys,"")},Ss=Object(J.c)((function(e){var t=e.messages,r=e.value,o=e.sendMessage,i=e.handleChange,s=e.muteControl,c=e.muteChat,u=e.handleMute,l=e.canChat,p=e.showRoomName,d=Object(a.useRef)(null);Object(a.useEffect)((function(){var e;(e=d.current).scrollTop=e.scrollHeight}),[t.length]);var h=Object(a.useMemo)((function(){return!l&&c}),[l,c]);return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"chat-messages-container"},n.a.createElement("div",{className:"chat-messages",ref:d},p?t.map((function(e,t){return n.a.createElement(gs,{key:t,roomName:e.fromRoomName,role:e.role,nickname:e.account,content:e.text,link:e.link,sender:e.sender})})):t.map((function(e,t){return n.a.createElement(bs,{key:t,nickname:e.account,content:e.text,role:e.role,link:e.link,sender:e.sender})})))),n.a.createElement("div",{className:"message-panel"},s?n.a.createElement("div",{className:"icon ".concat(c?"icon-chat-off":"icon-chat-on"),onClick:u}):null,n.a.createElement(D.a,{disabled:!l&&c,value:h?"":r,placeholder:A(h?"chat.banned":"chat.placeholder"),disableUnderline:!0,className:"message-input",onKeyPress:function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=7;break}if(!l&&c){e.next=7;break}if(a=ks(r),e.t0=a.length>0,!e.t0){e.next=7;break}return e.next=7,o(a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onChange:i}),n.a.createElement(_,{className:"chat-panel-btn",name:A("chat.send"),onClick:function(){var e=Object(v.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l&&c){e.next=6;break}if(a=ks(r),e.t0=a.length>0,!e.t0){e.next=6;break}return e.next=6,o(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})))}));r(605);function _s(e){var t=e.value,r=e.icon,a=e.id,o=e.type,i=e.onClick,s=function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("click",t),e.next=3,i(t,a,o);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return n.a.createElement("div",{className:"items"},n.a.createElement(N,{className:"icon-".concat(r,"-").concat(t?"on":"off"),onClick:s}))}var Os=Object(J.c)((function(e){var t=e.userRole,r=e.studentStreams,a=e.grantUsers,o=e.handleClick;return n.a.createElement("div",{className:"student-list"},r.map((function(e,r){return n.a.createElement("div",{key:r,className:"item"},n.a.createElement("div",{className:"nickname"},e.account),n.a.createElement("div",{className:"attrs-group"},"teacher"===t?n.a.createElement(_s,{type:"grantBoard",id:e.userUuid,value:a.includes(e.userUuid),icon:"connect",onClick:o}):null,n.a.createElement(_s,{type:"audio",id:e.userUuid,value:Boolean(e.audio),icon:"audio",onClick:o}),n.a.createElement(_s,{type:"video",id:e.userUuid,value:Boolean(e.video),icon:"video",onClick:o})))})))})),ws=Object(J.c)((function(e){var t=Q(),r=Object(a.useState)(""),o=Object(b.a)(r,2),i=o[0],s=o[1],c=function(){var e=Object(v.a)(f.a.mark((function e(r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendMessage(r);case 2:s("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=t.mutedChat,l=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=5;break}return e.next=3,t.unmuteChat();case 3:e.next=7;break;case 5:return e.next=7,t.muteChat();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=t.roomInfo.userRole,d=Z(),h=d.grantUsers,m=t.studentStreams,g=function(){var e=Object(v.a)(f.a.mark((function e(r,a,n){var o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(e){return t.roomInfo.userUuid===e},"teacher"!==t.roomInfo.userRole&&!o(a)){e.next=26;break}i=m.find((function(e){return e.userUuid===a})),e.t0=n,e.next="grantBoard"===e.t0?6:"audio"===e.t0?8:"video"===e.t0?17:26;break;case 6:return d.checkUserPermission(a)?d.revokeBoardPermission(a):d.grantBoardPermission(a),e.abrupt("break",26);case 8:if(!i){e.next=16;break}if(!i.audio){e.next=14;break}return e.next=12,t.muteAudio(a,o(a));case 12:e.next=16;break;case 14:return e.next=16,t.unmuteAudio(a,o(a));case 16:return e.abrupt("break",26);case 17:if(!i){e.next=25;break}if(!i.video){e.next=23;break}return e.next=21,t.muteVideo(a,o(a));case 21:e.next=25;break;case 23:return e.next=25,t.unmuteVideo(a,o(a));case 25:return e.abrupt("break",26);case 26:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}();return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"".concat(t.menuVisible?"icon-collapse-off":"icon-collapse-on"," fixed"),onClick:function(e){t.toggleMenu()}}),t.menuVisible?n.a.createElement("div",{className:"small-class chat-board"},n.a.createElement("div",{className:"menu"},n.a.createElement("div",{className:"item ".concat("chatroom"===t.activeTab?"active":""),onClick:function(){t.switchTab("chatroom")}},A("room.chat_room"),"chatroom"!==t.activeTab&&t.unreadMessageCount>0?n.a.createElement("span",{className:"message-count"},t.unreadMessageCount):null),n.a.createElement("div",{className:"item ".concat("student_list"===t.activeTab?"active":""),onClick:function(){t.switchTab("student_list")}},A("room.student_list"))),n.a.createElement("div",{className:"chat-container ".concat("chatroom"===t.activeTab?"":"hide")},n.a.createElement(Ss,{canChat:"teacher"===t.roomInfo.userRole,muteControl:t.muteControl,muteChat:t.mutedChat,handleMute:l,messages:t.roomChatMessages,value:i,sendMessage:c,handleChange:function(e){s(e.target.value)}})),n.a.createElement("div",{className:"student-container ".concat("chatroom"!==t.activeTab?"":"hide")},n.a.createElement(Os,{userRole:p,studentStreams:m,grantUsers:h,handleClick:g}))):null)}));function js(){return n.a.createElement(ws,null)}r(606);var xs=function(){return n.a.createElement("div",{className:"room-container"},n.a.createElement(Yi,null),n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"biz-container"},n.a.createElement(ds,null),n.a.createElement(hs,null)),n.a.createElement(js,null)))},Ts=(r(607),function(e){var t=X();return n.a.createElement("div",{className:"group-list"},e.rooms.map((function(e,r){return n.a.createElement("div",{key:r,className:"item"},n.a.createElement("div",{className:"field"},e.roomName,n.a.createElement("span",{className:"field"},"(",n.a.createElement("span",{className:"count"},e.memberCount),")")),n.a.createElement("div",{className:"field"},n.a.createElement("a",{onClick:function(r){var a;a=e.roomUuid,t.switchTabToRoom(a)}},A("room.show"))))})))}),Cs=Object(J.c)((function(){var e=X(),t=Object(a.useState)(""),r=Object(b.a)(t,2),o=r[0],i=r[1],s=function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[breakout] userRole",e.roomInfo.userRole),t.next=3,e.sendMessageToCurrentRoom(r);case 3:i("");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=e.mutedChat,u=e.courseList,l=function(){var t=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=5;break}return t.next=3,e.unmuteChat();case 3:t.next=7;break;case 5:return t.next=7,e.muteChat();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=(e.roomInfo.userRole,Z()),d=(p.grantUsers,Q());d.studentStreams;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"menu"},e.currentStudentRoomUuid?n.a.createElement("div",{className:"item sub-menu"},n.a.createElement("div",{className:"sub-menu-back",onClick:function(){e.resetTab()}}),n.a.createElement("span",null,e.currentStudentRoomName)):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"item ".concat("first"===e.activeTab?"active":""),onClick:function(){e.switchTab("first")}},A("room.course_list"),"first"!==e.activeTab&&e.unreadMessageCount>0?n.a.createElement("span",{className:"message-count"},e.unreadMessageCount):null),n.a.createElement("div",{className:"item ".concat("second"===e.activeTab?"active":""),onClick:function(){e.switchTab("second")}},A("room.chat_room")))),n.a.createElement("div",{className:"student-container ".concat("first"===e.activeTab?"":"hide")},n.a.createElement(Ts,{rooms:u})),n.a.createElement("div",{className:"chat-container ".concat("first"!==e.activeTab?"":"hide")},n.a.createElement(Ss,{canChat:!0,showRoomName:!e.currentStudentRoomUuid,muteControl:e.muteControl,muteChat:e.mutedChat,handleMute:l,messages:e.roomChatMessages,value:o,sendMessage:s,handleChange:function(e){i(e.target.value)}})))})),Es=Object(J.c)((function(){var e=X(),t=Object(a.useState)(""),r=Object(b.a)(t,2),o=r[0],i=r[1],s=function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendMessage(r);case 2:i("");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=(e.mutedChat,e.studentStreams),u=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=e.roomInfo.userRole,p=Z().grantUsers,d=function(){var t=Object(v.a)(f.a.mark((function t(r,a,n){var o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t){return e.roomInfo.userUuid===t},"teacher"!==e.roomInfo.userRole&&!o(a)){t.next=24;break}i=c.find((function(e){return e.userUuid===a})),t.t0=n,t.next="audio"===t.t0?6:"video"===t.t0?15:24;break;case 6:if(!i){t.next=14;break}if(!i.audio){t.next=12;break}return t.next=10,e.muteStudentAudio(a,o(a));case 10:t.next=14;break;case 12:return t.next=14,e.unmuteStudentAudio(a,o(a));case 14:return t.abrupt("break",24);case 15:if(!i){t.next=23;break}if(!i.video){t.next=21;break}return t.next=19,e.muteStudentVideo(a,o(a));case 19:t.next=23;break;case 21:return t.next=23,e.unmuteStudentVideo(a,o(a));case 23:return t.abrupt("break",24);case 24:case"end":return t.stop()}}),t)})));return function(e,r,a){return t.apply(this,arguments)}}();return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"menu"},n.a.createElement("div",{className:"item ".concat("first"===e.activeTab?"active":""),onClick:function(){e.switchTab("first")}},A("room.chat_room"),"first"!==e.activeTab&&e.unreadMessageCount>0?n.a.createElement("span",{className:"message-count"},e.unreadMessageCount):null),n.a.createElement("div",{className:"item ".concat("second"===e.activeTab?"active":""),onClick:function(){e.switchTab("second")}},A("room.student_list"))),n.a.createElement("div",{className:"chat-container ".concat("first"===e.activeTab?"":"hide")},n.a.createElement(Ss,{canChat:!1,muteControl:!1,muteChat:e.mutedChat,handleMute:u,messages:e.roomChatMessages,value:o,sendMessage:s,handleChange:function(e){i(e.target.value)}})),n.a.createElement("div",{className:"student-container ".concat("first"!==e.activeTab?"":"hide")},n.a.createElement(Os,{userRole:l,studentStreams:c,grantUsers:p,handleClick:d})))})),Us=Object(J.c)((function(){var e=X(),t=Object(a.useState)(""),r=Object(b.a)(t,2),o=r[0],i=r[1],s=function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendMessageToCurrentRoom(r);case 2:i("");case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=e.mutedChat,u=e.studentStreams,l=function(){var t=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=5;break}return t.next=3,e.unmuteChat();case 3:t.next=7;break;case 5:return t.next=7,e.muteChat();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=e.roomInfo.userRole,d=Z(),h=d.grantUsers,m=function(){var t=Object(v.a)(f.a.mark((function t(r,a,n){var o,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=function(t){return e.roomInfo.userUuid===t},"assistant"!==e.roomInfo.userRole&&!o(a)){t.next=26;break}i=u.find((function(e){return e.userUuid===a})),t.t0=n,t.next="grantBoard"===t.t0?6:"audio"===t.t0?8:"video"===t.t0?17:26;break;case 6:return d.checkUserPermission(a)?d.revokeBoardPermission(a):d.grantBoardPermission(a),t.abrupt("break",26);case 8:if(!i){t.next=16;break}if(!i.audio){t.next=14;break}return t.next=12,e.muteStudentAudio(a,!1);case 12:t.next=16;break;case 14:return t.next=16,e.unmuteStudentAudio(a,!1);case 16:return t.abrupt("break",26);case 17:if(!i){t.next=25;break}if(!i.video){t.next=23;break}return t.next=21,e.muteStudentVideo(a,!1);case 21:t.next=25;break;case 23:return t.next=25,e.unmuteStudentVideo(a,!1);case 25:return t.abrupt("break",26);case 26:case"end":return t.stop()}}),t)})));return function(e,r,a){return t.apply(this,arguments)}}();return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"menu"},n.a.createElement("div",{className:"item ".concat("first"===e.activeTab?"active":""),onClick:function(){e.switchTab("first")}},A("room.chat_room"),"first"!==e.activeTab&&e.unreadMessageCount>0?n.a.createElement("span",{className:"message-count"},e.unreadMessageCount):null),n.a.createElement("div",{className:"item ".concat("second"===e.activeTab?"active":""),onClick:function(){e.switchTab("second")}},A("room.student_list"))),n.a.createElement("div",{className:"chat-container ".concat("first"===e.activeTab?"":"hide")},n.a.createElement(Ss,{canChat:"assistant"===e.roomInfo.userRole,muteControl:e.muteControl,muteChat:e.mutedChat,handleMute:l,messages:e.roomChatMessages,value:o,sendMessage:s,handleChange:function(e){i(e.target.value)}})),n.a.createElement("div",{className:"student-container ".concat("first"!==e.activeTab?"":"hide")},n.a.createElement(Os,{userRole:p,studentStreams:u,grantUsers:h,handleClick:m})))})),Rs=Object(J.c)((function(e){var t=X().roomInfo.userRole;return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"small-class chat-board"},"teacher"===t&&n.a.createElement(Cs,null),"student"===t&&n.a.createElement(Es,null),"assistant"===t&&n.a.createElement(Us,null)))}));function Ps(){return n.a.createElement(Rs,null)}r(608);var As=function(){var e=Object(c.e)(),t=X(),r=function(){var r=Object(v.a)(f.a.mark((function r(){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.leaveCourse();case 2:e.push("/breakout-class/assistant/courses");case 3:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return n.a.createElement("div",{className:"back-button"},n.a.createElement("div",{className:"item",onClick:r},"\u8fd4\u56de"))},Is=Object(J.c)((function(){var e=X(),t=(e.mutedChat,e.muteControl,e.teacherStream),r=e.studentStreams,o=(e.roomInfo,Object(a.useState)("")),i=Object(b.a)(o,2);i[0],i[1];return n.a.createElement("div",{className:"super-small-class room-container"},n.a.createElement("div",{className:"room-container"},n.a.createElement("div",{className:"live-container"},n.a.createElement("div",{className:"biz-container"},"assistant"===e.roomInfo.userRole&&n.a.createElement(As,null),n.a.createElement(ds,null),n.a.createElement(hs,null)),n.a.createElement("div",{className:"super-container"},n.a.createElement("div",{className:"small-video"},r.map((function(t,r){return n.a.createElement(Ki,Object.assign({key:r,showClose:!1,role:"student"},t,{handleClickAudio:function(){var r=Object(v.a)(f.a.mark((function r(a,n){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.audio){r.next=5;break}return r.next=3,e.muteStudentAudio(a,n);case 3:r.next=7;break;case 5:return r.next=7,e.unmuteStudentAudio(a,n);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),handleClickVideo:function(){var r=Object(v.a)(f.a.mark((function r(a,n){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.video){r.next=5;break}return r.next=3,e.muteStudentVideo(a,n);case 3:r.next=7;break;case 5:return r.next=7,e.unmuteStudentVideo(a,n);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()}))})))))),n.a.createElement("div",{className:"live-board"},n.a.createElement("div",{className:"video-board"},n.a.createElement(Ki,Object.assign({role:"teacher",showClose:!1},t,{handleClickAudio:function(){var r=Object(v.a)(f.a.mark((function r(a,n){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.audio){r.next=5;break}return r.next=3,e.muteAudio(a,n,"teacher");case 3:r.next=7;break;case 5:return r.next=7,e.unmuteAudio(a,n,"teacher");case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),handleClickVideo:function(){var r=Object(v.a)(f.a.mark((function r(a,n){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.video){r.next=5;break}return r.next=3,e.muteVideo(a,n,"teacher");case 3:r.next=7;break;case 5:return r.next=7,e.unmuteVideo(a,n,"teacher");case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()}))),n.a.createElement(Ps,null)))}));function Ls(){return window.ipc}var Ns=Object(J.c)((function(e){var t=e.children;Object(a.useEffect)((function(){var e=Ls();return e&&e.send&&e.send("resize-window",{width:990,height:706}),function(){var e=Ls();e&&e.send&&e.send("resize-window",{width:700,height:500})}}),[Ls]);var r=H(),o=(Object(c.f)(),X()),i=Y(),s=Object(c.e)(),u=Object(c.g)().course_name;return console.log("params",u),Object(a.useEffect)((function(){if(i.userRole){window.history.pushState(null,document.title,window.location.href);return u||o.join().then((function(){r.addToast(A("toast.successfully_joined_the_room"))})).catch((function(e){console.warn(e.msg),r.addToast(A("toast.failed_to_join_the_room")+"".concat(JSON.stringify(e.msg)))})),u&&o.assistantJoinRoom(u).then((function(){r.addToast(A("toast.successfully_joined_the_room"))})).catch((function(e){console.warn(e.msg),r.addToast(A("toast.failed_to_join_the_room")+"".concat(JSON.stringify(e.msg)))})),function(){}}s.push("/")}),[]),n.a.createElement("div",{className:"classroom breakout-class"},r.loading?n.a.createElement(Ni,null):null,n.a.createElement(Ai,null),n.a.createElement(hi,null),n.a.createElement(Ti,null),n.a.createElement(Oi,null),t)})),Ms=function(){return n.a.createElement(Ns,null,n.a.createElement(Is,null))},Ds=function(e){return n.a.createElement("div",{className:"chat-board"},e.name?n.a.createElement("div",{className:"chat-roomname"},e.name,e.messageCount?"(".concat(e.messageCount,")"):null):null,n.a.createElement(Ss,{canChat:e.canChat,muteChat:e.muteChat,muteControl:e.muteControl,messages:e.messages,value:e.value,handleMute:e.handleMute,sendMessage:e.sendMessage,handleChange:e.handleChange}))},Vs=Object(J.c)((function(){var e=Q(),t=e.teacherStream,r=e.studentStreams,o=(e.roomInfo,e.mutedChat),i=e.muteControl,s=function(){var t=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o){t.next=5;break}return t.next=3,e.unmuteChat();case 3:t.next=7;break;case 5:return t.next=7,e.muteChat();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),c=Object(a.useState)(""),u=Object(b.a)(c,2),l=u[0],p=u[1],d=function(){var t=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendMessage(l);case 2:p("");case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return n.a.createElement("div",{className:"room-container"},n.a.createElement("div",{className:"biz-container"},n.a.createElement(ds,null),n.a.createElement(hs,null)),n.a.createElement("div",{className:"live-board"},n.a.createElement("div",{className:"video-board"},n.a.createElement(Ki,Object.assign({showClose:!1,role:"teacher"},t)),r[0]?n.a.createElement(Ki,Object.assign({showClose:!1,role:"student"},r[0])):n.a.createElement(Ki,{userUuid:"",streamUuid:"",showClose:!1,account:"student",renderer:{},local:!1,role:"student",video:!1,audio:!1,showControls:!1})),n.a.createElement(Ds,{canChat:"teacher"===e.roomInfo.userRole,messages:e.roomChatMessages,value:l,sendMessage:d,handleChange:function(e){p(e.target.value)},messageCount:e.unreadMessageCount,muteControl:i,muteChat:o,handleMute:s})))})),Ws=(r(609),Object(J.c)((function(){var e=Q(),t=e.mutedChat,r=e.muteControl,o=e.teacherStream,i=e.studentStreams,s=e.roomInfo,c=Object(a.useState)(""),u=Object(b.a)(c,2),l=u[0],p=u[1],d=function(){var t=Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendMessage(l);case 2:p("");case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var r=Object(v.a)(f.a.mark((function r(){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=5;break}return r.next=3,e.unmuteChat();case 3:r.next=7;break;case 5:return r.next=7,e.muteChat();case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),m=function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("hands_up"!==r){t.next=3;break}return t.next=3,e.callApply();case 3:if("hands_up_end"!==r){t.next=6;break}return t.next=6,e.callEnded();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return n.a.createElement("div",{className:"room-container"},n.a.createElement("div",{className:"live-container"},n.a.createElement("div",{className:"biz-container"},n.a.createElement(ds,null),n.a.createElement(hs,null),n.a.createElement("div",{className:"interactive ".concat(e.roomInfo.userRole)},"teacher"===e.roomInfo.userRole&&e.notice?n.a.createElement(rs,{name:e.notice.reason,onClick:function(){},active:!!e.notice.reason}):null,"teacher"!==e.roomInfo.userRole?n.a.createElement(rs,{name:e.cameraEduStream?"hands_up_end":"hands_up",onClick:m,active:!1,text:""}):null)),n.a.createElement("div",{className:"video-container"},i.map((function(e,t){return n.a.createElement(Ki,Object.assign({key:t,showClose:"teacher"===s.userRole||s.userUuid===e.userUuid,role:"student"},e))})))),n.a.createElement("div",{className:"live-board"},n.a.createElement("div",{className:"video-board"},n.a.createElement(Ki,Object.assign({role:"teacher",showClose:!1},o))),n.a.createElement(Ds,{name:e.roomInfo.roomName,canChat:"teacher"===e.roomInfo.userRole,messages:e.roomChatMessages,mute:e.mutedChat,value:l,messageCount:e.userList.length,sendMessage:d,muteControl:r,muteChat:t,handleMute:h,handleChange:function(e){p(e.target.value)}})))}))),Fs=r(677),Bs=r(664),zs=r(665);r(610);function qs(e){var t=e.onConfirm,r=e.onClose,a=e.dialogId,o=e.dialogMessage,i=H(),s=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(o.type);case 2:i.removeDialog(a);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(o.type);case 2:i.removeDialog(a);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n.a.createElement("div",null,n.a.createElement(Fs.a,{disableBackdropClick:!0,open:!0,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.a.createElement(Bs.a,{className:"modal-container"},n.a.createElement(zs.a,{className:"dialog-title"},o.message),n.a.createElement("div",{className:"button-group"},n.a.createElement(_,{name:A("toast.confirm"),className:"confirm",onClick:c,color:"primary"}),n.a.createElement(_,{name:A("toast.cancel"),className:"cancel",onClick:s,color:"primary"})))))}var Gs=Object(J.c)((function(){var e=Q(),t=X(),r=H(),a=Object(c.e)(),o=Object(c.f)(),i=function(){var t=Object(v.a)(f.a.mark((function t(r){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("apply"!==r){t.next=3;break}return t.next=3,e.teacherRejectApply();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),s=function(){var r=Object(v.a)(f.a.mark((function r(n){return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("exitRoom"!==n){r.next=11;break}if(!o.pathname.match(/breakout/)){r.next=6;break}return r.next=4,t.leave();case 4:r.next=8;break;case 6:return r.next=8,e.leave();case 8:a.push("/"),r.next=17;break;case 11:if("apply"!==n){r.next=16;break}return r.next=14,e.teacherAcceptApply();case 14:r.next=17;break;case 16:case 17:return r.abrupt("return");case 18:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return n.a.createElement(n.a.Fragment,null,r.dialogs.map((function(e){return n.a.createElement(qs,{key:e.id,dialogId:e.id,dialogMessage:e.dialog,onClose:i,onConfirm:s})})))})),Ks=(r(611),r(612),Object(J.c)((function(){var e=ee();return e.player&&e.firstFrame?e.phase!==yr.PlayerPhase.Playing?n.a.createElement("div",{className:"player-cover"},e.phase===yr.PlayerPhase.Buffering?n.a.createElement(Hi,{title:A("replay.loading")}):null,e.phase===yr.PlayerPhase.Pause||e.phase===yr.PlayerPhase.Ended||e.phase===yr.PlayerPhase.WaitingFirstFrame?n.a.createElement("div",{className:"play-btn",onClick:function(){return e.handlePlayerClick()}}):null):null:n.a.createElement(Hi,{title:A("replay.loading")})}))),Js=Object(J.c)((function(){var e=Object(c.f)(),t=Object(c.g)().roomUuid,r=(new URLSearchParams(e.search),ee()),o=Object(a.useRef)(null);!function(e,t){var r=Bi(),n=Object(a.useRef)(null);Object(a.useEffect)((function(){return n.current=setInterval((function(){e&&r&&e()}),t),function(){n.current&&clearInterval(n.current)}}),[n])}((function(){r.getCourseRecordBy(t)}),2500),Object(a.useEffect)((function(){o.current&&2===r.recordStatus&&r.mediaUrl&&r.replay(o.current)}),[r.recordStatus,o.current,r.mediaUrl]);return n.a.createElement("div",{className:"replay"},n.a.createElement("div",{className:"player-container"},n.a.createElement(Ks,null),n.a.createElement("div",{className:"player"},n.a.createElement("div",{className:"agora-log"}),n.a.createElement("div",{ref:o,id:"whiteboard",className:"whiteboard"}),n.a.createElement("div",{className:"video-menu"},n.a.createElement("div",{className:"control-btn"},n.a.createElement("div",{className:"btn ".concat(r.player&&r.phase===yr.PlayerPhase.Playing?"paused":"play"),onClick:function(){r.handlePlayerClick()}})),n.a.createElement("div",{className:"progress"},n.a.createElement(ai.a,{className:"custom-video-progress",value:r.currentTime,onMouseDown:function(){r.pauseCurrentTime()},onMouseUp:function(){r.seekToCurrentTime()},onChange:function(e,t){r.updateProgress(t)},onTouchStart:function(){r.pauseCurrentTime()},onTouchEnd:function(){r.seekToCurrentTime()},min:0,max:r.duration,"aria-labelledby":"continuous-slider"}),n.a.createElement("div",{className:"time"},n.a.createElement("div",{className:"current_duration"},fi()(r.currentTime).format("mm:ss")),"/",n.a.createElement("div",{className:"video_duration"},fi()(r.totalTime).format("mm:ss"))))))),n.a.createElement("div",{className:"video-container"},n.a.createElement("div",{className:"video-player"},n.a.createElement("video",{id:"white-sdk-video-js",className:"video-js video-layout",style:{width:"100%",height:"100%",objectFit:"cover"}})),n.a.createElement("div",{className:"chat-holder chat-board chat-messages-container"})))})),Ys=Object(J.c)((function(e){var t=H();return t.isElectron?n.a.createElement("div",{className:"replay-page-wrapper"},n.a.createElement("div",{className:"nav-container menu-nav ".concat("")},n.a.createElement("div",{className:"menu-nav-right"},t.isElectron&&n.a.createElement("div",{className:"menu-group"},n.a.createElement(N,{className:"icon-minimum",icon:!0,onClick:function(){t.windowMinimum()}}),n.a.createElement(N,{className:"icon-maximum",icon:!0,onClick:function(){t.windowMaximum()}}),n.a.createElement(N,{className:"icon-close",icon:!0,onClick:function(){t.windowClose()}})))),e.children):e.children})),Hs=function(){return n.a.createElement(Ys,null,n.a.createElement(Js,null))},Qs=(r(613),r(666)),Xs=r(667),Zs=r(668),$s=r(669),ec=r(670),tc=r(671),rc=r(672),ac=Object(k.a)((function(e){return Object(Qs.a)({table:{minWidth:350},root:{"& > *":{margin:e.spacing(1)}}})})),nc=Object(J.c)((function(e){var t=H();return n.a.createElement("div",{className:"classroom breakout-class"},t.loading?n.a.createElement(Ni,null):null,n.a.createElement(Ai,null),n.a.createElement(Oi,null),n.a.createElement(oc,null))})),oc=Object(J.c)((function(){var e=ac(),t=H(),r=X(),o=Object(c.e)(),i=Object(c.g)().course_name;return Object(a.useEffect)((function(){window.history.pushState(null,document.title,window.location.href);i?r.assistantJoinRoom(i):r.loginAsAssistant()}),[]),n.a.createElement("div",{className:"room-container"},n.a.createElement("div",{className:"assistant-box"},0!==r.courseList.length?n.a.createElement("div",{className:"assistant-table"},n.a.createElement("div",{className:"table-title"},A("assistant.classList")),n.a.createElement(Xs.a,null,n.a.createElement(Zs.a,{className:e.table,"aria-label":"simple table"},n.a.createElement($s.a,null,n.a.createElement(ec.a,{className:"table-head"},n.a.createElement(tc.a,null,A("assistant.className")),n.a.createElement(tc.a,{align:"center"},A("assistant.creatTime")),n.a.createElement(tc.a,{align:"right"},A("assistant.operation")))),n.a.createElement(rc.a,null,r.courseList.map((function(e){return n.a.createElement(ec.a,{key:e.roomUuid},n.a.createElement(tc.a,{component:"th",scope:"row"},e.roomName),n.a.createElement(tc.a,{align:"center"},mi.utc(e.createTime).local().format("HH:mm:ss")),n.a.createElement(tc.a,{align:"right"},n.a.createElement("a",{style:{cursor:"pointer"},onClick:function(t){r.roomInfo.groupName=e.roomName,o.push("/breakout-class/assistant/courses/".concat(e.roomUuid))}},A("assistant.enterClassRoom"))))})))))):n.a.createElement("div",{className:"data-null"},n.a.createElement("div",{className:"null-box"}),n.a.createElement("div",{className:"null-text"},A("assistant.data_null_text")),n.a.createElement("div",{className:"null-btn"},n.a.createElement("div",{className:"refresh-btn"},n.a.createElement(S.a,{variant:"outlined",onClick:function(){window.location.reload()}},A("assistant.refresh"))),n.a.createElement("div",{className:"exit-btn"},n.a.createElement(S.a,{variant:"outlined",onClick:function(){t.showDialog({type:"exitRoom",message:A("icon.exit-room")})}},A("assistant.exit")))))))})),ic=new Go;window.store=ic;var sc=function(){return n.a.createElement(J.b,{store:ic},n.a.createElement(d,null,n.a.createElement(s.a,null,n.a.createElement(Mi,null),n.a.createElement(Gi,null),n.a.createElement(Gs,null),n.a.createElement(c.a,{path:"/setting"},n.a.createElement(di,null)),n.a.createElement(c.a,{exact:!0,path:"/classroom/one-to-one"},n.a.createElement(Fi,null,n.a.createElement(Vs,null))),n.a.createElement(c.a,{exact:!0,path:"/classroom/small-class"},n.a.createElement(Fi,null,n.a.createElement(xs,null))),n.a.createElement(c.a,{exact:!0,path:"/classroom/big-class"},n.a.createElement(Fi,null,n.a.createElement(Ws,null))),n.a.createElement(c.a,{exact:!0,path:"/breakout-class/assistant/courses/:course_name"},n.a.createElement(Ms,null)),n.a.createElement(c.a,{exact:!0,path:"/breakout-class/assistant/courses"},n.a.createElement(nc,null)),n.a.createElement(c.a,{exact:!0,path:"/classroom/breakout-class"},n.a.createElement(Ms,null)),n.a.createElement(c.a,{path:"/replay/record/:roomUuid"},n.a.createElement(Hs,null)),n.a.createElement(c.a,{exact:!0,path:"/"},n.a.createElement(Ho,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var cc=r(286),uc=r.n(cc),lc=r(287),pc=r.n(lc),dc=(new W.a).getResult();if(Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_GTM_ID&&uc.a.initialize({gtmId:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_AGORA_APP_ID:"c5fe1ae528154b5fa97f26c6c82b6575",REACT_APP_AGORA_APP_SDK_DOMAIN:"https://api.agora.io",REACT_APP_AGORA_APP_SDK_LOG_SECRET:"agora_edu_sdk_log_secret",REACT_APP_AGORA_CUSTOMER_CERTIFICATE:"7bc716b34ecf49a5b4f2f0d05e80a00b",REACT_APP_AGORA_CUSTOMER_ID:"8c9ba8213b0541c49bd9651bc71b6fc0",REACT_APP_AGORA_LOG:"true",REACT_APP_AGORA_RESTFULL_TOKEN:"006c5fe1ae528154b5fa97f26c6c82b6575IACRSgeLXSRfZAkTKJ+8mlVPG3jpryuILoa2eBzIAlsiPVyuMdgAAAAAEAAdwi3R4ORDYAEAAQDg5ENg",REACT_APP_BUILD_VERSION:"0.0.1",REACT_APP_NETLESS_APP_ID:"LsRUYHjjEeupHKU5Pcts9Q/QtSAHW64LS3OWw",REACT_APP_RUNTIME_PLATFORM:"web",REACT_APP_YOUR_BACKEND_WHITEBOARD_API:"https://api.agora.io/edu/v1/apps/%app_id%/room/%room_id%/board",REACT_APP_YOUR_OWN_OSS_BUCKET_FOLDER:"your_oss_bucket_folder",REACT_APP_YOUR_OWN_OSS_BUCKET_KEY:"your_bucket_ak",REACT_APP_YOUR_OWN_OSS_BUCKET_NAME:"your_oss_bucket_name",REACT_APP_YOUR_OWN_OSS_BUCKET_REGION:"your_bucket_region",REACT_APP_YOUR_OWN_OSS_BUCKET_SECRET:"your_bucket_sk",REACT_APP_YOUR_OWN_OSS_CDN_ACCELERATE:"your_cdn_accelerate_endpoint"}).REACT_APP_AGORA_GTM_ID}),i.a.render(n.a.createElement(sc,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})),"mobile"===dc.device.type){var hc=document.createElement("div");document.body.appendChild(hc),pc.a.init({container:hc,tool:["console","elements"]})}}},[[304,1,2]]]);
//# sourceMappingURL=main.3f6f4c77.chunk.js.map